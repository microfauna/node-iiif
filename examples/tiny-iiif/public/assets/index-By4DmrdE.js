function DN(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function Yl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ON(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var R0={exports:{}},tl={},_0={exports:{}},St={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IT;function NN(){if(IT)return St;IT=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),d=Symbol.iterator;function h(q){return q===null||typeof q!="object"?null:(q=d&&q[d]||q["@@iterator"],typeof q=="function"?q:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,v={};function y(q,re,z){this.props=q,this.context=re,this.refs=v,this.updater=z||p}y.prototype.isReactComponent={},y.prototype.setState=function(q,re){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,re,"setState")},y.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function b(){}b.prototype=y.prototype;function T(q,re,z){this.props=q,this.context=re,this.refs=v,this.updater=z||p}var x=T.prototype=new b;x.constructor=T,g(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray,A=Object.prototype.hasOwnProperty,R={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function D(q,re,z){var ve,Le={},Ce=null,Ae=null;if(re!=null)for(ve in re.ref!==void 0&&(Ae=re.ref),re.key!==void 0&&(Ce=""+re.key),re)A.call(re,ve)&&!_.hasOwnProperty(ve)&&(Le[ve]=re[ve]);var ke=arguments.length-2;if(ke===1)Le.children=z;else if(1<ke){for(var je=Array(ke),We=0;We<ke;We++)je[We]=arguments[We+2];Le.children=je}if(q&&q.defaultProps)for(ve in ke=q.defaultProps,ke)Le[ve]===void 0&&(Le[ve]=ke[ve]);return{$$typeof:n,type:q,key:Ce,ref:Ae,props:Le,_owner:R.current}}function H(q,re){return{$$typeof:n,type:q.type,key:re,ref:q.ref,props:q.props,_owner:q._owner}}function P(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function N(q){var re={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(z){return re[z]})}var G=/\/+/g;function X(q,re){return typeof q=="object"&&q!==null&&q.key!=null?N(""+q.key):re.toString(36)}function te(q,re,z,ve,Le){var Ce=typeof q;(Ce==="undefined"||Ce==="boolean")&&(q=null);var Ae=!1;if(q===null)Ae=!0;else switch(Ce){case"string":case"number":Ae=!0;break;case"object":switch(q.$$typeof){case n:case e:Ae=!0}}if(Ae)return Ae=q,Le=Le(Ae),q=ve===""?"."+X(Ae,0):ve,w(Le)?(z="",q!=null&&(z=q.replace(G,"$&/")+"/"),te(Le,re,z,"",function(We){return We})):Le!=null&&(P(Le)&&(Le=H(Le,z+(!Le.key||Ae&&Ae.key===Le.key?"":(""+Le.key).replace(G,"$&/")+"/")+q)),re.push(Le)),1;if(Ae=0,ve=ve===""?".":ve+":",w(q))for(var ke=0;ke<q.length;ke++){Ce=q[ke];var je=ve+X(Ce,ke);Ae+=te(Ce,re,z,je,Le)}else if(je=h(q),typeof je=="function")for(q=je.call(q),ke=0;!(Ce=q.next()).done;)Ce=Ce.value,je=ve+X(Ce,ke++),Ae+=te(Ce,re,z,je,Le);else if(Ce==="object")throw re=String(q),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.");return Ae}function Q(q,re,z){if(q==null)return q;var ve=[],Le=0;return te(q,ve,"","",function(Ce){return re.call(z,Ce,Le++)}),ve}function ne(q){if(q._status===-1){var re=q._result;re=re(),re.then(function(z){(q._status===0||q._status===-1)&&(q._status=1,q._result=z)},function(z){(q._status===0||q._status===-1)&&(q._status=2,q._result=z)}),q._status===-1&&(q._status=0,q._result=re)}if(q._status===1)return q._result.default;throw q._result}var oe={current:null},Z={transition:null},se={ReactCurrentDispatcher:oe,ReactCurrentBatchConfig:Z,ReactCurrentOwner:R};function j(){throw Error("act(...) is not supported in production builds of React.")}return St.Children={map:Q,forEach:function(q,re,z){Q(q,function(){re.apply(this,arguments)},z)},count:function(q){var re=0;return Q(q,function(){re++}),re},toArray:function(q){return Q(q,function(re){return re})||[]},only:function(q){if(!P(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},St.Component=y,St.Fragment=t,St.Profiler=r,St.PureComponent=T,St.StrictMode=i,St.Suspense=l,St.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=se,St.act=j,St.cloneElement=function(q,re,z){if(q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+q+".");var ve=g({},q.props),Le=q.key,Ce=q.ref,Ae=q._owner;if(re!=null){if(re.ref!==void 0&&(Ce=re.ref,Ae=R.current),re.key!==void 0&&(Le=""+re.key),q.type&&q.type.defaultProps)var ke=q.type.defaultProps;for(je in re)A.call(re,je)&&!_.hasOwnProperty(je)&&(ve[je]=re[je]===void 0&&ke!==void 0?ke[je]:re[je])}var je=arguments.length-2;if(je===1)ve.children=z;else if(1<je){ke=Array(je);for(var We=0;We<je;We++)ke[We]=arguments[We+2];ve.children=ke}return{$$typeof:n,type:q.type,key:Le,ref:Ce,props:ve,_owner:Ae}},St.createContext=function(q){return q={$$typeof:a,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},q.Provider={$$typeof:s,_context:q},q.Consumer=q},St.createElement=D,St.createFactory=function(q){var re=D.bind(null,q);return re.type=q,re},St.createRef=function(){return{current:null}},St.forwardRef=function(q){return{$$typeof:o,render:q}},St.isValidElement=P,St.lazy=function(q){return{$$typeof:c,_payload:{_status:-1,_result:q},_init:ne}},St.memo=function(q,re){return{$$typeof:u,type:q,compare:re===void 0?null:re}},St.startTransition=function(q){var re=Z.transition;Z.transition={};try{q()}finally{Z.transition=re}},St.unstable_act=j,St.useCallback=function(q,re){return oe.current.useCallback(q,re)},St.useContext=function(q){return oe.current.useContext(q)},St.useDebugValue=function(){},St.useDeferredValue=function(q){return oe.current.useDeferredValue(q)},St.useEffect=function(q,re){return oe.current.useEffect(q,re)},St.useId=function(){return oe.current.useId()},St.useImperativeHandle=function(q,re,z){return oe.current.useImperativeHandle(q,re,z)},St.useInsertionEffect=function(q,re){return oe.current.useInsertionEffect(q,re)},St.useLayoutEffect=function(q,re){return oe.current.useLayoutEffect(q,re)},St.useMemo=function(q,re){return oe.current.useMemo(q,re)},St.useReducer=function(q,re,z){return oe.current.useReducer(q,re,z)},St.useRef=function(q){return oe.current.useRef(q)},St.useState=function(q){return oe.current.useState(q)},St.useSyncExternalStore=function(q,re,z){return oe.current.useSyncExternalStore(q,re,z)},St.useTransition=function(){return oe.current.useTransition()},St.version="18.3.1",St}var RT;function sy(){return RT||(RT=1,_0.exports=NN()),_0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _T;function MN(){if(_T)return tl;_T=1;var n=sy(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,u){var c,d={},h=null,p=null;u!==void 0&&(h=""+u),l.key!==void 0&&(h=""+l.key),l.ref!==void 0&&(p=l.ref);for(c in l)i.call(l,c)&&!s.hasOwnProperty(c)&&(d[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)d[c]===void 0&&(d[c]=l[c]);return{$$typeof:e,type:o,key:h,ref:p,props:d,_owner:r.current}}return tl.Fragment=t,tl.jsx=a,tl.jsxs=a,tl}var LT;function FN(){return LT||(LT=1,R0.exports=MN()),R0.exports}var be=FN(),U=sy();const B=Yl(U),ay=DN({__proto__:null,default:B},[U]);var vd={},L0={exports:{}},Jn={},P0={exports:{}},k0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PT;function BN(){return PT||(PT=1,(function(n){function e(Z,se){var j=Z.length;Z.push(se);e:for(;0<j;){var q=j-1>>>1,re=Z[q];if(0<r(re,se))Z[q]=se,Z[j]=re,j=q;else break e}}function t(Z){return Z.length===0?null:Z[0]}function i(Z){if(Z.length===0)return null;var se=Z[0],j=Z.pop();if(j!==se){Z[0]=j;e:for(var q=0,re=Z.length,z=re>>>1;q<z;){var ve=2*(q+1)-1,Le=Z[ve],Ce=ve+1,Ae=Z[Ce];if(0>r(Le,j))Ce<re&&0>r(Ae,Le)?(Z[q]=Ae,Z[Ce]=j,q=Ce):(Z[q]=Le,Z[ve]=j,q=ve);else if(Ce<re&&0>r(Ae,j))Z[q]=Ae,Z[Ce]=j,q=Ce;else break e}}return se}function r(Z,se){var j=Z.sortIndex-se.sortIndex;return j!==0?j:Z.id-se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,p=!1,g=!1,v=!1,y=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(Z){for(var se=t(u);se!==null;){if(se.callback===null)i(u);else if(se.startTime<=Z)i(u),se.sortIndex=se.expirationTime,e(l,se);else break;se=t(u)}}function w(Z){if(v=!1,x(Z),!g)if(t(l)!==null)g=!0,ne(A);else{var se=t(u);se!==null&&oe(w,se.startTime-Z)}}function A(Z,se){g=!1,v&&(v=!1,b(D),D=-1),p=!0;var j=h;try{for(x(se),d=t(l);d!==null&&(!(d.expirationTime>se)||Z&&!N());){var q=d.callback;if(typeof q=="function"){d.callback=null,h=d.priorityLevel;var re=q(d.expirationTime<=se);se=n.unstable_now(),typeof re=="function"?d.callback=re:d===t(l)&&i(l),x(se)}else i(l);d=t(l)}if(d!==null)var z=!0;else{var ve=t(u);ve!==null&&oe(w,ve.startTime-se),z=!1}return z}finally{d=null,h=j,p=!1}}var R=!1,_=null,D=-1,H=5,P=-1;function N(){return!(n.unstable_now()-P<H)}function G(){if(_!==null){var Z=n.unstable_now();P=Z;var se=!0;try{se=_(!0,Z)}finally{se?X():(R=!1,_=null)}}else R=!1}var X;if(typeof T=="function")X=function(){T(G)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,Q=te.port2;te.port1.onmessage=G,X=function(){Q.postMessage(null)}}else X=function(){y(G,0)};function ne(Z){_=Z,R||(R=!0,X())}function oe(Z,se){D=y(function(){Z(n.unstable_now())},se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Z){Z.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,ne(A))},n.unstable_forceFrameRate=function(Z){0>Z||125<Z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<Z?Math.floor(1e3/Z):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(Z){switch(h){case 1:case 2:case 3:var se=3;break;default:se=h}var j=h;h=se;try{return Z()}finally{h=j}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Z,se){switch(Z){case 1:case 2:case 3:case 4:case 5:break;default:Z=3}var j=h;h=Z;try{return se()}finally{h=j}},n.unstable_scheduleCallback=function(Z,se,j){var q=n.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?q+j:q):j=q,Z){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=j+re,Z={id:c++,callback:se,priorityLevel:Z,startTime:j,expirationTime:re,sortIndex:-1},j>q?(Z.sortIndex=j,e(u,Z),t(l)===null&&Z===t(u)&&(v?(b(D),D=-1):v=!0,oe(w,j-q))):(Z.sortIndex=re,e(l,Z),g||p||(g=!0,ne(A))),Z},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(Z){var se=h;return function(){var j=h;h=se;try{return Z.apply(this,arguments)}finally{h=j}}}})(k0)),k0}var kT;function UN(){return kT||(kT=1,P0.exports=BN()),P0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DT;function HN(){if(DT)return Jn;DT=1;var n=sy(),e=UN();function t(f){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+f,E=1;E<arguments.length;E++)m+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,r={};function s(f,m){a(f,m),a(f+"Capture",m)}function a(f,m){for(r[f]=m,f=0;f<m.length;f++)i.add(m[f])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},d={};function h(f){return l.call(d,f)?!0:l.call(c,f)?!1:u.test(f)?d[f]=!0:(c[f]=!0,!1)}function p(f,m,E,S){if(E!==null&&E.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return S?!1:E!==null?!E.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function g(f,m,E,S){if(m===null||typeof m>"u"||p(f,m,E,S))return!0;if(S)return!1;if(E!==null)switch(E.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function v(f,m,E,S,I,L,V){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=S,this.attributeNamespace=I,this.mustUseProperty=E,this.propertyName=f,this.type=m,this.sanitizeURL=L,this.removeEmptyString=V}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){y[f]=new v(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var m=f[0];y[m]=new v(m,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){y[f]=new v(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){y[f]=new v(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){y[f]=new v(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){y[f]=new v(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){y[f]=new v(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){y[f]=new v(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){y[f]=new v(f,5,!1,f.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function T(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var m=f.replace(b,T);y[m]=new v(m,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var m=f.replace(b,T);y[m]=new v(m,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var m=f.replace(b,T);y[m]=new v(m,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){y[f]=new v(f,1,!1,f.toLowerCase(),null,!1,!1)}),y.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){y[f]=new v(f,1,!1,f.toLowerCase(),null,!0,!0)});function x(f,m,E,S){var I=y.hasOwnProperty(m)?y[m]:null;(I!==null?I.type!==0:S||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(g(m,E,I,S)&&(E=null),S||I===null?h(m)&&(E===null?f.removeAttribute(m):f.setAttribute(m,""+E)):I.mustUseProperty?f[I.propertyName]=E===null?I.type===3?!1:"":E:(m=I.attributeName,S=I.attributeNamespace,E===null?f.removeAttribute(m):(I=I.type,E=I===3||I===4&&E===!0?"":""+E,S?f.setAttributeNS(S,m,E):f.setAttribute(m,E))))}var w=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),R=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),H=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),N=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),te=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),oe=Symbol.for("react.offscreen"),Z=Symbol.iterator;function se(f){return f===null||typeof f!="object"?null:(f=Z&&f[Z]||f["@@iterator"],typeof f=="function"?f:null)}var j=Object.assign,q;function re(f){if(q===void 0)try{throw Error()}catch(E){var m=E.stack.trim().match(/\n( *(at )?)/);q=m&&m[1]||""}return`
`+q+f}var z=!1;function ve(f,m){if(!f||z)return"";z=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(ye){var S=ye}Reflect.construct(f,[],m)}else{try{m.call()}catch(ye){S=ye}f.call(m.prototype)}else{try{throw Error()}catch(ye){S=ye}f()}}catch(ye){if(ye&&S&&typeof ye.stack=="string"){for(var I=ye.stack.split(`
`),L=S.stack.split(`
`),V=I.length-1,ee=L.length-1;1<=V&&0<=ee&&I[V]!==L[ee];)ee--;for(;1<=V&&0<=ee;V--,ee--)if(I[V]!==L[ee]){if(V!==1||ee!==1)do if(V--,ee--,0>ee||I[V]!==L[ee]){var ae=`
`+I[V].replace(" at new "," at ");return f.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",f.displayName)),ae}while(1<=V&&0<=ee);break}}}finally{z=!1,Error.prepareStackTrace=E}return(f=f?f.displayName||f.name:"")?re(f):""}function Le(f){switch(f.tag){case 5:return re(f.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 2:case 15:return f=ve(f.type,!1),f;case 11:return f=ve(f.type.render,!1),f;case 1:return f=ve(f.type,!0),f;default:return""}}function Ce(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case _:return"Fragment";case R:return"Portal";case H:return"Profiler";case D:return"StrictMode";case X:return"Suspense";case te:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case N:return(f.displayName||"Context")+".Consumer";case P:return(f._context.displayName||"Context")+".Provider";case G:var m=f.render;return f=f.displayName,f||(f=m.displayName||m.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Q:return m=f.displayName||null,m!==null?m:Ce(f.type)||"Memo";case ne:m=f._payload,f=f._init;try{return Ce(f(m))}catch{}}return null}function Ae(f){var m=f.type;switch(f.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=m.render,f=f.displayName||f.name||"",m.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ce(m);case 8:return m===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function ke(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function je(f){var m=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function We(f){var m=je(f)?"checked":"value",E=Object.getOwnPropertyDescriptor(f.constructor.prototype,m),S=""+f[m];if(!f.hasOwnProperty(m)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var I=E.get,L=E.set;return Object.defineProperty(f,m,{configurable:!0,get:function(){return I.call(this)},set:function(V){S=""+V,L.call(this,V)}}),Object.defineProperty(f,m,{enumerable:E.enumerable}),{getValue:function(){return S},setValue:function(V){S=""+V},stopTracking:function(){f._valueTracker=null,delete f[m]}}}}function de(f){f._valueTracker||(f._valueTracker=We(f))}function Re(f){if(!f)return!1;var m=f._valueTracker;if(!m)return!0;var E=m.getValue(),S="";return f&&(S=je(f)?f.checked?"true":"false":f.value),f=S,f!==E?(m.setValue(f),!0):!1}function Ie(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function Ye(f,m){var E=m.checked;return j({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??f._wrapperState.initialChecked})}function It(f,m){var E=m.defaultValue==null?"":m.defaultValue,S=m.checked!=null?m.checked:m.defaultChecked;E=ke(m.value!=null?m.value:E),f._wrapperState={initialChecked:S,initialValue:E,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Qe(f,m){m=m.checked,m!=null&&x(f,"checked",m,!1)}function k(f,m){Qe(f,m);var E=ke(m.value),S=m.type;if(E!=null)S==="number"?(E===0&&f.value===""||f.value!=E)&&(f.value=""+E):f.value!==""+E&&(f.value=""+E);else if(S==="submit"||S==="reset"){f.removeAttribute("value");return}m.hasOwnProperty("value")?ue(f,m.type,E):m.hasOwnProperty("defaultValue")&&ue(f,m.type,ke(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(f.defaultChecked=!!m.defaultChecked)}function $(f,m,E){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var S=m.type;if(!(S!=="submit"&&S!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+f._wrapperState.initialValue,E||m===f.value||(f.value=m),f.defaultValue=m}E=f.name,E!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,E!==""&&(f.name=E)}function ue(f,m,E){(m!=="number"||Ie(f.ownerDocument)!==f)&&(E==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+E&&(f.defaultValue=""+E))}var Ee=Array.isArray;function _e(f,m,E,S){if(f=f.options,m){m={};for(var I=0;I<E.length;I++)m["$"+E[I]]=!0;for(E=0;E<f.length;E++)I=m.hasOwnProperty("$"+f[E].value),f[E].selected!==I&&(f[E].selected=I),I&&S&&(f[E].defaultSelected=!0)}else{for(E=""+ke(E),m=null,I=0;I<f.length;I++){if(f[I].value===E){f[I].selected=!0,S&&(f[I].defaultSelected=!0);return}m!==null||f[I].disabled||(m=f[I])}m!==null&&(m.selected=!0)}}function Fe(f,m){if(m.dangerouslySetInnerHTML!=null)throw Error(t(91));return j({},m,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Pe(f,m){var E=m.value;if(E==null){if(E=m.children,m=m.defaultValue,E!=null){if(m!=null)throw Error(t(92));if(Ee(E)){if(1<E.length)throw Error(t(93));E=E[0]}m=E}m==null&&(m=""),E=m}f._wrapperState={initialValue:ke(E)}}function dt(f,m){var E=ke(m.value),S=ke(m.defaultValue);E!=null&&(E=""+E,E!==f.value&&(f.value=E),m.defaultValue==null&&f.defaultValue!==E&&(f.defaultValue=E)),S!=null&&(f.defaultValue=""+S)}function mt(f){var m=f.textContent;m===f._wrapperState.initialValue&&m!==""&&m!==null&&(f.value=m)}function he(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Se(f,m){return f==null||f==="http://www.w3.org/1999/xhtml"?he(m):f==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var qe,F=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,E,S,I){MSApp.execUnsafeLocalFunction(function(){return f(m,E,S,I)})}:f})(function(f,m){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=m;else{for(qe=qe||document.createElement("div"),qe.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=qe.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;m.firstChild;)f.appendChild(m.firstChild)}});function M(f,m){if(m){var E=f.firstChild;if(E&&E===f.lastChild&&E.nodeType===3){E.nodeValue=m;return}}f.textContent=m}var W={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Y=["Webkit","ms","Moz","O"];Object.keys(W).forEach(function(f){Y.forEach(function(m){m=m+f.charAt(0).toUpperCase()+f.substring(1),W[m]=W[f]})});function Te(f,m,E){return m==null||typeof m=="boolean"||m===""?"":E||typeof m!="number"||m===0||W.hasOwnProperty(f)&&W[f]?(""+m).trim():m+"px"}function Ne(f,m){f=f.style;for(var E in m)if(m.hasOwnProperty(E)){var S=E.indexOf("--")===0,I=Te(E,m[E],S);E==="float"&&(E="cssFloat"),S?f.setProperty(E,I):f[E]=I}}var st=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ft(f,m){if(m){if(st[f]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(t(137,f));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(t(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(t(61))}if(m.style!=null&&typeof m.style!="object")throw Error(t(62))}}function nt(f,m){if(f.indexOf("-")===-1)return typeof m.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=null;function en(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var ir=null,Pr=null,kr=null;function yu(f){if(f=Hu(f)){if(typeof ir!="function")throw Error(t(280));var m=f.stateNode;m&&(m=kc(m),ir(f.stateNode,f.type,m))}}function W1(f){Pr?kr?kr.push(f):kr=[f]:Pr=f}function q1(){if(Pr){var f=Pr,m=kr;if(kr=Pr=null,yu(f),m)for(f=0;f<m.length;f++)yu(m[f])}}function $1(f,m){return f(m)}function K1(){}var Wh=!1;function Y1(f,m,E){if(Wh)return f(m,E);Wh=!0;try{return $1(f,m,E)}finally{Wh=!1,(Pr!==null||kr!==null)&&(K1(),q1())}}function Eu(f,m){var E=f.stateNode;if(E===null)return null;var S=kc(E);if(S===null)return null;E=S[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(f=f.type,S=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!S;break e;default:f=!1}if(f)return null;if(E&&typeof E!="function")throw Error(t(231,m,typeof E));return E}var qh=!1;if(o)try{var bu={};Object.defineProperty(bu,"passive",{get:function(){qh=!0}}),window.addEventListener("test",bu,bu),window.removeEventListener("test",bu,bu)}catch{qh=!1}function UD(f,m,E,S,I,L,V,ee,ae){var ye=Array.prototype.slice.call(arguments,3);try{m.apply(E,ye)}catch(Me){this.onError(Me)}}var Tu=!1,cc=null,dc=!1,$h=null,HD={onError:function(f){Tu=!0,cc=f}};function zD(f,m,E,S,I,L,V,ee,ae){Tu=!1,cc=null,UD.apply(HD,arguments)}function jD(f,m,E,S,I,L,V,ee,ae){if(zD.apply(this,arguments),Tu){if(Tu){var ye=cc;Tu=!1,cc=null}else throw Error(t(198));dc||(dc=!0,$h=ye)}}function ra(f){var m=f,E=f;if(f.alternate)for(;m.return;)m=m.return;else{f=m;do m=f,(m.flags&4098)!==0&&(E=m.return),f=m.return;while(f)}return m.tag===3?E:null}function X1(f){if(f.tag===13){var m=f.memoizedState;if(m===null&&(f=f.alternate,f!==null&&(m=f.memoizedState)),m!==null)return m.dehydrated}return null}function Q1(f){if(ra(f)!==f)throw Error(t(188))}function VD(f){var m=f.alternate;if(!m){if(m=ra(f),m===null)throw Error(t(188));return m!==f?null:f}for(var E=f,S=m;;){var I=E.return;if(I===null)break;var L=I.alternate;if(L===null){if(S=I.return,S!==null){E=S;continue}break}if(I.child===L.child){for(L=I.child;L;){if(L===E)return Q1(I),f;if(L===S)return Q1(I),m;L=L.sibling}throw Error(t(188))}if(E.return!==S.return)E=I,S=L;else{for(var V=!1,ee=I.child;ee;){if(ee===E){V=!0,E=I,S=L;break}if(ee===S){V=!0,S=I,E=L;break}ee=ee.sibling}if(!V){for(ee=L.child;ee;){if(ee===E){V=!0,E=L,S=I;break}if(ee===S){V=!0,S=L,E=I;break}ee=ee.sibling}if(!V)throw Error(t(189))}}if(E.alternate!==S)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?f:m}function Z1(f){return f=VD(f),f!==null?J1(f):null}function J1(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var m=J1(f);if(m!==null)return m;f=f.sibling}return null}var eE=e.unstable_scheduleCallback,tE=e.unstable_cancelCallback,GD=e.unstable_shouldYield,WD=e.unstable_requestPaint,rn=e.unstable_now,qD=e.unstable_getCurrentPriorityLevel,Kh=e.unstable_ImmediatePriority,nE=e.unstable_UserBlockingPriority,fc=e.unstable_NormalPriority,$D=e.unstable_LowPriority,iE=e.unstable_IdlePriority,hc=null,rr=null;function KD(f){if(rr&&typeof rr.onCommitFiberRoot=="function")try{rr.onCommitFiberRoot(hc,f,void 0,(f.current.flags&128)===128)}catch{}}var Fi=Math.clz32?Math.clz32:QD,YD=Math.log,XD=Math.LN2;function QD(f){return f>>>=0,f===0?32:31-(YD(f)/XD|0)|0}var pc=64,mc=4194304;function xu(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function gc(f,m){var E=f.pendingLanes;if(E===0)return 0;var S=0,I=f.suspendedLanes,L=f.pingedLanes,V=E&268435455;if(V!==0){var ee=V&~I;ee!==0?S=xu(ee):(L&=V,L!==0&&(S=xu(L)))}else V=E&~I,V!==0?S=xu(V):L!==0&&(S=xu(L));if(S===0)return 0;if(m!==0&&m!==S&&(m&I)===0&&(I=S&-S,L=m&-m,I>=L||I===16&&(L&4194240)!==0))return m;if((S&4)!==0&&(S|=E&16),m=f.entangledLanes,m!==0)for(f=f.entanglements,m&=S;0<m;)E=31-Fi(m),I=1<<E,S|=f[E],m&=~I;return S}function ZD(f,m){switch(f){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JD(f,m){for(var E=f.suspendedLanes,S=f.pingedLanes,I=f.expirationTimes,L=f.pendingLanes;0<L;){var V=31-Fi(L),ee=1<<V,ae=I[V];ae===-1?((ee&E)===0||(ee&S)!==0)&&(I[V]=ZD(ee,m)):ae<=m&&(f.expiredLanes|=ee),L&=~ee}}function Yh(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function rE(){var f=pc;return pc<<=1,(pc&4194240)===0&&(pc=64),f}function Xh(f){for(var m=[],E=0;31>E;E++)m.push(f);return m}function Su(f,m,E){f.pendingLanes|=m,m!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,m=31-Fi(m),f[m]=E}function eO(f,m){var E=f.pendingLanes&~m;f.pendingLanes=m,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=m,f.mutableReadLanes&=m,f.entangledLanes&=m,m=f.entanglements;var S=f.eventTimes;for(f=f.expirationTimes;0<E;){var I=31-Fi(E),L=1<<I;m[I]=0,S[I]=-1,f[I]=-1,E&=~L}}function Qh(f,m){var E=f.entangledLanes|=m;for(f=f.entanglements;E;){var S=31-Fi(E),I=1<<S;I&m|f[S]&m&&(f[S]|=m),E&=~I}}var Pt=0;function sE(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var aE,Zh,oE,uE,lE,Jh=!1,vc=[],ls=null,cs=null,ds=null,wu=new Map,Au=new Map,fs=[],tO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cE(f,m){switch(f){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":cs=null;break;case"mouseover":case"mouseout":ds=null;break;case"pointerover":case"pointerout":wu.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Au.delete(m.pointerId)}}function Cu(f,m,E,S,I,L){return f===null||f.nativeEvent!==L?(f={blockedOn:m,domEventName:E,eventSystemFlags:S,nativeEvent:L,targetContainers:[I]},m!==null&&(m=Hu(m),m!==null&&Zh(m)),f):(f.eventSystemFlags|=S,m=f.targetContainers,I!==null&&m.indexOf(I)===-1&&m.push(I),f)}function nO(f,m,E,S,I){switch(m){case"focusin":return ls=Cu(ls,f,m,E,S,I),!0;case"dragenter":return cs=Cu(cs,f,m,E,S,I),!0;case"mouseover":return ds=Cu(ds,f,m,E,S,I),!0;case"pointerover":var L=I.pointerId;return wu.set(L,Cu(wu.get(L)||null,f,m,E,S,I)),!0;case"gotpointercapture":return L=I.pointerId,Au.set(L,Cu(Au.get(L)||null,f,m,E,S,I)),!0}return!1}function dE(f){var m=sa(f.target);if(m!==null){var E=ra(m);if(E!==null){if(m=E.tag,m===13){if(m=X1(E),m!==null){f.blockedOn=m,lE(f.priority,function(){oE(E)});return}}else if(m===3&&E.stateNode.current.memoizedState.isDehydrated){f.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}f.blockedOn=null}function yc(f){if(f.blockedOn!==null)return!1;for(var m=f.targetContainers;0<m.length;){var E=tp(f.domEventName,f.eventSystemFlags,m[0],f.nativeEvent);if(E===null){E=f.nativeEvent;var S=new E.constructor(E.type,E);Mt=S,E.target.dispatchEvent(S),Mt=null}else return m=Hu(E),m!==null&&Zh(m),f.blockedOn=E,!1;m.shift()}return!0}function fE(f,m,E){yc(f)&&E.delete(m)}function iO(){Jh=!1,ls!==null&&yc(ls)&&(ls=null),cs!==null&&yc(cs)&&(cs=null),ds!==null&&yc(ds)&&(ds=null),wu.forEach(fE),Au.forEach(fE)}function Iu(f,m){f.blockedOn===m&&(f.blockedOn=null,Jh||(Jh=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,iO)))}function Ru(f){function m(I){return Iu(I,f)}if(0<vc.length){Iu(vc[0],f);for(var E=1;E<vc.length;E++){var S=vc[E];S.blockedOn===f&&(S.blockedOn=null)}}for(ls!==null&&Iu(ls,f),cs!==null&&Iu(cs,f),ds!==null&&Iu(ds,f),wu.forEach(m),Au.forEach(m),E=0;E<fs.length;E++)S=fs[E],S.blockedOn===f&&(S.blockedOn=null);for(;0<fs.length&&(E=fs[0],E.blockedOn===null);)dE(E),E.blockedOn===null&&fs.shift()}var Ja=w.ReactCurrentBatchConfig,Ec=!0;function rO(f,m,E,S){var I=Pt,L=Ja.transition;Ja.transition=null;try{Pt=1,ep(f,m,E,S)}finally{Pt=I,Ja.transition=L}}function sO(f,m,E,S){var I=Pt,L=Ja.transition;Ja.transition=null;try{Pt=4,ep(f,m,E,S)}finally{Pt=I,Ja.transition=L}}function ep(f,m,E,S){if(Ec){var I=tp(f,m,E,S);if(I===null)yp(f,m,S,bc,E),cE(f,S);else if(nO(I,f,m,E,S))S.stopPropagation();else if(cE(f,S),m&4&&-1<tO.indexOf(f)){for(;I!==null;){var L=Hu(I);if(L!==null&&aE(L),L=tp(f,m,E,S),L===null&&yp(f,m,S,bc,E),L===I)break;I=L}I!==null&&S.stopPropagation()}else yp(f,m,S,null,E)}}var bc=null;function tp(f,m,E,S){if(bc=null,f=en(S),f=sa(f),f!==null)if(m=ra(f),m===null)f=null;else if(E=m.tag,E===13){if(f=X1(m),f!==null)return f;f=null}else if(E===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;f=null}else m!==f&&(f=null);return bc=f,null}function hE(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qD()){case Kh:return 1;case nE:return 4;case fc:case $D:return 16;case iE:return 536870912;default:return 16}default:return 16}}var hs=null,np=null,Tc=null;function pE(){if(Tc)return Tc;var f,m=np,E=m.length,S,I="value"in hs?hs.value:hs.textContent,L=I.length;for(f=0;f<E&&m[f]===I[f];f++);var V=E-f;for(S=1;S<=V&&m[E-S]===I[L-S];S++);return Tc=I.slice(f,1<S?1-S:void 0)}function xc(f){var m=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&m===13&&(f=13)):f=m,f===10&&(f=13),32<=f||f===13?f:0}function Sc(){return!0}function mE(){return!1}function ui(f){function m(E,S,I,L,V){this._reactName=E,this._targetInst=I,this.type=S,this.nativeEvent=L,this.target=V,this.currentTarget=null;for(var ee in f)f.hasOwnProperty(ee)&&(E=f[ee],this[ee]=E?E(L):L[ee]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Sc:mE,this.isPropagationStopped=mE,this}return j(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=Sc)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=Sc)},persist:function(){},isPersistent:Sc}),m}var eo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ip=ui(eo),_u=j({},eo,{view:0,detail:0}),aO=ui(_u),rp,sp,Lu,wc=j({},_u,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:op,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Lu&&(Lu&&f.type==="mousemove"?(rp=f.screenX-Lu.screenX,sp=f.screenY-Lu.screenY):sp=rp=0,Lu=f),rp)},movementY:function(f){return"movementY"in f?f.movementY:sp}}),gE=ui(wc),oO=j({},wc,{dataTransfer:0}),uO=ui(oO),lO=j({},_u,{relatedTarget:0}),ap=ui(lO),cO=j({},eo,{animationName:0,elapsedTime:0,pseudoElement:0}),dO=ui(cO),fO=j({},eo,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),hO=ui(fO),pO=j({},eo,{data:0}),vE=ui(pO),mO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yO(f){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(f):(f=vO[f])?!!m[f]:!1}function op(){return yO}var EO=j({},_u,{key:function(f){if(f.key){var m=mO[f.key]||f.key;if(m!=="Unidentified")return m}return f.type==="keypress"?(f=xc(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?gO[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:op,charCode:function(f){return f.type==="keypress"?xc(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?xc(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),bO=ui(EO),TO=j({},wc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yE=ui(TO),xO=j({},_u,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:op}),SO=ui(xO),wO=j({},eo,{propertyName:0,elapsedTime:0,pseudoElement:0}),AO=ui(wO),CO=j({},wc,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),IO=ui(CO),RO=[9,13,27,32],up=o&&"CompositionEvent"in window,Pu=null;o&&"documentMode"in document&&(Pu=document.documentMode);var _O=o&&"TextEvent"in window&&!Pu,EE=o&&(!up||Pu&&8<Pu&&11>=Pu),bE=" ",TE=!1;function xE(f,m){switch(f){case"keyup":return RO.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SE(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var to=!1;function LO(f,m){switch(f){case"compositionend":return SE(m);case"keypress":return m.which!==32?null:(TE=!0,bE);case"textInput":return f=m.data,f===bE&&TE?null:f;default:return null}}function PO(f,m){if(to)return f==="compositionend"||!up&&xE(f,m)?(f=pE(),Tc=np=hs=null,to=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return EE&&m.locale!=="ko"?null:m.data;default:return null}}var kO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wE(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m==="input"?!!kO[f.type]:m==="textarea"}function AE(f,m,E,S){W1(S),m=_c(m,"onChange"),0<m.length&&(E=new ip("onChange","change",null,E,S),f.push({event:E,listeners:m}))}var ku=null,Du=null;function DO(f){VE(f,0)}function Ac(f){var m=ao(f);if(Re(m))return f}function OO(f,m){if(f==="change")return m}var CE=!1;if(o){var lp;if(o){var cp="oninput"in document;if(!cp){var IE=document.createElement("div");IE.setAttribute("oninput","return;"),cp=typeof IE.oninput=="function"}lp=cp}else lp=!1;CE=lp&&(!document.documentMode||9<document.documentMode)}function RE(){ku&&(ku.detachEvent("onpropertychange",_E),Du=ku=null)}function _E(f){if(f.propertyName==="value"&&Ac(Du)){var m=[];AE(m,Du,f,en(f)),Y1(DO,m)}}function NO(f,m,E){f==="focusin"?(RE(),ku=m,Du=E,ku.attachEvent("onpropertychange",_E)):f==="focusout"&&RE()}function MO(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Ac(Du)}function FO(f,m){if(f==="click")return Ac(m)}function BO(f,m){if(f==="input"||f==="change")return Ac(m)}function UO(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var Bi=typeof Object.is=="function"?Object.is:UO;function Ou(f,m){if(Bi(f,m))return!0;if(typeof f!="object"||f===null||typeof m!="object"||m===null)return!1;var E=Object.keys(f),S=Object.keys(m);if(E.length!==S.length)return!1;for(S=0;S<E.length;S++){var I=E[S];if(!l.call(m,I)||!Bi(f[I],m[I]))return!1}return!0}function LE(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function PE(f,m){var E=LE(f);f=0;for(var S;E;){if(E.nodeType===3){if(S=f+E.textContent.length,f<=m&&S>=m)return{node:E,offset:m-f};f=S}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=LE(E)}}function kE(f,m){return f&&m?f===m?!0:f&&f.nodeType===3?!1:m&&m.nodeType===3?kE(f,m.parentNode):"contains"in f?f.contains(m):f.compareDocumentPosition?!!(f.compareDocumentPosition(m)&16):!1:!1}function DE(){for(var f=window,m=Ie();m instanceof f.HTMLIFrameElement;){try{var E=typeof m.contentWindow.location.href=="string"}catch{E=!1}if(E)f=m.contentWindow;else break;m=Ie(f.document)}return m}function dp(f){var m=f&&f.nodeName&&f.nodeName.toLowerCase();return m&&(m==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||m==="textarea"||f.contentEditable==="true")}function HO(f){var m=DE(),E=f.focusedElem,S=f.selectionRange;if(m!==E&&E&&E.ownerDocument&&kE(E.ownerDocument.documentElement,E)){if(S!==null&&dp(E)){if(m=S.start,f=S.end,f===void 0&&(f=m),"selectionStart"in E)E.selectionStart=m,E.selectionEnd=Math.min(f,E.value.length);else if(f=(m=E.ownerDocument||document)&&m.defaultView||window,f.getSelection){f=f.getSelection();var I=E.textContent.length,L=Math.min(S.start,I);S=S.end===void 0?L:Math.min(S.end,I),!f.extend&&L>S&&(I=S,S=L,L=I),I=PE(E,L);var V=PE(E,S);I&&V&&(f.rangeCount!==1||f.anchorNode!==I.node||f.anchorOffset!==I.offset||f.focusNode!==V.node||f.focusOffset!==V.offset)&&(m=m.createRange(),m.setStart(I.node,I.offset),f.removeAllRanges(),L>S?(f.addRange(m),f.extend(V.node,V.offset)):(m.setEnd(V.node,V.offset),f.addRange(m)))}}for(m=[],f=E;f=f.parentNode;)f.nodeType===1&&m.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<m.length;E++)f=m[E],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var zO=o&&"documentMode"in document&&11>=document.documentMode,no=null,fp=null,Nu=null,hp=!1;function OE(f,m,E){var S=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;hp||no==null||no!==Ie(S)||(S=no,"selectionStart"in S&&dp(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Nu&&Ou(Nu,S)||(Nu=S,S=_c(fp,"onSelect"),0<S.length&&(m=new ip("onSelect","select",null,m,E),f.push({event:m,listeners:S}),m.target=no)))}function Cc(f,m){var E={};return E[f.toLowerCase()]=m.toLowerCase(),E["Webkit"+f]="webkit"+m,E["Moz"+f]="moz"+m,E}var io={animationend:Cc("Animation","AnimationEnd"),animationiteration:Cc("Animation","AnimationIteration"),animationstart:Cc("Animation","AnimationStart"),transitionend:Cc("Transition","TransitionEnd")},pp={},NE={};o&&(NE=document.createElement("div").style,"AnimationEvent"in window||(delete io.animationend.animation,delete io.animationiteration.animation,delete io.animationstart.animation),"TransitionEvent"in window||delete io.transitionend.transition);function Ic(f){if(pp[f])return pp[f];if(!io[f])return f;var m=io[f],E;for(E in m)if(m.hasOwnProperty(E)&&E in NE)return pp[f]=m[E];return f}var ME=Ic("animationend"),FE=Ic("animationiteration"),BE=Ic("animationstart"),UE=Ic("transitionend"),HE=new Map,zE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ps(f,m){HE.set(f,m),s(m,[f])}for(var mp=0;mp<zE.length;mp++){var gp=zE[mp],jO=gp.toLowerCase(),VO=gp[0].toUpperCase()+gp.slice(1);ps(jO,"on"+VO)}ps(ME,"onAnimationEnd"),ps(FE,"onAnimationIteration"),ps(BE,"onAnimationStart"),ps("dblclick","onDoubleClick"),ps("focusin","onFocus"),ps("focusout","onBlur"),ps(UE,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GO=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mu));function jE(f,m,E){var S=f.type||"unknown-event";f.currentTarget=E,jD(S,m,void 0,f),f.currentTarget=null}function VE(f,m){m=(m&4)!==0;for(var E=0;E<f.length;E++){var S=f[E],I=S.event;S=S.listeners;e:{var L=void 0;if(m)for(var V=S.length-1;0<=V;V--){var ee=S[V],ae=ee.instance,ye=ee.currentTarget;if(ee=ee.listener,ae!==L&&I.isPropagationStopped())break e;jE(I,ee,ye),L=ae}else for(V=0;V<S.length;V++){if(ee=S[V],ae=ee.instance,ye=ee.currentTarget,ee=ee.listener,ae!==L&&I.isPropagationStopped())break e;jE(I,ee,ye),L=ae}}}if(dc)throw f=$h,dc=!1,$h=null,f}function Gt(f,m){var E=m[wp];E===void 0&&(E=m[wp]=new Set);var S=f+"__bubble";E.has(S)||(GE(m,f,2,!1),E.add(S))}function vp(f,m,E){var S=0;m&&(S|=4),GE(E,f,S,m)}var Rc="_reactListening"+Math.random().toString(36).slice(2);function Fu(f){if(!f[Rc]){f[Rc]=!0,i.forEach(function(E){E!=="selectionchange"&&(GO.has(E)||vp(E,!1,f),vp(E,!0,f))});var m=f.nodeType===9?f:f.ownerDocument;m===null||m[Rc]||(m[Rc]=!0,vp("selectionchange",!1,m))}}function GE(f,m,E,S){switch(hE(m)){case 1:var I=rO;break;case 4:I=sO;break;default:I=ep}E=I.bind(null,m,E,f),I=void 0,!qh||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(I=!0),S?I!==void 0?f.addEventListener(m,E,{capture:!0,passive:I}):f.addEventListener(m,E,!0):I!==void 0?f.addEventListener(m,E,{passive:I}):f.addEventListener(m,E,!1)}function yp(f,m,E,S,I){var L=S;if((m&1)===0&&(m&2)===0&&S!==null)e:for(;;){if(S===null)return;var V=S.tag;if(V===3||V===4){var ee=S.stateNode.containerInfo;if(ee===I||ee.nodeType===8&&ee.parentNode===I)break;if(V===4)for(V=S.return;V!==null;){var ae=V.tag;if((ae===3||ae===4)&&(ae=V.stateNode.containerInfo,ae===I||ae.nodeType===8&&ae.parentNode===I))return;V=V.return}for(;ee!==null;){if(V=sa(ee),V===null)return;if(ae=V.tag,ae===5||ae===6){S=L=V;continue e}ee=ee.parentNode}}S=S.return}Y1(function(){var ye=L,Me=en(E),Be=[];e:{var De=HE.get(f);if(De!==void 0){var Ke=ip,et=f;switch(f){case"keypress":if(xc(E)===0)break e;case"keydown":case"keyup":Ke=bO;break;case"focusin":et="focus",Ke=ap;break;case"focusout":et="blur",Ke=ap;break;case"beforeblur":case"afterblur":Ke=ap;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ke=gE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ke=uO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ke=SO;break;case ME:case FE:case BE:Ke=dO;break;case UE:Ke=AO;break;case"scroll":Ke=aO;break;case"wheel":Ke=IO;break;case"copy":case"cut":case"paste":Ke=hO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ke=yE}var tt=(m&4)!==0,sn=!tt&&f==="scroll",pe=tt?De!==null?De+"Capture":null:De;tt=[];for(var le=ye,ge;le!==null;){ge=le;var Ve=ge.stateNode;if(ge.tag===5&&Ve!==null&&(ge=Ve,pe!==null&&(Ve=Eu(le,pe),Ve!=null&&tt.push(Bu(le,Ve,ge)))),sn)break;le=le.return}0<tt.length&&(De=new Ke(De,et,null,E,Me),Be.push({event:De,listeners:tt}))}}if((m&7)===0){e:{if(De=f==="mouseover"||f==="pointerover",Ke=f==="mouseout"||f==="pointerout",De&&E!==Mt&&(et=E.relatedTarget||E.fromElement)&&(sa(et)||et[Dr]))break e;if((Ke||De)&&(De=Me.window===Me?Me:(De=Me.ownerDocument)?De.defaultView||De.parentWindow:window,Ke?(et=E.relatedTarget||E.toElement,Ke=ye,et=et?sa(et):null,et!==null&&(sn=ra(et),et!==sn||et.tag!==5&&et.tag!==6)&&(et=null)):(Ke=null,et=ye),Ke!==et)){if(tt=gE,Ve="onMouseLeave",pe="onMouseEnter",le="mouse",(f==="pointerout"||f==="pointerover")&&(tt=yE,Ve="onPointerLeave",pe="onPointerEnter",le="pointer"),sn=Ke==null?De:ao(Ke),ge=et==null?De:ao(et),De=new tt(Ve,le+"leave",Ke,E,Me),De.target=sn,De.relatedTarget=ge,Ve=null,sa(Me)===ye&&(tt=new tt(pe,le+"enter",et,E,Me),tt.target=ge,tt.relatedTarget=sn,Ve=tt),sn=Ve,Ke&&et)t:{for(tt=Ke,pe=et,le=0,ge=tt;ge;ge=ro(ge))le++;for(ge=0,Ve=pe;Ve;Ve=ro(Ve))ge++;for(;0<le-ge;)tt=ro(tt),le--;for(;0<ge-le;)pe=ro(pe),ge--;for(;le--;){if(tt===pe||pe!==null&&tt===pe.alternate)break t;tt=ro(tt),pe=ro(pe)}tt=null}else tt=null;Ke!==null&&WE(Be,De,Ke,tt,!1),et!==null&&sn!==null&&WE(Be,sn,et,tt,!0)}}e:{if(De=ye?ao(ye):window,Ke=De.nodeName&&De.nodeName.toLowerCase(),Ke==="select"||Ke==="input"&&De.type==="file")var at=OO;else if(wE(De))if(CE)at=BO;else{at=MO;var ut=NO}else(Ke=De.nodeName)&&Ke.toLowerCase()==="input"&&(De.type==="checkbox"||De.type==="radio")&&(at=FO);if(at&&(at=at(f,ye))){AE(Be,at,E,Me);break e}ut&&ut(f,De,ye),f==="focusout"&&(ut=De._wrapperState)&&ut.controlled&&De.type==="number"&&ue(De,"number",De.value)}switch(ut=ye?ao(ye):window,f){case"focusin":(wE(ut)||ut.contentEditable==="true")&&(no=ut,fp=ye,Nu=null);break;case"focusout":Nu=fp=no=null;break;case"mousedown":hp=!0;break;case"contextmenu":case"mouseup":case"dragend":hp=!1,OE(Be,E,Me);break;case"selectionchange":if(zO)break;case"keydown":case"keyup":OE(Be,E,Me)}var lt;if(up)e:{switch(f){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else to?xE(f,E)&&(ht="onCompositionEnd"):f==="keydown"&&E.keyCode===229&&(ht="onCompositionStart");ht&&(EE&&E.locale!=="ko"&&(to||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&to&&(lt=pE()):(hs=Me,np="value"in hs?hs.value:hs.textContent,to=!0)),ut=_c(ye,ht),0<ut.length&&(ht=new vE(ht,f,null,E,Me),Be.push({event:ht,listeners:ut}),lt?ht.data=lt:(lt=SE(E),lt!==null&&(ht.data=lt)))),(lt=_O?LO(f,E):PO(f,E))&&(ye=_c(ye,"onBeforeInput"),0<ye.length&&(Me=new vE("onBeforeInput","beforeinput",null,E,Me),Be.push({event:Me,listeners:ye}),Me.data=lt))}VE(Be,m)})}function Bu(f,m,E){return{instance:f,listener:m,currentTarget:E}}function _c(f,m){for(var E=m+"Capture",S=[];f!==null;){var I=f,L=I.stateNode;I.tag===5&&L!==null&&(I=L,L=Eu(f,E),L!=null&&S.unshift(Bu(f,L,I)),L=Eu(f,m),L!=null&&S.push(Bu(f,L,I))),f=f.return}return S}function ro(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function WE(f,m,E,S,I){for(var L=m._reactName,V=[];E!==null&&E!==S;){var ee=E,ae=ee.alternate,ye=ee.stateNode;if(ae!==null&&ae===S)break;ee.tag===5&&ye!==null&&(ee=ye,I?(ae=Eu(E,L),ae!=null&&V.unshift(Bu(E,ae,ee))):I||(ae=Eu(E,L),ae!=null&&V.push(Bu(E,ae,ee)))),E=E.return}V.length!==0&&f.push({event:m,listeners:V})}var WO=/\r\n?/g,qO=/\u0000|\uFFFD/g;function qE(f){return(typeof f=="string"?f:""+f).replace(WO,`
`).replace(qO,"")}function Lc(f,m,E){if(m=qE(m),qE(f)!==m&&E)throw Error(t(425))}function Pc(){}var Ep=null,bp=null;function Tp(f,m){return f==="textarea"||f==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var xp=typeof setTimeout=="function"?setTimeout:void 0,$O=typeof clearTimeout=="function"?clearTimeout:void 0,$E=typeof Promise=="function"?Promise:void 0,KO=typeof queueMicrotask=="function"?queueMicrotask:typeof $E<"u"?function(f){return $E.resolve(null).then(f).catch(YO)}:xp;function YO(f){setTimeout(function(){throw f})}function Sp(f,m){var E=m,S=0;do{var I=E.nextSibling;if(f.removeChild(E),I&&I.nodeType===8)if(E=I.data,E==="/$"){if(S===0){f.removeChild(I),Ru(m);return}S--}else E!=="$"&&E!=="$?"&&E!=="$!"||S++;E=I}while(E);Ru(m)}function ms(f){for(;f!=null;f=f.nextSibling){var m=f.nodeType;if(m===1||m===3)break;if(m===8){if(m=f.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return f}function KE(f){f=f.previousSibling;for(var m=0;f;){if(f.nodeType===8){var E=f.data;if(E==="$"||E==="$!"||E==="$?"){if(m===0)return f;m--}else E==="/$"&&m++}f=f.previousSibling}return null}var so=Math.random().toString(36).slice(2),sr="__reactFiber$"+so,Uu="__reactProps$"+so,Dr="__reactContainer$"+so,wp="__reactEvents$"+so,XO="__reactListeners$"+so,QO="__reactHandles$"+so;function sa(f){var m=f[sr];if(m)return m;for(var E=f.parentNode;E;){if(m=E[Dr]||E[sr]){if(E=m.alternate,m.child!==null||E!==null&&E.child!==null)for(f=KE(f);f!==null;){if(E=f[sr])return E;f=KE(f)}return m}f=E,E=f.parentNode}return null}function Hu(f){return f=f[sr]||f[Dr],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function ao(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(t(33))}function kc(f){return f[Uu]||null}var Ap=[],oo=-1;function gs(f){return{current:f}}function Wt(f){0>oo||(f.current=Ap[oo],Ap[oo]=null,oo--)}function zt(f,m){oo++,Ap[oo]=f.current,f.current=m}var vs={},On=gs(vs),Kn=gs(!1),aa=vs;function uo(f,m){var E=f.type.contextTypes;if(!E)return vs;var S=f.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===m)return S.__reactInternalMemoizedMaskedChildContext;var I={},L;for(L in E)I[L]=m[L];return S&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=m,f.__reactInternalMemoizedMaskedChildContext=I),I}function Yn(f){return f=f.childContextTypes,f!=null}function Dc(){Wt(Kn),Wt(On)}function YE(f,m,E){if(On.current!==vs)throw Error(t(168));zt(On,m),zt(Kn,E)}function XE(f,m,E){var S=f.stateNode;if(m=m.childContextTypes,typeof S.getChildContext!="function")return E;S=S.getChildContext();for(var I in S)if(!(I in m))throw Error(t(108,Ae(f)||"Unknown",I));return j({},E,S)}function Oc(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||vs,aa=On.current,zt(On,f),zt(Kn,Kn.current),!0}function QE(f,m,E){var S=f.stateNode;if(!S)throw Error(t(169));E?(f=XE(f,m,aa),S.__reactInternalMemoizedMergedChildContext=f,Wt(Kn),Wt(On),zt(On,f)):Wt(Kn),zt(Kn,E)}var Or=null,Nc=!1,Cp=!1;function ZE(f){Or===null?Or=[f]:Or.push(f)}function ZO(f){Nc=!0,ZE(f)}function ys(){if(!Cp&&Or!==null){Cp=!0;var f=0,m=Pt;try{var E=Or;for(Pt=1;f<E.length;f++){var S=E[f];do S=S(!0);while(S!==null)}Or=null,Nc=!1}catch(I){throw Or!==null&&(Or=Or.slice(f+1)),eE(Kh,ys),I}finally{Pt=m,Cp=!1}}return null}var lo=[],co=0,Mc=null,Fc=0,wi=[],Ai=0,oa=null,Nr=1,Mr="";function ua(f,m){lo[co++]=Fc,lo[co++]=Mc,Mc=f,Fc=m}function JE(f,m,E){wi[Ai++]=Nr,wi[Ai++]=Mr,wi[Ai++]=oa,oa=f;var S=Nr;f=Mr;var I=32-Fi(S)-1;S&=~(1<<I),E+=1;var L=32-Fi(m)+I;if(30<L){var V=I-I%5;L=(S&(1<<V)-1).toString(32),S>>=V,I-=V,Nr=1<<32-Fi(m)+I|E<<I|S,Mr=L+f}else Nr=1<<L|E<<I|S,Mr=f}function Ip(f){f.return!==null&&(ua(f,1),JE(f,1,0))}function Rp(f){for(;f===Mc;)Mc=lo[--co],lo[co]=null,Fc=lo[--co],lo[co]=null;for(;f===oa;)oa=wi[--Ai],wi[Ai]=null,Mr=wi[--Ai],wi[Ai]=null,Nr=wi[--Ai],wi[Ai]=null}var li=null,ci=null,$t=!1,Ui=null;function eb(f,m){var E=_i(5,null,null,0);E.elementType="DELETED",E.stateNode=m,E.return=f,m=f.deletions,m===null?(f.deletions=[E],f.flags|=16):m.push(E)}function tb(f,m){switch(f.tag){case 5:var E=f.type;return m=m.nodeType!==1||E.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(f.stateNode=m,li=f,ci=ms(m.firstChild),!0):!1;case 6:return m=f.pendingProps===""||m.nodeType!==3?null:m,m!==null?(f.stateNode=m,li=f,ci=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(E=oa!==null?{id:Nr,overflow:Mr}:null,f.memoizedState={dehydrated:m,treeContext:E,retryLane:1073741824},E=_i(18,null,null,0),E.stateNode=m,E.return=f,f.child=E,li=f,ci=null,!0):!1;default:return!1}}function _p(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Lp(f){if($t){var m=ci;if(m){var E=m;if(!tb(f,m)){if(_p(f))throw Error(t(418));m=ms(E.nextSibling);var S=li;m&&tb(f,m)?eb(S,E):(f.flags=f.flags&-4097|2,$t=!1,li=f)}}else{if(_p(f))throw Error(t(418));f.flags=f.flags&-4097|2,$t=!1,li=f}}}function nb(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;li=f}function Bc(f){if(f!==li)return!1;if(!$t)return nb(f),$t=!0,!1;var m;if((m=f.tag!==3)&&!(m=f.tag!==5)&&(m=f.type,m=m!=="head"&&m!=="body"&&!Tp(f.type,f.memoizedProps)),m&&(m=ci)){if(_p(f))throw ib(),Error(t(418));for(;m;)eb(f,m),m=ms(m.nextSibling)}if(nb(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(t(317));e:{for(f=f.nextSibling,m=0;f;){if(f.nodeType===8){var E=f.data;if(E==="/$"){if(m===0){ci=ms(f.nextSibling);break e}m--}else E!=="$"&&E!=="$!"&&E!=="$?"||m++}f=f.nextSibling}ci=null}}else ci=li?ms(f.stateNode.nextSibling):null;return!0}function ib(){for(var f=ci;f;)f=ms(f.nextSibling)}function fo(){ci=li=null,$t=!1}function Pp(f){Ui===null?Ui=[f]:Ui.push(f)}var JO=w.ReactCurrentBatchConfig;function zu(f,m,E){if(f=E.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var S=E.stateNode}if(!S)throw Error(t(147,f));var I=S,L=""+f;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===L?m.ref:(m=function(V){var ee=I.refs;V===null?delete ee[L]:ee[L]=V},m._stringRef=L,m)}if(typeof f!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,f))}return f}function Uc(f,m){throw f=Object.prototype.toString.call(m),Error(t(31,f==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":f))}function rb(f){var m=f._init;return m(f._payload)}function sb(f){function m(pe,le){if(f){var ge=pe.deletions;ge===null?(pe.deletions=[le],pe.flags|=16):ge.push(le)}}function E(pe,le){if(!f)return null;for(;le!==null;)m(pe,le),le=le.sibling;return null}function S(pe,le){for(pe=new Map;le!==null;)le.key!==null?pe.set(le.key,le):pe.set(le.index,le),le=le.sibling;return pe}function I(pe,le){return pe=Cs(pe,le),pe.index=0,pe.sibling=null,pe}function L(pe,le,ge){return pe.index=ge,f?(ge=pe.alternate,ge!==null?(ge=ge.index,ge<le?(pe.flags|=2,le):ge):(pe.flags|=2,le)):(pe.flags|=1048576,le)}function V(pe){return f&&pe.alternate===null&&(pe.flags|=2),pe}function ee(pe,le,ge,Ve){return le===null||le.tag!==6?(le=x0(ge,pe.mode,Ve),le.return=pe,le):(le=I(le,ge),le.return=pe,le)}function ae(pe,le,ge,Ve){var at=ge.type;return at===_?Me(pe,le,ge.props.children,Ve,ge.key):le!==null&&(le.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===ne&&rb(at)===le.type)?(Ve=I(le,ge.props),Ve.ref=zu(pe,le,ge),Ve.return=pe,Ve):(Ve=ld(ge.type,ge.key,ge.props,null,pe.mode,Ve),Ve.ref=zu(pe,le,ge),Ve.return=pe,Ve)}function ye(pe,le,ge,Ve){return le===null||le.tag!==4||le.stateNode.containerInfo!==ge.containerInfo||le.stateNode.implementation!==ge.implementation?(le=S0(ge,pe.mode,Ve),le.return=pe,le):(le=I(le,ge.children||[]),le.return=pe,le)}function Me(pe,le,ge,Ve,at){return le===null||le.tag!==7?(le=ga(ge,pe.mode,Ve,at),le.return=pe,le):(le=I(le,ge),le.return=pe,le)}function Be(pe,le,ge){if(typeof le=="string"&&le!==""||typeof le=="number")return le=x0(""+le,pe.mode,ge),le.return=pe,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case A:return ge=ld(le.type,le.key,le.props,null,pe.mode,ge),ge.ref=zu(pe,null,le),ge.return=pe,ge;case R:return le=S0(le,pe.mode,ge),le.return=pe,le;case ne:var Ve=le._init;return Be(pe,Ve(le._payload),ge)}if(Ee(le)||se(le))return le=ga(le,pe.mode,ge,null),le.return=pe,le;Uc(pe,le)}return null}function De(pe,le,ge,Ve){var at=le!==null?le.key:null;if(typeof ge=="string"&&ge!==""||typeof ge=="number")return at!==null?null:ee(pe,le,""+ge,Ve);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case A:return ge.key===at?ae(pe,le,ge,Ve):null;case R:return ge.key===at?ye(pe,le,ge,Ve):null;case ne:return at=ge._init,De(pe,le,at(ge._payload),Ve)}if(Ee(ge)||se(ge))return at!==null?null:Me(pe,le,ge,Ve,null);Uc(pe,ge)}return null}function Ke(pe,le,ge,Ve,at){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return pe=pe.get(ge)||null,ee(le,pe,""+Ve,at);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case A:return pe=pe.get(Ve.key===null?ge:Ve.key)||null,ae(le,pe,Ve,at);case R:return pe=pe.get(Ve.key===null?ge:Ve.key)||null,ye(le,pe,Ve,at);case ne:var ut=Ve._init;return Ke(pe,le,ge,ut(Ve._payload),at)}if(Ee(Ve)||se(Ve))return pe=pe.get(ge)||null,Me(le,pe,Ve,at,null);Uc(le,Ve)}return null}function et(pe,le,ge,Ve){for(var at=null,ut=null,lt=le,ht=le=0,Tn=null;lt!==null&&ht<ge.length;ht++){lt.index>ht?(Tn=lt,lt=null):Tn=lt.sibling;var Lt=De(pe,lt,ge[ht],Ve);if(Lt===null){lt===null&&(lt=Tn);break}f&&lt&&Lt.alternate===null&&m(pe,lt),le=L(Lt,le,ht),ut===null?at=Lt:ut.sibling=Lt,ut=Lt,lt=Tn}if(ht===ge.length)return E(pe,lt),$t&&ua(pe,ht),at;if(lt===null){for(;ht<ge.length;ht++)lt=Be(pe,ge[ht],Ve),lt!==null&&(le=L(lt,le,ht),ut===null?at=lt:ut.sibling=lt,ut=lt);return $t&&ua(pe,ht),at}for(lt=S(pe,lt);ht<ge.length;ht++)Tn=Ke(lt,pe,ht,ge[ht],Ve),Tn!==null&&(f&&Tn.alternate!==null&&lt.delete(Tn.key===null?ht:Tn.key),le=L(Tn,le,ht),ut===null?at=Tn:ut.sibling=Tn,ut=Tn);return f&&lt.forEach(function(Is){return m(pe,Is)}),$t&&ua(pe,ht),at}function tt(pe,le,ge,Ve){var at=se(ge);if(typeof at!="function")throw Error(t(150));if(ge=at.call(ge),ge==null)throw Error(t(151));for(var ut=at=null,lt=le,ht=le=0,Tn=null,Lt=ge.next();lt!==null&&!Lt.done;ht++,Lt=ge.next()){lt.index>ht?(Tn=lt,lt=null):Tn=lt.sibling;var Is=De(pe,lt,Lt.value,Ve);if(Is===null){lt===null&&(lt=Tn);break}f&&lt&&Is.alternate===null&&m(pe,lt),le=L(Is,le,ht),ut===null?at=Is:ut.sibling=Is,ut=Is,lt=Tn}if(Lt.done)return E(pe,lt),$t&&ua(pe,ht),at;if(lt===null){for(;!Lt.done;ht++,Lt=ge.next())Lt=Be(pe,Lt.value,Ve),Lt!==null&&(le=L(Lt,le,ht),ut===null?at=Lt:ut.sibling=Lt,ut=Lt);return $t&&ua(pe,ht),at}for(lt=S(pe,lt);!Lt.done;ht++,Lt=ge.next())Lt=Ke(lt,pe,ht,Lt.value,Ve),Lt!==null&&(f&&Lt.alternate!==null&&lt.delete(Lt.key===null?ht:Lt.key),le=L(Lt,le,ht),ut===null?at=Lt:ut.sibling=Lt,ut=Lt);return f&&lt.forEach(function(kN){return m(pe,kN)}),$t&&ua(pe,ht),at}function sn(pe,le,ge,Ve){if(typeof ge=="object"&&ge!==null&&ge.type===_&&ge.key===null&&(ge=ge.props.children),typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case A:e:{for(var at=ge.key,ut=le;ut!==null;){if(ut.key===at){if(at=ge.type,at===_){if(ut.tag===7){E(pe,ut.sibling),le=I(ut,ge.props.children),le.return=pe,pe=le;break e}}else if(ut.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===ne&&rb(at)===ut.type){E(pe,ut.sibling),le=I(ut,ge.props),le.ref=zu(pe,ut,ge),le.return=pe,pe=le;break e}E(pe,ut);break}else m(pe,ut);ut=ut.sibling}ge.type===_?(le=ga(ge.props.children,pe.mode,Ve,ge.key),le.return=pe,pe=le):(Ve=ld(ge.type,ge.key,ge.props,null,pe.mode,Ve),Ve.ref=zu(pe,le,ge),Ve.return=pe,pe=Ve)}return V(pe);case R:e:{for(ut=ge.key;le!==null;){if(le.key===ut)if(le.tag===4&&le.stateNode.containerInfo===ge.containerInfo&&le.stateNode.implementation===ge.implementation){E(pe,le.sibling),le=I(le,ge.children||[]),le.return=pe,pe=le;break e}else{E(pe,le);break}else m(pe,le);le=le.sibling}le=S0(ge,pe.mode,Ve),le.return=pe,pe=le}return V(pe);case ne:return ut=ge._init,sn(pe,le,ut(ge._payload),Ve)}if(Ee(ge))return et(pe,le,ge,Ve);if(se(ge))return tt(pe,le,ge,Ve);Uc(pe,ge)}return typeof ge=="string"&&ge!==""||typeof ge=="number"?(ge=""+ge,le!==null&&le.tag===6?(E(pe,le.sibling),le=I(le,ge),le.return=pe,pe=le):(E(pe,le),le=x0(ge,pe.mode,Ve),le.return=pe,pe=le),V(pe)):E(pe,le)}return sn}var ho=sb(!0),ab=sb(!1),Hc=gs(null),zc=null,po=null,kp=null;function Dp(){kp=po=zc=null}function Op(f){var m=Hc.current;Wt(Hc),f._currentValue=m}function Np(f,m,E){for(;f!==null;){var S=f.alternate;if((f.childLanes&m)!==m?(f.childLanes|=m,S!==null&&(S.childLanes|=m)):S!==null&&(S.childLanes&m)!==m&&(S.childLanes|=m),f===E)break;f=f.return}}function mo(f,m){zc=f,kp=po=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&m)!==0&&(Xn=!0),f.firstContext=null)}function Ci(f){var m=f._currentValue;if(kp!==f)if(f={context:f,memoizedValue:m,next:null},po===null){if(zc===null)throw Error(t(308));po=f,zc.dependencies={lanes:0,firstContext:f}}else po=po.next=f;return m}var la=null;function Mp(f){la===null?la=[f]:la.push(f)}function ob(f,m,E,S){var I=m.interleaved;return I===null?(E.next=E,Mp(m)):(E.next=I.next,I.next=E),m.interleaved=E,Fr(f,S)}function Fr(f,m){f.lanes|=m;var E=f.alternate;for(E!==null&&(E.lanes|=m),E=f,f=f.return;f!==null;)f.childLanes|=m,E=f.alternate,E!==null&&(E.childLanes|=m),E=f,f=f.return;return E.tag===3?E.stateNode:null}var Es=!1;function Fp(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ub(f,m){f=f.updateQueue,m.updateQueue===f&&(m.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Br(f,m){return{eventTime:f,lane:m,tag:0,payload:null,callback:null,next:null}}function bs(f,m,E){var S=f.updateQueue;if(S===null)return null;if(S=S.shared,(_t&2)!==0){var I=S.pending;return I===null?m.next=m:(m.next=I.next,I.next=m),S.pending=m,Fr(f,E)}return I=S.interleaved,I===null?(m.next=m,Mp(S)):(m.next=I.next,I.next=m),S.interleaved=m,Fr(f,E)}function jc(f,m,E){if(m=m.updateQueue,m!==null&&(m=m.shared,(E&4194240)!==0)){var S=m.lanes;S&=f.pendingLanes,E|=S,m.lanes=E,Qh(f,E)}}function lb(f,m){var E=f.updateQueue,S=f.alternate;if(S!==null&&(S=S.updateQueue,E===S)){var I=null,L=null;if(E=E.firstBaseUpdate,E!==null){do{var V={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};L===null?I=L=V:L=L.next=V,E=E.next}while(E!==null);L===null?I=L=m:L=L.next=m}else I=L=m;E={baseState:S.baseState,firstBaseUpdate:I,lastBaseUpdate:L,shared:S.shared,effects:S.effects},f.updateQueue=E;return}f=E.lastBaseUpdate,f===null?E.firstBaseUpdate=m:f.next=m,E.lastBaseUpdate=m}function Vc(f,m,E,S){var I=f.updateQueue;Es=!1;var L=I.firstBaseUpdate,V=I.lastBaseUpdate,ee=I.shared.pending;if(ee!==null){I.shared.pending=null;var ae=ee,ye=ae.next;ae.next=null,V===null?L=ye:V.next=ye,V=ae;var Me=f.alternate;Me!==null&&(Me=Me.updateQueue,ee=Me.lastBaseUpdate,ee!==V&&(ee===null?Me.firstBaseUpdate=ye:ee.next=ye,Me.lastBaseUpdate=ae))}if(L!==null){var Be=I.baseState;V=0,Me=ye=ae=null,ee=L;do{var De=ee.lane,Ke=ee.eventTime;if((S&De)===De){Me!==null&&(Me=Me.next={eventTime:Ke,lane:0,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null});e:{var et=f,tt=ee;switch(De=m,Ke=E,tt.tag){case 1:if(et=tt.payload,typeof et=="function"){Be=et.call(Ke,Be,De);break e}Be=et;break e;case 3:et.flags=et.flags&-65537|128;case 0:if(et=tt.payload,De=typeof et=="function"?et.call(Ke,Be,De):et,De==null)break e;Be=j({},Be,De);break e;case 2:Es=!0}}ee.callback!==null&&ee.lane!==0&&(f.flags|=64,De=I.effects,De===null?I.effects=[ee]:De.push(ee))}else Ke={eventTime:Ke,lane:De,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},Me===null?(ye=Me=Ke,ae=Be):Me=Me.next=Ke,V|=De;if(ee=ee.next,ee===null){if(ee=I.shared.pending,ee===null)break;De=ee,ee=De.next,De.next=null,I.lastBaseUpdate=De,I.shared.pending=null}}while(!0);if(Me===null&&(ae=Be),I.baseState=ae,I.firstBaseUpdate=ye,I.lastBaseUpdate=Me,m=I.shared.interleaved,m!==null){I=m;do V|=I.lane,I=I.next;while(I!==m)}else L===null&&(I.shared.lanes=0);fa|=V,f.lanes=V,f.memoizedState=Be}}function cb(f,m,E){if(f=m.effects,m.effects=null,f!==null)for(m=0;m<f.length;m++){var S=f[m],I=S.callback;if(I!==null){if(S.callback=null,S=E,typeof I!="function")throw Error(t(191,I));I.call(S)}}}var ju={},ar=gs(ju),Vu=gs(ju),Gu=gs(ju);function ca(f){if(f===ju)throw Error(t(174));return f}function Bp(f,m){switch(zt(Gu,m),zt(Vu,f),zt(ar,ju),f=m.nodeType,f){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Se(null,"");break;default:f=f===8?m.parentNode:m,m=f.namespaceURI||null,f=f.tagName,m=Se(m,f)}Wt(ar),zt(ar,m)}function go(){Wt(ar),Wt(Vu),Wt(Gu)}function db(f){ca(Gu.current);var m=ca(ar.current),E=Se(m,f.type);m!==E&&(zt(Vu,f),zt(ar,E))}function Up(f){Vu.current===f&&(Wt(ar),Wt(Vu))}var Xt=gs(0);function Gc(f){for(var m=f;m!==null;){if(m.tag===13){var E=m.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Hp=[];function zp(){for(var f=0;f<Hp.length;f++)Hp[f]._workInProgressVersionPrimary=null;Hp.length=0}var Wc=w.ReactCurrentDispatcher,jp=w.ReactCurrentBatchConfig,da=0,Qt=null,hn=null,En=null,qc=!1,Wu=!1,qu=0,eN=0;function Nn(){throw Error(t(321))}function Vp(f,m){if(m===null)return!1;for(var E=0;E<m.length&&E<f.length;E++)if(!Bi(f[E],m[E]))return!1;return!0}function Gp(f,m,E,S,I,L){if(da=L,Qt=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Wc.current=f===null||f.memoizedState===null?rN:sN,f=E(S,I),Wu){L=0;do{if(Wu=!1,qu=0,25<=L)throw Error(t(301));L+=1,En=hn=null,m.updateQueue=null,Wc.current=aN,f=E(S,I)}while(Wu)}if(Wc.current=Yc,m=hn!==null&&hn.next!==null,da=0,En=hn=Qt=null,qc=!1,m)throw Error(t(300));return f}function Wp(){var f=qu!==0;return qu=0,f}function or(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?Qt.memoizedState=En=f:En=En.next=f,En}function Ii(){if(hn===null){var f=Qt.alternate;f=f!==null?f.memoizedState:null}else f=hn.next;var m=En===null?Qt.memoizedState:En.next;if(m!==null)En=m,hn=f;else{if(f===null)throw Error(t(310));hn=f,f={memoizedState:hn.memoizedState,baseState:hn.baseState,baseQueue:hn.baseQueue,queue:hn.queue,next:null},En===null?Qt.memoizedState=En=f:En=En.next=f}return En}function $u(f,m){return typeof m=="function"?m(f):m}function qp(f){var m=Ii(),E=m.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=f;var S=hn,I=S.baseQueue,L=E.pending;if(L!==null){if(I!==null){var V=I.next;I.next=L.next,L.next=V}S.baseQueue=I=L,E.pending=null}if(I!==null){L=I.next,S=S.baseState;var ee=V=null,ae=null,ye=L;do{var Me=ye.lane;if((da&Me)===Me)ae!==null&&(ae=ae.next={lane:0,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null}),S=ye.hasEagerState?ye.eagerState:f(S,ye.action);else{var Be={lane:Me,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null};ae===null?(ee=ae=Be,V=S):ae=ae.next=Be,Qt.lanes|=Me,fa|=Me}ye=ye.next}while(ye!==null&&ye!==L);ae===null?V=S:ae.next=ee,Bi(S,m.memoizedState)||(Xn=!0),m.memoizedState=S,m.baseState=V,m.baseQueue=ae,E.lastRenderedState=S}if(f=E.interleaved,f!==null){I=f;do L=I.lane,Qt.lanes|=L,fa|=L,I=I.next;while(I!==f)}else I===null&&(E.lanes=0);return[m.memoizedState,E.dispatch]}function $p(f){var m=Ii(),E=m.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=f;var S=E.dispatch,I=E.pending,L=m.memoizedState;if(I!==null){E.pending=null;var V=I=I.next;do L=f(L,V.action),V=V.next;while(V!==I);Bi(L,m.memoizedState)||(Xn=!0),m.memoizedState=L,m.baseQueue===null&&(m.baseState=L),E.lastRenderedState=L}return[L,S]}function fb(){}function hb(f,m){var E=Qt,S=Ii(),I=m(),L=!Bi(S.memoizedState,I);if(L&&(S.memoizedState=I,Xn=!0),S=S.queue,Kp(gb.bind(null,E,S,f),[f]),S.getSnapshot!==m||L||En!==null&&En.memoizedState.tag&1){if(E.flags|=2048,Ku(9,mb.bind(null,E,S,I,m),void 0,null),bn===null)throw Error(t(349));(da&30)!==0||pb(E,m,I)}return I}function pb(f,m,E){f.flags|=16384,f={getSnapshot:m,value:E},m=Qt.updateQueue,m===null?(m={lastEffect:null,stores:null},Qt.updateQueue=m,m.stores=[f]):(E=m.stores,E===null?m.stores=[f]:E.push(f))}function mb(f,m,E,S){m.value=E,m.getSnapshot=S,vb(m)&&yb(f)}function gb(f,m,E){return E(function(){vb(m)&&yb(f)})}function vb(f){var m=f.getSnapshot;f=f.value;try{var E=m();return!Bi(f,E)}catch{return!0}}function yb(f){var m=Fr(f,1);m!==null&&Vi(m,f,1,-1)}function Eb(f){var m=or();return typeof f=="function"&&(f=f()),m.memoizedState=m.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$u,lastRenderedState:f},m.queue=f,f=f.dispatch=iN.bind(null,Qt,f),[m.memoizedState,f]}function Ku(f,m,E,S){return f={tag:f,create:m,destroy:E,deps:S,next:null},m=Qt.updateQueue,m===null?(m={lastEffect:null,stores:null},Qt.updateQueue=m,m.lastEffect=f.next=f):(E=m.lastEffect,E===null?m.lastEffect=f.next=f:(S=E.next,E.next=f,f.next=S,m.lastEffect=f)),f}function bb(){return Ii().memoizedState}function $c(f,m,E,S){var I=or();Qt.flags|=f,I.memoizedState=Ku(1|m,E,void 0,S===void 0?null:S)}function Kc(f,m,E,S){var I=Ii();S=S===void 0?null:S;var L=void 0;if(hn!==null){var V=hn.memoizedState;if(L=V.destroy,S!==null&&Vp(S,V.deps)){I.memoizedState=Ku(m,E,L,S);return}}Qt.flags|=f,I.memoizedState=Ku(1|m,E,L,S)}function Tb(f,m){return $c(8390656,8,f,m)}function Kp(f,m){return Kc(2048,8,f,m)}function xb(f,m){return Kc(4,2,f,m)}function Sb(f,m){return Kc(4,4,f,m)}function wb(f,m){if(typeof m=="function")return f=f(),m(f),function(){m(null)};if(m!=null)return f=f(),m.current=f,function(){m.current=null}}function Ab(f,m,E){return E=E!=null?E.concat([f]):null,Kc(4,4,wb.bind(null,m,f),E)}function Yp(){}function Cb(f,m){var E=Ii();m=m===void 0?null:m;var S=E.memoizedState;return S!==null&&m!==null&&Vp(m,S[1])?S[0]:(E.memoizedState=[f,m],f)}function Ib(f,m){var E=Ii();m=m===void 0?null:m;var S=E.memoizedState;return S!==null&&m!==null&&Vp(m,S[1])?S[0]:(f=f(),E.memoizedState=[f,m],f)}function Rb(f,m,E){return(da&21)===0?(f.baseState&&(f.baseState=!1,Xn=!0),f.memoizedState=E):(Bi(E,m)||(E=rE(),Qt.lanes|=E,fa|=E,f.baseState=!0),m)}function tN(f,m){var E=Pt;Pt=E!==0&&4>E?E:4,f(!0);var S=jp.transition;jp.transition={};try{f(!1),m()}finally{Pt=E,jp.transition=S}}function _b(){return Ii().memoizedState}function nN(f,m,E){var S=ws(f);if(E={lane:S,action:E,hasEagerState:!1,eagerState:null,next:null},Lb(f))Pb(m,E);else if(E=ob(f,m,E,S),E!==null){var I=Vn();Vi(E,f,S,I),kb(E,m,S)}}function iN(f,m,E){var S=ws(f),I={lane:S,action:E,hasEagerState:!1,eagerState:null,next:null};if(Lb(f))Pb(m,I);else{var L=f.alternate;if(f.lanes===0&&(L===null||L.lanes===0)&&(L=m.lastRenderedReducer,L!==null))try{var V=m.lastRenderedState,ee=L(V,E);if(I.hasEagerState=!0,I.eagerState=ee,Bi(ee,V)){var ae=m.interleaved;ae===null?(I.next=I,Mp(m)):(I.next=ae.next,ae.next=I),m.interleaved=I;return}}catch{}finally{}E=ob(f,m,I,S),E!==null&&(I=Vn(),Vi(E,f,S,I),kb(E,m,S))}}function Lb(f){var m=f.alternate;return f===Qt||m!==null&&m===Qt}function Pb(f,m){Wu=qc=!0;var E=f.pending;E===null?m.next=m:(m.next=E.next,E.next=m),f.pending=m}function kb(f,m,E){if((E&4194240)!==0){var S=m.lanes;S&=f.pendingLanes,E|=S,m.lanes=E,Qh(f,E)}}var Yc={readContext:Ci,useCallback:Nn,useContext:Nn,useEffect:Nn,useImperativeHandle:Nn,useInsertionEffect:Nn,useLayoutEffect:Nn,useMemo:Nn,useReducer:Nn,useRef:Nn,useState:Nn,useDebugValue:Nn,useDeferredValue:Nn,useTransition:Nn,useMutableSource:Nn,useSyncExternalStore:Nn,useId:Nn,unstable_isNewReconciler:!1},rN={readContext:Ci,useCallback:function(f,m){return or().memoizedState=[f,m===void 0?null:m],f},useContext:Ci,useEffect:Tb,useImperativeHandle:function(f,m,E){return E=E!=null?E.concat([f]):null,$c(4194308,4,wb.bind(null,m,f),E)},useLayoutEffect:function(f,m){return $c(4194308,4,f,m)},useInsertionEffect:function(f,m){return $c(4,2,f,m)},useMemo:function(f,m){var E=or();return m=m===void 0?null:m,f=f(),E.memoizedState=[f,m],f},useReducer:function(f,m,E){var S=or();return m=E!==void 0?E(m):m,S.memoizedState=S.baseState=m,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:m},S.queue=f,f=f.dispatch=nN.bind(null,Qt,f),[S.memoizedState,f]},useRef:function(f){var m=or();return f={current:f},m.memoizedState=f},useState:Eb,useDebugValue:Yp,useDeferredValue:function(f){return or().memoizedState=f},useTransition:function(){var f=Eb(!1),m=f[0];return f=tN.bind(null,f[1]),or().memoizedState=f,[m,f]},useMutableSource:function(){},useSyncExternalStore:function(f,m,E){var S=Qt,I=or();if($t){if(E===void 0)throw Error(t(407));E=E()}else{if(E=m(),bn===null)throw Error(t(349));(da&30)!==0||pb(S,m,E)}I.memoizedState=E;var L={value:E,getSnapshot:m};return I.queue=L,Tb(gb.bind(null,S,L,f),[f]),S.flags|=2048,Ku(9,mb.bind(null,S,L,E,m),void 0,null),E},useId:function(){var f=or(),m=bn.identifierPrefix;if($t){var E=Mr,S=Nr;E=(S&~(1<<32-Fi(S)-1)).toString(32)+E,m=":"+m+"R"+E,E=qu++,0<E&&(m+="H"+E.toString(32)),m+=":"}else E=eN++,m=":"+m+"r"+E.toString(32)+":";return f.memoizedState=m},unstable_isNewReconciler:!1},sN={readContext:Ci,useCallback:Cb,useContext:Ci,useEffect:Kp,useImperativeHandle:Ab,useInsertionEffect:xb,useLayoutEffect:Sb,useMemo:Ib,useReducer:qp,useRef:bb,useState:function(){return qp($u)},useDebugValue:Yp,useDeferredValue:function(f){var m=Ii();return Rb(m,hn.memoizedState,f)},useTransition:function(){var f=qp($u)[0],m=Ii().memoizedState;return[f,m]},useMutableSource:fb,useSyncExternalStore:hb,useId:_b,unstable_isNewReconciler:!1},aN={readContext:Ci,useCallback:Cb,useContext:Ci,useEffect:Kp,useImperativeHandle:Ab,useInsertionEffect:xb,useLayoutEffect:Sb,useMemo:Ib,useReducer:$p,useRef:bb,useState:function(){return $p($u)},useDebugValue:Yp,useDeferredValue:function(f){var m=Ii();return hn===null?m.memoizedState=f:Rb(m,hn.memoizedState,f)},useTransition:function(){var f=$p($u)[0],m=Ii().memoizedState;return[f,m]},useMutableSource:fb,useSyncExternalStore:hb,useId:_b,unstable_isNewReconciler:!1};function Hi(f,m){if(f&&f.defaultProps){m=j({},m),f=f.defaultProps;for(var E in f)m[E]===void 0&&(m[E]=f[E]);return m}return m}function Xp(f,m,E,S){m=f.memoizedState,E=E(S,m),E=E==null?m:j({},m,E),f.memoizedState=E,f.lanes===0&&(f.updateQueue.baseState=E)}var Xc={isMounted:function(f){return(f=f._reactInternals)?ra(f)===f:!1},enqueueSetState:function(f,m,E){f=f._reactInternals;var S=Vn(),I=ws(f),L=Br(S,I);L.payload=m,E!=null&&(L.callback=E),m=bs(f,L,I),m!==null&&(Vi(m,f,I,S),jc(m,f,I))},enqueueReplaceState:function(f,m,E){f=f._reactInternals;var S=Vn(),I=ws(f),L=Br(S,I);L.tag=1,L.payload=m,E!=null&&(L.callback=E),m=bs(f,L,I),m!==null&&(Vi(m,f,I,S),jc(m,f,I))},enqueueForceUpdate:function(f,m){f=f._reactInternals;var E=Vn(),S=ws(f),I=Br(E,S);I.tag=2,m!=null&&(I.callback=m),m=bs(f,I,S),m!==null&&(Vi(m,f,S,E),jc(m,f,S))}};function Db(f,m,E,S,I,L,V){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(S,L,V):m.prototype&&m.prototype.isPureReactComponent?!Ou(E,S)||!Ou(I,L):!0}function Ob(f,m,E){var S=!1,I=vs,L=m.contextType;return typeof L=="object"&&L!==null?L=Ci(L):(I=Yn(m)?aa:On.current,S=m.contextTypes,L=(S=S!=null)?uo(f,I):vs),m=new m(E,L),f.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Xc,f.stateNode=m,m._reactInternals=f,S&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=I,f.__reactInternalMemoizedMaskedChildContext=L),m}function Nb(f,m,E,S){f=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(E,S),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(E,S),m.state!==f&&Xc.enqueueReplaceState(m,m.state,null)}function Qp(f,m,E,S){var I=f.stateNode;I.props=E,I.state=f.memoizedState,I.refs={},Fp(f);var L=m.contextType;typeof L=="object"&&L!==null?I.context=Ci(L):(L=Yn(m)?aa:On.current,I.context=uo(f,L)),I.state=f.memoizedState,L=m.getDerivedStateFromProps,typeof L=="function"&&(Xp(f,m,L,E),I.state=f.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(m=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),m!==I.state&&Xc.enqueueReplaceState(I,I.state,null),Vc(f,E,I,S),I.state=f.memoizedState),typeof I.componentDidMount=="function"&&(f.flags|=4194308)}function vo(f,m){try{var E="",S=m;do E+=Le(S),S=S.return;while(S);var I=E}catch(L){I=`
Error generating stack: `+L.message+`
`+L.stack}return{value:f,source:m,stack:I,digest:null}}function Zp(f,m,E){return{value:f,source:null,stack:E??null,digest:m??null}}function Jp(f,m){try{console.error(m.value)}catch(E){setTimeout(function(){throw E})}}var oN=typeof WeakMap=="function"?WeakMap:Map;function Mb(f,m,E){E=Br(-1,E),E.tag=3,E.payload={element:null};var S=m.value;return E.callback=function(){id||(id=!0,p0=S),Jp(f,m)},E}function Fb(f,m,E){E=Br(-1,E),E.tag=3;var S=f.type.getDerivedStateFromError;if(typeof S=="function"){var I=m.value;E.payload=function(){return S(I)},E.callback=function(){Jp(f,m)}}var L=f.stateNode;return L!==null&&typeof L.componentDidCatch=="function"&&(E.callback=function(){Jp(f,m),typeof S!="function"&&(xs===null?xs=new Set([this]):xs.add(this));var V=m.stack;this.componentDidCatch(m.value,{componentStack:V!==null?V:""})}),E}function Bb(f,m,E){var S=f.pingCache;if(S===null){S=f.pingCache=new oN;var I=new Set;S.set(m,I)}else I=S.get(m),I===void 0&&(I=new Set,S.set(m,I));I.has(E)||(I.add(E),f=TN.bind(null,f,m,E),m.then(f,f))}function Ub(f){do{var m;if((m=f.tag===13)&&(m=f.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return f;f=f.return}while(f!==null);return null}function Hb(f,m,E,S,I){return(f.mode&1)===0?(f===m?f.flags|=65536:(f.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(m=Br(-1,1),m.tag=2,bs(E,m,1))),E.lanes|=1),f):(f.flags|=65536,f.lanes=I,f)}var uN=w.ReactCurrentOwner,Xn=!1;function jn(f,m,E,S){m.child=f===null?ab(m,null,E,S):ho(m,f.child,E,S)}function zb(f,m,E,S,I){E=E.render;var L=m.ref;return mo(m,I),S=Gp(f,m,E,S,L,I),E=Wp(),f!==null&&!Xn?(m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~I,Ur(f,m,I)):($t&&E&&Ip(m),m.flags|=1,jn(f,m,S,I),m.child)}function jb(f,m,E,S,I){if(f===null){var L=E.type;return typeof L=="function"&&!T0(L)&&L.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(m.tag=15,m.type=L,Vb(f,m,L,S,I)):(f=ld(E.type,null,S,m,m.mode,I),f.ref=m.ref,f.return=m,m.child=f)}if(L=f.child,(f.lanes&I)===0){var V=L.memoizedProps;if(E=E.compare,E=E!==null?E:Ou,E(V,S)&&f.ref===m.ref)return Ur(f,m,I)}return m.flags|=1,f=Cs(L,S),f.ref=m.ref,f.return=m,m.child=f}function Vb(f,m,E,S,I){if(f!==null){var L=f.memoizedProps;if(Ou(L,S)&&f.ref===m.ref)if(Xn=!1,m.pendingProps=S=L,(f.lanes&I)!==0)(f.flags&131072)!==0&&(Xn=!0);else return m.lanes=f.lanes,Ur(f,m,I)}return e0(f,m,E,S,I)}function Gb(f,m,E){var S=m.pendingProps,I=S.children,L=f!==null?f.memoizedState:null;if(S.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},zt(Eo,di),di|=E;else{if((E&1073741824)===0)return f=L!==null?L.baseLanes|E:E,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:f,cachePool:null,transitions:null},m.updateQueue=null,zt(Eo,di),di|=f,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=L!==null?L.baseLanes:E,zt(Eo,di),di|=S}else L!==null?(S=L.baseLanes|E,m.memoizedState=null):S=E,zt(Eo,di),di|=S;return jn(f,m,I,E),m.child}function Wb(f,m){var E=m.ref;(f===null&&E!==null||f!==null&&f.ref!==E)&&(m.flags|=512,m.flags|=2097152)}function e0(f,m,E,S,I){var L=Yn(E)?aa:On.current;return L=uo(m,L),mo(m,I),E=Gp(f,m,E,S,L,I),S=Wp(),f!==null&&!Xn?(m.updateQueue=f.updateQueue,m.flags&=-2053,f.lanes&=~I,Ur(f,m,I)):($t&&S&&Ip(m),m.flags|=1,jn(f,m,E,I),m.child)}function qb(f,m,E,S,I){if(Yn(E)){var L=!0;Oc(m)}else L=!1;if(mo(m,I),m.stateNode===null)Zc(f,m),Ob(m,E,S),Qp(m,E,S,I),S=!0;else if(f===null){var V=m.stateNode,ee=m.memoizedProps;V.props=ee;var ae=V.context,ye=E.contextType;typeof ye=="object"&&ye!==null?ye=Ci(ye):(ye=Yn(E)?aa:On.current,ye=uo(m,ye));var Me=E.getDerivedStateFromProps,Be=typeof Me=="function"||typeof V.getSnapshotBeforeUpdate=="function";Be||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(ee!==S||ae!==ye)&&Nb(m,V,S,ye),Es=!1;var De=m.memoizedState;V.state=De,Vc(m,S,V,I),ae=m.memoizedState,ee!==S||De!==ae||Kn.current||Es?(typeof Me=="function"&&(Xp(m,E,Me,S),ae=m.memoizedState),(ee=Es||Db(m,E,ee,S,De,ae,ye))?(Be||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount()),typeof V.componentDidMount=="function"&&(m.flags|=4194308)):(typeof V.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=S,m.memoizedState=ae),V.props=S,V.state=ae,V.context=ye,S=ee):(typeof V.componentDidMount=="function"&&(m.flags|=4194308),S=!1)}else{V=m.stateNode,ub(f,m),ee=m.memoizedProps,ye=m.type===m.elementType?ee:Hi(m.type,ee),V.props=ye,Be=m.pendingProps,De=V.context,ae=E.contextType,typeof ae=="object"&&ae!==null?ae=Ci(ae):(ae=Yn(E)?aa:On.current,ae=uo(m,ae));var Ke=E.getDerivedStateFromProps;(Me=typeof Ke=="function"||typeof V.getSnapshotBeforeUpdate=="function")||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(ee!==Be||De!==ae)&&Nb(m,V,S,ae),Es=!1,De=m.memoizedState,V.state=De,Vc(m,S,V,I);var et=m.memoizedState;ee!==Be||De!==et||Kn.current||Es?(typeof Ke=="function"&&(Xp(m,E,Ke,S),et=m.memoizedState),(ye=Es||Db(m,E,ye,S,De,et,ae)||!1)?(Me||typeof V.UNSAFE_componentWillUpdate!="function"&&typeof V.componentWillUpdate!="function"||(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(S,et,ae),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(S,et,ae)),typeof V.componentDidUpdate=="function"&&(m.flags|=4),typeof V.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof V.componentDidUpdate!="function"||ee===f.memoizedProps&&De===f.memoizedState||(m.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||ee===f.memoizedProps&&De===f.memoizedState||(m.flags|=1024),m.memoizedProps=S,m.memoizedState=et),V.props=S,V.state=et,V.context=ae,S=ye):(typeof V.componentDidUpdate!="function"||ee===f.memoizedProps&&De===f.memoizedState||(m.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||ee===f.memoizedProps&&De===f.memoizedState||(m.flags|=1024),S=!1)}return t0(f,m,E,S,L,I)}function t0(f,m,E,S,I,L){Wb(f,m);var V=(m.flags&128)!==0;if(!S&&!V)return I&&QE(m,E,!1),Ur(f,m,L);S=m.stateNode,uN.current=m;var ee=V&&typeof E.getDerivedStateFromError!="function"?null:S.render();return m.flags|=1,f!==null&&V?(m.child=ho(m,f.child,null,L),m.child=ho(m,null,ee,L)):jn(f,m,ee,L),m.memoizedState=S.state,I&&QE(m,E,!0),m.child}function $b(f){var m=f.stateNode;m.pendingContext?YE(f,m.pendingContext,m.pendingContext!==m.context):m.context&&YE(f,m.context,!1),Bp(f,m.containerInfo)}function Kb(f,m,E,S,I){return fo(),Pp(I),m.flags|=256,jn(f,m,E,S),m.child}var n0={dehydrated:null,treeContext:null,retryLane:0};function i0(f){return{baseLanes:f,cachePool:null,transitions:null}}function Yb(f,m,E){var S=m.pendingProps,I=Xt.current,L=!1,V=(m.flags&128)!==0,ee;if((ee=V)||(ee=f!==null&&f.memoizedState===null?!1:(I&2)!==0),ee?(L=!0,m.flags&=-129):(f===null||f.memoizedState!==null)&&(I|=1),zt(Xt,I&1),f===null)return Lp(m),f=m.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((m.mode&1)===0?m.lanes=1:f.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(V=S.children,f=S.fallback,L?(S=m.mode,L=m.child,V={mode:"hidden",children:V},(S&1)===0&&L!==null?(L.childLanes=0,L.pendingProps=V):L=cd(V,S,0,null),f=ga(f,S,E,null),L.return=m,f.return=m,L.sibling=f,m.child=L,m.child.memoizedState=i0(E),m.memoizedState=n0,f):r0(m,V));if(I=f.memoizedState,I!==null&&(ee=I.dehydrated,ee!==null))return lN(f,m,V,S,ee,I,E);if(L){L=S.fallback,V=m.mode,I=f.child,ee=I.sibling;var ae={mode:"hidden",children:S.children};return(V&1)===0&&m.child!==I?(S=m.child,S.childLanes=0,S.pendingProps=ae,m.deletions=null):(S=Cs(I,ae),S.subtreeFlags=I.subtreeFlags&14680064),ee!==null?L=Cs(ee,L):(L=ga(L,V,E,null),L.flags|=2),L.return=m,S.return=m,S.sibling=L,m.child=S,S=L,L=m.child,V=f.child.memoizedState,V=V===null?i0(E):{baseLanes:V.baseLanes|E,cachePool:null,transitions:V.transitions},L.memoizedState=V,L.childLanes=f.childLanes&~E,m.memoizedState=n0,S}return L=f.child,f=L.sibling,S=Cs(L,{mode:"visible",children:S.children}),(m.mode&1)===0&&(S.lanes=E),S.return=m,S.sibling=null,f!==null&&(E=m.deletions,E===null?(m.deletions=[f],m.flags|=16):E.push(f)),m.child=S,m.memoizedState=null,S}function r0(f,m){return m=cd({mode:"visible",children:m},f.mode,0,null),m.return=f,f.child=m}function Qc(f,m,E,S){return S!==null&&Pp(S),ho(m,f.child,null,E),f=r0(m,m.pendingProps.children),f.flags|=2,m.memoizedState=null,f}function lN(f,m,E,S,I,L,V){if(E)return m.flags&256?(m.flags&=-257,S=Zp(Error(t(422))),Qc(f,m,V,S)):m.memoizedState!==null?(m.child=f.child,m.flags|=128,null):(L=S.fallback,I=m.mode,S=cd({mode:"visible",children:S.children},I,0,null),L=ga(L,I,V,null),L.flags|=2,S.return=m,L.return=m,S.sibling=L,m.child=S,(m.mode&1)!==0&&ho(m,f.child,null,V),m.child.memoizedState=i0(V),m.memoizedState=n0,L);if((m.mode&1)===0)return Qc(f,m,V,null);if(I.data==="$!"){if(S=I.nextSibling&&I.nextSibling.dataset,S)var ee=S.dgst;return S=ee,L=Error(t(419)),S=Zp(L,S,void 0),Qc(f,m,V,S)}if(ee=(V&f.childLanes)!==0,Xn||ee){if(S=bn,S!==null){switch(V&-V){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(S.suspendedLanes|V))!==0?0:I,I!==0&&I!==L.retryLane&&(L.retryLane=I,Fr(f,I),Vi(S,f,I,-1))}return b0(),S=Zp(Error(t(421))),Qc(f,m,V,S)}return I.data==="$?"?(m.flags|=128,m.child=f.child,m=xN.bind(null,f),I._reactRetry=m,null):(f=L.treeContext,ci=ms(I.nextSibling),li=m,$t=!0,Ui=null,f!==null&&(wi[Ai++]=Nr,wi[Ai++]=Mr,wi[Ai++]=oa,Nr=f.id,Mr=f.overflow,oa=m),m=r0(m,S.children),m.flags|=4096,m)}function Xb(f,m,E){f.lanes|=m;var S=f.alternate;S!==null&&(S.lanes|=m),Np(f.return,m,E)}function s0(f,m,E,S,I){var L=f.memoizedState;L===null?f.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:S,tail:E,tailMode:I}:(L.isBackwards=m,L.rendering=null,L.renderingStartTime=0,L.last=S,L.tail=E,L.tailMode=I)}function Qb(f,m,E){var S=m.pendingProps,I=S.revealOrder,L=S.tail;if(jn(f,m,S.children,E),S=Xt.current,(S&2)!==0)S=S&1|2,m.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=m.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Xb(f,E,m);else if(f.tag===19)Xb(f,E,m);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===m)break e;for(;f.sibling===null;){if(f.return===null||f.return===m)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}S&=1}if(zt(Xt,S),(m.mode&1)===0)m.memoizedState=null;else switch(I){case"forwards":for(E=m.child,I=null;E!==null;)f=E.alternate,f!==null&&Gc(f)===null&&(I=E),E=E.sibling;E=I,E===null?(I=m.child,m.child=null):(I=E.sibling,E.sibling=null),s0(m,!1,I,E,L);break;case"backwards":for(E=null,I=m.child,m.child=null;I!==null;){if(f=I.alternate,f!==null&&Gc(f)===null){m.child=I;break}f=I.sibling,I.sibling=E,E=I,I=f}s0(m,!0,E,null,L);break;case"together":s0(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Zc(f,m){(m.mode&1)===0&&f!==null&&(f.alternate=null,m.alternate=null,m.flags|=2)}function Ur(f,m,E){if(f!==null&&(m.dependencies=f.dependencies),fa|=m.lanes,(E&m.childLanes)===0)return null;if(f!==null&&m.child!==f.child)throw Error(t(153));if(m.child!==null){for(f=m.child,E=Cs(f,f.pendingProps),m.child=E,E.return=m;f.sibling!==null;)f=f.sibling,E=E.sibling=Cs(f,f.pendingProps),E.return=m;E.sibling=null}return m.child}function cN(f,m,E){switch(m.tag){case 3:$b(m),fo();break;case 5:db(m);break;case 1:Yn(m.type)&&Oc(m);break;case 4:Bp(m,m.stateNode.containerInfo);break;case 10:var S=m.type._context,I=m.memoizedProps.value;zt(Hc,S._currentValue),S._currentValue=I;break;case 13:if(S=m.memoizedState,S!==null)return S.dehydrated!==null?(zt(Xt,Xt.current&1),m.flags|=128,null):(E&m.child.childLanes)!==0?Yb(f,m,E):(zt(Xt,Xt.current&1),f=Ur(f,m,E),f!==null?f.sibling:null);zt(Xt,Xt.current&1);break;case 19:if(S=(E&m.childLanes)!==0,(f.flags&128)!==0){if(S)return Qb(f,m,E);m.flags|=128}if(I=m.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),zt(Xt,Xt.current),S)break;return null;case 22:case 23:return m.lanes=0,Gb(f,m,E)}return Ur(f,m,E)}var Zb,a0,Jb,eT;Zb=function(f,m){for(var E=m.child;E!==null;){if(E.tag===5||E.tag===6)f.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===m)break;for(;E.sibling===null;){if(E.return===null||E.return===m)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},a0=function(){},Jb=function(f,m,E,S){var I=f.memoizedProps;if(I!==S){f=m.stateNode,ca(ar.current);var L=null;switch(E){case"input":I=Ye(f,I),S=Ye(f,S),L=[];break;case"select":I=j({},I,{value:void 0}),S=j({},S,{value:void 0}),L=[];break;case"textarea":I=Fe(f,I),S=Fe(f,S),L=[];break;default:typeof I.onClick!="function"&&typeof S.onClick=="function"&&(f.onclick=Pc)}ft(E,S);var V;E=null;for(ye in I)if(!S.hasOwnProperty(ye)&&I.hasOwnProperty(ye)&&I[ye]!=null)if(ye==="style"){var ee=I[ye];for(V in ee)ee.hasOwnProperty(V)&&(E||(E={}),E[V]="")}else ye!=="dangerouslySetInnerHTML"&&ye!=="children"&&ye!=="suppressContentEditableWarning"&&ye!=="suppressHydrationWarning"&&ye!=="autoFocus"&&(r.hasOwnProperty(ye)?L||(L=[]):(L=L||[]).push(ye,null));for(ye in S){var ae=S[ye];if(ee=I!=null?I[ye]:void 0,S.hasOwnProperty(ye)&&ae!==ee&&(ae!=null||ee!=null))if(ye==="style")if(ee){for(V in ee)!ee.hasOwnProperty(V)||ae&&ae.hasOwnProperty(V)||(E||(E={}),E[V]="");for(V in ae)ae.hasOwnProperty(V)&&ee[V]!==ae[V]&&(E||(E={}),E[V]=ae[V])}else E||(L||(L=[]),L.push(ye,E)),E=ae;else ye==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ee=ee?ee.__html:void 0,ae!=null&&ee!==ae&&(L=L||[]).push(ye,ae)):ye==="children"?typeof ae!="string"&&typeof ae!="number"||(L=L||[]).push(ye,""+ae):ye!=="suppressContentEditableWarning"&&ye!=="suppressHydrationWarning"&&(r.hasOwnProperty(ye)?(ae!=null&&ye==="onScroll"&&Gt("scroll",f),L||ee===ae||(L=[])):(L=L||[]).push(ye,ae))}E&&(L=L||[]).push("style",E);var ye=L;(m.updateQueue=ye)&&(m.flags|=4)}},eT=function(f,m,E,S){E!==S&&(m.flags|=4)};function Yu(f,m){if(!$t)switch(f.tailMode){case"hidden":m=f.tail;for(var E=null;m!==null;)m.alternate!==null&&(E=m),m=m.sibling;E===null?f.tail=null:E.sibling=null;break;case"collapsed":E=f.tail;for(var S=null;E!==null;)E.alternate!==null&&(S=E),E=E.sibling;S===null?m||f.tail===null?f.tail=null:f.tail.sibling=null:S.sibling=null}}function Mn(f){var m=f.alternate!==null&&f.alternate.child===f.child,E=0,S=0;if(m)for(var I=f.child;I!==null;)E|=I.lanes|I.childLanes,S|=I.subtreeFlags&14680064,S|=I.flags&14680064,I.return=f,I=I.sibling;else for(I=f.child;I!==null;)E|=I.lanes|I.childLanes,S|=I.subtreeFlags,S|=I.flags,I.return=f,I=I.sibling;return f.subtreeFlags|=S,f.childLanes=E,m}function dN(f,m,E){var S=m.pendingProps;switch(Rp(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mn(m),null;case 1:return Yn(m.type)&&Dc(),Mn(m),null;case 3:return S=m.stateNode,go(),Wt(Kn),Wt(On),zp(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(f===null||f.child===null)&&(Bc(m)?m.flags|=4:f===null||f.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Ui!==null&&(v0(Ui),Ui=null))),a0(f,m),Mn(m),null;case 5:Up(m);var I=ca(Gu.current);if(E=m.type,f!==null&&m.stateNode!=null)Jb(f,m,E,S,I),f.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!S){if(m.stateNode===null)throw Error(t(166));return Mn(m),null}if(f=ca(ar.current),Bc(m)){S=m.stateNode,E=m.type;var L=m.memoizedProps;switch(S[sr]=m,S[Uu]=L,f=(m.mode&1)!==0,E){case"dialog":Gt("cancel",S),Gt("close",S);break;case"iframe":case"object":case"embed":Gt("load",S);break;case"video":case"audio":for(I=0;I<Mu.length;I++)Gt(Mu[I],S);break;case"source":Gt("error",S);break;case"img":case"image":case"link":Gt("error",S),Gt("load",S);break;case"details":Gt("toggle",S);break;case"input":It(S,L),Gt("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!L.multiple},Gt("invalid",S);break;case"textarea":Pe(S,L),Gt("invalid",S)}ft(E,L),I=null;for(var V in L)if(L.hasOwnProperty(V)){var ee=L[V];V==="children"?typeof ee=="string"?S.textContent!==ee&&(L.suppressHydrationWarning!==!0&&Lc(S.textContent,ee,f),I=["children",ee]):typeof ee=="number"&&S.textContent!==""+ee&&(L.suppressHydrationWarning!==!0&&Lc(S.textContent,ee,f),I=["children",""+ee]):r.hasOwnProperty(V)&&ee!=null&&V==="onScroll"&&Gt("scroll",S)}switch(E){case"input":de(S),$(S,L,!0);break;case"textarea":de(S),mt(S);break;case"select":case"option":break;default:typeof L.onClick=="function"&&(S.onclick=Pc)}S=I,m.updateQueue=S,S!==null&&(m.flags|=4)}else{V=I.nodeType===9?I:I.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=he(E)),f==="http://www.w3.org/1999/xhtml"?E==="script"?(f=V.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof S.is=="string"?f=V.createElement(E,{is:S.is}):(f=V.createElement(E),E==="select"&&(V=f,S.multiple?V.multiple=!0:S.size&&(V.size=S.size))):f=V.createElementNS(f,E),f[sr]=m,f[Uu]=S,Zb(f,m,!1,!1),m.stateNode=f;e:{switch(V=nt(E,S),E){case"dialog":Gt("cancel",f),Gt("close",f),I=S;break;case"iframe":case"object":case"embed":Gt("load",f),I=S;break;case"video":case"audio":for(I=0;I<Mu.length;I++)Gt(Mu[I],f);I=S;break;case"source":Gt("error",f),I=S;break;case"img":case"image":case"link":Gt("error",f),Gt("load",f),I=S;break;case"details":Gt("toggle",f),I=S;break;case"input":It(f,S),I=Ye(f,S),Gt("invalid",f);break;case"option":I=S;break;case"select":f._wrapperState={wasMultiple:!!S.multiple},I=j({},S,{value:void 0}),Gt("invalid",f);break;case"textarea":Pe(f,S),I=Fe(f,S),Gt("invalid",f);break;default:I=S}ft(E,I),ee=I;for(L in ee)if(ee.hasOwnProperty(L)){var ae=ee[L];L==="style"?Ne(f,ae):L==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ae!=null&&F(f,ae)):L==="children"?typeof ae=="string"?(E!=="textarea"||ae!=="")&&M(f,ae):typeof ae=="number"&&M(f,""+ae):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(r.hasOwnProperty(L)?ae!=null&&L==="onScroll"&&Gt("scroll",f):ae!=null&&x(f,L,ae,V))}switch(E){case"input":de(f),$(f,S,!1);break;case"textarea":de(f),mt(f);break;case"option":S.value!=null&&f.setAttribute("value",""+ke(S.value));break;case"select":f.multiple=!!S.multiple,L=S.value,L!=null?_e(f,!!S.multiple,L,!1):S.defaultValue!=null&&_e(f,!!S.multiple,S.defaultValue,!0);break;default:typeof I.onClick=="function"&&(f.onclick=Pc)}switch(E){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return Mn(m),null;case 6:if(f&&m.stateNode!=null)eT(f,m,f.memoizedProps,S);else{if(typeof S!="string"&&m.stateNode===null)throw Error(t(166));if(E=ca(Gu.current),ca(ar.current),Bc(m)){if(S=m.stateNode,E=m.memoizedProps,S[sr]=m,(L=S.nodeValue!==E)&&(f=li,f!==null))switch(f.tag){case 3:Lc(S.nodeValue,E,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&Lc(S.nodeValue,E,(f.mode&1)!==0)}L&&(m.flags|=4)}else S=(E.nodeType===9?E:E.ownerDocument).createTextNode(S),S[sr]=m,m.stateNode=S}return Mn(m),null;case 13:if(Wt(Xt),S=m.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if($t&&ci!==null&&(m.mode&1)!==0&&(m.flags&128)===0)ib(),fo(),m.flags|=98560,L=!1;else if(L=Bc(m),S!==null&&S.dehydrated!==null){if(f===null){if(!L)throw Error(t(318));if(L=m.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(t(317));L[sr]=m}else fo(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Mn(m),L=!1}else Ui!==null&&(v0(Ui),Ui=null),L=!0;if(!L)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=E,m):(S=S!==null,S!==(f!==null&&f.memoizedState!==null)&&S&&(m.child.flags|=8192,(m.mode&1)!==0&&(f===null||(Xt.current&1)!==0?pn===0&&(pn=3):b0())),m.updateQueue!==null&&(m.flags|=4),Mn(m),null);case 4:return go(),a0(f,m),f===null&&Fu(m.stateNode.containerInfo),Mn(m),null;case 10:return Op(m.type._context),Mn(m),null;case 17:return Yn(m.type)&&Dc(),Mn(m),null;case 19:if(Wt(Xt),L=m.memoizedState,L===null)return Mn(m),null;if(S=(m.flags&128)!==0,V=L.rendering,V===null)if(S)Yu(L,!1);else{if(pn!==0||f!==null&&(f.flags&128)!==0)for(f=m.child;f!==null;){if(V=Gc(f),V!==null){for(m.flags|=128,Yu(L,!1),S=V.updateQueue,S!==null&&(m.updateQueue=S,m.flags|=4),m.subtreeFlags=0,S=E,E=m.child;E!==null;)L=E,f=S,L.flags&=14680066,V=L.alternate,V===null?(L.childLanes=0,L.lanes=f,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=V.childLanes,L.lanes=V.lanes,L.child=V.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=V.memoizedProps,L.memoizedState=V.memoizedState,L.updateQueue=V.updateQueue,L.type=V.type,f=V.dependencies,L.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),E=E.sibling;return zt(Xt,Xt.current&1|2),m.child}f=f.sibling}L.tail!==null&&rn()>bo&&(m.flags|=128,S=!0,Yu(L,!1),m.lanes=4194304)}else{if(!S)if(f=Gc(V),f!==null){if(m.flags|=128,S=!0,E=f.updateQueue,E!==null&&(m.updateQueue=E,m.flags|=4),Yu(L,!0),L.tail===null&&L.tailMode==="hidden"&&!V.alternate&&!$t)return Mn(m),null}else 2*rn()-L.renderingStartTime>bo&&E!==1073741824&&(m.flags|=128,S=!0,Yu(L,!1),m.lanes=4194304);L.isBackwards?(V.sibling=m.child,m.child=V):(E=L.last,E!==null?E.sibling=V:m.child=V,L.last=V)}return L.tail!==null?(m=L.tail,L.rendering=m,L.tail=m.sibling,L.renderingStartTime=rn(),m.sibling=null,E=Xt.current,zt(Xt,S?E&1|2:E&1),m):(Mn(m),null);case 22:case 23:return E0(),S=m.memoizedState!==null,f!==null&&f.memoizedState!==null!==S&&(m.flags|=8192),S&&(m.mode&1)!==0?(di&1073741824)!==0&&(Mn(m),m.subtreeFlags&6&&(m.flags|=8192)):Mn(m),null;case 24:return null;case 25:return null}throw Error(t(156,m.tag))}function fN(f,m){switch(Rp(m),m.tag){case 1:return Yn(m.type)&&Dc(),f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 3:return go(),Wt(Kn),Wt(On),zp(),f=m.flags,(f&65536)!==0&&(f&128)===0?(m.flags=f&-65537|128,m):null;case 5:return Up(m),null;case 13:if(Wt(Xt),f=m.memoizedState,f!==null&&f.dehydrated!==null){if(m.alternate===null)throw Error(t(340));fo()}return f=m.flags,f&65536?(m.flags=f&-65537|128,m):null;case 19:return Wt(Xt),null;case 4:return go(),null;case 10:return Op(m.type._context),null;case 22:case 23:return E0(),null;case 24:return null;default:return null}}var Jc=!1,Fn=!1,hN=typeof WeakSet=="function"?WeakSet:Set,Ze=null;function yo(f,m){var E=f.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(S){tn(f,m,S)}else E.current=null}function o0(f,m,E){try{E()}catch(S){tn(f,m,S)}}var tT=!1;function pN(f,m){if(Ep=Ec,f=DE(),dp(f)){if("selectionStart"in f)var E={start:f.selectionStart,end:f.selectionEnd};else e:{E=(E=f.ownerDocument)&&E.defaultView||window;var S=E.getSelection&&E.getSelection();if(S&&S.rangeCount!==0){E=S.anchorNode;var I=S.anchorOffset,L=S.focusNode;S=S.focusOffset;try{E.nodeType,L.nodeType}catch{E=null;break e}var V=0,ee=-1,ae=-1,ye=0,Me=0,Be=f,De=null;t:for(;;){for(var Ke;Be!==E||I!==0&&Be.nodeType!==3||(ee=V+I),Be!==L||S!==0&&Be.nodeType!==3||(ae=V+S),Be.nodeType===3&&(V+=Be.nodeValue.length),(Ke=Be.firstChild)!==null;)De=Be,Be=Ke;for(;;){if(Be===f)break t;if(De===E&&++ye===I&&(ee=V),De===L&&++Me===S&&(ae=V),(Ke=Be.nextSibling)!==null)break;Be=De,De=Be.parentNode}Be=Ke}E=ee===-1||ae===-1?null:{start:ee,end:ae}}else E=null}E=E||{start:0,end:0}}else E=null;for(bp={focusedElem:f,selectionRange:E},Ec=!1,Ze=m;Ze!==null;)if(m=Ze,f=m.child,(m.subtreeFlags&1028)!==0&&f!==null)f.return=m,Ze=f;else for(;Ze!==null;){m=Ze;try{var et=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(et!==null){var tt=et.memoizedProps,sn=et.memoizedState,pe=m.stateNode,le=pe.getSnapshotBeforeUpdate(m.elementType===m.type?tt:Hi(m.type,tt),sn);pe.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var ge=m.stateNode.containerInfo;ge.nodeType===1?ge.textContent="":ge.nodeType===9&&ge.documentElement&&ge.removeChild(ge.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Ve){tn(m,m.return,Ve)}if(f=m.sibling,f!==null){f.return=m.return,Ze=f;break}Ze=m.return}return et=tT,tT=!1,et}function Xu(f,m,E){var S=m.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var I=S=S.next;do{if((I.tag&f)===f){var L=I.destroy;I.destroy=void 0,L!==void 0&&o0(m,E,L)}I=I.next}while(I!==S)}}function ed(f,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var E=m=m.next;do{if((E.tag&f)===f){var S=E.create;E.destroy=S()}E=E.next}while(E!==m)}}function u0(f){var m=f.ref;if(m!==null){var E=f.stateNode;switch(f.tag){case 5:f=E;break;default:f=E}typeof m=="function"?m(f):m.current=f}}function nT(f){var m=f.alternate;m!==null&&(f.alternate=null,nT(m)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(m=f.stateNode,m!==null&&(delete m[sr],delete m[Uu],delete m[wp],delete m[XO],delete m[QO])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function iT(f){return f.tag===5||f.tag===3||f.tag===4}function rT(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||iT(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function l0(f,m,E){var S=f.tag;if(S===5||S===6)f=f.stateNode,m?E.nodeType===8?E.parentNode.insertBefore(f,m):E.insertBefore(f,m):(E.nodeType===8?(m=E.parentNode,m.insertBefore(f,E)):(m=E,m.appendChild(f)),E=E._reactRootContainer,E!=null||m.onclick!==null||(m.onclick=Pc));else if(S!==4&&(f=f.child,f!==null))for(l0(f,m,E),f=f.sibling;f!==null;)l0(f,m,E),f=f.sibling}function c0(f,m,E){var S=f.tag;if(S===5||S===6)f=f.stateNode,m?E.insertBefore(f,m):E.appendChild(f);else if(S!==4&&(f=f.child,f!==null))for(c0(f,m,E),f=f.sibling;f!==null;)c0(f,m,E),f=f.sibling}var An=null,zi=!1;function Ts(f,m,E){for(E=E.child;E!==null;)sT(f,m,E),E=E.sibling}function sT(f,m,E){if(rr&&typeof rr.onCommitFiberUnmount=="function")try{rr.onCommitFiberUnmount(hc,E)}catch{}switch(E.tag){case 5:Fn||yo(E,m);case 6:var S=An,I=zi;An=null,Ts(f,m,E),An=S,zi=I,An!==null&&(zi?(f=An,E=E.stateNode,f.nodeType===8?f.parentNode.removeChild(E):f.removeChild(E)):An.removeChild(E.stateNode));break;case 18:An!==null&&(zi?(f=An,E=E.stateNode,f.nodeType===8?Sp(f.parentNode,E):f.nodeType===1&&Sp(f,E),Ru(f)):Sp(An,E.stateNode));break;case 4:S=An,I=zi,An=E.stateNode.containerInfo,zi=!0,Ts(f,m,E),An=S,zi=I;break;case 0:case 11:case 14:case 15:if(!Fn&&(S=E.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){I=S=S.next;do{var L=I,V=L.destroy;L=L.tag,V!==void 0&&((L&2)!==0||(L&4)!==0)&&o0(E,m,V),I=I.next}while(I!==S)}Ts(f,m,E);break;case 1:if(!Fn&&(yo(E,m),S=E.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=E.memoizedProps,S.state=E.memoizedState,S.componentWillUnmount()}catch(ee){tn(E,m,ee)}Ts(f,m,E);break;case 21:Ts(f,m,E);break;case 22:E.mode&1?(Fn=(S=Fn)||E.memoizedState!==null,Ts(f,m,E),Fn=S):Ts(f,m,E);break;default:Ts(f,m,E)}}function aT(f){var m=f.updateQueue;if(m!==null){f.updateQueue=null;var E=f.stateNode;E===null&&(E=f.stateNode=new hN),m.forEach(function(S){var I=SN.bind(null,f,S);E.has(S)||(E.add(S),S.then(I,I))})}}function ji(f,m){var E=m.deletions;if(E!==null)for(var S=0;S<E.length;S++){var I=E[S];try{var L=f,V=m,ee=V;e:for(;ee!==null;){switch(ee.tag){case 5:An=ee.stateNode,zi=!1;break e;case 3:An=ee.stateNode.containerInfo,zi=!0;break e;case 4:An=ee.stateNode.containerInfo,zi=!0;break e}ee=ee.return}if(An===null)throw Error(t(160));sT(L,V,I),An=null,zi=!1;var ae=I.alternate;ae!==null&&(ae.return=null),I.return=null}catch(ye){tn(I,m,ye)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)oT(m,f),m=m.sibling}function oT(f,m){var E=f.alternate,S=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(ji(m,f),ur(f),S&4){try{Xu(3,f,f.return),ed(3,f)}catch(tt){tn(f,f.return,tt)}try{Xu(5,f,f.return)}catch(tt){tn(f,f.return,tt)}}break;case 1:ji(m,f),ur(f),S&512&&E!==null&&yo(E,E.return);break;case 5:if(ji(m,f),ur(f),S&512&&E!==null&&yo(E,E.return),f.flags&32){var I=f.stateNode;try{M(I,"")}catch(tt){tn(f,f.return,tt)}}if(S&4&&(I=f.stateNode,I!=null)){var L=f.memoizedProps,V=E!==null?E.memoizedProps:L,ee=f.type,ae=f.updateQueue;if(f.updateQueue=null,ae!==null)try{ee==="input"&&L.type==="radio"&&L.name!=null&&Qe(I,L),nt(ee,V);var ye=nt(ee,L);for(V=0;V<ae.length;V+=2){var Me=ae[V],Be=ae[V+1];Me==="style"?Ne(I,Be):Me==="dangerouslySetInnerHTML"?F(I,Be):Me==="children"?M(I,Be):x(I,Me,Be,ye)}switch(ee){case"input":k(I,L);break;case"textarea":dt(I,L);break;case"select":var De=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!L.multiple;var Ke=L.value;Ke!=null?_e(I,!!L.multiple,Ke,!1):De!==!!L.multiple&&(L.defaultValue!=null?_e(I,!!L.multiple,L.defaultValue,!0):_e(I,!!L.multiple,L.multiple?[]:"",!1))}I[Uu]=L}catch(tt){tn(f,f.return,tt)}}break;case 6:if(ji(m,f),ur(f),S&4){if(f.stateNode===null)throw Error(t(162));I=f.stateNode,L=f.memoizedProps;try{I.nodeValue=L}catch(tt){tn(f,f.return,tt)}}break;case 3:if(ji(m,f),ur(f),S&4&&E!==null&&E.memoizedState.isDehydrated)try{Ru(m.containerInfo)}catch(tt){tn(f,f.return,tt)}break;case 4:ji(m,f),ur(f);break;case 13:ji(m,f),ur(f),I=f.child,I.flags&8192&&(L=I.memoizedState!==null,I.stateNode.isHidden=L,!L||I.alternate!==null&&I.alternate.memoizedState!==null||(h0=rn())),S&4&&aT(f);break;case 22:if(Me=E!==null&&E.memoizedState!==null,f.mode&1?(Fn=(ye=Fn)||Me,ji(m,f),Fn=ye):ji(m,f),ur(f),S&8192){if(ye=f.memoizedState!==null,(f.stateNode.isHidden=ye)&&!Me&&(f.mode&1)!==0)for(Ze=f,Me=f.child;Me!==null;){for(Be=Ze=Me;Ze!==null;){switch(De=Ze,Ke=De.child,De.tag){case 0:case 11:case 14:case 15:Xu(4,De,De.return);break;case 1:yo(De,De.return);var et=De.stateNode;if(typeof et.componentWillUnmount=="function"){S=De,E=De.return;try{m=S,et.props=m.memoizedProps,et.state=m.memoizedState,et.componentWillUnmount()}catch(tt){tn(S,E,tt)}}break;case 5:yo(De,De.return);break;case 22:if(De.memoizedState!==null){cT(Be);continue}}Ke!==null?(Ke.return=De,Ze=Ke):cT(Be)}Me=Me.sibling}e:for(Me=null,Be=f;;){if(Be.tag===5){if(Me===null){Me=Be;try{I=Be.stateNode,ye?(L=I.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none"):(ee=Be.stateNode,ae=Be.memoizedProps.style,V=ae!=null&&ae.hasOwnProperty("display")?ae.display:null,ee.style.display=Te("display",V))}catch(tt){tn(f,f.return,tt)}}}else if(Be.tag===6){if(Me===null)try{Be.stateNode.nodeValue=ye?"":Be.memoizedProps}catch(tt){tn(f,f.return,tt)}}else if((Be.tag!==22&&Be.tag!==23||Be.memoizedState===null||Be===f)&&Be.child!==null){Be.child.return=Be,Be=Be.child;continue}if(Be===f)break e;for(;Be.sibling===null;){if(Be.return===null||Be.return===f)break e;Me===Be&&(Me=null),Be=Be.return}Me===Be&&(Me=null),Be.sibling.return=Be.return,Be=Be.sibling}}break;case 19:ji(m,f),ur(f),S&4&&aT(f);break;case 21:break;default:ji(m,f),ur(f)}}function ur(f){var m=f.flags;if(m&2){try{e:{for(var E=f.return;E!==null;){if(iT(E)){var S=E;break e}E=E.return}throw Error(t(160))}switch(S.tag){case 5:var I=S.stateNode;S.flags&32&&(M(I,""),S.flags&=-33);var L=rT(f);c0(f,L,I);break;case 3:case 4:var V=S.stateNode.containerInfo,ee=rT(f);l0(f,ee,V);break;default:throw Error(t(161))}}catch(ae){tn(f,f.return,ae)}f.flags&=-3}m&4096&&(f.flags&=-4097)}function mN(f,m,E){Ze=f,uT(f)}function uT(f,m,E){for(var S=(f.mode&1)!==0;Ze!==null;){var I=Ze,L=I.child;if(I.tag===22&&S){var V=I.memoizedState!==null||Jc;if(!V){var ee=I.alternate,ae=ee!==null&&ee.memoizedState!==null||Fn;ee=Jc;var ye=Fn;if(Jc=V,(Fn=ae)&&!ye)for(Ze=I;Ze!==null;)V=Ze,ae=V.child,V.tag===22&&V.memoizedState!==null?dT(I):ae!==null?(ae.return=V,Ze=ae):dT(I);for(;L!==null;)Ze=L,uT(L),L=L.sibling;Ze=I,Jc=ee,Fn=ye}lT(f)}else(I.subtreeFlags&8772)!==0&&L!==null?(L.return=I,Ze=L):lT(f)}}function lT(f){for(;Ze!==null;){var m=Ze;if((m.flags&8772)!==0){var E=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:Fn||ed(5,m);break;case 1:var S=m.stateNode;if(m.flags&4&&!Fn)if(E===null)S.componentDidMount();else{var I=m.elementType===m.type?E.memoizedProps:Hi(m.type,E.memoizedProps);S.componentDidUpdate(I,E.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var L=m.updateQueue;L!==null&&cb(m,L,S);break;case 3:var V=m.updateQueue;if(V!==null){if(E=null,m.child!==null)switch(m.child.tag){case 5:E=m.child.stateNode;break;case 1:E=m.child.stateNode}cb(m,V,E)}break;case 5:var ee=m.stateNode;if(E===null&&m.flags&4){E=ee;var ae=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":ae.autoFocus&&E.focus();break;case"img":ae.src&&(E.src=ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var ye=m.alternate;if(ye!==null){var Me=ye.memoizedState;if(Me!==null){var Be=Me.dehydrated;Be!==null&&Ru(Be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Fn||m.flags&512&&u0(m)}catch(De){tn(m,m.return,De)}}if(m===f){Ze=null;break}if(E=m.sibling,E!==null){E.return=m.return,Ze=E;break}Ze=m.return}}function cT(f){for(;Ze!==null;){var m=Ze;if(m===f){Ze=null;break}var E=m.sibling;if(E!==null){E.return=m.return,Ze=E;break}Ze=m.return}}function dT(f){for(;Ze!==null;){var m=Ze;try{switch(m.tag){case 0:case 11:case 15:var E=m.return;try{ed(4,m)}catch(ae){tn(m,E,ae)}break;case 1:var S=m.stateNode;if(typeof S.componentDidMount=="function"){var I=m.return;try{S.componentDidMount()}catch(ae){tn(m,I,ae)}}var L=m.return;try{u0(m)}catch(ae){tn(m,L,ae)}break;case 5:var V=m.return;try{u0(m)}catch(ae){tn(m,V,ae)}}}catch(ae){tn(m,m.return,ae)}if(m===f){Ze=null;break}var ee=m.sibling;if(ee!==null){ee.return=m.return,Ze=ee;break}Ze=m.return}}var gN=Math.ceil,td=w.ReactCurrentDispatcher,d0=w.ReactCurrentOwner,Ri=w.ReactCurrentBatchConfig,_t=0,bn=null,un=null,Cn=0,di=0,Eo=gs(0),pn=0,Qu=null,fa=0,nd=0,f0=0,Zu=null,Qn=null,h0=0,bo=1/0,Hr=null,id=!1,p0=null,xs=null,rd=!1,Ss=null,sd=0,Ju=0,m0=null,ad=-1,od=0;function Vn(){return(_t&6)!==0?rn():ad!==-1?ad:ad=rn()}function ws(f){return(f.mode&1)===0?1:(_t&2)!==0&&Cn!==0?Cn&-Cn:JO.transition!==null?(od===0&&(od=rE()),od):(f=Pt,f!==0||(f=window.event,f=f===void 0?16:hE(f.type)),f)}function Vi(f,m,E,S){if(50<Ju)throw Ju=0,m0=null,Error(t(185));Su(f,E,S),((_t&2)===0||f!==bn)&&(f===bn&&((_t&2)===0&&(nd|=E),pn===4&&As(f,Cn)),Zn(f,S),E===1&&_t===0&&(m.mode&1)===0&&(bo=rn()+500,Nc&&ys()))}function Zn(f,m){var E=f.callbackNode;JD(f,m);var S=gc(f,f===bn?Cn:0);if(S===0)E!==null&&tE(E),f.callbackNode=null,f.callbackPriority=0;else if(m=S&-S,f.callbackPriority!==m){if(E!=null&&tE(E),m===1)f.tag===0?ZO(hT.bind(null,f)):ZE(hT.bind(null,f)),KO(function(){(_t&6)===0&&ys()}),E=null;else{switch(sE(S)){case 1:E=Kh;break;case 4:E=nE;break;case 16:E=fc;break;case 536870912:E=iE;break;default:E=fc}E=TT(E,fT.bind(null,f))}f.callbackPriority=m,f.callbackNode=E}}function fT(f,m){if(ad=-1,od=0,(_t&6)!==0)throw Error(t(327));var E=f.callbackNode;if(To()&&f.callbackNode!==E)return null;var S=gc(f,f===bn?Cn:0);if(S===0)return null;if((S&30)!==0||(S&f.expiredLanes)!==0||m)m=ud(f,S);else{m=S;var I=_t;_t|=2;var L=mT();(bn!==f||Cn!==m)&&(Hr=null,bo=rn()+500,pa(f,m));do try{EN();break}catch(ee){pT(f,ee)}while(!0);Dp(),td.current=L,_t=I,un!==null?m=0:(bn=null,Cn=0,m=pn)}if(m!==0){if(m===2&&(I=Yh(f),I!==0&&(S=I,m=g0(f,I))),m===1)throw E=Qu,pa(f,0),As(f,S),Zn(f,rn()),E;if(m===6)As(f,S);else{if(I=f.current.alternate,(S&30)===0&&!vN(I)&&(m=ud(f,S),m===2&&(L=Yh(f),L!==0&&(S=L,m=g0(f,L))),m===1))throw E=Qu,pa(f,0),As(f,S),Zn(f,rn()),E;switch(f.finishedWork=I,f.finishedLanes=S,m){case 0:case 1:throw Error(t(345));case 2:ma(f,Qn,Hr);break;case 3:if(As(f,S),(S&130023424)===S&&(m=h0+500-rn(),10<m)){if(gc(f,0)!==0)break;if(I=f.suspendedLanes,(I&S)!==S){Vn(),f.pingedLanes|=f.suspendedLanes&I;break}f.timeoutHandle=xp(ma.bind(null,f,Qn,Hr),m);break}ma(f,Qn,Hr);break;case 4:if(As(f,S),(S&4194240)===S)break;for(m=f.eventTimes,I=-1;0<S;){var V=31-Fi(S);L=1<<V,V=m[V],V>I&&(I=V),S&=~L}if(S=I,S=rn()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*gN(S/1960))-S,10<S){f.timeoutHandle=xp(ma.bind(null,f,Qn,Hr),S);break}ma(f,Qn,Hr);break;case 5:ma(f,Qn,Hr);break;default:throw Error(t(329))}}}return Zn(f,rn()),f.callbackNode===E?fT.bind(null,f):null}function g0(f,m){var E=Zu;return f.current.memoizedState.isDehydrated&&(pa(f,m).flags|=256),f=ud(f,m),f!==2&&(m=Qn,Qn=E,m!==null&&v0(m)),f}function v0(f){Qn===null?Qn=f:Qn.push.apply(Qn,f)}function vN(f){for(var m=f;;){if(m.flags&16384){var E=m.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var S=0;S<E.length;S++){var I=E[S],L=I.getSnapshot;I=I.value;try{if(!Bi(L(),I))return!1}catch{return!1}}}if(E=m.child,m.subtreeFlags&16384&&E!==null)E.return=m,m=E;else{if(m===f)break;for(;m.sibling===null;){if(m.return===null||m.return===f)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function As(f,m){for(m&=~f0,m&=~nd,f.suspendedLanes|=m,f.pingedLanes&=~m,f=f.expirationTimes;0<m;){var E=31-Fi(m),S=1<<E;f[E]=-1,m&=~S}}function hT(f){if((_t&6)!==0)throw Error(t(327));To();var m=gc(f,0);if((m&1)===0)return Zn(f,rn()),null;var E=ud(f,m);if(f.tag!==0&&E===2){var S=Yh(f);S!==0&&(m=S,E=g0(f,S))}if(E===1)throw E=Qu,pa(f,0),As(f,m),Zn(f,rn()),E;if(E===6)throw Error(t(345));return f.finishedWork=f.current.alternate,f.finishedLanes=m,ma(f,Qn,Hr),Zn(f,rn()),null}function y0(f,m){var E=_t;_t|=1;try{return f(m)}finally{_t=E,_t===0&&(bo=rn()+500,Nc&&ys())}}function ha(f){Ss!==null&&Ss.tag===0&&(_t&6)===0&&To();var m=_t;_t|=1;var E=Ri.transition,S=Pt;try{if(Ri.transition=null,Pt=1,f)return f()}finally{Pt=S,Ri.transition=E,_t=m,(_t&6)===0&&ys()}}function E0(){di=Eo.current,Wt(Eo)}function pa(f,m){f.finishedWork=null,f.finishedLanes=0;var E=f.timeoutHandle;if(E!==-1&&(f.timeoutHandle=-1,$O(E)),un!==null)for(E=un.return;E!==null;){var S=E;switch(Rp(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&Dc();break;case 3:go(),Wt(Kn),Wt(On),zp();break;case 5:Up(S);break;case 4:go();break;case 13:Wt(Xt);break;case 19:Wt(Xt);break;case 10:Op(S.type._context);break;case 22:case 23:E0()}E=E.return}if(bn=f,un=f=Cs(f.current,null),Cn=di=m,pn=0,Qu=null,f0=nd=fa=0,Qn=Zu=null,la!==null){for(m=0;m<la.length;m++)if(E=la[m],S=E.interleaved,S!==null){E.interleaved=null;var I=S.next,L=E.pending;if(L!==null){var V=L.next;L.next=I,S.next=V}E.pending=S}la=null}return f}function pT(f,m){do{var E=un;try{if(Dp(),Wc.current=Yc,qc){for(var S=Qt.memoizedState;S!==null;){var I=S.queue;I!==null&&(I.pending=null),S=S.next}qc=!1}if(da=0,En=hn=Qt=null,Wu=!1,qu=0,d0.current=null,E===null||E.return===null){pn=1,Qu=m,un=null;break}e:{var L=f,V=E.return,ee=E,ae=m;if(m=Cn,ee.flags|=32768,ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var ye=ae,Me=ee,Be=Me.tag;if((Me.mode&1)===0&&(Be===0||Be===11||Be===15)){var De=Me.alternate;De?(Me.updateQueue=De.updateQueue,Me.memoizedState=De.memoizedState,Me.lanes=De.lanes):(Me.updateQueue=null,Me.memoizedState=null)}var Ke=Ub(V);if(Ke!==null){Ke.flags&=-257,Hb(Ke,V,ee,L,m),Ke.mode&1&&Bb(L,ye,m),m=Ke,ae=ye;var et=m.updateQueue;if(et===null){var tt=new Set;tt.add(ae),m.updateQueue=tt}else et.add(ae);break e}else{if((m&1)===0){Bb(L,ye,m),b0();break e}ae=Error(t(426))}}else if($t&&ee.mode&1){var sn=Ub(V);if(sn!==null){(sn.flags&65536)===0&&(sn.flags|=256),Hb(sn,V,ee,L,m),Pp(vo(ae,ee));break e}}L=ae=vo(ae,ee),pn!==4&&(pn=2),Zu===null?Zu=[L]:Zu.push(L),L=V;do{switch(L.tag){case 3:L.flags|=65536,m&=-m,L.lanes|=m;var pe=Mb(L,ae,m);lb(L,pe);break e;case 1:ee=ae;var le=L.type,ge=L.stateNode;if((L.flags&128)===0&&(typeof le.getDerivedStateFromError=="function"||ge!==null&&typeof ge.componentDidCatch=="function"&&(xs===null||!xs.has(ge)))){L.flags|=65536,m&=-m,L.lanes|=m;var Ve=Fb(L,ee,m);lb(L,Ve);break e}}L=L.return}while(L!==null)}vT(E)}catch(at){m=at,un===E&&E!==null&&(un=E=E.return);continue}break}while(!0)}function mT(){var f=td.current;return td.current=Yc,f===null?Yc:f}function b0(){(pn===0||pn===3||pn===2)&&(pn=4),bn===null||(fa&268435455)===0&&(nd&268435455)===0||As(bn,Cn)}function ud(f,m){var E=_t;_t|=2;var S=mT();(bn!==f||Cn!==m)&&(Hr=null,pa(f,m));do try{yN();break}catch(I){pT(f,I)}while(!0);if(Dp(),_t=E,td.current=S,un!==null)throw Error(t(261));return bn=null,Cn=0,pn}function yN(){for(;un!==null;)gT(un)}function EN(){for(;un!==null&&!GD();)gT(un)}function gT(f){var m=bT(f.alternate,f,di);f.memoizedProps=f.pendingProps,m===null?vT(f):un=m,d0.current=null}function vT(f){var m=f;do{var E=m.alternate;if(f=m.return,(m.flags&32768)===0){if(E=dN(E,m,di),E!==null){un=E;return}}else{if(E=fN(E,m),E!==null){E.flags&=32767,un=E;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{pn=6,un=null;return}}if(m=m.sibling,m!==null){un=m;return}un=m=f}while(m!==null);pn===0&&(pn=5)}function ma(f,m,E){var S=Pt,I=Ri.transition;try{Ri.transition=null,Pt=1,bN(f,m,E,S)}finally{Ri.transition=I,Pt=S}return null}function bN(f,m,E,S){do To();while(Ss!==null);if((_t&6)!==0)throw Error(t(327));E=f.finishedWork;var I=f.finishedLanes;if(E===null)return null;if(f.finishedWork=null,f.finishedLanes=0,E===f.current)throw Error(t(177));f.callbackNode=null,f.callbackPriority=0;var L=E.lanes|E.childLanes;if(eO(f,L),f===bn&&(un=bn=null,Cn=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||rd||(rd=!0,TT(fc,function(){return To(),null})),L=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||L){L=Ri.transition,Ri.transition=null;var V=Pt;Pt=1;var ee=_t;_t|=4,d0.current=null,pN(f,E),oT(E,f),HO(bp),Ec=!!Ep,bp=Ep=null,f.current=E,mN(E),WD(),_t=ee,Pt=V,Ri.transition=L}else f.current=E;if(rd&&(rd=!1,Ss=f,sd=I),L=f.pendingLanes,L===0&&(xs=null),KD(E.stateNode),Zn(f,rn()),m!==null)for(S=f.onRecoverableError,E=0;E<m.length;E++)I=m[E],S(I.value,{componentStack:I.stack,digest:I.digest});if(id)throw id=!1,f=p0,p0=null,f;return(sd&1)!==0&&f.tag!==0&&To(),L=f.pendingLanes,(L&1)!==0?f===m0?Ju++:(Ju=0,m0=f):Ju=0,ys(),null}function To(){if(Ss!==null){var f=sE(sd),m=Ri.transition,E=Pt;try{if(Ri.transition=null,Pt=16>f?16:f,Ss===null)var S=!1;else{if(f=Ss,Ss=null,sd=0,(_t&6)!==0)throw Error(t(331));var I=_t;for(_t|=4,Ze=f.current;Ze!==null;){var L=Ze,V=L.child;if((Ze.flags&16)!==0){var ee=L.deletions;if(ee!==null){for(var ae=0;ae<ee.length;ae++){var ye=ee[ae];for(Ze=ye;Ze!==null;){var Me=Ze;switch(Me.tag){case 0:case 11:case 15:Xu(8,Me,L)}var Be=Me.child;if(Be!==null)Be.return=Me,Ze=Be;else for(;Ze!==null;){Me=Ze;var De=Me.sibling,Ke=Me.return;if(nT(Me),Me===ye){Ze=null;break}if(De!==null){De.return=Ke,Ze=De;break}Ze=Ke}}}var et=L.alternate;if(et!==null){var tt=et.child;if(tt!==null){et.child=null;do{var sn=tt.sibling;tt.sibling=null,tt=sn}while(tt!==null)}}Ze=L}}if((L.subtreeFlags&2064)!==0&&V!==null)V.return=L,Ze=V;else e:for(;Ze!==null;){if(L=Ze,(L.flags&2048)!==0)switch(L.tag){case 0:case 11:case 15:Xu(9,L,L.return)}var pe=L.sibling;if(pe!==null){pe.return=L.return,Ze=pe;break e}Ze=L.return}}var le=f.current;for(Ze=le;Ze!==null;){V=Ze;var ge=V.child;if((V.subtreeFlags&2064)!==0&&ge!==null)ge.return=V,Ze=ge;else e:for(V=le;Ze!==null;){if(ee=Ze,(ee.flags&2048)!==0)try{switch(ee.tag){case 0:case 11:case 15:ed(9,ee)}}catch(at){tn(ee,ee.return,at)}if(ee===V){Ze=null;break e}var Ve=ee.sibling;if(Ve!==null){Ve.return=ee.return,Ze=Ve;break e}Ze=ee.return}}if(_t=I,ys(),rr&&typeof rr.onPostCommitFiberRoot=="function")try{rr.onPostCommitFiberRoot(hc,f)}catch{}S=!0}return S}finally{Pt=E,Ri.transition=m}}return!1}function yT(f,m,E){m=vo(E,m),m=Mb(f,m,1),f=bs(f,m,1),m=Vn(),f!==null&&(Su(f,1,m),Zn(f,m))}function tn(f,m,E){if(f.tag===3)yT(f,f,E);else for(;m!==null;){if(m.tag===3){yT(m,f,E);break}else if(m.tag===1){var S=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(xs===null||!xs.has(S))){f=vo(E,f),f=Fb(m,f,1),m=bs(m,f,1),f=Vn(),m!==null&&(Su(m,1,f),Zn(m,f));break}}m=m.return}}function TN(f,m,E){var S=f.pingCache;S!==null&&S.delete(m),m=Vn(),f.pingedLanes|=f.suspendedLanes&E,bn===f&&(Cn&E)===E&&(pn===4||pn===3&&(Cn&130023424)===Cn&&500>rn()-h0?pa(f,0):f0|=E),Zn(f,m)}function ET(f,m){m===0&&((f.mode&1)===0?m=1:(m=mc,mc<<=1,(mc&130023424)===0&&(mc=4194304)));var E=Vn();f=Fr(f,m),f!==null&&(Su(f,m,E),Zn(f,E))}function xN(f){var m=f.memoizedState,E=0;m!==null&&(E=m.retryLane),ET(f,E)}function SN(f,m){var E=0;switch(f.tag){case 13:var S=f.stateNode,I=f.memoizedState;I!==null&&(E=I.retryLane);break;case 19:S=f.stateNode;break;default:throw Error(t(314))}S!==null&&S.delete(m),ET(f,E)}var bT;bT=function(f,m,E){if(f!==null)if(f.memoizedProps!==m.pendingProps||Kn.current)Xn=!0;else{if((f.lanes&E)===0&&(m.flags&128)===0)return Xn=!1,cN(f,m,E);Xn=(f.flags&131072)!==0}else Xn=!1,$t&&(m.flags&1048576)!==0&&JE(m,Fc,m.index);switch(m.lanes=0,m.tag){case 2:var S=m.type;Zc(f,m),f=m.pendingProps;var I=uo(m,On.current);mo(m,E),I=Gp(null,m,S,f,I,E);var L=Wp();return m.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,Yn(S)?(L=!0,Oc(m)):L=!1,m.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,Fp(m),I.updater=Xc,m.stateNode=I,I._reactInternals=m,Qp(m,S,f,E),m=t0(null,m,S,!0,L,E)):(m.tag=0,$t&&L&&Ip(m),jn(null,m,I,E),m=m.child),m;case 16:S=m.elementType;e:{switch(Zc(f,m),f=m.pendingProps,I=S._init,S=I(S._payload),m.type=S,I=m.tag=AN(S),f=Hi(S,f),I){case 0:m=e0(null,m,S,f,E);break e;case 1:m=qb(null,m,S,f,E);break e;case 11:m=zb(null,m,S,f,E);break e;case 14:m=jb(null,m,S,Hi(S.type,f),E);break e}throw Error(t(306,S,""))}return m;case 0:return S=m.type,I=m.pendingProps,I=m.elementType===S?I:Hi(S,I),e0(f,m,S,I,E);case 1:return S=m.type,I=m.pendingProps,I=m.elementType===S?I:Hi(S,I),qb(f,m,S,I,E);case 3:e:{if($b(m),f===null)throw Error(t(387));S=m.pendingProps,L=m.memoizedState,I=L.element,ub(f,m),Vc(m,S,null,E);var V=m.memoizedState;if(S=V.element,L.isDehydrated)if(L={element:S,isDehydrated:!1,cache:V.cache,pendingSuspenseBoundaries:V.pendingSuspenseBoundaries,transitions:V.transitions},m.updateQueue.baseState=L,m.memoizedState=L,m.flags&256){I=vo(Error(t(423)),m),m=Kb(f,m,S,E,I);break e}else if(S!==I){I=vo(Error(t(424)),m),m=Kb(f,m,S,E,I);break e}else for(ci=ms(m.stateNode.containerInfo.firstChild),li=m,$t=!0,Ui=null,E=ab(m,null,S,E),m.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(fo(),S===I){m=Ur(f,m,E);break e}jn(f,m,S,E)}m=m.child}return m;case 5:return db(m),f===null&&Lp(m),S=m.type,I=m.pendingProps,L=f!==null?f.memoizedProps:null,V=I.children,Tp(S,I)?V=null:L!==null&&Tp(S,L)&&(m.flags|=32),Wb(f,m),jn(f,m,V,E),m.child;case 6:return f===null&&Lp(m),null;case 13:return Yb(f,m,E);case 4:return Bp(m,m.stateNode.containerInfo),S=m.pendingProps,f===null?m.child=ho(m,null,S,E):jn(f,m,S,E),m.child;case 11:return S=m.type,I=m.pendingProps,I=m.elementType===S?I:Hi(S,I),zb(f,m,S,I,E);case 7:return jn(f,m,m.pendingProps,E),m.child;case 8:return jn(f,m,m.pendingProps.children,E),m.child;case 12:return jn(f,m,m.pendingProps.children,E),m.child;case 10:e:{if(S=m.type._context,I=m.pendingProps,L=m.memoizedProps,V=I.value,zt(Hc,S._currentValue),S._currentValue=V,L!==null)if(Bi(L.value,V)){if(L.children===I.children&&!Kn.current){m=Ur(f,m,E);break e}}else for(L=m.child,L!==null&&(L.return=m);L!==null;){var ee=L.dependencies;if(ee!==null){V=L.child;for(var ae=ee.firstContext;ae!==null;){if(ae.context===S){if(L.tag===1){ae=Br(-1,E&-E),ae.tag=2;var ye=L.updateQueue;if(ye!==null){ye=ye.shared;var Me=ye.pending;Me===null?ae.next=ae:(ae.next=Me.next,Me.next=ae),ye.pending=ae}}L.lanes|=E,ae=L.alternate,ae!==null&&(ae.lanes|=E),Np(L.return,E,m),ee.lanes|=E;break}ae=ae.next}}else if(L.tag===10)V=L.type===m.type?null:L.child;else if(L.tag===18){if(V=L.return,V===null)throw Error(t(341));V.lanes|=E,ee=V.alternate,ee!==null&&(ee.lanes|=E),Np(V,E,m),V=L.sibling}else V=L.child;if(V!==null)V.return=L;else for(V=L;V!==null;){if(V===m){V=null;break}if(L=V.sibling,L!==null){L.return=V.return,V=L;break}V=V.return}L=V}jn(f,m,I.children,E),m=m.child}return m;case 9:return I=m.type,S=m.pendingProps.children,mo(m,E),I=Ci(I),S=S(I),m.flags|=1,jn(f,m,S,E),m.child;case 14:return S=m.type,I=Hi(S,m.pendingProps),I=Hi(S.type,I),jb(f,m,S,I,E);case 15:return Vb(f,m,m.type,m.pendingProps,E);case 17:return S=m.type,I=m.pendingProps,I=m.elementType===S?I:Hi(S,I),Zc(f,m),m.tag=1,Yn(S)?(f=!0,Oc(m)):f=!1,mo(m,E),Ob(m,S,I),Qp(m,S,I,E),t0(null,m,S,!0,f,E);case 19:return Qb(f,m,E);case 22:return Gb(f,m,E)}throw Error(t(156,m.tag))};function TT(f,m){return eE(f,m)}function wN(f,m,E,S){this.tag=f,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _i(f,m,E,S){return new wN(f,m,E,S)}function T0(f){return f=f.prototype,!(!f||!f.isReactComponent)}function AN(f){if(typeof f=="function")return T0(f)?1:0;if(f!=null){if(f=f.$$typeof,f===G)return 11;if(f===Q)return 14}return 2}function Cs(f,m){var E=f.alternate;return E===null?(E=_i(f.tag,m,f.key,f.mode),E.elementType=f.elementType,E.type=f.type,E.stateNode=f.stateNode,E.alternate=f,f.alternate=E):(E.pendingProps=m,E.type=f.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=f.flags&14680064,E.childLanes=f.childLanes,E.lanes=f.lanes,E.child=f.child,E.memoizedProps=f.memoizedProps,E.memoizedState=f.memoizedState,E.updateQueue=f.updateQueue,m=f.dependencies,E.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},E.sibling=f.sibling,E.index=f.index,E.ref=f.ref,E}function ld(f,m,E,S,I,L){var V=2;if(S=f,typeof f=="function")T0(f)&&(V=1);else if(typeof f=="string")V=5;else e:switch(f){case _:return ga(E.children,I,L,m);case D:V=8,I|=8;break;case H:return f=_i(12,E,m,I|2),f.elementType=H,f.lanes=L,f;case X:return f=_i(13,E,m,I),f.elementType=X,f.lanes=L,f;case te:return f=_i(19,E,m,I),f.elementType=te,f.lanes=L,f;case oe:return cd(E,I,L,m);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case P:V=10;break e;case N:V=9;break e;case G:V=11;break e;case Q:V=14;break e;case ne:V=16,S=null;break e}throw Error(t(130,f==null?f:typeof f,""))}return m=_i(V,E,m,I),m.elementType=f,m.type=S,m.lanes=L,m}function ga(f,m,E,S){return f=_i(7,f,S,m),f.lanes=E,f}function cd(f,m,E,S){return f=_i(22,f,S,m),f.elementType=oe,f.lanes=E,f.stateNode={isHidden:!1},f}function x0(f,m,E){return f=_i(6,f,null,m),f.lanes=E,f}function S0(f,m,E){return m=_i(4,f.children!==null?f.children:[],f.key,m),m.lanes=E,m.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},m}function CN(f,m,E,S,I){this.tag=m,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xh(0),this.expirationTimes=Xh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xh(0),this.identifierPrefix=S,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function w0(f,m,E,S,I,L,V,ee,ae){return f=new CN(f,m,E,ee,ae),m===1?(m=1,L===!0&&(m|=8)):m=0,L=_i(3,null,null,m),f.current=L,L.stateNode=f,L.memoizedState={element:S,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fp(L),f}function IN(f,m,E){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:S==null?null:""+S,children:f,containerInfo:m,implementation:E}}function xT(f){if(!f)return vs;f=f._reactInternals;e:{if(ra(f)!==f||f.tag!==1)throw Error(t(170));var m=f;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(Yn(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(t(171))}if(f.tag===1){var E=f.type;if(Yn(E))return XE(f,E,m)}return m}function ST(f,m,E,S,I,L,V,ee,ae){return f=w0(E,S,!0,f,I,L,V,ee,ae),f.context=xT(null),E=f.current,S=Vn(),I=ws(E),L=Br(S,I),L.callback=m??null,bs(E,L,I),f.current.lanes=I,Su(f,I,S),Zn(f,S),f}function dd(f,m,E,S){var I=m.current,L=Vn(),V=ws(I);return E=xT(E),m.context===null?m.context=E:m.pendingContext=E,m=Br(L,V),m.payload={element:f},S=S===void 0?null:S,S!==null&&(m.callback=S),f=bs(I,m,V),f!==null&&(Vi(f,I,V,L),jc(f,I,V)),V}function fd(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function wT(f,m){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var E=f.retryLane;f.retryLane=E!==0&&E<m?E:m}}function A0(f,m){wT(f,m),(f=f.alternate)&&wT(f,m)}function RN(){return null}var AT=typeof reportError=="function"?reportError:function(f){console.error(f)};function C0(f){this._internalRoot=f}hd.prototype.render=C0.prototype.render=function(f){var m=this._internalRoot;if(m===null)throw Error(t(409));dd(f,m,null,null)},hd.prototype.unmount=C0.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var m=f.containerInfo;ha(function(){dd(null,f,null,null)}),m[Dr]=null}};function hd(f){this._internalRoot=f}hd.prototype.unstable_scheduleHydration=function(f){if(f){var m=uE();f={blockedOn:null,target:f,priority:m};for(var E=0;E<fs.length&&m!==0&&m<fs[E].priority;E++);fs.splice(E,0,f),E===0&&dE(f)}};function I0(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function pd(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function CT(){}function _N(f,m,E,S,I){if(I){if(typeof S=="function"){var L=S;S=function(){var ye=fd(V);L.call(ye)}}var V=ST(m,S,f,0,null,!1,!1,"",CT);return f._reactRootContainer=V,f[Dr]=V.current,Fu(f.nodeType===8?f.parentNode:f),ha(),V}for(;I=f.lastChild;)f.removeChild(I);if(typeof S=="function"){var ee=S;S=function(){var ye=fd(ae);ee.call(ye)}}var ae=w0(f,0,!1,null,null,!1,!1,"",CT);return f._reactRootContainer=ae,f[Dr]=ae.current,Fu(f.nodeType===8?f.parentNode:f),ha(function(){dd(m,ae,E,S)}),ae}function md(f,m,E,S,I){var L=E._reactRootContainer;if(L){var V=L;if(typeof I=="function"){var ee=I;I=function(){var ae=fd(V);ee.call(ae)}}dd(m,V,f,I)}else V=_N(E,m,f,I,S);return fd(V)}aE=function(f){switch(f.tag){case 3:var m=f.stateNode;if(m.current.memoizedState.isDehydrated){var E=xu(m.pendingLanes);E!==0&&(Qh(m,E|1),Zn(m,rn()),(_t&6)===0&&(bo=rn()+500,ys()))}break;case 13:ha(function(){var S=Fr(f,1);if(S!==null){var I=Vn();Vi(S,f,1,I)}}),A0(f,1)}},Zh=function(f){if(f.tag===13){var m=Fr(f,134217728);if(m!==null){var E=Vn();Vi(m,f,134217728,E)}A0(f,134217728)}},oE=function(f){if(f.tag===13){var m=ws(f),E=Fr(f,m);if(E!==null){var S=Vn();Vi(E,f,m,S)}A0(f,m)}},uE=function(){return Pt},lE=function(f,m){var E=Pt;try{return Pt=f,m()}finally{Pt=E}},ir=function(f,m,E){switch(m){case"input":if(k(f,E),m=E.name,E.type==="radio"&&m!=null){for(E=f;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<E.length;m++){var S=E[m];if(S!==f&&S.form===f.form){var I=kc(S);if(!I)throw Error(t(90));Re(S),k(S,I)}}}break;case"textarea":dt(f,E);break;case"select":m=E.value,m!=null&&_e(f,!!E.multiple,m,!1)}},$1=y0,K1=ha;var LN={usingClientEntryPoint:!1,Events:[Hu,ao,kc,W1,q1,y0]},el={findFiberByHostInstance:sa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PN={bundleType:el.bundleType,version:el.version,rendererPackageName:el.rendererPackageName,rendererConfig:el.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Z1(f),f===null?null:f.stateNode},findFiberByHostInstance:el.findFiberByHostInstance||RN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gd.isDisabled&&gd.supportsFiber)try{hc=gd.inject(PN),rr=gd}catch{}}return Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LN,Jn.createPortal=function(f,m){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!I0(m))throw Error(t(200));return IN(f,m,null,E)},Jn.createRoot=function(f,m){if(!I0(f))throw Error(t(299));var E=!1,S="",I=AT;return m!=null&&(m.unstable_strictMode===!0&&(E=!0),m.identifierPrefix!==void 0&&(S=m.identifierPrefix),m.onRecoverableError!==void 0&&(I=m.onRecoverableError)),m=w0(f,1,!1,null,null,E,!1,S,I),f[Dr]=m.current,Fu(f.nodeType===8?f.parentNode:f),new C0(m)},Jn.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var m=f._reactInternals;if(m===void 0)throw typeof f.render=="function"?Error(t(188)):(f=Object.keys(f).join(","),Error(t(268,f)));return f=Z1(m),f=f===null?null:f.stateNode,f},Jn.flushSync=function(f){return ha(f)},Jn.hydrate=function(f,m,E){if(!pd(m))throw Error(t(200));return md(null,f,m,!0,E)},Jn.hydrateRoot=function(f,m,E){if(!I0(f))throw Error(t(405));var S=E!=null&&E.hydratedSources||null,I=!1,L="",V=AT;if(E!=null&&(E.unstable_strictMode===!0&&(I=!0),E.identifierPrefix!==void 0&&(L=E.identifierPrefix),E.onRecoverableError!==void 0&&(V=E.onRecoverableError)),m=ST(m,null,f,1,E??null,I,!1,L,V),f[Dr]=m.current,Fu(f),S)for(f=0;f<S.length;f++)E=S[f],I=E._getVersion,I=I(E._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[E,I]:m.mutableSourceEagerHydrationData.push(E,I);return new hd(m)},Jn.render=function(f,m,E){if(!pd(m))throw Error(t(200));return md(null,f,m,!1,E)},Jn.unmountComponentAtNode=function(f){if(!pd(f))throw Error(t(40));return f._reactRootContainer?(ha(function(){md(null,null,f,!1,function(){f._reactRootContainer=null,f[Dr]=null})}),!0):!1},Jn.unstable_batchedUpdates=y0,Jn.unstable_renderSubtreeIntoContainer=function(f,m,E,S){if(!pd(E))throw Error(t(200));if(f==null||f._reactInternals===void 0)throw Error(t(38));return md(f,m,E,!1,S)},Jn.version="18.3.1-next-f1338f8080-20240426",Jn}var OT;function eC(){if(OT)return L0.exports;OT=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),L0.exports=HN(),L0.exports}var NT;function zN(){if(NT)return vd;NT=1;var n=eC();return vd.createRoot=n.createRoot,vd.hydrateRoot=n.hydrateRoot,vd}var jN=zN();const{slice:VN,forEach:GN}=[];function WN(n){return GN.call(VN.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}function qN(n){return typeof n!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(t=>t.test(n))}const MT=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,$N=function(n,e){const i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},r=encodeURIComponent(e);let s=`${n}=${r}`;if(i.maxAge>0){const a=i.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(a)}`}if(i.domain){if(!MT.test(i.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${i.domain}`}if(i.path){if(!MT.test(i.path))throw new TypeError("option path is invalid");s+=`; Path=${i.path}`}if(i.expires){if(typeof i.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${i.expires.toUTCString()}`}if(i.httpOnly&&(s+="; HttpOnly"),i.secure&&(s+="; Secure"),i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i.partitioned&&(s+="; Partitioned"),s},FT={create(n,e,t,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+t*60*1e3)),i&&(r.domain=i),document.cookie=$N(n,e,r)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let i=0;i<t.length;i++){let r=t[i];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(e)===0)return r.substring(e.length,r.length)}return null},remove(n,e){this.create(n,"",-1,e)}};var KN={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return FT.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:i,cookieDomain:r,cookieOptions:s}=e;t&&typeof document<"u"&&FT.create(t,n,i,r,s)}},YN={name:"querystring",lookup(n){var i;let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:r}=window.location;!window.location.search&&((i=window.location.hash)==null?void 0:i.indexOf("?"))>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));const a=r.substring(1).split("&");for(let o=0;o<a.length;o++){const l=a[o].indexOf("=");l>0&&a[o].substring(0,l)===e&&(t=a[o].substring(l+1))}}return t}},XN={name:"hash",lookup(n){var r;let{lookupHash:e,lookupFromHashIndex:t}=n,i;if(typeof window<"u"){const{hash:s}=window.location;if(s&&s.length>2){const a=s.substring(1);if(e){const o=a.split("&");for(let l=0;l<o.length;l++){const u=o[l].indexOf("=");u>0&&o[l].substring(0,u)===e&&(i=o[l].substring(u+1))}}if(i)return i;if(!i&&t>-1){const o=s.match(/\/([a-zA-Z-]*)/g);return Array.isArray(o)?(r=o[typeof t=="number"?t:0])==null?void 0:r.replace("/",""):void 0}}}return i}};let xo=null;const BT=()=>{if(xo!==null)return xo;try{if(xo=typeof window<"u"&&window.localStorage!==null,!xo)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{xo=!1}return xo};var QN={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&BT())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&BT()&&window.localStorage.setItem(t,n)}};let So=null;const UT=()=>{if(So!==null)return So;try{if(So=typeof window<"u"&&window.sessionStorage!==null,!So)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{So=!1}return So};var ZN={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&UT())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&UT()&&window.sessionStorage.setItem(t,n)}},JN={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:i,language:r}=navigator;if(t)for(let s=0;s<t.length;s++)e.push(t[s]);i&&e.push(i),r&&e.push(r)}return e.length>0?e:void 0}},e6={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const i=e||(typeof document<"u"?document.documentElement:null);return i&&typeof i.getAttribute=="function"&&(t=i.getAttribute("lang")),t}},t6={name:"path",lookup(n){var r;let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(r=t[typeof e=="number"?e:0])==null?void 0:r.replace("/",""):void 0}},n6={name:"subdomain",lookup(n){var r,s;let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,i=typeof window<"u"&&((s=(r=window.location)==null?void 0:r.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(i)return i[t]}};let tC=!1;try{document.cookie,tC=!0}catch{}const nC=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];tC||nC.splice(1,1);const i6=()=>({order:nC,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class iC{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=WN(t,this.options||{},i6()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=r=>r.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=i,this.addDetector(KN),this.addDetector(YN),this.addDetector(QN),this.addDetector(ZN),this.addDetector(JN),this.addDetector(e6),this.addDetector(t6),this.addDetector(n6),this.addDetector(XN)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return e.forEach(i=>{if(this.detectors[i]){let r=this.detectors[i].lookup(this.options);r&&typeof r=="string"&&(r=[r]),r&&(t=t.concat(r))}}),t=t.filter(i=>i!=null&&!qN(i)).map(i=>this.options.convertDetectedLanguage(i)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(i=>{this.detectors[i]&&this.detectors[i].cacheUserLanguage(e,this.options)}))}}iC.type="languageDetector";const gt=n=>typeof n=="string",nl=()=>{let n,e;const t=new Promise((i,r)=>{n=i,e=r});return t.resolve=n,t.reject=e,t},HT=n=>n==null?"":""+n,r6=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},s6=/###/g,zT=n=>n&&n.indexOf("###")>-1?n.replace(s6,"."):n,jT=n=>!n||gt(n),yl=(n,e,t)=>{const i=gt(e)?e.split("."):e;let r=0;for(;r<i.length-1;){if(jT(n))return{};const s=zT(i[r]);!n[s]&&t&&(n[s]=new t),Object.prototype.hasOwnProperty.call(n,s)?n=n[s]:n={},++r}return jT(n)?{}:{obj:n,k:zT(i[r])}},VT=(n,e,t)=>{const{obj:i,k:r}=yl(n,e,Object);if(i!==void 0||e.length===1){i[r]=t;return}let s=e[e.length-1],a=e.slice(0,e.length-1),o=yl(n,a,Object);for(;o.obj===void 0&&a.length;)s=`${a[a.length-1]}.${s}`,a=a.slice(0,a.length-1),o=yl(n,a,Object),o&&o.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=t},a6=(n,e,t,i)=>{const{obj:r,k:s}=yl(n,e,Object);r[s]=r[s]||[],r[s].push(t)},If=(n,e)=>{const{obj:t,k:i}=yl(n,e);if(t)return t[i]},o6=(n,e,t)=>{const i=If(n,t);return i!==void 0?i:If(e,t)},rC=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?gt(n[i])||n[i]instanceof String||gt(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):rC(n[i],e[i],t):n[i]=e[i]);return n},wo=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var u6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const l6=n=>gt(n)?n.replace(/[&<>"'\/]/g,e=>u6[e]):n;class c6{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const d6=[" ",",","?","!",";"],f6=new c6(20),h6=(n,e,t)=>{e=e||"",t=t||"";const i=d6.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(i.length===0)return!0;const r=f6.getRegExp(`(${i.map(a=>a==="?"?"\\?":a).join("|")})`);let s=!r.test(n);if(!s){const a=n.indexOf(t);a>0&&!r.test(n.substring(0,a))&&(s=!0)}return s},Ug=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return n[e];const i=e.split(t);let r=n;for(let s=0;s<i.length;){if(!r||typeof r!="object")return;let a,o="";for(let l=s;l<i.length;++l)if(l!==s&&(o+=t),o+=i[l],a=r[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<i.length-1)continue;s+=l-s+1;break}r=a}return r},Rf=n=>n&&n.replace("_","-"),p6={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console&&console[n]&&console[n].apply(console,e)}};let m6=class Hg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||p6,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,r){return r&&!this.debug?null:(gt(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Hg(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Hg(this.logger,e)}};var vr=new m6;let th=class{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(t)||0;this.observers[i].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o.apply(o,[e,...i])})}};class GT extends th{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,t],i&&(Array.isArray(i)?o.push(...i):gt(i)&&s?o.push(...i.split(s)):o.push(i)));const l=If(this.data,o);return!l&&!t&&!i&&e.indexOf(".")>-1&&(e=o[0],t=o[1],i=o.slice(2).join(".")),l||!a||!gt(i)?l:Ug(this.data&&this.data[e]&&this.data[e][t],i,s)}addResource(e,t,i,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[e,t];i&&(o=o.concat(a?i.split(a):i)),e.indexOf(".")>-1&&(o=e.split("."),r=t,t=o[1]),this.addNamespaces(t),VT(this.data,o,r),s.silent||this.emit("added",e,t,i,r)}addResources(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in i)(gt(i[s])||Array.isArray(i[s]))&&this.addResource(e,t,s,i[s],{silent:!0});r.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),r=i,i=t,t=o[1]),this.addNamespaces(t);let l=If(this.data,o)||{};a.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?rC(l,i,s):l={...l,...i},VT(this.data,o,l),a.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var sC={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,r){return n.forEach(s=>{this.processors[s]&&(e=this.processors[s].process(e,t,i,r))}),e}};const WT={};class _f extends th{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),r6(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=vr.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const i=this.resolve(e,t);return i&&i.res!==void 0}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const a=i&&e.indexOf(i)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!h6(e,i,r);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:gt(s)?[s]:s};const u=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(u[0])>-1)&&(s=u.shift()),e=u.join(r)}return{key:e,namespaces:gt(s)?[s]:s}}translate(e,t,i){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,s=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(e[e.length-1],t),l=o[o.length-1],u=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(c){const w=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${w}${a}`,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${w}${a}`}return r?{res:a,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const d=this.resolve(e,t);let h=d&&d.res;const p=d&&d.usedKey||a,g=d&&d.exactUsedKey||a,v=Object.prototype.toString.apply(h),y=["[object Number]","[object Function]","[object RegExp]"],b=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,x=!gt(h)&&typeof h!="boolean"&&typeof h!="number";if(T&&h&&x&&y.indexOf(v)<0&&!(gt(b)&&Array.isArray(h))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const w=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,h,{...t,ns:o}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(d.res=w,d.usedParams=this.getUsedParamsDetails(t),d):w}if(s){const w=Array.isArray(h),A=w?[]:{},R=w?g:p;for(const _ in h)if(Object.prototype.hasOwnProperty.call(h,_)){const D=`${R}${s}${_}`;A[_]=this.translate(D,{...t,joinArrays:!1,ns:o}),A[_]===D&&(A[_]=h[_])}h=A}}else if(T&&gt(b)&&Array.isArray(h))h=h.join(b),h&&(h=this.extendTranslation(h,e,t,i));else{let w=!1,A=!1;const R=t.count!==void 0&&!gt(t.count),_=_f.hasDefaultValue(t),D=R?this.pluralResolver.getSuffix(u,t.count,t):"",H=t.ordinal&&R?this.pluralResolver.getSuffix(u,t.count,{ordinal:!1}):"",P=R&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),N=P&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${D}`]||t[`defaultValue${H}`]||t.defaultValue;!this.isValidLookup(h)&&_&&(w=!0,h=N),this.isValidLookup(h)||(A=!0,h=a);const X=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&A?void 0:h,te=_&&N!==h&&this.options.updateMissing;if(A||w||te){if(this.logger.log(te?"updateKey":"missingKey",u,l,a,te?N:h),s){const Z=this.resolve(a,{...t,keySeparator:!1});Z&&Z.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Q=[];const ne=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ne&&ne[0])for(let Z=0;Z<ne.length;Z++)Q.push(ne[Z]);else this.options.saveMissingTo==="all"?Q=this.languageUtils.toResolveHierarchy(t.lng||this.language):Q.push(t.lng||this.language);const oe=(Z,se,j)=>{const q=_&&j!==h?j:X;this.options.missingKeyHandler?this.options.missingKeyHandler(Z,l,se,q,te,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(Z,l,se,q,te,t),this.emit("missingKey",Z,l,se,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?Q.forEach(Z=>{const se=this.pluralResolver.getSuffixes(Z,t);P&&t[`defaultValue${this.options.pluralSeparator}zero`]&&se.indexOf(`${this.options.pluralSeparator}zero`)<0&&se.push(`${this.options.pluralSeparator}zero`),se.forEach(j=>{oe([Z],a+j,t[`defaultValue${j}`]||N)})}):oe(Q,a,N))}h=this.extendTranslation(h,e,t,d,i),A&&h===a&&this.options.appendNamespaceToMissingKey&&(h=`${l}:${a}`),(A||w)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,w?h:void 0):h=this.options.parseMissingKeyHandler(h))}return r?(d.res=h,d.usedParams=this.getUsedParamsDetails(t),d):h}extendTranslation(e,t,i,r,s){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const u=gt(e)&&(i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let c;if(u){const h=e.match(this.interpolator.nestingRegexp);c=h&&h.length}let d=i.replace&&!gt(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,i.lng||this.language||r.usedLng,i),u){const h=e.match(this.interpolator.nestingRegexp),p=h&&h.length;c<p&&(i.nest=!1)}!i.lng&&this.options.compatibilityAPI!=="v1"&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var h=arguments.length,p=new Array(h),g=0;g<h;g++)p[g]=arguments[g];return s&&s[0]===p[0]&&!i.context?(a.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${t[0]}`),null):a.translate(...p,t)},i)),i.interpolation&&this.interpolator.reset()}const o=i.postProcess||this.options.postProcess,l=gt(o)?[o]:o;return e!=null&&l&&l.length&&i.applyPostProcessor!==!1&&(e=sC.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i,r,s,a,o;return gt(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(i))return;const u=this.extractFromKey(l,t),c=u.key;r=c;let d=u.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const h=t.count!==void 0&&!gt(t.count),p=h&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),g=t.context!==void 0&&(gt(t.context)||typeof t.context=="number")&&t.context!=="",v=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);d.forEach(y=>{this.isValidLookup(i)||(o=y,!WT[`${v[0]}-${y}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(WT[`${v[0]}-${y}`]=!0,this.logger.warn(`key "${r}" for languages "${v.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),v.forEach(b=>{if(this.isValidLookup(i))return;a=b;const T=[c];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(T,c,b,y,t);else{let w;h&&(w=this.pluralResolver.getSuffix(b,t.count,t));const A=`${this.options.pluralSeparator}zero`,R=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(h&&(T.push(c+w),t.ordinal&&w.indexOf(R)===0&&T.push(c+w.replace(R,this.options.pluralSeparator)),p&&T.push(c+A)),g){const _=`${c}${this.options.contextSeparator}${t.context}`;T.push(_),h&&(T.push(_+w),t.ordinal&&w.indexOf(R)===0&&T.push(_+w.replace(R,this.options.pluralSeparator)),p&&T.push(_+A))}}let x;for(;x=T.pop();)this.isValidLookup(i)||(s=x,i=this.getResource(b,y,x,t))}))})}),{res:i,usedKey:r,exactUsedKey:s,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!gt(e.replace);let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const s of t)delete r[s]}return r}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}const D0=n=>n.charAt(0).toUpperCase()+n.slice(1);class qT{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=vr.create("languageUtils")}getScriptPartFromCode(e){if(e=Rf(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Rf(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(gt(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let r=Intl.getCanonicalLocales(e)[0];if(r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r)return r}catch{}const t=["hans","hant","latn","cyrl","cans","mong","arab"];let i=e.split("-");return this.options.lowerCaseLng?i=i.map(r=>r.toLowerCase()):i.length===2?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=D0(i[1].toLowerCase()))):i.length===3&&(i[0]=i[0].toLowerCase(),i[1].length===2&&(i[1]=i[1].toUpperCase()),i[0]!=="sgn"&&i[2].length===2&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=D0(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=D0(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(s=>{if(s===r)return s;if(!(s.indexOf("-")<0&&r.indexOf("-")<0)&&(s.indexOf("-")>0&&r.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===r||s.indexOf(r)===0&&r.length>1))return s})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),gt(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],s=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return gt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):gt(e)&&s(this.formatLanguageCode(e)),i.forEach(a=>{r.indexOf(a)<0&&s(this.formatLanguageCode(a))}),r}}let g6=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],v6={1:n=>+(n>1),2:n=>+(n!=1),3:n=>0,4:n=>n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,5:n=>n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5,6:n=>n==1?0:n>=2&&n<=4?1:2,7:n=>n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,8:n=>n==1?0:n==2?1:n!=8&&n!=11?2:3,9:n=>+(n>=2),10:n=>n==1?0:n==2?1:n<7?2:n<11?3:4,11:n=>n==1||n==11?0:n==2||n==12?1:n>2&&n<20?2:3,12:n=>+(n%10!=1||n%100==11),13:n=>+(n!==0),14:n=>n==1?0:n==2?1:n==3?2:3,15:n=>n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2,16:n=>n%10==1&&n%100!=11?0:n!==0?1:2,17:n=>n==1||n%10==1&&n%100!=11?0:1,18:n=>n==0?0:n==1?1:2,19:n=>n==1?0:n==0||n%100>1&&n%100<11?1:n%100>10&&n%100<20?2:3,20:n=>n==1?0:n==0||n%100>0&&n%100<20?1:2,21:n=>n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0,22:n=>n==1?0:n==2?1:(n<0||n>10)&&n%10==0?2:3};const y6=["v1","v2","v3"],E6=["v4"],$T={zero:0,one:1,two:2,few:3,many:4,other:5},b6=()=>{const n={};return g6.forEach(e=>{e.lngs.forEach(t=>{n[t]={numbers:e.nr,plurals:v6[e.fc]}})}),n};class T6{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=vr.create("pluralResolver"),(!this.options.compatibilityJSON||E6.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=b6(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const i=Rf(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:i,type:r});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let a;try{a=new Intl.PluralRules(i,{type:r})}catch{if(!e.match(/-|_/))return;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,t)}return this.pluralRulesCache[s]=a,a}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,t);return this.shouldUseIntlApi()?i&&i.resolvedOptions().pluralCategories.length>1:i&&i.numbers.length>1}getPluralFormsOfKey(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,i).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,t);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((r,s)=>$T[r]-$T[s]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):i.numbers.map(r=>this.getSuffix(e,r,t)):[]}getSuffix(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,i);return r?this.shouldUseIntlApi()?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:this.getSuffixRetroCompatible(r,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const i=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let r=e.numbers[i];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(r===2?r="plural":r===1&&(r=""));const s=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return this.options.compatibilityJSON==="v1"?r===1?"":typeof r=="number"?`_plural_${r.toString()}`:s():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}shouldUseIntlApi(){return!y6.includes(this.options.compatibilityJSON)}}const KT=function(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=o6(n,e,t);return!s&&r&&gt(t)&&(s=Ug(n,t,i),s===void 0&&(s=Ug(e,t,i))),s},O0=n=>n.replace(/\$/g,"$$$$");class x6{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=vr.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:s,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:u,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:h,nestingPrefixEscaped:p,nestingSuffix:g,nestingSuffixEscaped:v,nestingOptionsSeparator:y,maxReplaces:b,alwaysFormat:T}=e.interpolation;this.escape=t!==void 0?t:l6,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=s?wo(s):a||"{{",this.suffix=o?wo(o):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=h?wo(h):p||wo("$t("),this.nestingSuffix=g?wo(g):v||wo(")"),this.nestingOptionsSeparator=y||",",this.maxReplaces=b||1e3,this.alwaysFormat=T!==void 0?T:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t&&t.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,r){let s,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=p=>{if(p.indexOf(this.formatSeparator)<0){const b=KT(t,l,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(b,void 0,i,{...r,...t,interpolationkey:p}):b}const g=p.split(this.formatSeparator),v=g.shift().trim(),y=g.join(this.formatSeparator).trim();return this.format(KT(t,l,v,this.options.keySeparator,this.options.ignoreJSONStructure),y,i,{...r,...t,interpolationkey:v})};this.resetRegExp();const c=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>O0(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?O0(this.escape(p)):O0(p)}].forEach(p=>{for(o=0;s=p.regex.exec(e);){const g=s[1].trim();if(a=u(g),a===void 0)if(typeof c=="function"){const y=c(e,s,r);a=gt(y)?y:""}else if(r&&Object.prototype.hasOwnProperty.call(r,g))a="";else if(d){a=s[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),a="";else!gt(a)&&!this.useRawValueToEscape&&(a=HT(a));const v=p.safeValue(a);if(e=e.replace(s[0],v),d?(p.regex.lastIndex+=a.length,p.regex.lastIndex-=s[0].length):p.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,s,a;const o=(l,u)=>{const c=this.nestingOptionsSeparator;if(l.indexOf(c)<0)return l;const d=l.split(new RegExp(`${c}[ ]*{`));let h=`{${d[1]}`;l=d[0],h=this.interpolate(h,a);const p=h.match(/'/g),g=h.match(/"/g);(p&&p.length%2===0&&!g||g.length%2!==0)&&(h=h.replace(/'/g,'"'));try{a=JSON.parse(h),u&&(a={...u,...a})}catch(v){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,v),`${l}${c}${h}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...i},a=a.replace&&!gt(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let u=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const c=r[1].split(this.formatSeparator).map(d=>d.trim());r[1]=c.shift(),l=c,u=!0}if(s=t(o.call(this,r[1].trim(),a),a),s&&r[0]===e&&!gt(s))return s;gt(s)||(s=HT(s)),s||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),s=""),u&&(s=l.reduce((c,d)=>this.format(c,d,i.lng,{...i,interpolationkey:r[1].trim()}),s.trim())),e=e.replace(r[0],s),this.regexp.lastIndex=0}return e}}const S6=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),c=o.trim();t[c]||(t[c]=u),u==="false"&&(t[c]=!1),u==="true"&&(t[c]=!0),isNaN(u)||(t[c]=parseInt(u,10))}})}return{formatName:e,formatOptions:t}},Ao=n=>{const e={};return(t,i,r)=>{let s=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(s={...s,[r.interpolationkey]:void 0});const a=i+JSON.stringify(s);let o=e[a];return o||(o=n(Rf(i),r),e[a]=o),o(t)}};class w6{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=vr.create("formatter"),this.options=e,this.formats={number:Ao((t,i)=>{const r=new Intl.NumberFormat(t,{...i});return s=>r.format(s)}),currency:Ao((t,i)=>{const r=new Intl.NumberFormat(t,{...i,style:"currency"});return s=>r.format(s)}),datetime:Ao((t,i)=>{const r=new Intl.DateTimeFormat(t,{...i});return s=>r.format(s)}),relativetime:Ao((t,i)=>{const r=new Intl.RelativeTimeFormat(t,{...i});return s=>r.format(s,i.range||"day")}),list:Ao((t,i)=>{const r=new Intl.ListFormat(t,{...i});return s=>r.format(s)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Ao(t)}format(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,l)=>{const{formatName:u,formatOptions:c}=S6(l);if(this.formats[u]){let d=o;try{const h=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},p=h.locale||h.lng||r.locale||r.lng||i;d=this.formats[u](o,p,{...c,...r,...h})}catch(h){this.logger.warn(h)}return d}else this.logger.warn(`there was no format function for ${u}`);return o},e)}}const A6=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class C6 extends th{constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=vr.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(i,r.backend,r)}queueLoad(e,t,i,r){const s={},a={},o={},l={};return e.forEach(u=>{let c=!0;t.forEach(d=>{const h=`${u}|${d}`;!i.reload&&this.store.hasResourceBundle(u,d)?this.state[h]=2:this.state[h]<0||(this.state[h]===1?a[h]===void 0&&(a[h]=!0):(this.state[h]=1,c=!1,a[h]===void 0&&(a[h]=!0),s[h]===void 0&&(s[h]=!0),l[d]===void 0&&(l[d]=!0)))}),c||(o[u]=!0)}),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,t,i){const r=e.split("|"),s=r[0],a=r[1];t&&this.emit("failedLoading",s,a,t),!t&&i&&this.store.addResourceBundle(s,a,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const o={};this.queue.forEach(l=>{a6(l.loaded,[s],a),A6(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{o[u]||(o[u]={});const c=l.loaded[u];c.length&&c.forEach(d=>{o[u][d]===void 0&&(o[u][d]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:s,callback:a});return}this.readingCalls++;const o=(u,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(u&&c&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,r+1,s*2,a)},s);return}a(u,c)},l=this.backend[i].bind(this.backend);if(l.length===2){try{const u=l(e,t);u&&typeof u.then=="function"?u.then(c=>o(null,c)).catch(o):o(null,u)}catch(u){o(u)}return}return l(e,t,o)}prepareLoading(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();gt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),gt(t)&&(t=[t]);const s=this.queueLoad(e,t,i,r);if(!s.toLoad.length)return s.pending.length||r(),null;s.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=e.split("|"),r=i[0],s=i[1];this.read(r,s,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${t}loading namespace ${s} for language ${r} failed`,a),!a&&o&&this.logger.log(`${t}loaded namespace ${s} for language ${r}`,o),this.loaded(e,a,o)})}saveMissing(e,t,i,r,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend&&this.backend.create){const l={...a,isUpdate:s},u=this.backend.create.bind(this.backend);if(u.length<6)try{let c;u.length===5?c=u(e,t,i,r,l):c=u(e,t,i,r),c&&typeof c.then=="function"?c.then(d=>o(null,d)).catch(o):o(null,c)}catch(c){o(c)}else u(e,t,i,r,o,l)}!e||!e[0]||this.store.addResource(e[0],t,i,r)}}}const YT=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),gt(n[1])&&(e.defaultValue=n[1]),gt(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),XT=n=>(gt(n.ns)&&(n.ns=[n.ns]),gt(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),gt(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs&&n.supportedLngs.indexOf("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),n),yd=()=>{},I6=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class Ol extends th{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=XT(e),this.services={},this.logger=vr,this.modules={external:[]},I6(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(i=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(gt(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=YT();this.options={...r,...this.options,...XT(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=c=>c?typeof c=="function"?new c:c:null;if(!this.options.isClone){this.modules.logger?vr.init(s(this.modules.logger),this.options):vr.init(null,this.options);let c;this.modules.formatter?c=this.modules.formatter:typeof Intl<"u"&&(c=w6);const d=new qT(this.options);this.store=new GT(this.options.resources,this.options);const h=this.services;h.logger=vr,h.resourceStore=this.store,h.languageUtils=d,h.pluralResolver=new T6(d,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),c&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(h.formatter=s(c),h.formatter.init(h,this.options),this.options.interpolation.format=h.formatter.format.bind(h.formatter)),h.interpolator=new x6(this.options),h.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},h.backendConnector=new C6(s(this.modules.backend),h.resourceStore,h,this.options),h.backendConnector.on("*",function(p){for(var g=arguments.length,v=new Array(g>1?g-1:0),y=1;y<g;y++)v[y-1]=arguments[y];e.emit(p,...v)}),this.modules.languageDetector&&(h.languageDetector=s(this.modules.languageDetector),h.languageDetector.init&&h.languageDetector.init(h,this.options.detection,this.options)),this.modules.i18nFormat&&(h.i18nFormat=s(this.modules.i18nFormat),h.i18nFormat.init&&h.i18nFormat.init(this)),this.translator=new _f(this.services,this.options),this.translator.on("*",function(p){for(var g=arguments.length,v=new Array(g>1?g-1:0),y=1;y<g;y++)v[y-1]=arguments[y];e.emit(p,...v)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,i||(i=yd),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&c[0]!=="dev"&&(this.options.lng=c[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(c=>{this[c]=function(){return e.store[c](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(c=>{this[c]=function(){return e.store[c](...arguments),e}});const l=nl(),u=()=>{const c=(d,h)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(h),i(d,h)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return c(null,this.t.bind(this));this.changeLanguage(this.options.lng,c)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yd;const r=gt(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&r.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const s=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(u=>{u!=="cimode"&&s.indexOf(u)<0&&s.push(u)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload&&this.options.preload.forEach(o=>a(o)),this.services.backendConnector.load(s,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(o)})}else i(null)}reloadResources(e,t,i){const r=nl();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=yd),this.services.backendConnector.reload(e,t,s=>{r.resolve(),i(s)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&sC.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}}changeLanguage(e,t){var i=this;this.isLanguageChangingTo=e;const r=nl();this.emit("languageChanging",e);const s=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,u)=>{u?(s(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,r.resolve(function(){return i.t(...arguments)}),t&&t(l,function(){return i.t(...arguments)})},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=gt(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||s(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,c=>{a(c,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),r}getFixedT(e,t,i){var r=this;const s=function(a,o){let l;if(typeof o!="object"){for(var u=arguments.length,c=new Array(u>2?u-2:0),d=2;d<u;d++)c[d-2]=arguments[d];l=r.options.overloadTranslationOptionHandler([a,o].concat(c))}else l={...o};l.lng=l.lng||s.lng,l.lngs=l.lngs||s.lngs,l.ns=l.ns||s.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||i||s.keyPrefix);const h=r.options.keySeparator||".";let p;return l.keyPrefix&&Array.isArray(a)?p=a.map(g=>`${l.keyPrefix}${h}${g}`):p=l.keyPrefix?`${l.keyPrefix}${h}${a}`:a,r.t(p,l)};return gt(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=i,s}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const u=this.services.backendConnector.state[`${o}|${l}`];return u===-1||u===0||u===2};if(t.precheck){const o=t.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(i,e)&&(!r||a(s,e)))}loadNamespaces(e,t){const i=nl();return this.options.ns?(gt(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),t&&t(r)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=nl();gt(e)&&(e=[e]);const r=this.options.preload||[],s=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return s.length?(this.options.preload=r.concat(s),this.loadResources(a=>{i.resolve(),t&&t(a)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services&&this.services.languageUtils||new qT(YT());return t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Ol(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yd;const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},s=new Ol(r);return(e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},i&&(s.store=new GT(this.store.data,r),s.services.resourceStore=s.store),s.translator=new _f(s.services,r),s.translator.on("*",function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];s.emit(o,...u)}),s.init(r,t),s.translator.options=r,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Hn=Ol.createInstance();Hn.createInstance=Ol.createInstance;Hn.createInstance;Hn.dir;Hn.init;Hn.loadResources;Hn.reloadResources;Hn.use;Hn.changeLanguage;Hn.getFixedT;Hn.t;Hn.exists;Hn.setDefaultNamespace;Hn.hasLoadedNamespace;Hn.loadNamespaces;Hn.loadLanguages;const R6=(n,e,t,i)=>{var s,a,o,l;const r=[t,{code:e,...i||{}}];if((a=(s=n==null?void 0:n.services)==null?void 0:s.logger)!=null&&a.forward)return n.services.logger.forward(r,"warn","react-i18next::",!0);Oa(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),(l=(o=n==null?void 0:n.services)==null?void 0:o.logger)!=null&&l.warn?n.services.logger.warn(...r):console!=null&&console.warn&&console.warn(...r)},QT={},zg=(n,e,t,i)=>{Oa(t)&&QT[t]||(Oa(t)&&(QT[t]=new Date),R6(n,e,t,i))},aC=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},jg=(n,e,t)=>{n.loadNamespaces(e,aC(n,t))},ZT=(n,e,t,i)=>{if(Oa(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(e)>-1)return jg(n,t,i);t.forEach(r=>{n.options.ns.indexOf(r)<0&&n.options.ns.push(r)}),n.loadLanguages(e,aC(n,i))},_6=(n,e,t={})=>!e.languages||!e.languages.length?(zg(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(n,{lng:t.lng,precheck:(i,r)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!r(i.isLanguageChangingTo,n))return!1}}),Oa=n=>typeof n=="string",L6=n=>typeof n=="object"&&n!==null,P6=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,k6={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},D6=n=>k6[n],O6=n=>n.replace(P6,D6);let Vg={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:O6};const N6=(n={})=>{Vg={...Vg,...n}},M6=()=>Vg;let oC;const F6=n=>{oC=n},B6=()=>oC,U6={type:"3rdParty",init(n){N6(n.options.react),F6(n)}},H6=U.createContext();class z6{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const j6=(n,e)=>{const t=U.useRef();return U.useEffect(()=>{t.current=n},[n,e]),t.current},uC=(n,e,t,i)=>n.getFixedT(e,t,i),V6=(n,e,t,i)=>U.useCallback(uC(n,e,t,i),[n,e,t,i]),Zs=(n,e={})=>{var w,A,R,_;const{i18n:t}=e,{i18n:i,defaultNS:r}=U.useContext(H6)||{},s=t||i||B6();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new z6),!s){zg(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const D=(P,N)=>Oa(N)?N:L6(N)&&Oa(N.defaultValue)?N.defaultValue:Array.isArray(P)?P[P.length-1]:P,H=[D,{},!1];return H.t=D,H.i18n={},H.ready=!1,H}(w=s.options.react)!=null&&w.wait&&zg(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...M6(),...s.options.react,...e},{useSuspense:o,keyPrefix:l}=a;let u=r||((A=s.options)==null?void 0:A.defaultNS);u=Oa(u)?[u]:u||["translation"],(_=(R=s.reportNamespaces).addUsedNamespaces)==null||_.call(R,u);const c=(s.isInitialized||s.initializedStoreOnce)&&u.every(D=>_6(D,s,a)),d=V6(s,e.lng||null,a.nsMode==="fallback"?u:u[0],l),h=()=>d,p=()=>uC(s,e.lng||null,a.nsMode==="fallback"?u:u[0],l),[g,v]=U.useState(h);let y=u.join();e.lng&&(y=`${e.lng}${y}`);const b=j6(y),T=U.useRef(!0);U.useEffect(()=>{const{bindI18n:D,bindI18nStore:H}=a;T.current=!0,!c&&!o&&(e.lng?ZT(s,e.lng,u,()=>{T.current&&v(p)}):jg(s,u,()=>{T.current&&v(p)})),c&&b&&b!==y&&T.current&&v(p);const P=()=>{T.current&&v(p)};return D&&(s==null||s.on(D,P)),H&&(s==null||s.store.on(H,P)),()=>{T.current=!1,s&&D&&(D==null||D.split(" ").forEach(N=>s.off(N,P))),H&&s&&H.split(" ").forEach(N=>s.store.off(N,P))}},[s,y]),U.useEffect(()=>{T.current&&c&&v(h)},[s,l,c]);const x=[g,s,c];if(x.t=g,x.i18n=s,x.ready=c,c||!c&&!o)return x;throw new Promise(D=>{e.lng?ZT(s,e.lng,u,()=>D()):jg(s,u,()=>D())})};function Nl(n){"@babel/helpers - typeof";return Nl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nl(n)}function G6(n,e){if(Nl(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(Nl(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function W6(n){var e=G6(n,"string");return Nl(e)=="symbol"?e:e+""}function Fs(n,e,t){return(e=W6(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $r(n){return Array.isArray(n)?n:n?[n]:[]}function Ar(n){for(let e in n)(n[e]===void 0||n[e]===null)&&delete n[e];return n}function zs(n){return typeof n=="string"?!1:n&&!n.type&&"source"in n?(n.type="SpecificResource",!0):!!n&&n.type==="SpecificResource"}function Ed(...n){return e=>n.reduce((t,i)=>i(t),e)}const JT=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function q6(n,e){if(n==null)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(n))throw Error("Array is not a valid entity");if(typeof n!="object"){if(e)return e;throw Error(`${typeof n} is not a valid entity`)}if(typeof n.type=="string"){let t=JT.indexOf(n.type);if(t!==-1)return JT[t]}if(n.profile)return"Service";throw Error("Resource type is not known")}var $6=class lC{constructor(e,t={}){Fs(this,"traversals",void 0),Fs(this,"options",void 0),Fs(this,"_traverseManifest",Ed(this.traverseManifestItems.bind(this),this.traverseNavPlace.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),Fs(this,"_traverseCanvas",Ed(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),Fs(this,"_traverseAnnotationPage",Ed(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),Fs(this,"_traverseRange",Ed(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(e){return new lC({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],geoJson:[e],specificResource:[e],agent:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=$r(e.thumbnail).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(t=>this.traverseAgent(t,e))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=$r(e.seeAlso).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.service&&(e.service=$r(e.service).map(t=>this.traverseService(t))),e.services&&(e.services=$r(e.services).map(t=>this.traverseService(t,e))),e.logo&&(e.logo=$r(e.logo).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.homepage&&(e.homepage=$r(e.homepage).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(t=>typeof t=="string"||!t.type?this.traverseType(t,{parent:e},this.traversals.contentResource):t.type==="Canvas"?this.traverseType(t,{parent:e},this.traversals.canvas):t.type==="AnnotationCollection"?this.traverseType(t,{parent:e},this.traversals.annotationCollection):t.type==="Collection"?this.traverseType(t,{parent:e},this.traversals.collection):this.traverseType(t,{parent:e},this.traversals.contentResource))),e.start&&(zs(e.start)?e.start=this.traverseSpecificResource(e.start,"Canvas",e):e.start=this.traverseType(e.start,{parent:e},this.traversals.canvas)),e.rendering&&(e.rendering=e.rendering.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(t=>t.type==="Collection"?this.traverseCollection(t):this.traverseManifest(t)),e}traverseCollection(e,t){return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e)))))),{parent:t},this.traversals.collection)}traverseGeoJson(e,t){return this.traverseType(e,{parent:t},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&(e.navPlace=this.traverseGeoJson(e.navPlace,e)),e}traverseManifestItems(e){return e.items&&(e.items=e.items.map(t=>this.traverseCanvas(t))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(t=>this.traverseRange(t))),e}traverseManifest(e,t){return this.traverseType(this._traverseManifest(e),{parent:t},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t,e)),e}traverseInlineAnnotationPages(e){return typeof e=="string"||!e||e.annotations&&(e.annotations=e.annotations.map(t=>this.traverseAnnotationPage(t,e))),e}traverseCanvas(e,t){return this.traverseType(this._traverseCanvas(e),{parent:t},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(t=>this.traverseAnnotation(t,e))),e}traverseAnnotationPage(e,t){return this.traverseType(this._traverseAnnotationPage(e),{parent:t},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t,e)):e.body&&(e.body=this.traverseContentResource(e.body,e)),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e,t){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:t},this.traversals.annotation)}traverseContentResourceLinking(e){return typeof e=="string"||!e||e&&e.service&&(e.service=$r(e.service||[]).map(t=>this.traverseService(t,e))),e}traverseContentResource(e,t){return e.type==="Choice"&&(e.items=e.items.map(i=>this.traverseContentResource(i,e))),zs(e)?this.traverseSpecificResource(e,"ContentResource"):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:t},this.traversals.contentResource)}traverseSpecificResource(e,t,i){let r=e.source;return typeof e.source=="string"&&(r={id:e.source,type:t||"unknown"}),this.traverseType({...e,source:t==="Canvas"||r.type==="Canvas"?this.traverseType(r,{parent:i},this.traversals.canvas):t==="ContentResource"?this.traverseContentResource(r,{parent:i}):this.traverseUnknown(r,{parent:i,typeHint:t})},{parent:i},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(t=>typeof t=="string"?this.traverseCanvas({id:t,type:"Canvas"},e):zs(t)?this.traverseSpecificResource(t,"Canvas",e):t.type==="Manifest"?this.traverseManifest(t,e):this.traverseRange(t,e))),e}traverseRange(e,t){return this.traverseType(this._traverseRange(e),{parent:t},this.traversals.range)}traverseAgent(e,t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:t},this.traversals.agent)}traverseType(e,t,i){return i.reduce((r,s)=>{let a=s(r,t);return a===void 0&&!this.options.allowUndefinedReturn?r:a},e)}traverseService(e,t){let i=Object.assign({},e);return i&&i.service&&(i.service=$r(i.service).map(r=>this.traverseService(r))),this.traverseType(i,{parent:t},this.traversals.service)}traverseUnknown(e,{parent:t,typeHint:i}={}){let r=q6(e,i);switch(r){case"Collection":return this.traverseCollection(e,t);case"Manifest":return this.traverseManifest(e,t);case"Canvas":return this.traverseCanvas(e,t);case"AnnotationPage":return this.traverseAnnotationPage(e,t);case"Annotation":return this.traverseAnnotation(e,t);case"ContentResource":return this.traverseContentResource(e,t);case"Range":return this.traverseRange(e,t);case"Service":return this.traverseService(e,t);case"Agent":return this.traverseAgent(e,t);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}};const K6="http://library.stanford.edu/iiif/image-api/compliance.html#level0",Y6="http://library.stanford.edu/iiif/image-api/compliance.html#level1",cC="http://library.stanford.edu/iiif/image-api/compliance.html#level2",X6="http://library.stanford.edu/iiif/image-api/conformance.html#level0",Q6="http://library.stanford.edu/iiif/image-api/conformance.html#level1",dC="http://library.stanford.edu/iiif/image-api/conformance.html#level2",Z6="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",J6="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",fC="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e4="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",t4="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",hC="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",n4="http://iiif.io/api/image/1/level0.json",i4="http://iiif.io/api/image/1/profiles/level0.json",r4="http://iiif.io/api/image/1/level1.json",s4="http://iiif.io/api/image/1/profiles/level1.json",pC="http://iiif.io/api/image/1/level2.json",mC="http://iiif.io/api/image/1/profiles/level2.json",a4="http://iiif.io/api/image/2/level0.json",o4="http://iiif.io/api/image/2/profiles/level0.json",u4="http://iiif.io/api/image/2/level1.json",l4="http://iiif.io/api/image/2/profiles/level1.json",gC="http://iiif.io/api/image/2/level2.json",vC="http://iiif.io/api/image/2/profiles/level2.json",c4="level0",d4="level1",yC="level2",f4="http://iiif.io/api/image/2/level0",h4="http://iiif.io/api/image/2/level1",EC="http://iiif.io/api/image/2/level2",p4=[EC,cC,dC,fC,hC,pC,mC,gC,vC,yC],m4=[f4,h4,EC,K6,Y6,cC,X6,Q6,dC,Z6,J6,fC,e4,t4,hC,n4,i4,r4,s4,pC,mC,a4,o4,u4,l4,gC,vC,c4,d4,yC],g4=m4,ex=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function v4(n){if(n==null)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(n))throw Error("Array is not a valid entity");if(typeof n!="object")throw Error(`${typeof n} is not a valid entity`);if(typeof n["@type"]=="string"){let e=ex.indexOf(n["@type"]);if(e!==-1)return ex[e]}if(n.profile)return"Service";if(n.format||n["@type"])return"ContentResource";throw Error("Resource type is not known")}var y4=class bC{constructor(e,t={}){Fs(this,"traversals",void 0),Fs(this,"options",void 0),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new bC({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let t=[...(e.manifests||[]).map(s=>typeof s=="string"?{"@id":s,"@type":"sc:Manifest"}:s),...(e.collections||[]).map(s=>typeof s=="string"?{"@id":s,"@type":"sc:Collection"}:s),...e.members||[]],i=[],r=t.filter(s=>i.includes(s["@id"])?!1:(i.push(s["@id"]),!0));delete e.collections,delete e.manifests,e.members=r}return e.manifests&&(e.manifests=e.manifests.map(t=>this.traverseManifest(typeof t=="string"?{"@id":t,"@type":"sc:Manifest"}:t))),e.collections&&(e.collections=e.collections.map(t=>this.traverseCollection(typeof t=="string"?{"@id":t,"@type":"sc:Collection"}:t))),e.members&&(e.members=e.members.map(t=>typeof t=="string"?t:t["@type"]==="sc:Collection"?this.traverseCollection(t):t["@type"]==="sc:Manifest"?this.traverseManifest(t):this.traverseUnknown(t))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(t=>this.traverseSequence(t))),e.structures&&(e.structures=e.structures.map(t=>this.traverseRange(t))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(t=>this.traverseCanvas(t))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(t=>this.traverseAnnotation(t))),e.otherContent&&(e.otherContent=e.otherContent.map(t=>this.traverseAnnotationList(t))),e}traverseRange(e){return e["@type"]!=="sc:Range"&&(e["@type"]="sc:Range"),this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Range"}:i),...(e.canvases||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Canvas"}:i),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(i=>this.traverseUnknown(i)):void 0}return e}traverseAnnotationList(e){let t=typeof e=="string"?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(t=>this.traverseAnnotation(t))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(t=>this.traverseContentResource(t)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(t=>this.traverseAnnotationList(t))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&e.default!=="rdf:nil"&&(e.default=this.traverseContentResource(e.default)),e.item&&e.item!=="rdf:nil"&&(e.item=e.item.map(t=>this.traverseContentResource(t))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return e["@type"]==="oa:Choice"?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||typeof e=="string")return e;switch(v4(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let s of i)typeof s=="string"?r.push(this.traverseContentResource({"@id":s,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(s));return!t&&!this.options.convertPropsToArray?r[0]:r}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let s of i)r.push(this.traverseService(s));return!t&&!this.options.convertPropsToArray?r[0]:r}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&(typeof e.within=="string"||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&(typeof e.startCanvas=="string"?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&(typeof e.contentLayer=="string"?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e))if(this.options.convertPropsToArray)e=[e];else return this.traverseType(e,t);return e.map(i=>this.traverseType(i,t))}traverseType(e,t){return t.reduce((i,r)=>{let s=r(i);return s===void 0&&!this.options.allowUndefinedReturn?i:s},e)}};const E4=["http://iiif.io/api/image/2/level1","http://iiif.io/api/image/2/level2","http://library.stanford.edu/iiif/image-api/compliance.html#level1","http://library.stanford.edu/iiif/image-api/compliance.html#level2","http://library.stanford.edu/iiif/image-api/conformance.html#level1","http://library.stanford.edu/iiif/image-api/conformance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2","http://iiif.io/api/image/1/level1.json","http://iiif.io/api/image/1/profiles/level1.json","http://iiif.io/api/image/1/level2.json","http://iiif.io/api/image/1/profiles/level2.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/profiles/level1.json","http://iiif.io/api/image/2/level2.json","http://iiif.io/api/image/2/profiles/level2.json","level1","level2"],Gg={attributionLabel:"Attribution",providerId:"http://example.org/provider",providerName:""};function b4(n){if(typeof n=="string")return[n];if(!n)return[];let e=Array.isArray(n)?n:[n],t=[];for(let i of e){if(typeof i=="string"){t.push(i);continue}t.push({"@language":i["@language"]||i.language,"@value":i["@value"]||i.value})}return t}function Pa(n,e="none"){if(!n)return{none:[""]};let t=b4(n),i={};for(let r of t){if(typeof r=="string"){i[e]=i[e]?i[e]:[],i[e].push(r||"");continue}if(!r["@language"]){i[e]=i[e]?i[e]:[],i[e].push(r["@value"]||"");continue}let s=r["@language"];i[s]=i[s]?i[s]:[],i[s].push(r["@value"]||"")}return Object.keys(i).length===0?{none:[""]}:i}function TC(n){if(Array.isArray(n))return TC(n.find(e=>typeof e=="string"));if(p4.indexOf(n)!==-1)return"level2";if(E4.indexOf(n)!==-1)return"level1";if(g4.indexOf(n)!==-1)return"level0";if(typeof n=="string")return n}function T4(n){let e=Array.isArray(n)?n:[n];for(let t of e)switch(t){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function x4(n){switch(n){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function tx(n){for(let e of["sc","oa","dcterms","dctypes","iiif"])if(n.startsWith(`${e}:`))return n.slice(e.length+1);return n}const S4=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function oy(n){let e=n["@id"]||n.id,t=n["@type"]||n.type,i=n.profile||void 0,r=n["@context"]||void 0;if(i){let s=x4(i);if(s)return s}if(r){let s=T4(r);if(s)return s}if(t){if(Array.isArray(t)){if(t.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(t.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";t=t[0]}for(let s of["sc","oa","dcterms","dctypes","iiif"])if(t.startsWith(`${s}:`)){t=t.slice(s.length+1);break}switch(t){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(t&&S4.indexOf(t)!==-1)return t;if(n.format){if(n.format.startsWith("image/"))return"Image";if(n.format.startsWith("text/")||n.format==="application/pdf")return"Text";if(n.format.startsWith("application/"))return"Dataset"}return e&&(e.endsWith(".jpg")||e.endsWith(".png")||e.endsWith(".jpeg"))?"Image":t||"unknown"}const w4=/^|["'\\>]http(s)?:\/\/(creativecommons.org|rightsstatements.org)\/[^"'\\<\n]+/gm;function A4(n){let e=n.match(w4);return e?e[0]:n}function C4(n,e="Rights/License",t="none"){let i=null,r=[],s=Array.isArray(n)?n:[n];for(let a of s){let o=a?A4(a):void 0;if(o&&(o.indexOf("creativecommons.org")!==-1||o.indexOf("rightsstatements.org")!==-1)){i=o.startsWith("https://")?`http://${o.slice(8)}`:o;continue}o&&r.push({label:{[t]:[e]},value:{[t]:[o]}})}return[i,r]}const I4=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function R4(n){if(n){let e=Array.isArray(n)?n:[n],t=[];for(let i of e)i==="http://iiif.io/api/presentation/2/context.json"&&t.push("http://iiif.io/api/presentation/3/context.json"),I4.indexOf(i)===-1&&t.push(i);if(e.length)return t.length===1?t[0]:t}}function _4(n){return n?n.map(e=>({label:Pa(e.label),value:Pa(e.value)})):[]}let nx=0;function xC(n,e){let t=encodeURI(n.id||n["@id"]||"").trim();return t&&e?`${t}/${e}`:t||(nx++,`http://example.org/${n["@type"]}${e?`/${e}`:""}/${nx}`)}function ns(n){let e=[...n.behavior||[]];n.viewingHint&&e.push(n.viewingHint);let t;return Array.isArray(n.motivation)?t=n.motivation.map(tx):n.motivation&&(t=tx(n.motivation)),{"@context":n["@context"]?R4(n["@context"]):void 0,id:(n["@id"]||xC(n)).trim(),type:oy(n),behavior:e.length?e:void 0,height:n.height?n.height:void 0,width:n.width?n.width:void 0,motivation:t,viewingDirection:n.viewingDirection,profile:n.profile,format:n.format?n.format:void 0,duration:void 0,timeMode:void 0}}function is(n){let[e,t]=C4(n.license),i=[...n.metadata?_4(n.metadata):[],...t];return{rights:e,metadata:i.length?i:void 0,label:n.label?Pa(n.label):void 0,requiredStatement:n.attribution?{label:Pa(Gg.attributionLabel),value:Pa(n.attribution)}:void 0,navDate:n.navDate,summary:n.description?Pa(n.description):void 0,thumbnail:L4(n.thumbnail)}}function L4(n){return n&&(Array.isArray(n)?n:[n]).map(t=>typeof t=="string"?{id:t,type:"Image"}:(t.type==="unknown"&&(t.type="Image"),t))}function P4(n){if(!n.within)return;let e=Array.isArray(n.within)?n.within:[n.within],t=[];for(let i of e)if(typeof i=="string"){if(i)switch(n["@type"]){case"sc:Manifest":t.push({id:i,type:"Collection"});break}}else i["@id"]&&t.push({id:i["@id"],type:oy(i)});return t.length?t:void 0}function Js(n){let e=n.related?Array.isArray(n.related)?n.related:[n.related]:[],t=n.contentLayer;return{provider:n.logo||e.length?[{id:Gg.providerId,type:"Agent",homepage:e.length?[e[0]]:void 0,logo:n.logo?Array.isArray(n.logo)?n.logo:[n.logo]:void 0,label:Pa(Gg.providerName)}]:void 0,partOf:P4(n),rendering:n.rendering,seeAlso:n.seeAlso,start:n.startCanvas,service:n.service?$r(n.service):void 0,supplementary:t?[t]:void 0}}function k4(n){return{chars:n.chars,format:n.format?n.format:void 0,language:n.language}}function N0(n,e){return n?typeof n=="string"?{id:n,type:e}:typeof(n==null?void 0:n["@id"])=="string"?{id:n["@id"],type:e}:typeof n.id=="string"?{id:n.id,type:e}:null:null}function D4(n){let e={};if(n.first){let t=N0(n.first,"Collection");t&&(e.first=t)}if((n.total||n.total===0)&&(e.total=n.total),n.prev){let t=N0(n.prev,"Collection");t&&(e.prev=t)}if(n.next){let t=N0(n.next,"Collection");t&&(e.next=t)}return e}function O4(n){let e=[];for(let t of n){let i={...t};i.items&&i.items.length===0&&delete i.items,e.push(i)}return e}function N4(n){return Ar({...ns(n),...is(n),...Js(n),...D4(n),items:O4(n.members)})}function M4(n){let e=[],t=[],i,r;for(let a of n.sequences||[])a.canvases.length&&e.push(...a.canvases),a.behavior&&t.push(...a.behavior),a.viewingDirection&&(r=a.viewingDirection),a.startCanvas&&(i=a.startCanvas);let s=ns(n);return t.length&&(s.behavior?s.behavior.push(...t):s.behavior=t),Ar({...s,...is(n),...Js(n),viewingDirection:r,start:i,items:e,structures:F4(n.structures)})}function F4(n){if(!n)return n;let e=new Map;for(let i of n)e.set(i.id,i);let t=[];for(let i of n)if(i.items){let r=i.items.map(s=>typeof s=="string"?(t.push(s),e.get(s)||s):s&&s.id?(t.push(s.id),e.get(s.id)||s):s);i.items=r}return n.filter(i=>t.indexOf(i.id)===-1)}function B4(n){return Ar({...ns(n),...is(n),...Js(n),annotations:n.otherContent&&n.otherContent.length?n.otherContent:void 0,items:n.images&&n.images.length?[{id:xC(n,"annotation-page"),type:"AnnotationPage",items:n.images}]:void 0})}function U4(n){return Ar({...ns(n),...is(n),...Js(n),items:n.resources&&n.resources.length?n.resources:void 0})}function H4(n){return!n.canvases||n.canvases.length===0?{canvases:[],behavior:[]}:{canvases:n.canvases,behavior:n.viewingHint?[n.viewingHint]:[],viewingDirection:n.viewingDirection,startCanvas:n.startCanvas}}function z4(n){function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if(typeof t=="string")return encodeURI(t).trim();if("@type"in t){let i;if(typeof t.full=="string")i=t.full;else if(t.full["@type"]==="dctypes:Image")i={id:t.full["@id"],type:"Image"};else if(t.full["@type"]==="sc:Canvas")i={id:t.full["@id"],type:"Canvas"};else throw Error(`Unsupported source type on annotation: ${t.full["@type"]}`);return{type:"SpecificResource",source:i,selector:Wg(t.selector)}}else return encodeURI(t["@id"]).trim()}return Ar({...ns(n),...is(n),...Js(n),target:e(n.on),body:Array.isArray(n.resource)?n.resource.map(ix):ix(n.resource)})}function ix(n){return n.type==="Choice"?n:SC(n)}function SC(n){let e=n;return Ar({...ns(e),...is(e),...Js(e),...k4(e)})}function j4(n){let e=[];return n.default&&n.default!=="rdf:nil"&&e.push(n.default),n.item&&n.item!=="rdf:nil"&&e.push(...n.item),Ar({...ns(n),...is(n),items:e})}function V4(n){return Ar({...ns(n),...is(n),...Js(n),items:n.members})}function G4(n){let{"@id":e,"@type":t,"@context":i,profile:r,...s}=n,a={};return e&&(a["@id"]=e),a["@type"]=oy(n),a["@type"]==="unknown"&&(i&&i.length&&(a["@context"]=i),a["@type"]="Service"),r&&(a.profile=TC(r)),Ar({...a,...s})}function W4(n){return Ar({...ns(n),...is(n),...Js(n)})}const q4=new y4({collection:[N4],manifest:[M4],canvas:[B4],annotationList:[U4],sequence:[H4],annotation:[z4],contentResource:[SC],choice:[j4],range:[V4],service:[G4],layer:[W4]});function $4(n){return n&&n["@context"]&&(n["@context"]==="http://iiif.io/api/presentation/2/context.json"||Array.isArray(n["@context"])&&n["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||n["@context"]==="http://www.shared-canvas.org/ns/context.json")||n["@context"]==="http://iiif.io/api/image/2/context.json"||n["@id"]&&n["@type"]==="sc:Collection"||n["@id"]&&n["@type"]==="sc:Manifest"?(n["@context"]||(n["@context"]="http://iiif.io/api/presentation/2/context.json"),q4.traverseUnknown(n)):n}function Wg(n){if((Array.isArray(n["@type"])&&n["@type"].includes("oa:SvgSelector")||n["@type"]=="oa:SvgSelector")&&("chars"in n||"value"in n))return{type:"SvgSelector",value:"chars"in n?n.chars:n.value};if(n["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:n.value};if(n["@type"]==="oa:Choice")return[Wg(n.default),...(Array.isArray(n.item)?n.item:[n.item]).map(Wg)];if(n["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in n?n.region:void 0,rotation:"rotation"in n?n.rotation:void 0};throw Error(`Unsupported selector type: ${n["@type"]}`)}function wC(n,e){let t="unknown";if(!n)return;if(typeof n=="string")return{id:n,type:t};if(zs(n))return wC(n.source);let i=n.type||n["@type"],r=n.id||n["@id"];if(i&&i.indexOf(":")!==-1&&(i=i.split(":").pop()),r&&i)return{id:r,type:i}}const El={},gn="iiif-parser:hasPart",Qr="iiif-parser:partOf",bl="iiif-parser:isExternal",Qi="__$UNSET$__",AC="__$UNWRAP$__",it=[];Object.freeze(it),Object.freeze(El);function K4(n){if(n===El||Object.keys(n).length===0)return!0;for(let e in n)return!1;return!0}function uy(n,e){if(e&&e["@explicit"]){let t={},i=Object.keys(e);for(let r of i)r===Qr||r==="@explicit"||(K4(e[r])?t[r]=n[r]:t[r]=e[r]);return t}return n}function CC(n,e,t){let i=wC(e);if(!i)return[void 0,void 0];let r=n.requests[i.id],s=i.type||n.mapping[i.id];if(!s||r&&r.resourceUri&&(!n.entities[s]||!n.entities[s][r.resourceUri]))return[void 0,void 0];let a=n.entities[s][r?r.resourceUri:i.id];if(i.type&&!a)return CC(n,{id:i.id},t);if(a&&a[gn]){let o=a[gn].find(u=>t?u[Qr]===t.id:u[Qr]===a.id);return[uy(a,o),a]}return[a,a]}const Y4={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:it,label:null,thumbnail:it,summary:null,requiredStatement:null,metadata:it,rights:null,provider:it,items:it,seeAlso:it,homepage:it,rendering:it,service:it},X4={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:it,thumbnail:it,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:it,rights:null,navDate:null,provider:it,items:it,annotations:it,seeAlso:it,homepage:it,partOf:it,rendering:it,service:it,duration:0,height:0,width:0},Q4={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:it,thumbnail:it,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:it,rights:null,navDate:null,provider:it,items:it,annotations:it,seeAlso:it,homepage:it,partOf:it,rendering:it,service:it,services:it},Z4={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:it,behavior:it,homepage:it,items:it,label:null,metadata:it,navDate:null,provider:it,partOf:it,accompanyingCanvas:null,placeholderCanvas:null,rendering:it,requiredStatement:null,rights:null,seeAlso:it,service:it,services:it,start:null,structures:it,summary:null,thumbnail:it,viewingDirection:"left-to-right"},J4={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:it,thumbnail:it,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:it,rights:null,navDate:null,provider:it,items:it,annotations:it,seeAlso:it,homepage:it,partOf:it,rendering:it,service:it,start:null,supplementary:null,viewingDirection:"left-to-right"},eM={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:it,seeAlso:it,homepage:it},tM={id:"https://iiif-parser/empty-service",type:"UnknownService"};function of(n){let[e,t]=(n||"").split("#");return!t||!nM(t)?[n||"",""]:[e,t]}function nM(n){return n.includes("xywh=")||n.includes("t=")}function uf(n,e={}){if(Array.isArray(n))return uf(n[0]);if(typeof n=="string"){let[t,i]=of(n);return i?{type:"SpecificResource",source:{id:t,type:e.typeHint||"Unknown"},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{id:t,type:e.typeMap&&e.typeMap[t]||e.typeHint||"Unknown"}}}if(n.type==="Choice"||n.type==="List"||n.type==="Composite"||n.type==="Independents")return uf(n.items[0]);if(!n.type&&"source"in n&&(n.type="SpecificResource"),n.type==="SpecificResource"){n.source.type==="Canvas"&&n.source.partOf&&typeof n.source.partOf=="string"&&(n.source.partOf=[{id:n.source.partOf,type:"Manifest"}]);let t=typeof n.source=="string"?n.source:n.source.id,[,i]=of(t);if(i){let r=uf(t,e);r&&(n.selector=r.selector,n.source=r.source)}return n.selector?{...n,type:"SpecificResource",source:n.source,selector:n.selector}:{...n,type:"SpecificResource",source:n.source}}if(n.id){n.type==="Canvas"&&n.partOf&&typeof n.partOf=="string"&&(n.partOf=[{id:n.partOf,type:"Manifest"}]);let[t,i]=of(n.id);return i?{type:"SpecificResource",source:{...n,id:t},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{...n,id:t}}}return{type:"SpecificResource",source:n}}function iM(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function IC(n,e){if(typeof n=="string")return{id:n,type:e};if(!n.id)throw Error(`Invalid resource does not have an ID (${JSON.stringify(n)}, ${e})`);return n}function rM(n,e){return(t,i)=>{let r=n[t]?n[t]:{};return(s,a)=>{let o=IC(s,i||t);return o&&o.id&&t?(r[o.id]=r[o.id]?$g(r[o.id],o,{parent:a.parent,isTopLevel:e.id===o.id}):$g({id:o.id,type:o.type},o,{parent:a.parent,isTopLevel:e.id===o.id}),{id:o.id,type:t==="ContentResource"?t:o.type}):o}}}function qg(n,e,t){if(!e)return n;if(Array.isArray(n)){if(!Array.isArray(e))throw Error("Cannot merge array with non-array");let i=[...n];for(let r of e)if(r["@id"]&&!r.id&&(r.id=r["@id"]),r["@type"]&&!r.type&&(r.type=r["@type"]),r!=null)if(Array.isArray(r))i.push(r);else if(typeof r=="object"&&r.id&&r.type){let s=i.findIndex(a=>a.id===r.id&&a.type===r.type);s>=0&&(i[s]=qg(i[s],r))}else n.indexOf(r)===-1&&i.push(r);return i}else if(typeof n=="object"){if(Array.isArray(e)||typeof e!="object")throw Error("Cannot merge object with non-object");let i={...n},r=[],s=[],a=Object.keys(n).filter(u=>u!==gn&&u!=="id"&&u!=="type"),o={},l={};for(let[u,c]of Object.entries(e)){if(u===gn||u==="id"||u==="type")continue;let d=i[u];d===c?s.push(u):d===it||!d?(r.push(u),i[u]=c):(d&&c&&(o[u]=d,l[u]=c),i[u]=qg(d,c),i[u]===o[u]&&(s.push(u),delete o[u]))}if(t&&(t.parent&&t.parent.id||t.isTopLevel)){let u=[],c={};if(t.parent?c[Qr]=t.parent.id:t.isTopLevel&&(c[Qr]=n.id),i[gn]&&i[gn].length){let d=!(i[gn]||[]).find(p=>p["@explicit"]),h=r.length>0||s.length!==a.length;if(d&&h)for(let p of i[gn]){let g={...p},v=Object.keys(o);if(g){g["@explicit"]=!0;for(let y of a)y!==gn&&(g[y]=El);for(let y of v)g[y]=o[y]}u.push(g)}else u.push(...i[gn]);if(h){let p=Object.keys(l);c["@explicit"]=!0;for(let g of r)c[g]=El;for(let g of s)c[g]=El;for(let g of p)c[g]=l[g]}}c.id=i.id,c.type=i.type,u.push(c),i[gn]=u}return i}else if(n)return n;return e}function $g(n,e,t){if(typeof n=="string")return n;if(e.id!==n.id||e.type!==n.type){if(e.type==="ImageService3")return e;if(n.type==="ImageService3")return n;throw Error(`Can only merge entities with identical identifiers and type! ${e.type}(${e.id}) => ${n.type}(${n.id})`)}return qg({...n},e,t)}function sM(n){return(e,t)=>i=>{let{id:r,type:s}=IC(i,t||e);if(r===void 0)throw Error("Found invalid entity without an ID.");return e==="ContentResource"||e==="Service"?n[r]=e:n[r]=s,i}}function aM(n){let e=Object.assign({},n);if(e["@id"]&&(e.id=e["@id"]),e["@type"]&&(e.type=e["@type"]),e.service){let t=[];e.service=Array.isArray(e.service)?e.service:[e.service];for(let i of e.service)t.push({id:i["@id"]||i.id,type:i["@type"]||i.type});e.service=t}return Object.assign({},tM,e)}function oM(n){return e=>{n.Service=n.Service?n.Service:{};let t=e.id||e["@id"],i=aM(e);return i&&i.id&&(n.Service[i.id]?n.Service[t]=$g(n.Service[t],i):n.Service[t]=i),e}}function uM(n){let e=JSON.stringify(n),t=5381,i=e.length;for(;i;)t=t*33^e.charCodeAt(--i);let r=t>>>0,s=r.toString(16);return s.length%2?"0"+s:s}function M0(n){return e=>typeof e=="string"?{id:e,type:n}:e.id?e.type?e:{type:n,...e}:{id:`vault://${uM(e)}`,type:n,...e}}function Co(n){return e=>({...n,...e})}function il(n){return Array.isArray(n)?n:[n]}function lM(n){return n.body&&(n.body=il(n.body)),n.seeAlso&&(n.seeAlso=il(n.seeAlso)),n.audience&&(n.audience=il(n.audience)),n.accessibility&&(n.accessibility=il(n.accessibility)),n.motivation&&(n.motivation=il(n.motivation)),n}function RC(n,{typeHint:e,partOfTypeHint:t}={}){if(typeof n=="string"&&(n={id:n,type:e||"unknown"}),zs(n))return typeof n.source=="string"&&(n.source={id:n.source,type:e||"unknown"}),n.source.type==="Canvas"&&n.source.partOf&&typeof n.source.partOf=="string"&&(n.source.partOf=[{id:n.source.partOf,type:t||"Manifest"}]),n;let i,[r,s]=of(n.id);return n.id=r,s&&s&&(i={type:"FragmentSelector",value:s}),{type:"SpecificResource",source:n,selector:i}}function cM(n){let e=Object.assign({},n);return n&&n.items&&(e.items=n.items.map(t=>typeof t=="string"||t.type==="Canvas"?RC(t):t)),e}function dM(n){let e=Object.assign({},n);return e.start?(e.start=RC(e.start,{typeHint:"Canvas"}),e):n}function fM(n){let e=Object.assign({},n);return e.target?(e.target=uf(e.target,{typeHint:"Canvas"}),e):n}function hM(n){return n}function F0(n){return n.items===void 0&&(n[bl]=!0),n}function pM(n){let e=$4(n),t=iM(),i={},r=rM(t,e),s=sM(i),a=new $6({collection:[F0,Co(Q4),s("Collection"),r("Collection")],manifest:[F0,Co(Z4),dM,s("Manifest"),r("Manifest")],canvas:[Co(X4),s("Canvas"),r("Canvas")],annotationPage:[F0,M0("AnnotationPage"),Co(Y4),s("AnnotationPage"),r("AnnotationPage")],annotation:[M0("Annotation"),lM,fM,s("Annotation"),r("Annotation")],contentResource:[M0("ContentResource"),s("ContentResource"),r("ContentResource")],range:[Co(J4),cM,s("Range","Canvas"),r("Range","Canvas")],agent:[Co(eM),s("Agent"),r("Agent")],specificResource:[hM],service:[oM(t)]}),o=a.traverseUnknown(e);return{entities:t,resource:o,mapping:i}}function mM(n){let e={};for(let[t,i]of n){if(t===AC&&i!==Qi)return i;i!==Qi&&i!=null&&(e[t]=i)}return e}function gM(n,e,t){if(!e.type||!e.id)throw Error("Unknown entity");if(!t[e.type])throw Error(`Serializer not found for ${e.type}`);function i(r,s,a=0){let o=t[r.type];if(!o)return Qi;if(a>20)throw Error("Circular reference: "+r.id+" "+r.type);let[l,u]=CC(n,r.type?r:r.id,s)||(r.id&&r.type?r:null);if(!l)return Qi;let c=o(l,n,{parent:s,isTopLevel:e.id===r.id,fullResource:u}),d=c.next();for(;!d.done;){let h=d.value,p=Qi;if(h)if(Array.isArray(h)){let g=[];for(let v of h)g.push(i(v,r,a+1));p=g}else p=i(h,r,a+1);d=c.next(p)}return d.value===Qi?Qi:mM(d.value)}return i(e)}function Tl(n,{allowSourceString:e=!0,allowString:t=!1,allowedStringType:i}={}){let r=s=>{if(e&&s&&s.source&&typeof s.source!="string"){let a=Object.keys(s.source);if(s.source.id&&s.source.type&&a.length===2)return{...s,source:s.source.id}}return s};if(n){if(n.source&&n.source.partOf)return r(n);let s=Object.keys(n);if(s.length===2&&n.type&&n.source||s.length===3&&n.type&&n.source&&s.indexOf("selector")!==-1&&!n.selector)return t&&(!i||i===n.source.type)?n.source.id:n.source.type==="ContentResource"?{type:"SpecificResource",source:n.source.id}:n.source;if(n.selector&&!Array.isArray(n.selector)&&typeof n.selector!="string"&&n.selector.type==="FragmentSelector"){let a=`${n.source.id}#${n.selector.value}`;return t?a:{id:a,type:n.source.type}}}return r(n)}function Uo(n){if(!n)return;let e=Object.keys(n);if(e.length!==0){if(e.length===1){let t=e[0];if(!t)return"";let i=(n[t]||[]).join("");return t==="@none"||t==="none"||t==="en"?i:{"@language":t,"@value":i}}return e.map(t=>({"@language":t,"@value":(n[t]||[]).join("")}))}}function _C(n){return Array.isArray(n)?n.map(e=>_C(e)):typeof n=="string"?n:n.type&&n.type==="Canvas"?n.id:n}function js(n,e=!1){if(n)return n.length>1&&!e?n:n[0]||void 0}function vM(n){if(n){if(typeof n=="string")return{"@id":n};if("@id"in n){let e={...n};return delete e["@type"],e}return{"@context":"http://iiif.io/api/image/2/context.json","@id":n.id,profile:`http://iiif.io/api/image/2/profiles/${n.profile}.json`}}}function va(n,e){return[["@id",n.id],["@type",e],["format",n.format],["height",n.height],["width",n.width],["viewingDirection",n.viewingDirection==="left-to-right"?void 0:n.viewingDirection],["license",n.license?n.license:void 0]]}function*ya(n){let e=n.provider?yield n.provider[0]:void 0;return[["label",Uo(n.label)],["metadata",n.metadata&&n.metadata.length?n.metadata.map(t=>({label:Uo(t.label)||"",value:Uo(t.value)||""})):void 0],["description",Uo(n.summary)],["thumbnail",js(yield n.thumbnail)],["navDate",n.navDate],["logo",e?js(e.logo):void 0],["homepage",e?e.homepage:void 0],["attribution",n.requiredStatement?Uo(n.requiredStatement.value):void 0]]}function*rl(n){let e=n.start&&n.start.type&&n.start.type==="SpecificResource"?Tl(n.start):n.start;return[["seeAlso",js(yield n.seeAlso)],["service",js((n.service||[]).map(vM))],["rendering",js(yield n.rendering)],["startCanvas",e?e.id:void 0]]}function yM(n){return n.type==="SpecificResource"}function EM(n){return n&&n.type==="FragmentSelector"}function bM(n){if(n&&yM(n)){let e=n.id,t=n.selector?Array.isArray(n.selector)?n.selector[0]:n.selector:void 0;return EM(t)&&(e+="#"+t.value),e}return n==null?void 0:n.id}const TM={Manifest:function*(n,e,{isTopLevel:t}){return[...t?[["@context","http://iiif.io/api/presentation/2/context.json"]]:[],...va(n,"sc:Manifest"),...yield*ya(n),...yield*rl(n),["sequences",[{"@id":`${n.id}/sequence0`,"@type":"sc:Sequence",canvases:yield n.items}]],["structures",yield n.structures]]},Canvas:function*(n){let e=yield n.items,t=e[0];return[...va(n,"sc:Canvas"),...yield*ya(n),...yield*rl(n),["images",t?[t.resources]:void 0],["annotations",n.annotations&&n.annotations.length?js(yield n.annotations):void 0]]},AnnotationPage:function*(n){return[...va(n,"sc:AnnotationList"),...yield*ya(n),["resources",n.items&&n.items.length?js(yield n.items):void 0]]},Annotation:function*(n){return[["@id",n.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",_C(n.target)],["resource",js(yield n.body,!0)]]},ContentResource:function*(n){switch(n.type){case"Image":return[...va(n,"dctypes:Image"),...yield*ya(n),...yield*rl(n)];case"Text":case"Dataset":default:return[...va(n,void 0),...yield*ya(n)]}},AnnotationCollection:function*(n){return[["@id",n.id],["@type","sc:Layer"],["label",Uo(n.label)]]},Collection:function*(n){return[...va(n,"sc:Collection"),...yield*ya(n),...yield*rl(n),["members",yield*n.items]]},Range:function*(n){let e=[],t=[];if(n.items)for(let i of n.items){let r=i.type==="SpecificResource"?i.source:i;if(r){let s=yield r;e.push({"@id":bM(i),"@type":r.type,label:s?s.label:void 0,within:n.id}),r.type==="Canvas"&&t.push(r.id)}}return[...va(n,"sc:Range"),...yield*ya(n),...yield*rl(n),["canvases",t.length===e.length?t:void 0],["members",t.length===e.length?void 0:e]]}};function Ea(n){var e;return[["id",(e=n.id)!=null&&e.startsWith("vault://")?void 0:n.id],["type",n.type],["format",n.format],["profile",n.profile],["height",n.height||void 0],["width",n.width||void 0],["duration",n.duration||void 0],["viewingDirection",n.viewingDirection==="left-to-right"?void 0:n.viewingDirection],["behavior",n.behavior&&n.behavior.length?n.behavior:void 0],["timeMode",n.timeMode],["motivation",Array.isArray(n.motivation)?n.motivation[0]:n.motivation],[gn,Qi]]}function dn(n){if(n===Qi||!n||n.length===0)return;let e=n.filter(t=>t!==Qi);if(e.length!==0)return e}function LC(n){if(n&&n.type&&n.type==="ImageService2"){let{id:e,type:t,profile:i,...r}=n,s=typeof i=="string"?i:Array.isArray(i)?i.find(a=>typeof a=="string"):"";return{"@id":e,"@type":t,profile:s?s.startsWith("http")?s:`http://iiif.io/api/image/2/${s}.json`:"http://iiif.io/api/image/2/level0.json",...r}}return n}function rx(n){if(Array.isArray(n)||(n=n?[n]:[]),!(!n||n.length===0))return n.map(LC)}function*Rs(n){return[["label",n.label],["metadata",dn(n.metadata)],["summary",n.summary],["requiredStatement",n.requiredStatement],["rights",Array.isArray(n.rights)?n.rights[0]||void 0:n.rights||void 0],["navDate",n.navDate],["language",n.language],["thumbnail",dn(yield n.thumbnail)],["placeholderCanvas",yield n.placeholderCanvas],["accompanyingCanvas",yield n.accompanyingCanvas],["provider",dn(yield n.provider)]]}function*_s(n,e){let t=[];for(let i of n.partOf||[])i.type==="Manifest"&&e.type==="Manifest"||t.push(yield i);return[["seeAlso",dn(yield n.seeAlso)],["service",dn(rx(n.service))],["services",dn(rx(n.services))],["rendering",dn(yield n.rendering)],["supplementary",dn(yield n.supplementary)],["homepage",dn(yield n.homepage)],["logo",dn(yield n.logo)],["partOf",dn(t)],["start",n.start?Tl(n.start):n.start]]}const xM={Manifest:function*(n,e,{isTopLevel:t}){if(!t)return[...Ea(n),...yield*Rs(n),["navPlace",n.navPlace]];let i="http://iiif.io/api/presentation/3/context.json";return(n.navPlace||sx(n))&&(i=["http://iiif.io/api/presentation/3/context.json","http://iiif.io/api/extension/navplace/context.json"]),[["@context",n["@context"]?n["@context"]:i],...Ea(n),...yield*Rs(n),...yield*_s(n),["items",yield n.items],["structures",dn(yield n.structures)],["annotations",dn(yield n.annotations)],["navPlace",n.navPlace]]},Canvas:function*(n,e,{parent:t}){return t&&t.type!=="Manifest"&&t.type!=="Canvas"?[["id",n.id]]:[...Ea(n),...yield*Rs(n),...yield*_s(n,t),["items",yield n.items],["annotations",dn(yield n.annotations)],["navPlace",n.navPlace]]},Agent:function*(n){return[["id",n.id],["type","Agent"],["label",n.label],...yield*_s(n)]},AnnotationPage:function*(n){var i;let e=Object.entries(n).map(([r,s])=>[r,Array.isArray(s)?dn(s):s]).filter(([r,s])=>r!=="items"&&r!=="id"&&r!==gn&&r!==Qr&&r!==bl),t=yield n.items;return[["id",(i=n.id)!=null&&i.startsWith("vault://")?void 0:n.id],...e,...yield*_s(n),["items",t.length||n[bl]===!1?t:Qi]]},Service:function*(n){return[[AC,LC(n)]]},Annotation:function*(n){let e=Object.entries(n).map(([i,r])=>i==="motivation"?[i,Array.isArray(r)?r[0]:r]:i==="target"?[i,Tl(r,{allowString:!0,allowSourceString:!0,allowedStringType:"Canvas"})]:[i,Array.isArray(r)?dn(r):r]).filter(([i])=>i!=="body"&&i!==gn&&i!==bl),t;if(Array.isArray(n.body)){let i=[];for(let r of n.body)if(r&&zs(r)){let s={...r};r.source.type==="Canvas"?s.source=r.source:s.source=yield r.source,i.push(Tl(s,{allowSourceString:!0}))}else i.push(yield r);t=i}else n.body&&zs(n.body)?(t={...n.body},t.source=yield n.body.source):t=yield n.body;return[...e,...yield*Rs(n),...yield*_s(n),["body",t.length===1?t[0]:t]]},ContentResource:function*(n){return SM([...Ea(n),...yield*Rs(n),...yield*_s(n),["annotations",dn(yield n.annotations)],["items",dn(yield n.items)]],n)},AnnotationCollection:function*(n){return[["id",n.id],["type","AnnotationCollection"],["label",n.label]]},Collection:function*(n,e,{isTopLevel:t}){if(t){let i="http://iiif.io/api/presentation/3/context.json";return(n.navPlace||sx(n))&&(i=["http://iiif.io/api/extension/navplace/context.json","http://iiif.io/api/presentation/3/context.json"]),[["@context",i],...Ea(n),...yield*Rs(n),...yield*_s(n),["items",dn(yield n.items)],["navPlace",n.navPlace]]}return[...Ea(n),...yield*Rs(n),["navPlace",n.navPlace]]},Range:function*(n){let e=[];for(let t of n.items)t.type==="Range"?e.push(yield t):t&&t.type==="SpecificResource"?e.push(Tl(t)):e.push(t);return[...Ea(n),...yield*Rs(n),...yield*_s(n),["items",e],["annotations",dn(yield n.annotations)],["navPlace",n.navPlace]]}};function SM(n,e){let t=Object.keys(e),i=n.map(([r])=>r);for(let r of t)r===gn||r===bl||i.indexOf(r)===-1&&e[r]!==void 0&&n.push([r,e[r]]);return n}function sx(n){if(!n.items||!Array.isArray(n.items))return!1;for(let e of n.items)if(e.navPlace)return!0;return!1}let bd;const wM=new Uint8Array(16);function AM(){if(!bd&&(bd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!bd))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return bd(wM)}const In=[];for(let n=0;n<256;++n)In.push((n+256).toString(16).slice(1));function CM(n,e=0){return In[n[e+0]]+In[n[e+1]]+In[n[e+2]]+In[n[e+3]]+"-"+In[n[e+4]]+In[n[e+5]]+"-"+In[n[e+6]]+In[n[e+7]]+"-"+In[n[e+8]]+In[n[e+9]]+"-"+In[n[e+10]]+In[n[e+11]]+In[n[e+12]]+In[n[e+13]]+In[n[e+14]]+In[n[e+15]]}const IM=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ax={randomUUID:IM};function Ml(n,e,t){if(ax.randomUUID&&!n)return ax.randomUUID();n=n||{};const i=n.random||(n.rng||AM)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,CM(i)}const Td={},ly={get(n){return n},setMetaValue([n,e,t],i){let r=ly.getResourceMeta(n,e),s=r?r[t]:void 0,a=typeof i=="function"?i(s):i;Td[n]={...Td[n]||{},[e]:{...(Td[n]||{})[e]||{},[t]:a}}},getResourceMeta:((n,e)=>{let t=Td[n];if(t)return e?t[e]:t}),async load(n){let e=typeof n=="string"?n:n.id;return fetch(e).then(t=>t.json())},requestStatus(n){}};var RM=Object.create,PC=Object.defineProperty,_M=Object.getOwnPropertyDescriptor,LM=Object.getOwnPropertyNames,PM=Object.getPrototypeOf,kM=Object.prototype.hasOwnProperty,kC=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),DM=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(var r=LM(e),s=0,a=r.length,o;s<a;s++)o=r[s],!kM.call(n,o)&&o!==t&&PC(n,o,{get:(l=>e[l]).bind(null,o),enumerable:!(i=_M(e,o))||i.enumerable});return n},DC=(n,e,t)=>(t=n==null?{}:RM(PM(n)),DM(PC(t,"default",{value:n,enumerable:!0}),n)),OM=kC(((n,e)=>{e.exports=r;var t={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=/([astvzqmhlc])([^astvzqmhlc]*)/gi;function r(o){var l=[];return o.replace(i,function(u,c,d){var h=c.toLowerCase();for(d=a(d),h=="m"&&d.length>2&&(l.push([c].concat(d.splice(0,2))),h="l",c=c=="m"?"l":"L");;){if(d.length==t[h])return d.unshift(c),l.push(d);if(d.length<t[h])throw Error("malformed path data");l.push([c].concat(d.splice(0,t[h])))}}),l}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function a(o){var l=o.match(s);return l?l.map(Number):[]}})),NM=kC(((n,e)=>{e.exports=t;function t(i){var r=0,s=0,a=0,o=0;return i.map(function(l){l=l.slice();var u=l[0],c=u.toUpperCase();if(u!=c)switch(l[0]=c,u){case"a":l[6]+=a,l[7]+=o;break;case"v":l[1]+=o;break;case"h":l[1]+=a;break;default:for(var d=1;d<l.length;)l[d++]+=a,l[d++]+=o}switch(c){case"Z":a=r,o=s;break;case"H":a=l[1];break;case"V":o=l[1];break;case"M":a=r=l[1],o=s=l[2];break;default:a=l[l.length-2],o=l[l.length-1]}return l})}}));DC(OM());DC(NM());function MM(n){let[e,t]=n.split("#");return!t||!FM(t)?[n,""]:[e,t]}function FM(n){return n.includes("xywh=")||n.includes("t=")}function BM(n){let e=encodeURIComponent(n);return(typeof btoa>"u"?Buffer.from(e,"utf-8").toString("base64"):btoa(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function UM(n){let e=HM(n).replace(/-/g,"+").replace(/_/g,"/"),t=typeof atob>"u"?Buffer.from(e,"base64").toString("utf-8"):atob(e);return decodeURIComponent(t).trim()}function HM(n){let e=n.length%4;if(e===1)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return n+(e?"====".slice(0,4-e):"")}function OC(n,e){var i;let t=[];for(let r of e.items){if(r.type==="SpecificResource"&&((i=r.source)==null?void 0:i.type)==="Canvas"){let[s,a]=MM(r.source.id||"");a?t.push({id:s,type:"Canvas"}):t.push(r.source)}if(r.type==="Range"&&t.push(...OC(n,n.get(r))),r.type==="SpecificResource"){let s=typeof r.source=="string"?r.source:r.source.id;t.push({id:s,type:"Canvas"})}}return t}function zM(n=ly,e,t,i=!1){let r=e.behavior||[],s=t?n.get(t):null;if(!s)return[];let a=s.behavior||[],o=i?!1:r.includes("paged"),l=o?!1:r.includes("continuous"),u=o||l?!1:r.includes("individuals"),c=a.includes("facing-pages"),d=a.includes("non-paged");if(c||d||u||i)return[{id:s.id,type:"Canvas"}];let[h,p]=NC(n,e);if(l)return h;let g=h.findIndex(v=>v.id===t);if(g===-1)return[];for(let v of p)if(v.includes(g))return v.map(y=>h[y]);return[{id:s.id,type:"Canvas"}]}function NC(n=ly,e,{disablePaging:t,skipNonPaged:i}={}){let r=e.behavior||[],s=r.includes("paged"),a=s?!1:r.includes("continuous"),o=s||a?!1:r.includes("individuals"),l=e.type==="Manifest"?e.items:OC(n,e);if(a)return[l,[l.map((g,v)=>v)]];if(o||!s||t)return[l,l.map((g,v)=>[v])];let u=[],c=[],d=()=>{c.length&&(u.push([...c]),c=[])},h=0,p=!1;for(let g=0;g<l.length;g++){let v=n.get(l[g]).behavior||[];if(v.includes("non-paged")){g===h&&h++,i||(d(),u.push([g]),d());continue}if(g===h||v.includes("facing-pages")){c.length&&(p=!0),d(),u.push([g]),d();continue}if(c.push(g),p){d(),p=!1;continue}c.length>1&&d()}return c.length&&d(),[l,u]}function xt(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function Cr(n,e=[]){let t=[];function i(s,a){const o=U.createContext(a),l=t.length;t=[...t,a];const u=d=>{var b;const{scope:h,children:p,...g}=d,v=((b=h==null?void 0:h[n])==null?void 0:b[l])||o,y=U.useMemo(()=>g,Object.values(g));return be.jsx(v.Provider,{value:y,children:p})};u.displayName=s+"Provider";function c(d,h){var v;const p=((v=h==null?void 0:h[n])==null?void 0:v[l])||o,g=U.useContext(p);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[u,c]}const r=()=>{const s=t.map(a=>U.createContext(a));return function(o){const l=(o==null?void 0:o[n])||s;return U.useMemo(()=>({[`__scope${n}`]:{...o,[n]:l}}),[o,l])}};return r.scopeName=n,[i,jM(r,...e)]}function jM(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const i=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const a=i.reduce((o,{useScope:l,scopeName:u})=>{const d=l(s)[`__scope${u}`];return{...o,...d}},{});return U.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}var kn=globalThis!=null&&globalThis.document?U.useLayoutEffect:()=>{},VM=ay[" useInsertionEffect ".trim().toString()]||kn;function Gs({prop:n,defaultProp:e,onChange:t=()=>{},caller:i}){const[r,s,a]=GM({defaultProp:e,onChange:t}),o=n!==void 0,l=o?n:r;{const c=U.useRef(n!==void 0);U.useEffect(()=>{const d=c.current;d!==o&&console.warn(`${i} is changing from ${d?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),c.current=o},[o,i])}const u=U.useCallback(c=>{var d;if(o){const h=WM(c)?c(n):c;h!==n&&((d=a.current)==null||d.call(a,h))}else s(c)},[o,n,s,a]);return[l,u]}function GM({defaultProp:n,onChange:e}){const[t,i]=U.useState(n),r=U.useRef(t),s=U.useRef(e);return VM(()=>{s.current=e},[e]),U.useEffect(()=>{var a;r.current!==t&&((a=s.current)==null||a.call(s,t),r.current=t)},[t,r]),[t,i,s]}function WM(n){return typeof n=="function"}function ox(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function MC(...n){return e=>{let t=!1;const i=n.map(r=>{const s=ox(r,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let r=0;r<i.length;r++){const s=i[r];typeof s=="function"?s():ox(n[r],null)}}}}function Ht(...n){return U.useCallback(MC(...n),n)}var Xl=eC();const qM=Yl(Xl);function Dn(n){const e=$M(n),t=U.forwardRef((i,r)=>{const{children:s,...a}=i,o=U.Children.toArray(s),l=o.find(YM);if(l){const u=l.props.children,c=o.map(d=>d===l?U.Children.count(u)>1?U.Children.only(null):U.isValidElement(u)?u.props.children:null:d);return be.jsx(e,{...a,ref:r,children:U.isValidElement(u)?U.cloneElement(u,void 0,c):null})}return be.jsx(e,{...a,ref:r,children:s})});return t.displayName=`${n}.Slot`,t}function $M(n){const e=U.forwardRef((t,i)=>{const{children:r,...s}=t;if(U.isValidElement(r)){const a=QM(r),o=XM(s,r.props);return r.type!==U.Fragment&&(o.ref=i?MC(i,a):a),U.cloneElement(r,o)}return U.Children.count(r)>1?U.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var KM=Symbol("radix.slottable");function YM(n){return U.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===KM}function XM(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{const l=s(...o);return r(...o),l}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}function QM(n){var i,r;let e=(i=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(r=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var ZM=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],cy=ZM.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function JM(n,e){return U.useReducer((t,i)=>e[t][i]??t,n)}var Ql=n=>{const{present:e,children:t}=n,i=e8(e),r=typeof t=="function"?t({present:i.isPresent}):U.Children.only(t),s=Ht(i.ref,t8(r));return typeof t=="function"||i.isPresent?U.cloneElement(r,{ref:s}):null};Ql.displayName="Presence";function e8(n){const[e,t]=U.useState(),i=U.useRef(null),r=U.useRef(n),s=U.useRef("none"),a=n?"mounted":"unmounted",[o,l]=JM(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return U.useEffect(()=>{const u=xd(i.current);s.current=o==="mounted"?u:"none"},[o]),kn(()=>{const u=i.current,c=r.current;if(c!==n){const h=s.current,p=xd(u);n?l("MOUNT"):p==="none"||(u==null?void 0:u.display)==="none"?l("UNMOUNT"):l(c&&h!==p?"ANIMATION_OUT":"UNMOUNT"),r.current=n}},[n,l]),kn(()=>{if(e){let u;const c=e.ownerDocument.defaultView??window,d=p=>{const v=xd(i.current).includes(CSS.escape(p.animationName));if(p.target===e&&v&&(l("ANIMATION_END"),!r.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",u=c.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},h=p=>{p.target===e&&(s.current=xd(i.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{c.clearTimeout(u),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:U.useCallback(u=>{i.current=u?getComputedStyle(u):null,t(u)},[])}}function xd(n){return(n==null?void 0:n.animationName)||"none"}function t8(n){var i,r;let e=(i=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(r=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var n8=ay[" useId ".trim().toString()]||(()=>{}),i8=0;function qa(n){const[e,t]=U.useState(n8());return kn(()=>{t(i=>i??String(i8++))},[n]),n||(e?`radix-${e}`:"")}var nh="Collapsible",[r8]=Cr(nh),[s8,dy]=r8(nh),FC=U.forwardRef((n,e)=>{const{__scopeCollapsible:t,open:i,defaultOpen:r,disabled:s,onOpenChange:a,...o}=n,[l,u]=Gs({prop:i,defaultProp:r??!1,onChange:a,caller:nh});return be.jsx(s8,{scope:t,disabled:s,contentId:qa(),open:l,onOpenToggle:U.useCallback(()=>u(c=>!c),[u]),children:be.jsx(cy.div,{"data-state":hy(l),"data-disabled":s?"":void 0,...o,ref:e})})});FC.displayName=nh;var BC="CollapsibleTrigger",a8=U.forwardRef((n,e)=>{const{__scopeCollapsible:t,...i}=n,r=dy(BC,t);return be.jsx(cy.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":hy(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...i,ref:e,onClick:xt(n.onClick,r.onOpenToggle)})});a8.displayName=BC;var fy="CollapsibleContent",o8=U.forwardRef((n,e)=>{const{forceMount:t,...i}=n,r=dy(fy,n.__scopeCollapsible);return be.jsx(Ql,{present:t||r.open,children:({present:s})=>be.jsx(u8,{...i,ref:e,present:s})})});o8.displayName=fy;var u8=U.forwardRef((n,e)=>{const{__scopeCollapsible:t,present:i,children:r,...s}=n,a=dy(fy,t),[o,l]=U.useState(i),u=U.useRef(null),c=Ht(e,u),d=U.useRef(0),h=d.current,p=U.useRef(0),g=p.current,v=a.open||o,y=U.useRef(v),b=U.useRef(void 0);return U.useEffect(()=>{const T=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(T)},[]),kn(()=>{const T=u.current;if(T){b.current=b.current||{transitionDuration:T.style.transitionDuration,animationName:T.style.animationName},T.style.transitionDuration="0s",T.style.animationName="none";const x=T.getBoundingClientRect();d.current=x.height,p.current=x.width,y.current||(T.style.transitionDuration=b.current.transitionDuration,T.style.animationName=b.current.animationName),l(i)}},[a.open,i]),be.jsx(cy.div,{"data-state":hy(a.open),"data-disabled":a.disabled?"":void 0,id:a.contentId,hidden:!v,...s,ref:c,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":g?`${g}px`:void 0,...n.style},children:v&&r})});function hy(n){return n?"open":"closed"}var l8=FC;const c8=U.createContext(null),B0={didCatch:!1,error:null};class py extends U.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=B0}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,i,r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];(t=(i=this.props).onReset)===null||t===void 0||t.call(i,{args:s,reason:"imperative-api"}),this.setState(B0)}}componentDidCatch(e,t){var i,r;(i=(r=this.props).onError)===null||i===void 0||i.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&t.error!==null&&d8(e.resetKeys,r)){var s,a;(s=(a=this.props).onReset)===null||s===void 0||s.call(a,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(B0)}}render(){const{children:e,fallbackRender:t,FallbackComponent:i,fallback:r}=this.props,{didCatch:s,error:a}=this.state;let o=e;if(s){const l={error:a,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")o=t(l);else if(i)o=U.createElement(i,l);else if(r!==void 0)o=r;else throw a}return U.createElement(c8.Provider,{value:{didCatch:s,error:a,resetErrorBoundary:this.resetErrorBoundary}},o)}}function d8(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==e.length||n.some((t,i)=>!Object.is(t,e[i]))}var Ot="colors",Gn="sizes",Je="space",f8={gap:Je,gridGap:Je,columnGap:Je,gridColumnGap:Je,rowGap:Je,gridRowGap:Je,inset:Je,insetBlock:Je,insetBlockEnd:Je,insetBlockStart:Je,insetInline:Je,insetInlineEnd:Je,insetInlineStart:Je,margin:Je,marginTop:Je,marginRight:Je,marginBottom:Je,marginLeft:Je,marginBlock:Je,marginBlockEnd:Je,marginBlockStart:Je,marginInline:Je,marginInlineEnd:Je,marginInlineStart:Je,padding:Je,paddingTop:Je,paddingRight:Je,paddingBottom:Je,paddingLeft:Je,paddingBlock:Je,paddingBlockEnd:Je,paddingBlockStart:Je,paddingInline:Je,paddingInlineEnd:Je,paddingInlineStart:Je,top:Je,right:Je,bottom:Je,left:Je,scrollMargin:Je,scrollMarginTop:Je,scrollMarginRight:Je,scrollMarginBottom:Je,scrollMarginLeft:Je,scrollMarginX:Je,scrollMarginY:Je,scrollMarginBlock:Je,scrollMarginBlockEnd:Je,scrollMarginBlockStart:Je,scrollMarginInline:Je,scrollMarginInlineEnd:Je,scrollMarginInlineStart:Je,scrollPadding:Je,scrollPaddingTop:Je,scrollPaddingRight:Je,scrollPaddingBottom:Je,scrollPaddingLeft:Je,scrollPaddingX:Je,scrollPaddingY:Je,scrollPaddingBlock:Je,scrollPaddingBlockEnd:Je,scrollPaddingBlockStart:Je,scrollPaddingInline:Je,scrollPaddingInlineEnd:Je,scrollPaddingInlineStart:Je,fontSize:"fontSizes",background:Ot,backgroundColor:Ot,backgroundImage:Ot,borderImage:Ot,border:Ot,borderBlock:Ot,borderBlockEnd:Ot,borderBlockStart:Ot,borderBottom:Ot,borderBottomColor:Ot,borderColor:Ot,borderInline:Ot,borderInlineEnd:Ot,borderInlineStart:Ot,borderLeft:Ot,borderLeftColor:Ot,borderRight:Ot,borderRightColor:Ot,borderTop:Ot,borderTopColor:Ot,caretColor:Ot,color:Ot,columnRuleColor:Ot,fill:Ot,outline:Ot,outlineColor:Ot,stroke:Ot,textDecorationColor:Ot,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Gn,minBlockSize:Gn,maxBlockSize:Gn,inlineSize:Gn,minInlineSize:Gn,maxInlineSize:Gn,width:Gn,minWidth:Gn,maxWidth:Gn,height:Gn,minHeight:Gn,maxHeight:Gn,flexBasis:Gn,gridTemplateColumns:Gn,gridTemplateRows:Gn,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},h8=(n,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,uu=()=>{const n=Object.create(null);return(e,t,...i)=>{const r=(s=>JSON.stringify(s,h8))(e);return r in n?n[r]:n[r]=t(e,...i)}},Na=Symbol.for("sxs.internal"),my=(n,e)=>Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)),ux=n=>{for(const e in n)return!0;return!1},{hasOwnProperty:p8}=Object.prototype,Kg=n=>n.includes("-")?n:n.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),m8=/\s+(?![^()]*\))/,Io=n=>e=>n(...typeof e=="string"?String(e).split(m8):[e]),lx={appearance:n=>({WebkitAppearance:n,appearance:n}),backfaceVisibility:n=>({WebkitBackfaceVisibility:n,backfaceVisibility:n}),backdropFilter:n=>({WebkitBackdropFilter:n,backdropFilter:n}),backgroundClip:n=>({WebkitBackgroundClip:n,backgroundClip:n}),boxDecorationBreak:n=>({WebkitBoxDecorationBreak:n,boxDecorationBreak:n}),clipPath:n=>({WebkitClipPath:n,clipPath:n}),content:n=>({content:n.includes('"')||n.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(n)?n:`"${n}"`}),hyphens:n=>({WebkitHyphens:n,hyphens:n}),maskImage:n=>({WebkitMaskImage:n,maskImage:n}),maskSize:n=>({WebkitMaskSize:n,maskSize:n}),tabSize:n=>({MozTabSize:n,tabSize:n}),textSizeAdjust:n=>({WebkitTextSizeAdjust:n,textSizeAdjust:n}),userSelect:n=>({WebkitUserSelect:n,userSelect:n}),marginBlock:Io(((n,e)=>({marginBlockStart:n,marginBlockEnd:e||n}))),marginInline:Io(((n,e)=>({marginInlineStart:n,marginInlineEnd:e||n}))),maxSize:Io(((n,e)=>({maxBlockSize:n,maxInlineSize:e||n}))),minSize:Io(((n,e)=>({minBlockSize:n,minInlineSize:e||n}))),paddingBlock:Io(((n,e)=>({paddingBlockStart:n,paddingBlockEnd:e||n}))),paddingInline:Io(((n,e)=>({paddingInlineStart:n,paddingInlineEnd:e||n})))},U0=/([\d.]+)([^]*)/,g8=(n,e)=>n.length?n.reduce(((t,i)=>(t.push(...e.map((r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(r)?`:is(${i})`:i):i+" "+r))),t)),[]):e,v8=(n,e)=>n in y8&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,i,r,s)=>i+(r==="stretch"?`-moz-available${s};${Kg(n)}:${i}-webkit-fill-available`:`-moz-fit-content${s};${Kg(n)}:${i}fit-content`)+s)):String(e),y8={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Zr=n=>n?n+"-":"",UC=(n,e,t)=>n.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((i,r,s,a,o)=>a=="$"==!!s?i:(r||a=="--"?"calc(":"")+"var(--"+(a==="$"?Zr(e)+(o.includes("$")?"":Zr(t))+o.replace(/\$/g,"-"):o)+")"+(r||a=="--"?"*"+(r||"")+(s||"1")+")":""))),E8=/\s*,\s*(?![^()]*\))/,b8=Object.prototype.toString,jo=(n,e,t,i,r)=>{let s,a,o;const l=(u,c,d)=>{let h,p;const g=v=>{for(h in v){const T=h.charCodeAt(0)===64,x=T&&Array.isArray(v[h])?v[h]:[v[h]];for(p of x){const w=/[A-Z]/.test(b=h)?b:b.replace(/-[^]/g,(R=>R[1].toUpperCase())),A=typeof p=="object"&&p&&p.toString===b8&&(!i.utils[w]||!c.length);if(w in i.utils&&!A){const R=i.utils[w];if(R!==a){a=R,g(R(p)),a=null;continue}}else if(w in lx){const R=lx[w];if(R!==o){o=R,g(R(p)),o=null;continue}}if(T&&(y=h.slice(1)in i.media?"@media "+i.media[h.slice(1)]:h,h=y.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((R,_,D,H,P,N)=>{const G=U0.test(_),X=.0625*(G?-1:1),[te,Q]=G?[H,_]:[_,H];return"("+(D[0]==="="?"":D[0]===">"===G?"max-":"min-")+te+":"+(D[0]!=="="&&D.length===1?Q.replace(U0,((ne,oe,Z)=>Number(oe)+X*(D===">"?1:-1)+Z)):Q)+(P?") and ("+(P[0]===">"?"min-":"max-")+te+":"+(P.length===1?N.replace(U0,((ne,oe,Z)=>Number(oe)+X*(P===">"?-1:1)+Z)):N):"")+")"}))),A){const R=T?d.concat(h):[...d],_=T?[...c]:g8(c,h.split(E8));s!==void 0&&r(cx(...s)),s=void 0,l(p,_,R)}else s===void 0&&(s=[[],c,d]),h=T||h.charCodeAt(0)!==36?h:`--${Zr(i.prefix)}${h.slice(1).replace(/\$/g,"-")}`,p=A?p:typeof p=="number"?p&&w in T8?String(p)+"px":String(p):UC(v8(w,p??""),i.prefix,i.themeMap[w]),s[0].push(`${T?`${h} `:`${Kg(h)}:`}${p}`)}}var y,b};g(u),s!==void 0&&r(cx(...s)),s=void 0};l(n,e,t)},cx=(n,e,t)=>`${t.map((i=>`${i}{`)).join("")}${e.length?`${e.join(",")}{`:""}${n.join(";")}${e.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,T8={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},dx=n=>String.fromCharCode(n+(n>25?39:97)),Ma=n=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=dx(t%52)+i;return dx(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(n))>>>0),hl=["themed","global","styled","onevar","resonevar","allvar","inline"],x8=n=>{if(n.href&&!n.href.startsWith(location.origin))return!1;try{return!!n.cssRules}catch{return!1}},S8=n=>{let e;const t=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,((s,a)=>{const{cssText:o}=s;let l="";if(o.startsWith("--sxs"))return"";if(r[a-1]&&(l=r[a-1].cssText).startsWith("--sxs")){if(!s.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===s)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${o}`;return s.cssRules.length?`${l}${o}`:""}return o})).join("")},i=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in o)delete o[u]}const r=Object(n).styleSheets||[];for(const o of r)if(x8(o)){for(let l=0,u=o.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:h}=c;if(!h.startsWith("--sxs"))continue;const p=h.slice(14,-3).trim().split(/\s+/),g=hl[p[0]];g&&(e||(e={sheet:o,reset:i,rules:{},toString:t}),e.rules[g]={group:d,index:l,cache:new Set(p)})}if(e)break}if(!e){const o=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,o(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,(c=>c.cssText)).join("")}}`:l}});e={sheet:n?(n.head||n).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:i,toString:t}}const{sheet:s,rules:a}=e;for(let o=hl.length-1;o>=0;--o){const l=hl[o];if(!a[l]){const u=hl[o+1],c=a[u]?a[u].index:s.cssRules.length;s.insertRule("@media{}",c),s.insertRule(`--sxs{--sxs:${o}}`,c),a[l]={group:s.cssRules[c+1],index:c,cache:new Set([o])}}w8(a[l])}};return i(),e},w8=n=>{const e=n.group;let t=e.cssRules.length;n.apply=i=>{try{e.insertRule(i,t),++t}catch{}}},sl=Symbol(),A8=uu(),fx=(n,e)=>A8(n,(()=>(...t)=>{let i={type:null,composers:new Set};for(const r of t)if(r!=null)if(r[Na]){i.type==null&&(i.type=r[Na].type);for(const s of r[Na].composers)i.composers.add(s)}else r.constructor!==Object||r.$$typeof?i.type==null&&(i.type=r):i.composers.add(C8(r,n));return i.type==null&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),I8(n,i,e)})),C8=({variants:n,compoundVariants:e,defaultVariants:t,...i},r)=>{const s=`${Zr(r.prefix)}c-${Ma(i)}`,a=[],o=[],l=Object.create(null),u=[];for(const h in t)l[h]=String(t[h]);if(typeof n=="object"&&n)for(const h in n){c=l,d=h,p8.call(c,d)||(l[h]="undefined");const p=n[h];for(const g in p){const v={[h]:String(g)};String(g)==="undefined"&&u.push(h);const y=p[g],b=[v,y,!ux(y)];a.push(b)}}var c,d;if(typeof e=="object"&&e)for(const h of e){let{css:p,...g}=h;p=typeof p=="object"&&p||{};for(const y in g)g[y]=String(g[y]);const v=[g,p,!ux(p)];o.push(v)}return[s,i,a,o,l,u]},I8=(n,e,t)=>{const[i,r,s,a]=R8(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(d=>{function h(){for(let p=0;p<h[sl].length;p++){const[g,v]=h[sl][p];d.rules[g].apply(v)}return h[sl]=[],null}return h[sl]=[],h.rules={},hl.forEach((p=>h.rules[p]={apply:g=>h[sl].push([p,g])})),h})(t):null,l=(o||t).rules,u=`.${i}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||_8;const{css:h,...p}=d,g={};for(const b in s)if(delete p[b],b in d){let T=d[b];typeof T=="object"&&T?g[b]={"@initial":s[b],...T}:(T=String(T),g[b]=T!=="undefined"||a.has(b)?T:s[b])}else g[b]=s[b];const v=new Set([...r]);for(const[b,T,x,w]of e.composers){t.rules.styled.cache.has(b)||(t.rules.styled.cache.add(b),jo(T,[`.${b}`],[],n,(_=>{l.styled.apply(_)})));const A=hx(x,g,n.media),R=hx(w,g,n.media,!0);for(const _ of A)if(_!==void 0)for(const[D,H,P]of _){const N=`${b}-${Ma(H)}-${D}`;v.add(N);const G=(P?t.rules.resonevar:t.rules.onevar).cache,X=P?l.resonevar:l.onevar;G.has(N)||(G.add(N),jo(H,[`.${N}`],[],n,(te=>{X.apply(te)})))}for(const _ of R)if(_!==void 0)for(const[D,H]of _){const P=`${b}-${Ma(H)}-${D}`;v.add(P),t.rules.allvar.cache.has(P)||(t.rules.allvar.cache.add(P),jo(H,[`.${P}`],[],n,(N=>{l.allvar.apply(N)})))}}if(typeof h=="object"&&h){const b=`${i}-i${Ma(h)}-css`;v.add(b),t.rules.inline.cache.has(b)||(t.rules.inline.cache.add(b),jo(h,[`.${b}`],[],n,(T=>{l.inline.apply(T)})))}for(const b of String(d.className||"").trim().split(/\s+/))b&&v.add(b);const y=p.className=[...v].join(" ");return{type:e.type,className:y,selector:u,props:p,toString:()=>y,deferredInjector:o}};return my(c,{className:i,selector:u,[Na]:e,toString:()=>(t.rules.styled.cache.has(i)||c(),i)})},R8=n=>{let e="";const t=[],i={},r=[];for(const[s,,,,a,o]of n){e===""&&(e=s),t.push(s),r.push(...o);for(const l in a){const u=a[l];(i[l]===void 0||u!=="undefined"||o.includes(u))&&(i[l]=u)}}return[e,t,i,new Set(r)]},hx=(n,e,t,i)=>{const r=[];e:for(let[s,a,o]of n){if(o)continue;let l,u=0,c=!1;for(l in s){const d=s[l];let h=e[l];if(h!==d){if(typeof h!="object"||!h)continue e;{let p,g,v=0;for(const y in h){if(d===String(h[y])){if(y!=="@initial"){const b=y.slice(1);(g=g||[]).push(b in t?t[b]:y.replace(/^@media ?/,"")),c=!0}u+=v,p=!0}++v}if(g&&g.length&&(a={["@media "+g.join(", ")]:a}),!p)continue e}}}(r[u]=r[u]||[]).push([i?"cv":`${l}-${s[l]}`,a,c])}return r},_8={},L8=uu(),P8=(n,e)=>L8(n,(()=>(...t)=>{const i=()=>{for(let r of t){r=typeof r=="object"&&r||{};let s=Ma(r);if(!e.rules.global.cache.has(s)){if(e.rules.global.cache.add(s),"@import"in r){let a=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(r["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,a++);delete r["@import"]}jo(r,[],[],n,(a=>{e.rules.global.apply(a)}))}}return""};return my(i,{toString:i})})),k8=uu(),D8=(n,e)=>k8(n,(()=>t=>{const i=`${Zr(n.prefix)}k-${Ma(t)}`,r=()=>{if(!e.rules.global.cache.has(i)){e.rules.global.cache.add(i);const s=[];jo(t,[],[],n,(o=>s.push(o)));const a=`@keyframes ${i}{${s.join("")}}`;e.rules.global.apply(a)}return i};return my(r,{get name(){return r()},toString:r})})),O8=class{constructor(n,e,t,i){this.token=n==null?"":String(n),this.value=e==null?"":String(e),this.scale=t==null?"":String(t),this.prefix=i==null?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Zr(this.prefix)+Zr(this.scale)+this.token}toString(){return this.computedValue}},N8=uu(),M8=(n,e)=>N8(n,(()=>(t,i)=>{i=typeof t=="object"&&t||Object(i);const r=`.${t=(t=typeof t=="string"?t:"")||`${Zr(n.prefix)}t-${Ma(i)}`}`,s={},a=[];for(const l in i){s[l]={};for(const u in i[l]){const c=`--${Zr(n.prefix)}${l}-${u}`,d=UC(String(i[l][u]),n.prefix,l);s[l][u]=new O8(u,d,l,n.prefix),a.push(`${c}:${d}`)}}const o=()=>{if(a.length&&!e.rules.themed.cache.has(t)){e.rules.themed.cache.add(t);const l=`${i===n.theme?":root,":""}.${t}{${a.join(";")}}`;e.rules.themed.apply(l)}return t};return{...s,get className(){return o()},selector:r,toString:o}})),F8=uu(),px,B8=uu(),HC=n=>{const e=(t=>{let i=!1;const r=F8(t,(s=>{i=!0;const a="prefix"in(s=typeof s=="object"&&s||{})?String(s.prefix):"",o=typeof s.media=="object"&&s.media||{},l=typeof s.root=="object"?s.root||null:globalThis.document||null,u=typeof s.theme=="object"&&s.theme||{},c={prefix:a,media:o,theme:u,themeMap:typeof s.themeMap=="object"&&s.themeMap||{...f8},utils:typeof s.utils=="object"&&s.utils||{}},d=S8(l),h={css:fx(c,d),globalCss:P8(c,d),keyframes:D8(c,d),createTheme:M8(c,d),reset(){d.reset(),h.theme.toString()},theme:{},sheet:d,config:c,prefix:a,getCssText:d.toString,toString:d.toString};return String(h.theme=h.createTheme(u)),h}));return i||r.reset(),r})(n);return e.styled=(({config:t,sheet:i})=>B8(t,(()=>{const r=fx(t,i);return(...s)=>{const a=r(...s),o=a[Na].type,l=B.forwardRef(((u,c)=>{const d=u&&u.as||o,{props:h,deferredInjector:p}=a(u);return delete h.as,h.ref=c,p?B.createElement(B.Fragment,null,B.createElement(d,h),B.createElement(p,null)):B.createElement(d,h)}));return l.className=a.className,l.displayName=`Styled.${o.displayName||o.name||o}`,l.selector=a.selector,l.toString=()=>a.selector,l[Na]=a[Na],l}})))(e),e},U8=()=>px||(px=HC()),H8=(...n)=>U8().createTheme(...n);function zC(n){const e=n+"CollectionProvider",[t,i]=Cr(e),[r,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),a=v=>{const{scope:y,children:b}=v,T=B.useRef(null),x=B.useRef(new Map).current;return be.jsx(r,{scope:y,itemMap:x,collectionRef:T,children:b})};a.displayName=e;const o=n+"CollectionSlot",l=Dn(o),u=B.forwardRef((v,y)=>{const{scope:b,children:T}=v,x=s(o,b),w=Ht(y,x.collectionRef);return be.jsx(l,{ref:w,children:T})});u.displayName=o;const c=n+"CollectionItemSlot",d="data-radix-collection-item",h=Dn(c),p=B.forwardRef((v,y)=>{const{scope:b,children:T,...x}=v,w=B.useRef(null),A=Ht(y,w),R=s(c,b);return B.useEffect(()=>(R.itemMap.set(w,{ref:w,...x}),()=>void R.itemMap.delete(w))),be.jsx(h,{[d]:"",ref:A,children:T})});p.displayName=c;function g(v){const y=s(n+"CollectionConsumer",v);return B.useCallback(()=>{const T=y.collectionRef.current;if(!T)return[];const x=Array.from(T.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((R,_)=>x.indexOf(R.ref.current)-x.indexOf(_.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:a,Slot:u,ItemSlot:p},g,i]}var z8=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],jC=z8.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function Ws(n){const e=U.useRef(n);return U.useEffect(()=>{e.current=n}),U.useMemo(()=>(...t)=>{var i;return(i=e.current)==null?void 0:i.call(e,...t)},[])}var j8=U.createContext(void 0);function ih(n){const e=U.useContext(j8);return n||e||"ltr"}var H0="rovingFocusGroup.onEntryFocus",V8={bubbles:!1,cancelable:!0},Zl="RovingFocusGroup",[Yg,VC,G8]=zC(Zl),[W8,rh]=Cr(Zl,[G8]),[q8,$8]=W8(Zl),GC=U.forwardRef((n,e)=>be.jsx(Yg.Provider,{scope:n.__scopeRovingFocusGroup,children:be.jsx(Yg.Slot,{scope:n.__scopeRovingFocusGroup,children:be.jsx(K8,{...n,ref:e})})}));GC.displayName=Zl;var K8=U.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:i,loop:r=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:l,onEntryFocus:u,preventScrollOnEntryFocus:c=!1,...d}=n,h=U.useRef(null),p=Ht(e,h),g=ih(s),[v,y]=Gs({prop:a,defaultProp:o??null,onChange:l,caller:Zl}),[b,T]=U.useState(!1),x=Ws(u),w=VC(t),A=U.useRef(!1),[R,_]=U.useState(0);return U.useEffect(()=>{const D=h.current;if(D)return D.addEventListener(H0,x),()=>D.removeEventListener(H0,x)},[x]),be.jsx(q8,{scope:t,orientation:i,dir:g,loop:r,currentTabStopId:v,onItemFocus:U.useCallback(D=>y(D),[y]),onItemShiftTab:U.useCallback(()=>T(!0),[]),onFocusableItemAdd:U.useCallback(()=>_(D=>D+1),[]),onFocusableItemRemove:U.useCallback(()=>_(D=>D-1),[]),children:be.jsx(jC.div,{tabIndex:b||R===0?-1:0,"data-orientation":i,...d,ref:p,style:{outline:"none",...n.style},onMouseDown:xt(n.onMouseDown,()=>{A.current=!0}),onFocus:xt(n.onFocus,D=>{const H=!A.current;if(D.target===D.currentTarget&&H&&!b){const P=new CustomEvent(H0,V8);if(D.currentTarget.dispatchEvent(P),!P.defaultPrevented){const N=w().filter(ne=>ne.focusable),G=N.find(ne=>ne.active),X=N.find(ne=>ne.id===v),Q=[G,X,...N].filter(Boolean).map(ne=>ne.ref.current);$C(Q,c)}}A.current=!1}),onBlur:xt(n.onBlur,()=>T(!1))})})}),WC="RovingFocusGroupItem",qC=U.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:i=!0,active:r=!1,tabStopId:s,children:a,...o}=n,l=qa(),u=s||l,c=$8(WC,t),d=c.currentTabStopId===u,h=VC(t),{onFocusableItemAdd:p,onFocusableItemRemove:g,currentTabStopId:v}=c;return U.useEffect(()=>{if(i)return p(),()=>g()},[i,p,g]),be.jsx(Yg.ItemSlot,{scope:t,id:u,focusable:i,active:r,children:be.jsx(jC.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...o,ref:e,onMouseDown:xt(n.onMouseDown,y=>{i?c.onItemFocus(u):y.preventDefault()}),onFocus:xt(n.onFocus,()=>c.onItemFocus(u)),onKeyDown:xt(n.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){c.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const b=Q8(y,c.orientation,c.dir);if(b!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let x=h().filter(w=>w.focusable).map(w=>w.ref.current);if(b==="last")x.reverse();else if(b==="prev"||b==="next"){b==="prev"&&x.reverse();const w=x.indexOf(y.currentTarget);x=c.loop?Z8(x,w+1):x.slice(w+1)}setTimeout(()=>$C(x))}}),children:typeof a=="function"?a({isCurrentTabStop:d,hasTabStop:v!=null}):a})})});qC.displayName=WC;var Y8={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function X8(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function Q8(n,e,t){const i=X8(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return Y8[i]}function $C(n,e=!1){const t=document.activeElement;for(const i of n)if(i===t||(i.focus({preventScroll:e}),document.activeElement!==t))return}function Z8(n,e){return n.map((t,i)=>n[(e+i)%n.length])}var KC=GC,YC=qC,J8=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],sh=J8.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),ah="Tabs",[eF]=Cr(ah,[rh]),XC=rh(),[tF,gy]=eF(ah),QC=U.forwardRef((n,e)=>{const{__scopeTabs:t,value:i,onValueChange:r,defaultValue:s,orientation:a="horizontal",dir:o,activationMode:l="automatic",...u}=n,c=ih(o),[d,h]=Gs({prop:i,onChange:r,defaultProp:s??"",caller:ah});return be.jsx(tF,{scope:t,baseId:qa(),value:d,onValueChange:h,orientation:a,dir:c,activationMode:l,children:be.jsx(sh.div,{dir:c,"data-orientation":a,...u,ref:e})})});QC.displayName=ah;var ZC="TabsList",JC=U.forwardRef((n,e)=>{const{__scopeTabs:t,loop:i=!0,...r}=n,s=gy(ZC,t),a=XC(t);return be.jsx(KC,{asChild:!0,...a,orientation:s.orientation,dir:s.dir,loop:i,children:be.jsx(sh.div,{role:"tablist","aria-orientation":s.orientation,...r,ref:e})})});JC.displayName=ZC;var eI="TabsTrigger",tI=U.forwardRef((n,e)=>{const{__scopeTabs:t,value:i,disabled:r=!1,...s}=n,a=gy(eI,t),o=XC(t),l=rI(a.baseId,i),u=sI(a.baseId,i),c=i===a.value;return be.jsx(YC,{asChild:!0,...o,focusable:!r,active:c,children:be.jsx(sh.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":u,"data-state":c?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:l,...s,ref:e,onMouseDown:xt(n.onMouseDown,d=>{!r&&d.button===0&&d.ctrlKey===!1?a.onValueChange(i):d.preventDefault()}),onKeyDown:xt(n.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&a.onValueChange(i)}),onFocus:xt(n.onFocus,()=>{const d=a.activationMode!=="manual";!c&&!r&&d&&a.onValueChange(i)})})})});tI.displayName=eI;var nI="TabsContent",iI=U.forwardRef((n,e)=>{const{__scopeTabs:t,value:i,forceMount:r,children:s,...a}=n,o=gy(nI,t),l=rI(o.baseId,i),u=sI(o.baseId,i),c=i===o.value,d=U.useRef(c);return U.useEffect(()=>{const h=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(h)},[]),be.jsx(Ql,{present:r||c,children:({present:h})=>be.jsx(sh.div,{"data-state":c?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":l,hidden:!h,id:u,tabIndex:0,...a,ref:e,style:{...n.style,animationDuration:d.current?"0s":void 0},children:h&&s})})});iI.displayName=nI;function rI(n,e){return`${n}-trigger-${e}`}function sI(n,e){return`${n}-content-${e}`}var nF=QC,iF=JC,rF=tI,sF=iI;const aI=-1,oh=0,xl=1,Lf=2,vy=3,yy=4,Ey=5,by=6,oI=7,uI=8,mx=typeof self=="object"?self:globalThis,aF=(n,e)=>{const t=(r,s)=>(n.set(s,r),r),i=r=>{if(n.has(r))return n.get(r);const[s,a]=e[r];switch(s){case oh:case aI:return t(a,r);case xl:{const o=t([],r);for(const l of a)o.push(i(l));return o}case Lf:{const o=t({},r);for(const[l,u]of a)o[i(l)]=i(u);return o}case vy:return t(new Date(a),r);case yy:{const{source:o,flags:l}=a;return t(new RegExp(o,l),r)}case Ey:{const o=t(new Map,r);for(const[l,u]of a)o.set(i(l),i(u));return o}case by:{const o=t(new Set,r);for(const l of a)o.add(i(l));return o}case oI:{const{name:o,message:l}=a;return t(new mx[o](l),r)}case uI:return t(BigInt(a),r);case"BigInt":return t(Object(BigInt(a)),r);case"ArrayBuffer":return t(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return t(new DataView(o),a)}}return t(new mx[s](a),r)};return i},gx=n=>aF(new Map,n)(0),Ro="",{toString:oF}={},{keys:uF}=Object,al=n=>{const e=typeof n;if(e!=="object"||!n)return[oh,e];const t=oF.call(n).slice(8,-1);switch(t){case"Array":return[xl,Ro];case"Object":return[Lf,Ro];case"Date":return[vy,Ro];case"RegExp":return[yy,Ro];case"Map":return[Ey,Ro];case"Set":return[by,Ro];case"DataView":return[xl,t]}return t.includes("Array")?[xl,t]:t.includes("Error")?[oI,t]:[Lf,t]},Sd=([n,e])=>n===oh&&(e==="function"||e==="symbol"),lF=(n,e,t,i)=>{const r=(a,o)=>{const l=i.push(a)-1;return t.set(o,l),l},s=a=>{if(t.has(a))return t.get(a);let[o,l]=al(a);switch(o){case oh:{let c=a;switch(l){case"bigint":o=uI,c=a.toString();break;case"function":case"symbol":if(n)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return r([aI],a)}return r([o,c],a)}case xl:{if(l){let h=a;return l==="DataView"?h=new Uint8Array(a.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(a)),r([l,[...h]],a)}const c=[],d=r([o,c],a);for(const h of a)c.push(s(h));return d}case Lf:{if(l)switch(l){case"BigInt":return r([l,a.toString()],a);case"Boolean":case"Number":case"String":return r([l,a.valueOf()],a)}if(e&&"toJSON"in a)return s(a.toJSON());const c=[],d=r([o,c],a);for(const h of uF(a))(n||!Sd(al(a[h])))&&c.push([s(h),s(a[h])]);return d}case vy:return r([o,a.toISOString()],a);case yy:{const{source:c,flags:d}=a;return r([o,{source:c,flags:d}],a)}case Ey:{const c=[],d=r([o,c],a);for(const[h,p]of a)(n||!(Sd(al(h))||Sd(al(p))))&&c.push([s(h),s(p)]);return d}case by:{const c=[],d=r([o,c],a);for(const h of a)(n||!Sd(al(h)))&&c.push(s(h));return d}}const{message:u}=a;return r([o,{name:l,message:u}],a)};return s},vx=(n,{json:e,lossy:t}={})=>{const i=[];return lF(!(e||t),!!e,new Map,i)(n),i},tu=typeof structuredClone=="function"?(n,e)=>e&&("json"in e||"lossy"in e)?gx(vx(n,e)):structuredClone(n):(n,e)=>gx(vx(n,e));let Jl=class{constructor(e,t,i){this.normal=t,this.property=e,i&&(this.space=i)}};Jl.prototype.normal={};Jl.prototype.property={};Jl.prototype.space=void 0;function lI(n,e){const t={},i={};for(const r of n)Object.assign(t,r.property),Object.assign(i,r.normal);return new Jl(t,i,e)}function Fl(n){return n.toLowerCase()}let ai=class{constructor(e,t){this.attribute=t,this.property=e}};ai.prototype.attribute="";ai.prototype.booleanish=!1;ai.prototype.boolean=!1;ai.prototype.commaOrSpaceSeparated=!1;ai.prototype.commaSeparated=!1;ai.prototype.defined=!1;ai.prototype.mustUseProperty=!1;ai.prototype.number=!1;ai.prototype.overloadedBoolean=!1;ai.prototype.property="";ai.prototype.spaceSeparated=!1;ai.prototype.space=void 0;let cF=0;const bt=$a(),ln=$a(),Xg=$a(),He=$a(),jt=$a(),Wo=$a(),fi=$a();function $a(){return 2**++cF}const Qg=Object.freeze(Object.defineProperty({__proto__:null,boolean:bt,booleanish:ln,commaOrSpaceSeparated:fi,commaSeparated:Wo,number:He,overloadedBoolean:Xg,spaceSeparated:jt},Symbol.toStringTag,{value:"Module"})),z0=Object.keys(Qg);let Ty=class extends ai{constructor(e,t,i,r){let s=-1;if(super(e,t),yx(this,"space",r),typeof i=="number")for(;++s<z0.length;){const a=z0[s];yx(this,z0[s],(i&Qg[a])===Qg[a])}}};Ty.prototype.defined=!0;function yx(n,e,t){t&&(n[e]=t)}function lu(n){const e={},t={};for(const[i,r]of Object.entries(n.properties)){const s=new Ty(i,n.transform(n.attributes||{},i),r,n.space);n.mustUseProperty&&n.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,t[Fl(i)]=i,t[Fl(s.attribute)]=i}return new Jl(e,t,n.space)}const cI=lu({properties:{ariaActiveDescendant:null,ariaAtomic:ln,ariaAutoComplete:null,ariaBusy:ln,ariaChecked:ln,ariaColCount:He,ariaColIndex:He,ariaColSpan:He,ariaControls:jt,ariaCurrent:null,ariaDescribedBy:jt,ariaDetails:null,ariaDisabled:ln,ariaDropEffect:jt,ariaErrorMessage:null,ariaExpanded:ln,ariaFlowTo:jt,ariaGrabbed:ln,ariaHasPopup:null,ariaHidden:ln,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:jt,ariaLevel:He,ariaLive:null,ariaModal:ln,ariaMultiLine:ln,ariaMultiSelectable:ln,ariaOrientation:null,ariaOwns:jt,ariaPlaceholder:null,ariaPosInSet:He,ariaPressed:ln,ariaReadOnly:ln,ariaRelevant:null,ariaRequired:ln,ariaRoleDescription:jt,ariaRowCount:He,ariaRowIndex:He,ariaRowSpan:He,ariaSelected:ln,ariaSetSize:He,ariaSort:null,ariaValueMax:He,ariaValueMin:He,ariaValueNow:He,ariaValueText:null,role:null},transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function dI(n,e){return e in n?n[e]:e}function fI(n,e){return dI(n,e.toLowerCase())}const dF=lu({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Wo,acceptCharset:jt,accessKey:jt,action:null,allow:null,allowFullScreen:bt,allowPaymentRequest:bt,allowUserMedia:bt,alt:null,as:null,async:bt,autoCapitalize:null,autoComplete:jt,autoFocus:bt,autoPlay:bt,blocking:jt,capture:null,charSet:null,checked:bt,cite:null,className:jt,cols:He,colSpan:null,content:null,contentEditable:ln,controls:bt,controlsList:jt,coords:He|Wo,crossOrigin:null,data:null,dateTime:null,decoding:null,default:bt,defer:bt,dir:null,dirName:null,disabled:bt,download:Xg,draggable:ln,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:bt,formTarget:null,headers:jt,height:He,hidden:Xg,high:He,href:null,hrefLang:null,htmlFor:jt,httpEquiv:jt,id:null,imageSizes:null,imageSrcSet:null,inert:bt,inputMode:null,integrity:null,is:null,isMap:bt,itemId:null,itemProp:jt,itemRef:jt,itemScope:bt,itemType:jt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:bt,low:He,manifest:null,max:null,maxLength:He,media:null,method:null,min:null,minLength:He,multiple:bt,muted:bt,name:null,nonce:null,noModule:bt,noValidate:bt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:bt,optimum:He,pattern:null,ping:jt,placeholder:null,playsInline:bt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:bt,referrerPolicy:null,rel:jt,required:bt,reversed:bt,rows:He,rowSpan:He,sandbox:jt,scope:null,scoped:bt,seamless:bt,selected:bt,shadowRootClonable:bt,shadowRootDelegatesFocus:bt,shadowRootMode:null,shape:null,size:He,sizes:null,slot:null,span:He,spellCheck:ln,src:null,srcDoc:null,srcLang:null,srcSet:null,start:He,step:null,style:null,tabIndex:He,target:null,title:null,translate:null,type:null,typeMustMatch:bt,useMap:null,value:ln,width:He,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:jt,axis:null,background:null,bgColor:null,border:He,borderColor:null,bottomMargin:He,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:bt,declare:bt,event:null,face:null,frame:null,frameBorder:null,hSpace:He,leftMargin:He,link:null,longDesc:null,lowSrc:null,marginHeight:He,marginWidth:He,noResize:bt,noHref:bt,noShade:bt,noWrap:bt,object:null,profile:null,prompt:null,rev:null,rightMargin:He,rules:null,scheme:null,scrolling:ln,standby:null,summary:null,text:null,topMargin:He,valueType:null,version:null,vAlign:null,vLink:null,vSpace:He,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:bt,disableRemotePlayback:bt,prefix:null,property:null,results:He,security:null,unselectable:null},space:"html",transform:fI}),fF=lu({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:fi,accentHeight:He,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:He,amplitude:He,arabicForm:null,ascent:He,attributeName:null,attributeType:null,azimuth:He,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:He,by:null,calcMode:null,capHeight:He,className:jt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:He,diffuseConstant:He,direction:null,display:null,dur:null,divisor:He,dominantBaseline:null,download:bt,dx:null,dy:null,edgeMode:null,editable:null,elevation:He,enableBackground:null,end:null,event:null,exponent:He,externalResourcesRequired:null,fill:null,fillOpacity:He,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Wo,g2:Wo,glyphName:Wo,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:He,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:He,horizOriginX:He,horizOriginY:He,id:null,ideographic:He,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:He,k:He,k1:He,k2:He,k3:He,k4:He,kernelMatrix:fi,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:He,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:He,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:He,overlineThickness:He,paintOrder:null,panose1:null,path:null,pathLength:He,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:jt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:He,pointsAtY:He,pointsAtZ:He,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:fi,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:fi,rev:fi,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:fi,requiredFeatures:fi,requiredFonts:fi,requiredFormats:fi,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:He,specularExponent:He,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:He,strikethroughThickness:He,string:null,stroke:null,strokeDashArray:fi,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:He,strokeOpacity:He,strokeWidth:null,style:null,surfaceScale:He,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:fi,tabIndex:He,tableValues:null,target:null,targetX:He,targetY:He,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:fi,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:He,underlineThickness:He,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:He,values:null,vAlphabetic:He,vMathematical:He,vectorEffect:null,vHanging:He,vIdeographic:He,version:null,vertAdvY:He,vertOriginX:He,vertOriginY:He,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:He,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:dI}),hI=lu({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()}}),pI=lu({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:fI}),mI=lu({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()}}),hF=/[A-Z]/g,Ex=/-[a-z]/g,pF=/^data[-\w.:]+$/i;function xy(n,e){const t=Fl(e);let i=e,r=ai;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&pF.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(Ex,gF);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!Ex.test(s)){let a=s.replace(hF,mF);a.charAt(0)!=="-"&&(a="-"+a),e="data"+a}}r=Ty}return new r(i,e)}function mF(n){return"-"+n.toLowerCase()}function gF(n){return n.charAt(1).toUpperCase()}const uh=lI([cI,dF,hI,pI,mI],"html"),ec=lI([cI,fF,hI,pI,mI],"svg");function bx(n){const e=[],t=String(n||"");let i=t.indexOf(","),r=0,s=!1;for(;!s;){i===-1&&(i=t.length,s=!0);const a=t.slice(r,i).trim();(a||!s)&&e.push(a),r=i+1,i=t.indexOf(",",r)}return e}function gI(n,e){const t=e||{};return(n[n.length-1]===""?[...n,""]:n).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const Tx=/[#.]/g;function vF(n,e){const t=n||"",i={};let r=0,s,a;for(;r<t.length;){Tx.lastIndex=r;const o=Tx.exec(t),l=t.slice(r,o?o.index:t.length);l&&(s?s==="#"?i.id=l:Array.isArray(i.className)?i.className.push(l):i.className=[l]:a=l,r+=l.length),o&&(s=o[0],r++)}return{type:"element",tagName:a||e||"div",properties:i,children:[]}}function xx(n){const e=String(n||"").trim();return e?e.split(/[ \t\n\r\f]+/g):[]}function vI(n){return n.join(" ").trim()}function yI(n,e,t){const i=t?TF(t):void 0;function r(s,a,...o){let l;if(s==null){l={type:"root",children:[]};const u=a;o.unshift(u)}else{l=vF(s,e);const u=l.tagName.toLowerCase(),c=i?i.get(u):void 0;if(l.tagName=c||u,yF(a))o.unshift(a);else for(const[d,h]of Object.entries(a))EF(n,l.properties,d,h)}for(const u of o)Zg(l.children,u);return l.type==="element"&&l.tagName==="template"&&(l.content={type:"root",children:l.children},l.children=[]),l}return r}function yF(n){if(n===null||typeof n!="object"||Array.isArray(n))return!0;if(typeof n.type!="string")return!1;const e=n,t=Object.keys(n);for(const i of t){const r=e[i];if(r&&typeof r=="object"){if(!Array.isArray(r))return!0;const s=r;for(const a of s)if(typeof a!="number"&&typeof a!="string")return!0}}return!!("children"in n&&Array.isArray(n.children))}function EF(n,e,t,i){const r=xy(n,t);let s;if(i!=null){if(typeof i=="number"){if(Number.isNaN(i))return;s=i}else typeof i=="boolean"?s=i:typeof i=="string"?r.spaceSeparated?s=xx(i):r.commaSeparated?s=bx(i):r.commaOrSpaceSeparated?s=xx(bx(i).join(" ")):s=Sx(r,r.property,i):Array.isArray(i)?s=[...i]:s=r.property==="style"?bF(i):String(i);if(Array.isArray(s)){const a=[];for(const o of s)a.push(Sx(r,r.property,o));s=a}r.property==="className"&&Array.isArray(e.className)&&(s=e.className.concat(s)),e[r.property]=s}}function Zg(n,e){if(e!=null)if(typeof e=="number"||typeof e=="string")n.push({type:"text",value:String(e)});else if(Array.isArray(e))for(const t of e)Zg(n,t);else if(typeof e=="object"&&"type"in e)e.type==="root"?Zg(n,e.children):n.push(e);else throw new Error("Expected node, nodes, or string, got `"+e+"`")}function Sx(n,e,t){if(typeof t=="string"){if(n.number&&t&&!Number.isNaN(Number(t)))return Number(t);if((n.boolean||n.overloadedBoolean)&&(t===""||Fl(t)===Fl(e)))return!0}return t}function bF(n){const e=[];for(const[t,i]of Object.entries(n))e.push([t,i].join(": "));return e.join("; ")}function TF(n){const e=new Map;for(const t of n)e.set(t.toLowerCase(),t);return e}const xF=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],SF=yI(uh,"div"),wF=yI(ec,"g",xF);function AF(n){const e=String(n),t=[];return{toOffset:r,toPoint:i};function i(s){if(typeof s=="number"&&s>-1&&s<=e.length){let a=0;for(;;){let o=t[a];if(o===void 0){const l=wx(e,t[a-1]);o=l===-1?e.length+1:l+1,t[a]=o}if(o>s)return{line:a+1,column:s-(a>0?t[a-1]:0)+1,offset:s};a++}}}function r(s){if(s&&typeof s.line=="number"&&typeof s.column=="number"&&!Number.isNaN(s.line)&&!Number.isNaN(s.column)){for(;t.length<s.line;){const o=t[t.length-1],l=wx(e,o),u=l===-1?e.length+1:l+1;if(o===u)break;t.push(u)}const a=(s.line>1?t[s.line-2]:0)+s.column-1;if(a<t[s.line-1])return a}}}function wx(n,e){const t=n.indexOf("\r",e),i=n.indexOf(`
`,e);return i===-1?t:t===-1||t+1===i?i:t<i?t:i}const ka={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},EI={}.hasOwnProperty,CF=Object.prototype;function IF(n,e){const t=e||{};return Sy({file:t.file||void 0,location:!1,schema:t.space==="svg"?ec:uh,verbose:t.verbose||!1},n)}function Sy(n,e){let t;switch(e.nodeName){case"#comment":{const i=e;return t={type:"comment",value:i.data},lf(n,i,t),t}case"#document":case"#document-fragment":{const i=e,r="mode"in i?i.mode==="quirks"||i.mode==="limited-quirks":!1;if(t={type:"root",children:bI(n,e.childNodes),data:{quirksMode:r}},n.file&&n.location){const s=String(n.file),a=AF(s),o=a.toPoint(0),l=a.toPoint(s.length);t.position={start:o,end:l}}return t}case"#documentType":{const i=e;return t={type:"doctype"},lf(n,i,t),t}case"#text":{const i=e;return t={type:"text",value:i.value},lf(n,i,t),t}default:return t=RF(n,e),t}}function bI(n,e){let t=-1;const i=[];for(;++t<e.length;){const r=Sy(n,e[t]);i.push(r)}return i}function RF(n,e){const t=n.schema;n.schema=e.namespaceURI===ka.svg?ec:uh;let i=-1;const r={};for(;++i<e.attrs.length;){const o=e.attrs[i],l=(o.prefix?o.prefix+":":"")+o.name;EI.call(CF,l)||(r[l]=o.value)}const a=(n.schema.space==="svg"?wF:SF)(e.tagName,r,bI(n,e.childNodes));if(lf(n,e,a),a.tagName==="template"){const o=e,l=o.sourceCodeLocation,u=l&&l.startTag&&Vo(l.startTag),c=l&&l.endTag&&Vo(l.endTag),d=Sy(n,o.content);u&&c&&n.file&&(d.position={start:u.end,end:c.start}),a.content=d}return n.schema=t,a}function lf(n,e,t){if("sourceCodeLocation"in e&&e.sourceCodeLocation&&n.file){const i=_F(n,t,e.sourceCodeLocation);i&&(n.location=!0,t.position=i)}}function _F(n,e,t){const i=Vo(t);if(e.type==="element"){const r=e.children[e.children.length-1];if(i&&!t.endTag&&r&&r.position&&r.position.end&&(i.end=Object.assign({},r.position.end)),n.verbose){const s={};let a;if(t.attrs)for(a in t.attrs)EI.call(t.attrs,a)&&(s[xy(n.schema,a).property]=Vo(t.attrs[a]));t.startTag;const o=Vo(t.startTag),l=t.endTag?Vo(t.endTag):void 0,u={opening:o};l&&(u.closing=l),u.properties=s,e.data={position:u}}}return i}function Vo(n){const e=Ax({line:n.startLine,column:n.startCol,offset:n.startOffset}),t=Ax({line:n.endLine,column:n.endCol,offset:n.endOffset});return e||t?{start:e,end:t}:void 0}function Ax(n){return n.line&&n.column?n:void 0}class tc{constructor(e,t,i){this.property=e,this.normal=t,i&&(this.space=i)}}tc.prototype.property={};tc.prototype.normal={};tc.prototype.space=null;function TI(n,e){const t={},i={};let r=-1;for(;++r<n.length;)Object.assign(t,n[r].property),Object.assign(i,n[r].normal);return new tc(t,i,e)}function Jg(n){return n.toLowerCase()}class Ni{constructor(e,t){this.property=e,this.attribute=t}}Ni.prototype.space=null;Ni.prototype.boolean=!1;Ni.prototype.booleanish=!1;Ni.prototype.overloadedBoolean=!1;Ni.prototype.number=!1;Ni.prototype.commaSeparated=!1;Ni.prototype.spaceSeparated=!1;Ni.prototype.commaOrSpaceSeparated=!1;Ni.prototype.mustUseProperty=!1;Ni.prototype.defined=!1;let LF=0;const yt=Ka(),cn=Ka(),xI=Ka(),ze=Ka(),Vt=Ka(),qo=Ka(),hi=Ka();function Ka(){return 2**++LF}const ev=Object.freeze(Object.defineProperty({__proto__:null,boolean:yt,booleanish:cn,commaOrSpaceSeparated:hi,commaSeparated:qo,number:ze,overloadedBoolean:xI,spaceSeparated:Vt},Symbol.toStringTag,{value:"Module"})),j0=Object.keys(ev);class wy extends Ni{constructor(e,t,i,r){let s=-1;if(super(e,t),Cx(this,"space",r),typeof i=="number")for(;++s<j0.length;){const a=j0[s];Cx(this,j0[s],(i&ev[a])===ev[a])}}}wy.prototype.defined=!0;function Cx(n,e,t){t&&(n[e]=t)}const PF={}.hasOwnProperty;function cu(n){const e={},t={};let i;for(i in n.properties)if(PF.call(n.properties,i)){const r=n.properties[i],s=new wy(i,n.transform(n.attributes||{},i),r,n.space);n.mustUseProperty&&n.mustUseProperty.includes(i)&&(s.mustUseProperty=!0),e[i]=s,t[Jg(i)]=i,t[Jg(s.attribute)]=i}return new tc(e,t,n.space)}const SI=cu({space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),wI=cu({space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function AI(n,e){return e in n?n[e]:e}function CI(n,e){return AI(n,e.toLowerCase())}const II=cu({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:CI,properties:{xmlns:null,xmlnsXLink:null}}),RI=cu({transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:cn,ariaAutoComplete:null,ariaBusy:cn,ariaChecked:cn,ariaColCount:ze,ariaColIndex:ze,ariaColSpan:ze,ariaControls:Vt,ariaCurrent:null,ariaDescribedBy:Vt,ariaDetails:null,ariaDisabled:cn,ariaDropEffect:Vt,ariaErrorMessage:null,ariaExpanded:cn,ariaFlowTo:Vt,ariaGrabbed:cn,ariaHasPopup:null,ariaHidden:cn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Vt,ariaLevel:ze,ariaLive:null,ariaModal:cn,ariaMultiLine:cn,ariaMultiSelectable:cn,ariaOrientation:null,ariaOwns:Vt,ariaPlaceholder:null,ariaPosInSet:ze,ariaPressed:cn,ariaReadOnly:cn,ariaRelevant:null,ariaRequired:cn,ariaRoleDescription:Vt,ariaRowCount:ze,ariaRowIndex:ze,ariaRowSpan:ze,ariaSelected:cn,ariaSetSize:ze,ariaSort:null,ariaValueMax:ze,ariaValueMin:ze,ariaValueNow:ze,ariaValueText:null,role:null}}),kF=cu({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:CI,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:qo,acceptCharset:Vt,accessKey:Vt,action:null,allow:null,allowFullScreen:yt,allowPaymentRequest:yt,allowUserMedia:yt,alt:null,as:null,async:yt,autoCapitalize:null,autoComplete:Vt,autoFocus:yt,autoPlay:yt,blocking:Vt,capture:null,charSet:null,checked:yt,cite:null,className:Vt,cols:ze,colSpan:null,content:null,contentEditable:cn,controls:yt,controlsList:Vt,coords:ze|qo,crossOrigin:null,data:null,dateTime:null,decoding:null,default:yt,defer:yt,dir:null,dirName:null,disabled:yt,download:xI,draggable:cn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:yt,formTarget:null,headers:Vt,height:ze,hidden:yt,high:ze,href:null,hrefLang:null,htmlFor:Vt,httpEquiv:Vt,id:null,imageSizes:null,imageSrcSet:null,inert:yt,inputMode:null,integrity:null,is:null,isMap:yt,itemId:null,itemProp:Vt,itemRef:Vt,itemScope:yt,itemType:Vt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:yt,low:ze,manifest:null,max:null,maxLength:ze,media:null,method:null,min:null,minLength:ze,multiple:yt,muted:yt,name:null,nonce:null,noModule:yt,noValidate:yt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:yt,optimum:ze,pattern:null,ping:Vt,placeholder:null,playsInline:yt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:yt,referrerPolicy:null,rel:Vt,required:yt,reversed:yt,rows:ze,rowSpan:ze,sandbox:Vt,scope:null,scoped:yt,seamless:yt,selected:yt,shadowRootClonable:yt,shadowRootDelegatesFocus:yt,shadowRootMode:null,shape:null,size:ze,sizes:null,slot:null,span:ze,spellCheck:cn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ze,step:null,style:null,tabIndex:ze,target:null,title:null,translate:null,type:null,typeMustMatch:yt,useMap:null,value:cn,width:ze,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Vt,axis:null,background:null,bgColor:null,border:ze,borderColor:null,bottomMargin:ze,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:yt,declare:yt,event:null,face:null,frame:null,frameBorder:null,hSpace:ze,leftMargin:ze,link:null,longDesc:null,lowSrc:null,marginHeight:ze,marginWidth:ze,noResize:yt,noHref:yt,noShade:yt,noWrap:yt,object:null,profile:null,prompt:null,rev:null,rightMargin:ze,rules:null,scheme:null,scrolling:cn,standby:null,summary:null,text:null,topMargin:ze,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ze,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:yt,disableRemotePlayback:yt,prefix:null,property:null,results:ze,security:null,unselectable:null}}),DF=cu({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:AI,properties:{about:hi,accentHeight:ze,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ze,amplitude:ze,arabicForm:null,ascent:ze,attributeName:null,attributeType:null,azimuth:ze,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ze,by:null,calcMode:null,capHeight:ze,className:Vt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ze,diffuseConstant:ze,direction:null,display:null,dur:null,divisor:ze,dominantBaseline:null,download:yt,dx:null,dy:null,edgeMode:null,editable:null,elevation:ze,enableBackground:null,end:null,event:null,exponent:ze,externalResourcesRequired:null,fill:null,fillOpacity:ze,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:qo,g2:qo,glyphName:qo,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ze,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ze,horizOriginX:ze,horizOriginY:ze,id:null,ideographic:ze,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ze,k:ze,k1:ze,k2:ze,k3:ze,k4:ze,kernelMatrix:hi,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ze,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ze,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ze,overlineThickness:ze,paintOrder:null,panose1:null,path:null,pathLength:ze,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Vt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ze,pointsAtY:ze,pointsAtZ:ze,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:hi,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:hi,rev:hi,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:hi,requiredFeatures:hi,requiredFonts:hi,requiredFormats:hi,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ze,specularExponent:ze,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ze,strikethroughThickness:ze,string:null,stroke:null,strokeDashArray:hi,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ze,strokeOpacity:ze,strokeWidth:null,style:null,surfaceScale:ze,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:hi,tabIndex:ze,tableValues:null,target:null,targetX:ze,targetY:ze,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:hi,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ze,underlineThickness:ze,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ze,values:null,vAlphabetic:ze,vMathematical:ze,vectorEffect:null,vHanging:ze,vIdeographic:ze,version:null,vertAdvY:ze,vertOriginX:ze,vertOriginY:ze,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ze,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),OF=/^data[-\w.:]+$/i,Ix=/-[a-z]/g,NF=/[A-Z]/g;function MF(n,e){const t=Jg(e);let i=e,r=Ni;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&OF.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(Ix,BF);i="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!Ix.test(s)){let a=s.replace(NF,FF);a.charAt(0)!=="-"&&(a="-"+a),e="data"+a}}r=wy}return new r(i,e)}function FF(n){return"-"+n.toLowerCase()}function BF(n){return n.charAt(1).toUpperCase()}const UF=TI([wI,SI,II,RI,kF],"html"),_I=TI([wI,SI,II,RI,DF],"svg"),Rx={}.hasOwnProperty;function Ay(n,e){const t=e||{};function i(r,...s){let a=i.invalid;const o=i.handlers;if(r&&Rx.call(r,n)){const l=String(r[n]);a=Rx.call(o,l)?o[l]:i.unknown}if(a)return a.call(this,r,...s)}return i.handlers=t.handlers||{},i.invalid=t.invalid,i.unknown=t.unknown,i}const HF={},zF={}.hasOwnProperty,LI=Ay("type",{handlers:{root:VF,element:KF,text:qF,comment:$F,doctype:WF}});function jF(n,e){const i=(e||HF).space;return LI(n,i==="svg"?_I:UF)}function VF(n,e){const t={nodeName:"#document",mode:(n.data||{}).quirksMode?"quirks":"no-quirks",childNodes:[]};return t.childNodes=Cy(n.children,t,e),du(n,t),t}function GF(n,e){const t={nodeName:"#document-fragment",childNodes:[]};return t.childNodes=Cy(n.children,t,e),du(n,t),t}function WF(n){const e={nodeName:"#documentType",name:"html",publicId:"",systemId:"",parentNode:null};return du(n,e),e}function qF(n){const e={nodeName:"#text",value:n.value,parentNode:null};return du(n,e),e}function $F(n){const e={nodeName:"#comment",data:n.value,parentNode:null};return du(n,e),e}function KF(n,e){const t=e;let i=t;n.type==="element"&&n.tagName.toLowerCase()==="svg"&&t.space==="html"&&(i=_I);const r=[];let s;if(n.properties){for(s in n.properties)if(s!=="children"&&zF.call(n.properties,s)){const l=YF(i,s,n.properties[s]);l&&r.push(l)}}const a=i.space,o={nodeName:n.tagName,tagName:n.tagName,attrs:r,namespaceURI:ka[a],childNodes:[],parentNode:null};return o.childNodes=Cy(n.children,o,i),du(n,o),n.tagName==="template"&&n.content&&(o.content=GF(n.content,i)),o}function YF(n,e,t){const i=MF(n,e);if(t===!1||t===null||t===void 0||typeof t=="number"&&Number.isNaN(t)||!t&&i.boolean)return;Array.isArray(t)&&(t=i.commaSeparated?gI(t):vI(t));const r={name:i.attribute,value:t===!0?"":String(t)};if(i.space&&i.space!=="html"&&i.space!=="svg"){const s=r.name.indexOf(":");s<0?r.prefix="":(r.name=r.name.slice(s+1),r.prefix=i.attribute.slice(0,s)),r.namespace=ka[i.space]}return r}function Cy(n,e,t){let i=-1;const r=[];if(n)for(;++i<n.length;){const s=LI(n[i],t);s.parentNode=e,r.push(s)}return r}function du(n,e){const t=n.position;t&&t.start&&t.end&&(t.start.offset,t.end.offset,e.sourceCodeLocation={startLine:t.start.line,startCol:t.start.column,startOffset:t.start.offset,endLine:t.end.line,endCol:t.end.column,endOffset:t.end.offset})}const PI=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],XF=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),Kt="";var K;(function(n){n[n.EOF=-1]="EOF",n[n.NULL=0]="NULL",n[n.TABULATION=9]="TABULATION",n[n.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",n[n.LINE_FEED=10]="LINE_FEED",n[n.FORM_FEED=12]="FORM_FEED",n[n.SPACE=32]="SPACE",n[n.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",n[n.QUOTATION_MARK=34]="QUOTATION_MARK",n[n.AMPERSAND=38]="AMPERSAND",n[n.APOSTROPHE=39]="APOSTROPHE",n[n.HYPHEN_MINUS=45]="HYPHEN_MINUS",n[n.SOLIDUS=47]="SOLIDUS",n[n.DIGIT_0=48]="DIGIT_0",n[n.DIGIT_9=57]="DIGIT_9",n[n.SEMICOLON=59]="SEMICOLON",n[n.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",n[n.EQUALS_SIGN=61]="EQUALS_SIGN",n[n.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",n[n.QUESTION_MARK=63]="QUESTION_MARK",n[n.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",n[n.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",n[n.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",n[n.GRAVE_ACCENT=96]="GRAVE_ACCENT",n[n.LATIN_SMALL_A=97]="LATIN_SMALL_A",n[n.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(K||(K={}));const ei={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function kI(n){return n>=55296&&n<=57343}function QF(n){return n>=56320&&n<=57343}function ZF(n,e){return(n-55296)*1024+9216+e}function DI(n){return n!==32&&n!==10&&n!==13&&n!==9&&n!==12&&n>=1&&n<=31||n>=127&&n<=159}function OI(n){return n>=64976&&n<=65007||XF.has(n)}var xe;(function(n){n.controlCharacterInInputStream="control-character-in-input-stream",n.noncharacterInInputStream="noncharacter-in-input-stream",n.surrogateInInputStream="surrogate-in-input-stream",n.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",n.endTagWithAttributes="end-tag-with-attributes",n.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",n.unexpectedSolidusInTag="unexpected-solidus-in-tag",n.unexpectedNullCharacter="unexpected-null-character",n.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",n.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",n.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",n.missingEndTagName="missing-end-tag-name",n.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",n.unknownNamedCharacterReference="unknown-named-character-reference",n.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",n.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",n.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",n.eofBeforeTagName="eof-before-tag-name",n.eofInTag="eof-in-tag",n.missingAttributeValue="missing-attribute-value",n.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",n.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",n.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",n.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",n.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",n.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",n.missingDoctypePublicIdentifier="missing-doctype-public-identifier",n.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",n.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",n.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",n.cdataInHtmlContent="cdata-in-html-content",n.incorrectlyOpenedComment="incorrectly-opened-comment",n.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",n.eofInDoctype="eof-in-doctype",n.nestedComment="nested-comment",n.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",n.eofInComment="eof-in-comment",n.incorrectlyClosedComment="incorrectly-closed-comment",n.eofInCdata="eof-in-cdata",n.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",n.nullCharacterReference="null-character-reference",n.surrogateCharacterReference="surrogate-character-reference",n.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",n.controlCharacterReference="control-character-reference",n.noncharacterCharacterReference="noncharacter-character-reference",n.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",n.missingDoctypeName="missing-doctype-name",n.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",n.duplicateAttribute="duplicate-attribute",n.nonConformingDoctype="non-conforming-doctype",n.missingDoctype="missing-doctype",n.misplacedDoctype="misplaced-doctype",n.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",n.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",n.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",n.openElementsLeftAfterEof="open-elements-left-after-eof",n.abandonedHeadElementChild="abandoned-head-element-child",n.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",n.nestedNoscriptInHead="nested-noscript-in-head",n.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(xe||(xe={}));const JF=65536;class e5{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=JF,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,t){const{line:i,col:r,offset:s}=this,a=r+t,o=s+t;return{code:e,startLine:i,endLine:i,startCol:a,endCol:a,startOffset:o,endOffset:o}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const t=this.html.charCodeAt(this.pos+1);if(QF(t))return this.pos++,this._addGap(),ZF(e,t)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,K.EOF;return this._err(xe.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,t){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=t}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,t){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(t)return this.html.startsWith(e,this.pos);for(let i=0;i<e.length;i++)if((this.html.charCodeAt(this.pos+i)|32)!==e.charCodeAt(i))return!1;return!0}peek(e){const t=this.pos+e;if(t>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,K.EOF;const i=this.html.charCodeAt(t);return i===K.CARRIAGE_RETURN?K.LINE_FEED:i}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,K.EOF;let e=this.html.charCodeAt(this.pos);return e===K.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,K.LINE_FEED):e===K.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,kI(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===K.LINE_FEED||e===K.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){DI(e)?this._err(xe.controlCharacterInInputStream):OI(e)&&this._err(xe.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var At;(function(n){n[n.CHARACTER=0]="CHARACTER",n[n.NULL_CHARACTER=1]="NULL_CHARACTER",n[n.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",n[n.START_TAG=3]="START_TAG",n[n.END_TAG=4]="END_TAG",n[n.COMMENT=5]="COMMENT",n[n.DOCTYPE=6]="DOCTYPE",n[n.EOF=7]="EOF",n[n.HIBERNATION=8]="HIBERNATION"})(At||(At={}));function NI(n,e){for(let t=n.attrs.length-1;t>=0;t--)if(n.attrs[t].name===e)return n.attrs[t].value;return null}const t5=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(n=>n.charCodeAt(0))),n5=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function i5(n){var e;return n>=55296&&n<=57343||n>1114111?65533:(e=n5.get(n))!==null&&e!==void 0?e:n}var wn;(function(n){n[n.NUM=35]="NUM",n[n.SEMI=59]="SEMI",n[n.EQUALS=61]="EQUALS",n[n.ZERO=48]="ZERO",n[n.NINE=57]="NINE",n[n.LOWER_A=97]="LOWER_A",n[n.LOWER_F=102]="LOWER_F",n[n.LOWER_X=120]="LOWER_X",n[n.LOWER_Z=122]="LOWER_Z",n[n.UPPER_A=65]="UPPER_A",n[n.UPPER_F=70]="UPPER_F",n[n.UPPER_Z=90]="UPPER_Z"})(wn||(wn={}));const r5=32;var Hs;(function(n){n[n.VALUE_LENGTH=49152]="VALUE_LENGTH",n[n.BRANCH_LENGTH=16256]="BRANCH_LENGTH",n[n.JUMP_TABLE=127]="JUMP_TABLE"})(Hs||(Hs={}));function tv(n){return n>=wn.ZERO&&n<=wn.NINE}function s5(n){return n>=wn.UPPER_A&&n<=wn.UPPER_F||n>=wn.LOWER_A&&n<=wn.LOWER_F}function a5(n){return n>=wn.UPPER_A&&n<=wn.UPPER_Z||n>=wn.LOWER_A&&n<=wn.LOWER_Z||tv(n)}function o5(n){return n===wn.EQUALS||a5(n)}var Sn;(function(n){n[n.EntityStart=0]="EntityStart",n[n.NumericStart=1]="NumericStart",n[n.NumericDecimal=2]="NumericDecimal",n[n.NumericHex=3]="NumericHex",n[n.NamedEntity=4]="NamedEntity"})(Sn||(Sn={}));var Xr;(function(n){n[n.Legacy=0]="Legacy",n[n.Strict=1]="Strict",n[n.Attribute=2]="Attribute"})(Xr||(Xr={}));class u5{constructor(e,t,i){this.decodeTree=e,this.emitCodePoint=t,this.errors=i,this.state=Sn.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Xr.Strict}startEntity(e){this.decodeMode=e,this.state=Sn.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,t){switch(this.state){case Sn.EntityStart:return e.charCodeAt(t)===wn.NUM?(this.state=Sn.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=Sn.NamedEntity,this.stateNamedEntity(e,t));case Sn.NumericStart:return this.stateNumericStart(e,t);case Sn.NumericDecimal:return this.stateNumericDecimal(e,t);case Sn.NumericHex:return this.stateNumericHex(e,t);case Sn.NamedEntity:return this.stateNamedEntity(e,t)}}stateNumericStart(e,t){return t>=e.length?-1:(e.charCodeAt(t)|r5)===wn.LOWER_X?(this.state=Sn.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=Sn.NumericDecimal,this.stateNumericDecimal(e,t))}addToNumericResult(e,t,i,r){if(t!==i){const s=i-t;this.result=this.result*Math.pow(r,s)+Number.parseInt(e.substr(t,s),r),this.consumed+=s}}stateNumericHex(e,t){const i=t;for(;t<e.length;){const r=e.charCodeAt(t);if(tv(r)||s5(r))t+=1;else return this.addToNumericResult(e,i,t,16),this.emitNumericEntity(r,3)}return this.addToNumericResult(e,i,t,16),-1}stateNumericDecimal(e,t){const i=t;for(;t<e.length;){const r=e.charCodeAt(t);if(tv(r))t+=1;else return this.addToNumericResult(e,i,t,10),this.emitNumericEntity(r,2)}return this.addToNumericResult(e,i,t,10),-1}emitNumericEntity(e,t){var i;if(this.consumed<=t)return(i=this.errors)===null||i===void 0||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===wn.SEMI)this.consumed+=1;else if(this.decodeMode===Xr.Strict)return 0;return this.emitCodePoint(i5(this.result),this.consumed),this.errors&&(e!==wn.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,t){const{decodeTree:i}=this;let r=i[this.treeIndex],s=(r&Hs.VALUE_LENGTH)>>14;for(;t<e.length;t++,this.excess++){const a=e.charCodeAt(t);if(this.treeIndex=l5(i,r,this.treeIndex+Math.max(1,s),a),this.treeIndex<0)return this.result===0||this.decodeMode===Xr.Attribute&&(s===0||o5(a))?0:this.emitNotTerminatedNamedEntity();if(r=i[this.treeIndex],s=(r&Hs.VALUE_LENGTH)>>14,s!==0){if(a===wn.SEMI)return this.emitNamedEntityData(this.treeIndex,s,this.consumed+this.excess);this.decodeMode!==Xr.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:t,decodeTree:i}=this,r=(i[t]&Hs.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,r,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,t,i){const{decodeTree:r}=this;return this.emitCodePoint(t===1?r[e]&~Hs.VALUE_LENGTH:r[e+1],i),t===3&&this.emitCodePoint(r[e+2],i),i}end(){var e;switch(this.state){case Sn.NamedEntity:return this.result!==0&&(this.decodeMode!==Xr.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Sn.NumericDecimal:return this.emitNumericEntity(0,2);case Sn.NumericHex:return this.emitNumericEntity(0,3);case Sn.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Sn.EntityStart:return 0}}}function l5(n,e,t,i){const r=(e&Hs.BRANCH_LENGTH)>>7,s=e&Hs.JUMP_TABLE;if(r===0)return s!==0&&i===s?t:-1;if(s){const l=i-s;return l<0||l>=r?-1:n[t+l]-1}let a=t,o=a+r-1;for(;a<=o;){const l=a+o>>>1,u=n[l];if(u<i)a=l+1;else if(u>i)o=l-1;else return n[l+r]}return-1}var Oe;(function(n){n.HTML="http://www.w3.org/1999/xhtml",n.MATHML="http://www.w3.org/1998/Math/MathML",n.SVG="http://www.w3.org/2000/svg",n.XLINK="http://www.w3.org/1999/xlink",n.XML="http://www.w3.org/XML/1998/namespace",n.XMLNS="http://www.w3.org/2000/xmlns/"})(Oe||(Oe={}));var Fa;(function(n){n.TYPE="type",n.ACTION="action",n.ENCODING="encoding",n.PROMPT="prompt",n.NAME="name",n.COLOR="color",n.FACE="face",n.SIZE="size"})(Fa||(Fa={}));var ki;(function(n){n.NO_QUIRKS="no-quirks",n.QUIRKS="quirks",n.LIMITED_QUIRKS="limited-quirks"})(ki||(ki={}));var me;(function(n){n.A="a",n.ADDRESS="address",n.ANNOTATION_XML="annotation-xml",n.APPLET="applet",n.AREA="area",n.ARTICLE="article",n.ASIDE="aside",n.B="b",n.BASE="base",n.BASEFONT="basefont",n.BGSOUND="bgsound",n.BIG="big",n.BLOCKQUOTE="blockquote",n.BODY="body",n.BR="br",n.BUTTON="button",n.CAPTION="caption",n.CENTER="center",n.CODE="code",n.COL="col",n.COLGROUP="colgroup",n.DD="dd",n.DESC="desc",n.DETAILS="details",n.DIALOG="dialog",n.DIR="dir",n.DIV="div",n.DL="dl",n.DT="dt",n.EM="em",n.EMBED="embed",n.FIELDSET="fieldset",n.FIGCAPTION="figcaption",n.FIGURE="figure",n.FONT="font",n.FOOTER="footer",n.FOREIGN_OBJECT="foreignObject",n.FORM="form",n.FRAME="frame",n.FRAMESET="frameset",n.H1="h1",n.H2="h2",n.H3="h3",n.H4="h4",n.H5="h5",n.H6="h6",n.HEAD="head",n.HEADER="header",n.HGROUP="hgroup",n.HR="hr",n.HTML="html",n.I="i",n.IMG="img",n.IMAGE="image",n.INPUT="input",n.IFRAME="iframe",n.KEYGEN="keygen",n.LABEL="label",n.LI="li",n.LINK="link",n.LISTING="listing",n.MAIN="main",n.MALIGNMARK="malignmark",n.MARQUEE="marquee",n.MATH="math",n.MENU="menu",n.META="meta",n.MGLYPH="mglyph",n.MI="mi",n.MO="mo",n.MN="mn",n.MS="ms",n.MTEXT="mtext",n.NAV="nav",n.NOBR="nobr",n.NOFRAMES="noframes",n.NOEMBED="noembed",n.NOSCRIPT="noscript",n.OBJECT="object",n.OL="ol",n.OPTGROUP="optgroup",n.OPTION="option",n.P="p",n.PARAM="param",n.PLAINTEXT="plaintext",n.PRE="pre",n.RB="rb",n.RP="rp",n.RT="rt",n.RTC="rtc",n.RUBY="ruby",n.S="s",n.SCRIPT="script",n.SEARCH="search",n.SECTION="section",n.SELECT="select",n.SOURCE="source",n.SMALL="small",n.SPAN="span",n.STRIKE="strike",n.STRONG="strong",n.STYLE="style",n.SUB="sub",n.SUMMARY="summary",n.SUP="sup",n.TABLE="table",n.TBODY="tbody",n.TEMPLATE="template",n.TEXTAREA="textarea",n.TFOOT="tfoot",n.TD="td",n.TH="th",n.THEAD="thead",n.TITLE="title",n.TR="tr",n.TRACK="track",n.TT="tt",n.U="u",n.UL="ul",n.SVG="svg",n.VAR="var",n.WBR="wbr",n.XMP="xmp"})(me||(me={}));var C;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.A=1]="A",n[n.ADDRESS=2]="ADDRESS",n[n.ANNOTATION_XML=3]="ANNOTATION_XML",n[n.APPLET=4]="APPLET",n[n.AREA=5]="AREA",n[n.ARTICLE=6]="ARTICLE",n[n.ASIDE=7]="ASIDE",n[n.B=8]="B",n[n.BASE=9]="BASE",n[n.BASEFONT=10]="BASEFONT",n[n.BGSOUND=11]="BGSOUND",n[n.BIG=12]="BIG",n[n.BLOCKQUOTE=13]="BLOCKQUOTE",n[n.BODY=14]="BODY",n[n.BR=15]="BR",n[n.BUTTON=16]="BUTTON",n[n.CAPTION=17]="CAPTION",n[n.CENTER=18]="CENTER",n[n.CODE=19]="CODE",n[n.COL=20]="COL",n[n.COLGROUP=21]="COLGROUP",n[n.DD=22]="DD",n[n.DESC=23]="DESC",n[n.DETAILS=24]="DETAILS",n[n.DIALOG=25]="DIALOG",n[n.DIR=26]="DIR",n[n.DIV=27]="DIV",n[n.DL=28]="DL",n[n.DT=29]="DT",n[n.EM=30]="EM",n[n.EMBED=31]="EMBED",n[n.FIELDSET=32]="FIELDSET",n[n.FIGCAPTION=33]="FIGCAPTION",n[n.FIGURE=34]="FIGURE",n[n.FONT=35]="FONT",n[n.FOOTER=36]="FOOTER",n[n.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",n[n.FORM=38]="FORM",n[n.FRAME=39]="FRAME",n[n.FRAMESET=40]="FRAMESET",n[n.H1=41]="H1",n[n.H2=42]="H2",n[n.H3=43]="H3",n[n.H4=44]="H4",n[n.H5=45]="H5",n[n.H6=46]="H6",n[n.HEAD=47]="HEAD",n[n.HEADER=48]="HEADER",n[n.HGROUP=49]="HGROUP",n[n.HR=50]="HR",n[n.HTML=51]="HTML",n[n.I=52]="I",n[n.IMG=53]="IMG",n[n.IMAGE=54]="IMAGE",n[n.INPUT=55]="INPUT",n[n.IFRAME=56]="IFRAME",n[n.KEYGEN=57]="KEYGEN",n[n.LABEL=58]="LABEL",n[n.LI=59]="LI",n[n.LINK=60]="LINK",n[n.LISTING=61]="LISTING",n[n.MAIN=62]="MAIN",n[n.MALIGNMARK=63]="MALIGNMARK",n[n.MARQUEE=64]="MARQUEE",n[n.MATH=65]="MATH",n[n.MENU=66]="MENU",n[n.META=67]="META",n[n.MGLYPH=68]="MGLYPH",n[n.MI=69]="MI",n[n.MO=70]="MO",n[n.MN=71]="MN",n[n.MS=72]="MS",n[n.MTEXT=73]="MTEXT",n[n.NAV=74]="NAV",n[n.NOBR=75]="NOBR",n[n.NOFRAMES=76]="NOFRAMES",n[n.NOEMBED=77]="NOEMBED",n[n.NOSCRIPT=78]="NOSCRIPT",n[n.OBJECT=79]="OBJECT",n[n.OL=80]="OL",n[n.OPTGROUP=81]="OPTGROUP",n[n.OPTION=82]="OPTION",n[n.P=83]="P",n[n.PARAM=84]="PARAM",n[n.PLAINTEXT=85]="PLAINTEXT",n[n.PRE=86]="PRE",n[n.RB=87]="RB",n[n.RP=88]="RP",n[n.RT=89]="RT",n[n.RTC=90]="RTC",n[n.RUBY=91]="RUBY",n[n.S=92]="S",n[n.SCRIPT=93]="SCRIPT",n[n.SEARCH=94]="SEARCH",n[n.SECTION=95]="SECTION",n[n.SELECT=96]="SELECT",n[n.SOURCE=97]="SOURCE",n[n.SMALL=98]="SMALL",n[n.SPAN=99]="SPAN",n[n.STRIKE=100]="STRIKE",n[n.STRONG=101]="STRONG",n[n.STYLE=102]="STYLE",n[n.SUB=103]="SUB",n[n.SUMMARY=104]="SUMMARY",n[n.SUP=105]="SUP",n[n.TABLE=106]="TABLE",n[n.TBODY=107]="TBODY",n[n.TEMPLATE=108]="TEMPLATE",n[n.TEXTAREA=109]="TEXTAREA",n[n.TFOOT=110]="TFOOT",n[n.TD=111]="TD",n[n.TH=112]="TH",n[n.THEAD=113]="THEAD",n[n.TITLE=114]="TITLE",n[n.TR=115]="TR",n[n.TRACK=116]="TRACK",n[n.TT=117]="TT",n[n.U=118]="U",n[n.UL=119]="UL",n[n.SVG=120]="SVG",n[n.VAR=121]="VAR",n[n.WBR=122]="WBR",n[n.XMP=123]="XMP"})(C||(C={}));const c5=new Map([[me.A,C.A],[me.ADDRESS,C.ADDRESS],[me.ANNOTATION_XML,C.ANNOTATION_XML],[me.APPLET,C.APPLET],[me.AREA,C.AREA],[me.ARTICLE,C.ARTICLE],[me.ASIDE,C.ASIDE],[me.B,C.B],[me.BASE,C.BASE],[me.BASEFONT,C.BASEFONT],[me.BGSOUND,C.BGSOUND],[me.BIG,C.BIG],[me.BLOCKQUOTE,C.BLOCKQUOTE],[me.BODY,C.BODY],[me.BR,C.BR],[me.BUTTON,C.BUTTON],[me.CAPTION,C.CAPTION],[me.CENTER,C.CENTER],[me.CODE,C.CODE],[me.COL,C.COL],[me.COLGROUP,C.COLGROUP],[me.DD,C.DD],[me.DESC,C.DESC],[me.DETAILS,C.DETAILS],[me.DIALOG,C.DIALOG],[me.DIR,C.DIR],[me.DIV,C.DIV],[me.DL,C.DL],[me.DT,C.DT],[me.EM,C.EM],[me.EMBED,C.EMBED],[me.FIELDSET,C.FIELDSET],[me.FIGCAPTION,C.FIGCAPTION],[me.FIGURE,C.FIGURE],[me.FONT,C.FONT],[me.FOOTER,C.FOOTER],[me.FOREIGN_OBJECT,C.FOREIGN_OBJECT],[me.FORM,C.FORM],[me.FRAME,C.FRAME],[me.FRAMESET,C.FRAMESET],[me.H1,C.H1],[me.H2,C.H2],[me.H3,C.H3],[me.H4,C.H4],[me.H5,C.H5],[me.H6,C.H6],[me.HEAD,C.HEAD],[me.HEADER,C.HEADER],[me.HGROUP,C.HGROUP],[me.HR,C.HR],[me.HTML,C.HTML],[me.I,C.I],[me.IMG,C.IMG],[me.IMAGE,C.IMAGE],[me.INPUT,C.INPUT],[me.IFRAME,C.IFRAME],[me.KEYGEN,C.KEYGEN],[me.LABEL,C.LABEL],[me.LI,C.LI],[me.LINK,C.LINK],[me.LISTING,C.LISTING],[me.MAIN,C.MAIN],[me.MALIGNMARK,C.MALIGNMARK],[me.MARQUEE,C.MARQUEE],[me.MATH,C.MATH],[me.MENU,C.MENU],[me.META,C.META],[me.MGLYPH,C.MGLYPH],[me.MI,C.MI],[me.MO,C.MO],[me.MN,C.MN],[me.MS,C.MS],[me.MTEXT,C.MTEXT],[me.NAV,C.NAV],[me.NOBR,C.NOBR],[me.NOFRAMES,C.NOFRAMES],[me.NOEMBED,C.NOEMBED],[me.NOSCRIPT,C.NOSCRIPT],[me.OBJECT,C.OBJECT],[me.OL,C.OL],[me.OPTGROUP,C.OPTGROUP],[me.OPTION,C.OPTION],[me.P,C.P],[me.PARAM,C.PARAM],[me.PLAINTEXT,C.PLAINTEXT],[me.PRE,C.PRE],[me.RB,C.RB],[me.RP,C.RP],[me.RT,C.RT],[me.RTC,C.RTC],[me.RUBY,C.RUBY],[me.S,C.S],[me.SCRIPT,C.SCRIPT],[me.SEARCH,C.SEARCH],[me.SECTION,C.SECTION],[me.SELECT,C.SELECT],[me.SOURCE,C.SOURCE],[me.SMALL,C.SMALL],[me.SPAN,C.SPAN],[me.STRIKE,C.STRIKE],[me.STRONG,C.STRONG],[me.STYLE,C.STYLE],[me.SUB,C.SUB],[me.SUMMARY,C.SUMMARY],[me.SUP,C.SUP],[me.TABLE,C.TABLE],[me.TBODY,C.TBODY],[me.TEMPLATE,C.TEMPLATE],[me.TEXTAREA,C.TEXTAREA],[me.TFOOT,C.TFOOT],[me.TD,C.TD],[me.TH,C.TH],[me.THEAD,C.THEAD],[me.TITLE,C.TITLE],[me.TR,C.TR],[me.TRACK,C.TRACK],[me.TT,C.TT],[me.U,C.U],[me.UL,C.UL],[me.SVG,C.SVG],[me.VAR,C.VAR],[me.WBR,C.WBR],[me.XMP,C.XMP]]);function fu(n){var e;return(e=c5.get(n))!==null&&e!==void 0?e:C.UNKNOWN}const Ue=C,d5={[Oe.HTML]:new Set([Ue.ADDRESS,Ue.APPLET,Ue.AREA,Ue.ARTICLE,Ue.ASIDE,Ue.BASE,Ue.BASEFONT,Ue.BGSOUND,Ue.BLOCKQUOTE,Ue.BODY,Ue.BR,Ue.BUTTON,Ue.CAPTION,Ue.CENTER,Ue.COL,Ue.COLGROUP,Ue.DD,Ue.DETAILS,Ue.DIR,Ue.DIV,Ue.DL,Ue.DT,Ue.EMBED,Ue.FIELDSET,Ue.FIGCAPTION,Ue.FIGURE,Ue.FOOTER,Ue.FORM,Ue.FRAME,Ue.FRAMESET,Ue.H1,Ue.H2,Ue.H3,Ue.H4,Ue.H5,Ue.H6,Ue.HEAD,Ue.HEADER,Ue.HGROUP,Ue.HR,Ue.HTML,Ue.IFRAME,Ue.IMG,Ue.INPUT,Ue.LI,Ue.LINK,Ue.LISTING,Ue.MAIN,Ue.MARQUEE,Ue.MENU,Ue.META,Ue.NAV,Ue.NOEMBED,Ue.NOFRAMES,Ue.NOSCRIPT,Ue.OBJECT,Ue.OL,Ue.P,Ue.PARAM,Ue.PLAINTEXT,Ue.PRE,Ue.SCRIPT,Ue.SECTION,Ue.SELECT,Ue.SOURCE,Ue.STYLE,Ue.SUMMARY,Ue.TABLE,Ue.TBODY,Ue.TD,Ue.TEMPLATE,Ue.TEXTAREA,Ue.TFOOT,Ue.TH,Ue.THEAD,Ue.TITLE,Ue.TR,Ue.TRACK,Ue.UL,Ue.WBR,Ue.XMP]),[Oe.MATHML]:new Set([Ue.MI,Ue.MO,Ue.MN,Ue.MS,Ue.MTEXT,Ue.ANNOTATION_XML]),[Oe.SVG]:new Set([Ue.TITLE,Ue.FOREIGN_OBJECT,Ue.DESC]),[Oe.XLINK]:new Set,[Oe.XML]:new Set,[Oe.XMLNS]:new Set},nv=new Set([Ue.H1,Ue.H2,Ue.H3,Ue.H4,Ue.H5,Ue.H6]);me.STYLE,me.SCRIPT,me.XMP,me.IFRAME,me.NOEMBED,me.NOFRAMES,me.PLAINTEXT;var J;(function(n){n[n.DATA=0]="DATA",n[n.RCDATA=1]="RCDATA",n[n.RAWTEXT=2]="RAWTEXT",n[n.SCRIPT_DATA=3]="SCRIPT_DATA",n[n.PLAINTEXT=4]="PLAINTEXT",n[n.TAG_OPEN=5]="TAG_OPEN",n[n.END_TAG_OPEN=6]="END_TAG_OPEN",n[n.TAG_NAME=7]="TAG_NAME",n[n.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",n[n.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",n[n.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",n[n.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",n[n.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",n[n.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",n[n.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",n[n.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",n[n.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",n[n.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",n[n.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",n[n.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",n[n.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",n[n.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",n[n.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",n[n.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",n[n.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",n[n.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",n[n.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",n[n.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",n[n.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",n[n.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",n[n.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",n[n.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",n[n.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",n[n.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",n[n.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",n[n.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",n[n.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",n[n.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",n[n.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",n[n.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",n[n.BOGUS_COMMENT=40]="BOGUS_COMMENT",n[n.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",n[n.COMMENT_START=42]="COMMENT_START",n[n.COMMENT_START_DASH=43]="COMMENT_START_DASH",n[n.COMMENT=44]="COMMENT",n[n.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",n[n.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",n[n.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",n[n.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",n[n.COMMENT_END_DASH=49]="COMMENT_END_DASH",n[n.COMMENT_END=50]="COMMENT_END",n[n.COMMENT_END_BANG=51]="COMMENT_END_BANG",n[n.DOCTYPE=52]="DOCTYPE",n[n.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",n[n.DOCTYPE_NAME=54]="DOCTYPE_NAME",n[n.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",n[n.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",n[n.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",n[n.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",n[n.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",n[n.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",n[n.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",n[n.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",n[n.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",n[n.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",n[n.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",n[n.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",n[n.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",n[n.CDATA_SECTION=68]="CDATA_SECTION",n[n.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",n[n.CDATA_SECTION_END=70]="CDATA_SECTION_END",n[n.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",n[n.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(J||(J={}));const on={DATA:J.DATA,RCDATA:J.RCDATA,RAWTEXT:J.RAWTEXT,SCRIPT_DATA:J.SCRIPT_DATA,PLAINTEXT:J.PLAINTEXT,CDATA_SECTION:J.CDATA_SECTION};function f5(n){return n>=K.DIGIT_0&&n<=K.DIGIT_9}function pl(n){return n>=K.LATIN_CAPITAL_A&&n<=K.LATIN_CAPITAL_Z}function h5(n){return n>=K.LATIN_SMALL_A&&n<=K.LATIN_SMALL_Z}function Os(n){return h5(n)||pl(n)}function _x(n){return Os(n)||f5(n)}function wd(n){return n+32}function MI(n){return n===K.SPACE||n===K.LINE_FEED||n===K.TABULATION||n===K.FORM_FEED}function Lx(n){return MI(n)||n===K.SOLIDUS||n===K.GREATER_THAN_SIGN}function p5(n){return n===K.NULL?xe.nullCharacterReference:n>1114111?xe.characterReferenceOutsideUnicodeRange:kI(n)?xe.surrogateCharacterReference:OI(n)?xe.noncharacterCharacterReference:DI(n)||n===K.CARRIAGE_RETURN?xe.controlCharacterReference:null}let m5=class{constructor(e,t){this.options=e,this.handler=t,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=J.DATA,this.returnState=J.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new e5(t),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new u5(t5,(i,r)=>{this.preprocessor.pos=this.entityStartPos+r-1,this._flushCodePointConsumedAsCharacterReference(i)},t.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(xe.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:i=>{this._err(xe.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+i)},validateNumericCharacterReference:i=>{const r=p5(i);r&&this._err(r,1)}}:void 0)}_err(e,t=0){var i,r;(r=(i=this.handler).onParseError)===null||r===void 0||r.call(i,this.preprocessor.getError(e,t))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e==null||e())}write(e,t,i){this.active=!0,this.preprocessor.write(e,t),this._runParsingLoop(),this.paused||i==null||i()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let t=0;t<e;t++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,t){return this.preprocessor.startsWith(e,t)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:At.START_TAG,tagName:"",tagID:C.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:At.END_TAG,tagName:"",tagID:C.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:At.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:At.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,t){this.currentCharacterToken={type:e,chars:t,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,t;const i=this.currentToken;if(NI(i,this.currentAttr.name)===null){if(i.attrs.push(this.currentAttr),i.location&&this.currentLocation){const r=(e=(t=i.location).attrs)!==null&&e!==void 0?e:t.attrs=Object.create(null);r[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(xe.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=fu(e.tagName),e.type===At.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err(xe.endTagWithAttributes),e.selfClosing&&this._err(xe.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case At.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case At.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case At.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:At.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,t){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=t;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,t)}_emitCodePoint(e){const t=MI(e)?At.WHITESPACE_CHARACTER:e===K.NULL?At.NULL_CHARACTER:At.CHARACTER;this._appendCharToCurrentCharacterToken(t,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(At.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=J.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?Xr.Attribute:Xr.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===J.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===J.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===J.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case J.DATA:{this._stateData(e);break}case J.RCDATA:{this._stateRcdata(e);break}case J.RAWTEXT:{this._stateRawtext(e);break}case J.SCRIPT_DATA:{this._stateScriptData(e);break}case J.PLAINTEXT:{this._statePlaintext(e);break}case J.TAG_OPEN:{this._stateTagOpen(e);break}case J.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case J.TAG_NAME:{this._stateTagName(e);break}case J.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case J.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case J.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case J.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case J.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case J.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case J.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case J.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case J.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case J.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case J.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case J.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case J.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case J.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case J.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case J.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case J.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case J.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case J.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case J.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case J.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case J.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case J.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case J.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case J.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case J.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case J.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case J.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case J.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case J.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case J.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case J.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case J.BOGUS_COMMENT:{this._stateBogusComment(e);break}case J.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case J.COMMENT_START:{this._stateCommentStart(e);break}case J.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case J.COMMENT:{this._stateComment(e);break}case J.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case J.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case J.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case J.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case J.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case J.COMMENT_END:{this._stateCommentEnd(e);break}case J.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case J.DOCTYPE:{this._stateDoctype(e);break}case J.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case J.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case J.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case J.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case J.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case J.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case J.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case J.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case J.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case J.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case J.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case J.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case J.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case J.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case J.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case J.CDATA_SECTION:{this._stateCdataSection(e);break}case J.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case J.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case J.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case J.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case K.LESS_THAN_SIGN:{this.state=J.TAG_OPEN;break}case K.AMPERSAND:{this._startCharacterReference();break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitCodePoint(e);break}case K.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case K.AMPERSAND:{this._startCharacterReference();break}case K.LESS_THAN_SIGN:{this.state=J.RCDATA_LESS_THAN_SIGN;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitChars(Kt);break}case K.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case K.LESS_THAN_SIGN:{this.state=J.RAWTEXT_LESS_THAN_SIGN;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitChars(Kt);break}case K.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_LESS_THAN_SIGN;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitChars(Kt);break}case K.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitChars(Kt);break}case K.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(Os(e))this._createStartTagToken(),this.state=J.TAG_NAME,this._stateTagName(e);else switch(e){case K.EXCLAMATION_MARK:{this.state=J.MARKUP_DECLARATION_OPEN;break}case K.SOLIDUS:{this.state=J.END_TAG_OPEN;break}case K.QUESTION_MARK:{this._err(xe.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=J.BOGUS_COMMENT,this._stateBogusComment(e);break}case K.EOF:{this._err(xe.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(xe.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=J.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(Os(e))this._createEndTagToken(),this.state=J.TAG_NAME,this._stateTagName(e);else switch(e){case K.GREATER_THAN_SIGN:{this._err(xe.missingEndTagName),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(xe.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=J.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this.state=J.BEFORE_ATTRIBUTE_NAME;break}case K.SOLIDUS:{this.state=J.SELF_CLOSING_START_TAG;break}case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentTagToken();break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.tagName+=Kt;break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:t.tagName+=String.fromCodePoint(pl(e)?wd(e):e)}}_stateRcdataLessThanSign(e){e===K.SOLIDUS?this.state=J.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=J.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){Os(e)?(this.state=J.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=J.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const t=this.currentToken;switch(t.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=J.BEFORE_ATTRIBUTE_NAME,!1;case K.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=J.SELF_CLOSING_START_TAG,!1;case K.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=J.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=J.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===K.SOLIDUS?this.state=J.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=J.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){Os(e)?(this.state=J.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=J.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=J.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case K.SOLIDUS:{this.state=J.SCRIPT_DATA_END_TAG_OPEN;break}case K.EXCLAMATION_MARK:{this.state=J.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=J.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){Os(e)?(this.state=J.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=J.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=J.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===K.HYPHEN_MINUS?(this.state=J.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=J.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===K.HYPHEN_MINUS?(this.state=J.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=J.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case K.HYPHEN_MINUS:{this.state=J.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitChars(Kt);break}case K.EOF:{this._err(xe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case K.HYPHEN_MINUS:{this.state=J.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.state=J.SCRIPT_DATA_ESCAPED,this._emitChars(Kt);break}case K.EOF:{this._err(xe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=J.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case K.HYPHEN_MINUS:{this._emitChars("-");break}case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case K.GREATER_THAN_SIGN:{this.state=J.SCRIPT_DATA,this._emitChars(">");break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.state=J.SCRIPT_DATA_ESCAPED,this._emitChars(Kt);break}case K.EOF:{this._err(xe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=J.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===K.SOLIDUS?this.state=J.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Os(e)?(this._emitChars("<"),this.state=J.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=J.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){Os(e)?(this.state=J.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=J.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=J.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(ei.SCRIPT,!1)&&Lx(this.preprocessor.peek(ei.SCRIPT.length))){this._emitCodePoint(e);for(let t=0;t<ei.SCRIPT.length;t++)this._emitCodePoint(this._consume());this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=J.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case K.HYPHEN_MINUS:{this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this._emitChars(Kt);break}case K.EOF:{this._err(xe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case K.HYPHEN_MINUS:{this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Kt);break}case K.EOF:{this._err(xe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case K.HYPHEN_MINUS:{this._emitChars("-");break}case K.LESS_THAN_SIGN:{this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case K.GREATER_THAN_SIGN:{this.state=J.SCRIPT_DATA,this._emitChars(">");break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Kt);break}case K.EOF:{this._err(xe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===K.SOLIDUS?(this.state=J.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(ei.SCRIPT,!1)&&Lx(this.preprocessor.peek(ei.SCRIPT.length))){this._emitCodePoint(e);for(let t=0;t<ei.SCRIPT.length;t++)this._emitCodePoint(this._consume());this.state=J.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=J.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.SOLIDUS:case K.GREATER_THAN_SIGN:case K.EOF:{this.state=J.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case K.EQUALS_SIGN:{this._err(xe.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=J.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=J.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:case K.SOLIDUS:case K.GREATER_THAN_SIGN:case K.EOF:{this._leaveAttrName(),this.state=J.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case K.EQUALS_SIGN:{this._leaveAttrName(),this.state=J.BEFORE_ATTRIBUTE_VALUE;break}case K.QUOTATION_MARK:case K.APOSTROPHE:case K.LESS_THAN_SIGN:{this._err(xe.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.currentAttr.name+=Kt;break}default:this.currentAttr.name+=String.fromCodePoint(pl(e)?wd(e):e)}}_stateAfterAttributeName(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.SOLIDUS:{this.state=J.SELF_CLOSING_START_TAG;break}case K.EQUALS_SIGN:{this.state=J.BEFORE_ATTRIBUTE_VALUE;break}case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentTagToken();break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=J.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.QUOTATION_MARK:{this.state=J.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case K.APOSTROPHE:{this.state=J.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case K.GREATER_THAN_SIGN:{this._err(xe.missingAttributeValue),this.state=J.DATA,this.emitCurrentTagToken();break}default:this.state=J.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case K.QUOTATION_MARK:{this.state=J.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case K.AMPERSAND:{this._startCharacterReference();break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.currentAttr.value+=Kt;break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case K.APOSTROPHE:{this.state=J.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case K.AMPERSAND:{this._startCharacterReference();break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.currentAttr.value+=Kt;break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this._leaveAttrValue(),this.state=J.BEFORE_ATTRIBUTE_NAME;break}case K.AMPERSAND:{this._startCharacterReference();break}case K.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=J.DATA,this.emitCurrentTagToken();break}case K.NULL:{this._err(xe.unexpectedNullCharacter),this.currentAttr.value+=Kt;break}case K.QUOTATION_MARK:case K.APOSTROPHE:case K.LESS_THAN_SIGN:case K.EQUALS_SIGN:case K.GRAVE_ACCENT:{this._err(xe.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this._leaveAttrValue(),this.state=J.BEFORE_ATTRIBUTE_NAME;break}case K.SOLIDUS:{this._leaveAttrValue(),this.state=J.SELF_CLOSING_START_TAG;break}case K.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=J.DATA,this.emitCurrentTagToken();break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:this._err(xe.missingWhitespaceBetweenAttributes),this.state=J.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case K.GREATER_THAN_SIGN:{const t=this.currentToken;t.selfClosing=!0,this.state=J.DATA,this.emitCurrentTagToken();break}case K.EOF:{this._err(xe.eofInTag),this._emitEOFToken();break}default:this._err(xe.unexpectedSolidusInTag),this.state=J.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const t=this.currentToken;switch(e){case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentComment(t);break}case K.EOF:{this.emitCurrentComment(t),this._emitEOFToken();break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.data+=Kt;break}default:t.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(ei.DASH_DASH,!0)?(this._createCommentToken(ei.DASH_DASH.length+1),this.state=J.COMMENT_START):this._consumeSequenceIfMatch(ei.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(ei.DOCTYPE.length+1),this.state=J.DOCTYPE):this._consumeSequenceIfMatch(ei.CDATA_START,!0)?this.inForeignNode?this.state=J.CDATA_SECTION:(this._err(xe.cdataInHtmlContent),this._createCommentToken(ei.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=J.BOGUS_COMMENT):this._ensureHibernation()||(this._err(xe.incorrectlyOpenedComment),this._createCommentToken(2),this.state=J.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case K.HYPHEN_MINUS:{this.state=J.COMMENT_START_DASH;break}case K.GREATER_THAN_SIGN:{this._err(xe.abruptClosingOfEmptyComment),this.state=J.DATA;const t=this.currentToken;this.emitCurrentComment(t);break}default:this.state=J.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const t=this.currentToken;switch(e){case K.HYPHEN_MINUS:{this.state=J.COMMENT_END;break}case K.GREATER_THAN_SIGN:{this._err(xe.abruptClosingOfEmptyComment),this.state=J.DATA,this.emitCurrentComment(t);break}case K.EOF:{this._err(xe.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="-",this.state=J.COMMENT,this._stateComment(e)}}_stateComment(e){const t=this.currentToken;switch(e){case K.HYPHEN_MINUS:{this.state=J.COMMENT_END_DASH;break}case K.LESS_THAN_SIGN:{t.data+="<",this.state=J.COMMENT_LESS_THAN_SIGN;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.data+=Kt;break}case K.EOF:{this._err(xe.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const t=this.currentToken;switch(e){case K.EXCLAMATION_MARK:{t.data+="!",this.state=J.COMMENT_LESS_THAN_SIGN_BANG;break}case K.LESS_THAN_SIGN:{t.data+="<";break}default:this.state=J.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===K.HYPHEN_MINUS?this.state=J.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=J.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===K.HYPHEN_MINUS?this.state=J.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=J.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==K.GREATER_THAN_SIGN&&e!==K.EOF&&this._err(xe.nestedComment),this.state=J.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const t=this.currentToken;switch(e){case K.HYPHEN_MINUS:{this.state=J.COMMENT_END;break}case K.EOF:{this._err(xe.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="-",this.state=J.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const t=this.currentToken;switch(e){case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentComment(t);break}case K.EXCLAMATION_MARK:{this.state=J.COMMENT_END_BANG;break}case K.HYPHEN_MINUS:{t.data+="-";break}case K.EOF:{this._err(xe.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="--",this.state=J.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const t=this.currentToken;switch(e){case K.HYPHEN_MINUS:{t.data+="--!",this.state=J.COMMENT_END_DASH;break}case K.GREATER_THAN_SIGN:{this._err(xe.incorrectlyClosedComment),this.state=J.DATA,this.emitCurrentComment(t);break}case K.EOF:{this._err(xe.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="--!",this.state=J.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this.state=J.BEFORE_DOCTYPE_NAME;break}case K.GREATER_THAN_SIGN:{this.state=J.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case K.EOF:{this._err(xe.eofInDoctype),this._createDoctypeToken(null);const t=this.currentToken;t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingWhitespaceBeforeDoctypeName),this.state=J.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(pl(e))this._createDoctypeToken(String.fromCharCode(wd(e))),this.state=J.DOCTYPE_NAME;else switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.NULL:{this._err(xe.unexpectedNullCharacter),this._createDoctypeToken(Kt),this.state=J.DOCTYPE_NAME;break}case K.GREATER_THAN_SIGN:{this._err(xe.missingDoctypeName),this._createDoctypeToken(null);const t=this.currentToken;t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofInDoctype),this._createDoctypeToken(null);const t=this.currentToken;t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=J.DOCTYPE_NAME}}_stateDoctypeName(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this.state=J.AFTER_DOCTYPE_NAME;break}case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.name+=Kt;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.name+=String.fromCodePoint(pl(e)?wd(e):e)}}_stateAfterDoctypeName(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(ei.PUBLIC,!1)?this.state=J.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(ei.SYSTEM,!1)?this.state=J.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(xe.invalidCharacterSequenceAfterDoctypeName),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this.state=J.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case K.QUOTATION_MARK:{this._err(xe.missingWhitespaceAfterDoctypePublicKeyword),t.publicId="",this.state=J.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case K.APOSTROPHE:{this._err(xe.missingWhitespaceAfterDoctypePublicKeyword),t.publicId="",this.state=J.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case K.GREATER_THAN_SIGN:{this._err(xe.missingDoctypePublicIdentifier),t.forceQuirks=!0,this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingQuoteBeforeDoctypePublicIdentifier),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.QUOTATION_MARK:{t.publicId="",this.state=J.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case K.APOSTROPHE:{t.publicId="",this.state=J.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case K.GREATER_THAN_SIGN:{this._err(xe.missingDoctypePublicIdentifier),t.forceQuirks=!0,this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingQuoteBeforeDoctypePublicIdentifier),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const t=this.currentToken;switch(e){case K.QUOTATION_MARK:{this.state=J.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.publicId+=Kt;break}case K.GREATER_THAN_SIGN:{this._err(xe.abruptDoctypePublicIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const t=this.currentToken;switch(e){case K.APOSTROPHE:{this.state=J.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.publicId+=Kt;break}case K.GREATER_THAN_SIGN:{this._err(xe.abruptDoctypePublicIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this.state=J.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case K.GREATER_THAN_SIGN:{this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.QUOTATION_MARK:{this._err(xe.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case K.APOSTROPHE:{this._err(xe.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.GREATER_THAN_SIGN:{this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.QUOTATION_MARK:{t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case K.APOSTROPHE:{t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:{this.state=J.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case K.QUOTATION_MARK:{this._err(xe.missingWhitespaceAfterDoctypeSystemKeyword),t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case K.APOSTROPHE:{this._err(xe.missingWhitespaceAfterDoctypeSystemKeyword),t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case K.GREATER_THAN_SIGN:{this._err(xe.missingDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.QUOTATION_MARK:{t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case K.APOSTROPHE:{t.systemId="",this.state=J.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case K.GREATER_THAN_SIGN:{this._err(xe.missingDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=J.DATA,this.emitCurrentDoctype(t);break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const t=this.currentToken;switch(e){case K.QUOTATION_MARK:{this.state=J.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.systemId+=Kt;break}case K.GREATER_THAN_SIGN:{this._err(xe.abruptDoctypeSystemIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const t=this.currentToken;switch(e){case K.APOSTROPHE:{this.state=J.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case K.NULL:{this._err(xe.unexpectedNullCharacter),t.systemId+=Kt;break}case K.GREATER_THAN_SIGN:{this._err(xe.abruptDoctypeSystemIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const t=this.currentToken;switch(e){case K.SPACE:case K.LINE_FEED:case K.TABULATION:case K.FORM_FEED:break;case K.GREATER_THAN_SIGN:{this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.EOF:{this._err(xe.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(xe.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=J.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const t=this.currentToken;switch(e){case K.GREATER_THAN_SIGN:{this.emitCurrentDoctype(t),this.state=J.DATA;break}case K.NULL:{this._err(xe.unexpectedNullCharacter);break}case K.EOF:{this.emitCurrentDoctype(t),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case K.RIGHT_SQUARE_BRACKET:{this.state=J.CDATA_SECTION_BRACKET;break}case K.EOF:{this._err(xe.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===K.RIGHT_SQUARE_BRACKET?this.state=J.CDATA_SECTION_END:(this._emitChars("]"),this.state=J.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case K.GREATER_THAN_SIGN:{this.state=J.DATA;break}case K.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=J.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(K.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&_x(this.preprocessor.peek(1))?J.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){_x(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===K.SEMICOLON&&this._err(xe.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}};const FI=new Set([C.DD,C.DT,C.LI,C.OPTGROUP,C.OPTION,C.P,C.RB,C.RP,C.RT,C.RTC]),Px=new Set([...FI,C.CAPTION,C.COLGROUP,C.TBODY,C.TD,C.TFOOT,C.TH,C.THEAD,C.TR]),Pf=new Set([C.APPLET,C.CAPTION,C.HTML,C.MARQUEE,C.OBJECT,C.TABLE,C.TD,C.TEMPLATE,C.TH]),g5=new Set([...Pf,C.OL,C.UL]),v5=new Set([...Pf,C.BUTTON]),kx=new Set([C.ANNOTATION_XML,C.MI,C.MN,C.MO,C.MS,C.MTEXT]),Dx=new Set([C.DESC,C.FOREIGN_OBJECT,C.TITLE]),y5=new Set([C.TR,C.TEMPLATE,C.HTML]),E5=new Set([C.TBODY,C.TFOOT,C.THEAD,C.TEMPLATE,C.HTML]),b5=new Set([C.TABLE,C.TEMPLATE,C.HTML]),T5=new Set([C.TD,C.TH]);class x5{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,t,i){this.treeAdapter=t,this.handler=i,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=C.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===C.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===Oe.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,t){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=t,this.currentTagId=t,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,t,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,t){const i=this._indexOf(e);this.items[i]=t,i===this.stackTop&&(this.current=t)}insertAfter(e,t,i){const r=this._indexOf(e)+1;this.items.splice(r,0,t),this.tagIDs.splice(r,0,i),this.stackTop++,r===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,r===this.stackTop)}popUntilTagNamePopped(e){let t=this.stackTop+1;do t=this.tagIDs.lastIndexOf(e,t-1);while(t>0&&this.treeAdapter.getNamespaceURI(this.items[t])!==Oe.HTML);this.shortenToLength(Math.max(t,0))}shortenToLength(e){for(;this.stackTop>=e;){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,this.stackTop<e)}}popUntilElementPopped(e){const t=this._indexOf(e);this.shortenToLength(Math.max(t,0))}popUntilPopped(e,t){const i=this._indexOfTagNames(e,t);this.shortenToLength(Math.max(i,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(nv,Oe.HTML)}popUntilTableCellPopped(){this.popUntilPopped(T5,Oe.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,t){for(let i=this.stackTop;i>=0;i--)if(e.has(this.tagIDs[i])&&this.treeAdapter.getNamespaceURI(this.items[i])===t)return i;return-1}clearBackTo(e,t){const i=this._indexOfTagNames(e,t);this.shortenToLength(i+1)}clearBackToTableContext(){this.clearBackTo(b5,Oe.HTML)}clearBackToTableBodyContext(){this.clearBackTo(E5,Oe.HTML)}clearBackToTableRowContext(){this.clearBackTo(y5,Oe.HTML)}remove(e){const t=this._indexOf(e);t>=0&&(t===this.stackTop?this.pop():(this.items.splice(t,1),this.tagIDs.splice(t,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===C.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const t=this._indexOf(e)-1;return t>=0?this.items[t]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===C.HTML}hasInDynamicScope(e,t){for(let i=this.stackTop;i>=0;i--){const r=this.tagIDs[i];switch(this.treeAdapter.getNamespaceURI(this.items[i])){case Oe.HTML:{if(r===e)return!0;if(t.has(r))return!1;break}case Oe.SVG:{if(Dx.has(r))return!1;break}case Oe.MATHML:{if(kx.has(r))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,Pf)}hasInListItemScope(e){return this.hasInDynamicScope(e,g5)}hasInButtonScope(e){return this.hasInDynamicScope(e,v5)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const t=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case Oe.HTML:{if(nv.has(t))return!0;if(Pf.has(t))return!1;break}case Oe.SVG:{if(Dx.has(t))return!1;break}case Oe.MATHML:{if(kx.has(t))return!1;break}}}return!0}hasInTableScope(e){for(let t=this.stackTop;t>=0;t--)if(this.treeAdapter.getNamespaceURI(this.items[t])===Oe.HTML)switch(this.tagIDs[t]){case e:return!0;case C.TABLE:case C.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===Oe.HTML)switch(this.tagIDs[e]){case C.TBODY:case C.THEAD:case C.TFOOT:return!0;case C.TABLE:case C.HTML:return!1}return!0}hasInSelectScope(e){for(let t=this.stackTop;t>=0;t--)if(this.treeAdapter.getNamespaceURI(this.items[t])===Oe.HTML)switch(this.tagIDs[t]){case e:return!0;case C.OPTION:case C.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&FI.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&Px.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==void 0&&this.currentTagId!==e&&Px.has(this.currentTagId);)this.pop()}}const V0=3;var pr;(function(n){n[n.Marker=0]="Marker",n[n.Element=1]="Element"})(pr||(pr={}));const Ox={type:pr.Marker};class S5{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,t){const i=[],r=t.length,s=this.treeAdapter.getTagName(e),a=this.treeAdapter.getNamespaceURI(e);for(let o=0;o<this.entries.length;o++){const l=this.entries[o];if(l.type===pr.Marker)break;const{element:u}=l;if(this.treeAdapter.getTagName(u)===s&&this.treeAdapter.getNamespaceURI(u)===a){const c=this.treeAdapter.getAttrList(u);c.length===r&&i.push({idx:o,attrs:c})}}return i}_ensureNoahArkCondition(e){if(this.entries.length<V0)return;const t=this.treeAdapter.getAttrList(e),i=this._getNoahArkConditionCandidates(e,t);if(i.length<V0)return;const r=new Map(t.map(a=>[a.name,a.value]));let s=0;for(let a=0;a<i.length;a++){const o=i[a];o.attrs.every(l=>r.get(l.name)===l.value)&&(s+=1,s>=V0&&this.entries.splice(o.idx,1))}}insertMarker(){this.entries.unshift(Ox)}pushElement(e,t){this._ensureNoahArkCondition(e),this.entries.unshift({type:pr.Element,element:e,token:t})}insertElementAfterBookmark(e,t){const i=this.entries.indexOf(this.bookmark);this.entries.splice(i,0,{type:pr.Element,element:e,token:t})}removeEntry(e){const t=this.entries.indexOf(e);t!==-1&&this.entries.splice(t,1)}clearToLastMarker(){const e=this.entries.indexOf(Ox);e===-1?this.entries.length=0:this.entries.splice(0,e+1)}getElementEntryInScopeWithTagName(e){const t=this.entries.find(i=>i.type===pr.Marker||this.treeAdapter.getTagName(i.element)===e);return t&&t.type===pr.Element?t:null}getElementEntry(e){return this.entries.find(t=>t.type===pr.Element&&t.element===e)}}const Ns={createDocument(){return{nodeName:"#document",mode:ki.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(n,e,t){return{nodeName:n,tagName:n,attrs:t,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(n){return{nodeName:"#comment",data:n,parentNode:null}},createTextNode(n){return{nodeName:"#text",value:n,parentNode:null}},appendChild(n,e){n.childNodes.push(e),e.parentNode=n},insertBefore(n,e,t){const i=n.childNodes.indexOf(t);n.childNodes.splice(i,0,e),e.parentNode=n},setTemplateContent(n,e){n.content=e},getTemplateContent(n){return n.content},setDocumentType(n,e,t,i){const r=n.childNodes.find(s=>s.nodeName==="#documentType");if(r)r.name=e,r.publicId=t,r.systemId=i;else{const s={nodeName:"#documentType",name:e,publicId:t,systemId:i,parentNode:null};Ns.appendChild(n,s)}},setDocumentMode(n,e){n.mode=e},getDocumentMode(n){return n.mode},detachNode(n){if(n.parentNode){const e=n.parentNode.childNodes.indexOf(n);n.parentNode.childNodes.splice(e,1),n.parentNode=null}},insertText(n,e){if(n.childNodes.length>0){const t=n.childNodes[n.childNodes.length-1];if(Ns.isTextNode(t)){t.value+=e;return}}Ns.appendChild(n,Ns.createTextNode(e))},insertTextBefore(n,e,t){const i=n.childNodes[n.childNodes.indexOf(t)-1];i&&Ns.isTextNode(i)?i.value+=e:Ns.insertBefore(n,Ns.createTextNode(e),t)},adoptAttributes(n,e){const t=new Set(n.attrs.map(i=>i.name));for(let i=0;i<e.length;i++)t.has(e[i].name)||n.attrs.push(e[i])},getFirstChild(n){return n.childNodes[0]},getChildNodes(n){return n.childNodes},getParentNode(n){return n.parentNode},getAttrList(n){return n.attrs},getTagName(n){return n.tagName},getNamespaceURI(n){return n.namespaceURI},getTextNodeContent(n){return n.value},getCommentNodeContent(n){return n.data},getDocumentTypeNodeName(n){return n.name},getDocumentTypeNodePublicId(n){return n.publicId},getDocumentTypeNodeSystemId(n){return n.systemId},isTextNode(n){return n.nodeName==="#text"},isCommentNode(n){return n.nodeName==="#comment"},isDocumentTypeNode(n){return n.nodeName==="#documentType"},isElementNode(n){return Object.prototype.hasOwnProperty.call(n,"tagName")},setNodeSourceCodeLocation(n,e){n.sourceCodeLocation=e},getNodeSourceCodeLocation(n){return n.sourceCodeLocation},updateNodeSourceCodeLocation(n,e){n.sourceCodeLocation={...n.sourceCodeLocation,...e}}},BI="html",w5="about:legacy-compat",A5="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",UI=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],C5=[...UI,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],I5=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),HI=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],R5=[...HI,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function Nx(n,e){return e.some(t=>n.startsWith(t))}function _5(n){return n.name===BI&&n.publicId===null&&(n.systemId===null||n.systemId===w5)}function L5(n){if(n.name!==BI)return ki.QUIRKS;const{systemId:e}=n;if(e&&e.toLowerCase()===A5)return ki.QUIRKS;let{publicId:t}=n;if(t!==null){if(t=t.toLowerCase(),I5.has(t))return ki.QUIRKS;let i=e===null?C5:UI;if(Nx(t,i))return ki.QUIRKS;if(i=e===null?HI:R5,Nx(t,i))return ki.LIMITED_QUIRKS}return ki.NO_QUIRKS}const Mx={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},P5="definitionurl",k5="definitionURL",D5=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(n=>[n.toLowerCase(),n])),O5=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:Oe.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:Oe.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:Oe.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:Oe.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:Oe.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:Oe.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:Oe.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:Oe.XML}],["xml:space",{prefix:"xml",name:"space",namespace:Oe.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:Oe.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:Oe.XMLNS}]]),N5=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(n=>[n.toLowerCase(),n])),M5=new Set([C.B,C.BIG,C.BLOCKQUOTE,C.BODY,C.BR,C.CENTER,C.CODE,C.DD,C.DIV,C.DL,C.DT,C.EM,C.EMBED,C.H1,C.H2,C.H3,C.H4,C.H5,C.H6,C.HEAD,C.HR,C.I,C.IMG,C.LI,C.LISTING,C.MENU,C.META,C.NOBR,C.OL,C.P,C.PRE,C.RUBY,C.S,C.SMALL,C.SPAN,C.STRONG,C.STRIKE,C.SUB,C.SUP,C.TABLE,C.TT,C.U,C.UL,C.VAR]);function F5(n){const e=n.tagID;return e===C.FONT&&n.attrs.some(({name:i})=>i===Fa.COLOR||i===Fa.SIZE||i===Fa.FACE)||M5.has(e)}function zI(n){for(let e=0;e<n.attrs.length;e++)if(n.attrs[e].name===P5){n.attrs[e].name=k5;break}}function jI(n){for(let e=0;e<n.attrs.length;e++){const t=D5.get(n.attrs[e].name);t!=null&&(n.attrs[e].name=t)}}function Iy(n){for(let e=0;e<n.attrs.length;e++){const t=O5.get(n.attrs[e].name);t&&(n.attrs[e].prefix=t.prefix,n.attrs[e].name=t.name,n.attrs[e].namespace=t.namespace)}}function B5(n){const e=N5.get(n.tagName);e!=null&&(n.tagName=e,n.tagID=fu(n.tagName))}function U5(n,e){return e===Oe.MATHML&&(n===C.MI||n===C.MO||n===C.MN||n===C.MS||n===C.MTEXT)}function H5(n,e,t){if(e===Oe.MATHML&&n===C.ANNOTATION_XML){for(let i=0;i<t.length;i++)if(t[i].name===Fa.ENCODING){const r=t[i].value.toLowerCase();return r===Mx.TEXT_HTML||r===Mx.APPLICATION_XML}}return e===Oe.SVG&&(n===C.FOREIGN_OBJECT||n===C.DESC||n===C.TITLE)}function z5(n,e,t,i){return(!i||i===Oe.HTML)&&H5(n,e,t)||(!i||i===Oe.MATHML)&&U5(n,e)}const j5="hidden",V5=8,G5=3;var ie;(function(n){n[n.INITIAL=0]="INITIAL",n[n.BEFORE_HTML=1]="BEFORE_HTML",n[n.BEFORE_HEAD=2]="BEFORE_HEAD",n[n.IN_HEAD=3]="IN_HEAD",n[n.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",n[n.AFTER_HEAD=5]="AFTER_HEAD",n[n.IN_BODY=6]="IN_BODY",n[n.TEXT=7]="TEXT",n[n.IN_TABLE=8]="IN_TABLE",n[n.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",n[n.IN_CAPTION=10]="IN_CAPTION",n[n.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",n[n.IN_TABLE_BODY=12]="IN_TABLE_BODY",n[n.IN_ROW=13]="IN_ROW",n[n.IN_CELL=14]="IN_CELL",n[n.IN_SELECT=15]="IN_SELECT",n[n.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",n[n.IN_TEMPLATE=17]="IN_TEMPLATE",n[n.AFTER_BODY=18]="AFTER_BODY",n[n.IN_FRAMESET=19]="IN_FRAMESET",n[n.AFTER_FRAMESET=20]="AFTER_FRAMESET",n[n.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",n[n.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(ie||(ie={}));const W5={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},VI=new Set([C.TABLE,C.TBODY,C.TFOOT,C.THEAD,C.TR]),Fx={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Ns,onParseError:null};let Bx=class{constructor(e,t,i=null,r=null){this.fragmentContext=i,this.scriptHandler=r,this.currentToken=null,this.stopped=!1,this.insertionMode=ie.INITIAL,this.originalInsertionMode=ie.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...Fx,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=t??this.treeAdapter.createDocument(),this.tokenizer=new m5(this.options,this),this.activeFormattingElements=new S5(this.treeAdapter),this.fragmentContextID=i?fu(this.treeAdapter.getTagName(i)):C.UNKNOWN,this._setContextModes(i??this.document,this.fragmentContextID),this.openElements=new x5(this.document,this.treeAdapter,this)}static parse(e,t){const i=new this(t);return i.tokenizer.write(e,!0),i.document}static getFragmentParser(e,t){const i={...Fx,...t};e??(e=i.treeAdapter.createElement(me.TEMPLATE,Oe.HTML,[]));const r=i.treeAdapter.createElement("documentmock",Oe.HTML,[]),s=new this(i,r,e);return s.fragmentContextID===C.TEMPLATE&&s.tmplInsertionModeStack.unshift(ie.IN_TEMPLATE),s._initTokenizerForFragmentParsing(),s._insertFakeRootElement(),s._resetInsertionMode(),s._findFormInFragmentContext(),s}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),t=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,t),t}_err(e,t,i){var r;if(!this.onParseError)return;const s=(r=e.location)!==null&&r!==void 0?r:W5,a={code:t,startLine:s.startLine,startCol:s.startCol,startOffset:s.startOffset,endLine:i?s.startLine:s.endLine,endCol:i?s.startCol:s.endCol,endOffset:i?s.startOffset:s.endOffset};this.onParseError(a)}onItemPush(e,t,i){var r,s;(s=(r=this.treeAdapter).onItemPush)===null||s===void 0||s.call(r,e),i&&this.openElements.stackTop>0&&this._setContextModes(e,t)}onItemPop(e,t){var i,r;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(r=(i=this.treeAdapter).onItemPop)===null||r===void 0||r.call(i,e,this.openElements.current),t){let s,a;this.openElements.stackTop===0&&this.fragmentContext?(s=this.fragmentContext,a=this.fragmentContextID):{current:s,currentTagId:a}=this.openElements,this._setContextModes(s,a)}}_setContextModes(e,t){const i=e===this.document||e&&this.treeAdapter.getNamespaceURI(e)===Oe.HTML;this.currentNotInHTML=!i,this.tokenizer.inForeignNode=!i&&e!==void 0&&t!==void 0&&!this._isIntegrationPoint(t,e)}_switchToTextParsing(e,t){this._insertElement(e,Oe.HTML),this.tokenizer.state=t,this.originalInsertionMode=this.insertionMode,this.insertionMode=ie.TEXT}switchToPlaintextParsing(){this.insertionMode=ie.TEXT,this.originalInsertionMode=ie.IN_BODY,this.tokenizer.state=on.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===me.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==Oe.HTML))switch(this.fragmentContextID){case C.TITLE:case C.TEXTAREA:{this.tokenizer.state=on.RCDATA;break}case C.STYLE:case C.XMP:case C.IFRAME:case C.NOEMBED:case C.NOFRAMES:case C.NOSCRIPT:{this.tokenizer.state=on.RAWTEXT;break}case C.SCRIPT:{this.tokenizer.state=on.SCRIPT_DATA;break}case C.PLAINTEXT:{this.tokenizer.state=on.PLAINTEXT;break}}}_setDocumentType(e){const t=e.name||"",i=e.publicId||"",r=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,t,i,r),e.location){const a=this.treeAdapter.getChildNodes(this.document).find(o=>this.treeAdapter.isDocumentTypeNode(o));a&&this.treeAdapter.setNodeSourceCodeLocation(a,e.location)}}_attachElementToTree(e,t){if(this.options.sourceCodeLocationInfo){const i=t&&{...t,startTag:t};this.treeAdapter.setNodeSourceCodeLocation(e,i)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const i=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(i??this.document,e)}}_appendElement(e,t){const i=this.treeAdapter.createElement(e.tagName,t,e.attrs);this._attachElementToTree(i,e.location)}_insertElement(e,t){const i=this.treeAdapter.createElement(e.tagName,t,e.attrs);this._attachElementToTree(i,e.location),this.openElements.push(i,e.tagID)}_insertFakeElement(e,t){const i=this.treeAdapter.createElement(e,Oe.HTML,[]);this._attachElementToTree(i,null),this.openElements.push(i,t)}_insertTemplate(e){const t=this.treeAdapter.createElement(e.tagName,Oe.HTML,e.attrs),i=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(t,i),this._attachElementToTree(t,e.location),this.openElements.push(t,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(me.HTML,Oe.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,C.HTML)}_appendCommentNode(e,t){const i=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(t,i),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}_insertCharacters(e){let t,i;if(this._shouldFosterParentOnInsertion()?({parent:t,beforeElement:i}=this._findFosterParentingLocation(),i?this.treeAdapter.insertTextBefore(t,e.chars,i):this.treeAdapter.insertText(t,e.chars)):(t=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(t,e.chars)),!e.location)return;const r=this.treeAdapter.getChildNodes(t),s=i?r.lastIndexOf(i):r.length,a=r[s-1];if(this.treeAdapter.getNodeSourceCodeLocation(a)){const{endLine:l,endCol:u,endOffset:c}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(a,{endLine:l,endCol:u,endOffset:c})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(a,e.location)}_adoptNodes(e,t){for(let i=this.treeAdapter.getFirstChild(e);i;i=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(i),this.treeAdapter.appendChild(t,i)}_setEndLocation(e,t){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&t.location){const i=t.location,r=this.treeAdapter.getTagName(e),s=t.type===At.END_TAG&&r===t.tagName?{endTag:{...i},endLine:i.endLine,endCol:i.endCol,endOffset:i.endOffset}:{endLine:i.startLine,endCol:i.startCol,endOffset:i.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,s)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let t,i;return this.openElements.stackTop===0&&this.fragmentContext?(t=this.fragmentContext,i=this.fragmentContextID):{current:t,currentTagId:i}=this.openElements,e.tagID===C.SVG&&this.treeAdapter.getTagName(t)===me.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(t)===Oe.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===C.MGLYPH||e.tagID===C.MALIGNMARK)&&i!==void 0&&!this._isIntegrationPoint(i,t,Oe.HTML)}_processToken(e){switch(e.type){case At.CHARACTER:{this.onCharacter(e);break}case At.NULL_CHARACTER:{this.onNullCharacter(e);break}case At.COMMENT:{this.onComment(e);break}case At.DOCTYPE:{this.onDoctype(e);break}case At.START_TAG:{this._processStartTag(e);break}case At.END_TAG:{this.onEndTag(e);break}case At.EOF:{this.onEof(e);break}case At.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,t,i){const r=this.treeAdapter.getNamespaceURI(t),s=this.treeAdapter.getAttrList(t);return z5(e,r,s,i)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const t=this.activeFormattingElements.entries.findIndex(r=>r.type===pr.Marker||this.openElements.contains(r.element)),i=t===-1?e-1:t-1;for(let r=i;r>=0;r--){const s=this.activeFormattingElements.entries[r];this._insertElement(s.token,this.treeAdapter.getNamespaceURI(s.element)),s.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=ie.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(C.P),this.openElements.popUntilTagNamePopped(C.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case C.TR:{this.insertionMode=ie.IN_ROW;return}case C.TBODY:case C.THEAD:case C.TFOOT:{this.insertionMode=ie.IN_TABLE_BODY;return}case C.CAPTION:{this.insertionMode=ie.IN_CAPTION;return}case C.COLGROUP:{this.insertionMode=ie.IN_COLUMN_GROUP;return}case C.TABLE:{this.insertionMode=ie.IN_TABLE;return}case C.BODY:{this.insertionMode=ie.IN_BODY;return}case C.FRAMESET:{this.insertionMode=ie.IN_FRAMESET;return}case C.SELECT:{this._resetInsertionModeForSelect(e);return}case C.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case C.HTML:{this.insertionMode=this.headElement?ie.AFTER_HEAD:ie.BEFORE_HEAD;return}case C.TD:case C.TH:{if(e>0){this.insertionMode=ie.IN_CELL;return}break}case C.HEAD:{if(e>0){this.insertionMode=ie.IN_HEAD;return}break}}this.insertionMode=ie.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let t=e-1;t>0;t--){const i=this.openElements.tagIDs[t];if(i===C.TEMPLATE)break;if(i===C.TABLE){this.insertionMode=ie.IN_SELECT_IN_TABLE;return}}this.insertionMode=ie.IN_SELECT}_isElementCausesFosterParenting(e){return VI.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const t=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case C.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(t)===Oe.HTML)return{parent:this.treeAdapter.getTemplateContent(t),beforeElement:null};break}case C.TABLE:{const i=this.treeAdapter.getParentNode(t);return i?{parent:i,beforeElement:t}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const t=this._findFosterParentingLocation();t.beforeElement?this.treeAdapter.insertBefore(t.parent,e,t.beforeElement):this.treeAdapter.appendChild(t.parent,e)}_isSpecialElement(e,t){const i=this.treeAdapter.getNamespaceURI(e);return d5[i].has(t)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){T9(this,e);return}switch(this.insertionMode){case ie.INITIAL:{ol(this,e);break}case ie.BEFORE_HTML:{Sl(this,e);break}case ie.BEFORE_HEAD:{wl(this,e);break}case ie.IN_HEAD:{Al(this,e);break}case ie.IN_HEAD_NO_SCRIPT:{Cl(this,e);break}case ie.AFTER_HEAD:{Il(this,e);break}case ie.IN_BODY:case ie.IN_CAPTION:case ie.IN_CELL:case ie.IN_TEMPLATE:{WI(this,e);break}case ie.TEXT:case ie.IN_SELECT:case ie.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case ie.IN_TABLE:case ie.IN_TABLE_BODY:case ie.IN_ROW:{G0(this,e);break}case ie.IN_TABLE_TEXT:{QI(this,e);break}case ie.IN_COLUMN_GROUP:{kf(this,e);break}case ie.AFTER_BODY:{Df(this,e);break}case ie.AFTER_AFTER_BODY:{cf(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){b9(this,e);return}switch(this.insertionMode){case ie.INITIAL:{ol(this,e);break}case ie.BEFORE_HTML:{Sl(this,e);break}case ie.BEFORE_HEAD:{wl(this,e);break}case ie.IN_HEAD:{Al(this,e);break}case ie.IN_HEAD_NO_SCRIPT:{Cl(this,e);break}case ie.AFTER_HEAD:{Il(this,e);break}case ie.TEXT:{this._insertCharacters(e);break}case ie.IN_TABLE:case ie.IN_TABLE_BODY:case ie.IN_ROW:{G0(this,e);break}case ie.IN_COLUMN_GROUP:{kf(this,e);break}case ie.AFTER_BODY:{Df(this,e);break}case ie.AFTER_AFTER_BODY:{cf(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){iv(this,e);return}switch(this.insertionMode){case ie.INITIAL:case ie.BEFORE_HTML:case ie.BEFORE_HEAD:case ie.IN_HEAD:case ie.IN_HEAD_NO_SCRIPT:case ie.AFTER_HEAD:case ie.IN_BODY:case ie.IN_TABLE:case ie.IN_CAPTION:case ie.IN_COLUMN_GROUP:case ie.IN_TABLE_BODY:case ie.IN_ROW:case ie.IN_CELL:case ie.IN_SELECT:case ie.IN_SELECT_IN_TABLE:case ie.IN_TEMPLATE:case ie.IN_FRAMESET:case ie.AFTER_FRAMESET:{iv(this,e);break}case ie.IN_TABLE_TEXT:{ul(this,e);break}case ie.AFTER_BODY:{Z5(this,e);break}case ie.AFTER_AFTER_BODY:case ie.AFTER_AFTER_FRAMESET:{J5(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case ie.INITIAL:{eB(this,e);break}case ie.BEFORE_HEAD:case ie.IN_HEAD:case ie.IN_HEAD_NO_SCRIPT:case ie.AFTER_HEAD:{this._err(e,xe.misplacedDoctype);break}case ie.IN_TABLE_TEXT:{ul(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,xe.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?x9(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case ie.INITIAL:{ol(this,e);break}case ie.BEFORE_HTML:{tB(this,e);break}case ie.BEFORE_HEAD:{iB(this,e);break}case ie.IN_HEAD:{nr(this,e);break}case ie.IN_HEAD_NO_SCRIPT:{aB(this,e);break}case ie.AFTER_HEAD:{uB(this,e);break}case ie.IN_BODY:{zn(this,e);break}case ie.IN_TABLE:{nu(this,e);break}case ie.IN_TABLE_TEXT:{ul(this,e);break}case ie.IN_CAPTION:{r9(this,e);break}case ie.IN_COLUMN_GROUP:{Ly(this,e);break}case ie.IN_TABLE_BODY:{dh(this,e);break}case ie.IN_ROW:{fh(this,e);break}case ie.IN_CELL:{o9(this,e);break}case ie.IN_SELECT:{eR(this,e);break}case ie.IN_SELECT_IN_TABLE:{l9(this,e);break}case ie.IN_TEMPLATE:{d9(this,e);break}case ie.AFTER_BODY:{h9(this,e);break}case ie.IN_FRAMESET:{p9(this,e);break}case ie.AFTER_FRAMESET:{g9(this,e);break}case ie.AFTER_AFTER_BODY:{y9(this,e);break}case ie.AFTER_AFTER_FRAMESET:{E9(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?S9(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case ie.INITIAL:{ol(this,e);break}case ie.BEFORE_HTML:{nB(this,e);break}case ie.BEFORE_HEAD:{rB(this,e);break}case ie.IN_HEAD:{sB(this,e);break}case ie.IN_HEAD_NO_SCRIPT:{oB(this,e);break}case ie.AFTER_HEAD:{lB(this,e);break}case ie.IN_BODY:{ch(this,e);break}case ie.TEXT:{KB(this,e);break}case ie.IN_TABLE:{Bl(this,e);break}case ie.IN_TABLE_TEXT:{ul(this,e);break}case ie.IN_CAPTION:{s9(this,e);break}case ie.IN_COLUMN_GROUP:{a9(this,e);break}case ie.IN_TABLE_BODY:{rv(this,e);break}case ie.IN_ROW:{JI(this,e);break}case ie.IN_CELL:{u9(this,e);break}case ie.IN_SELECT:{tR(this,e);break}case ie.IN_SELECT_IN_TABLE:{c9(this,e);break}case ie.IN_TEMPLATE:{f9(this,e);break}case ie.AFTER_BODY:{iR(this,e);break}case ie.IN_FRAMESET:{m9(this,e);break}case ie.AFTER_FRAMESET:{v9(this,e);break}case ie.AFTER_AFTER_BODY:{cf(this,e);break}}}onEof(e){switch(this.insertionMode){case ie.INITIAL:{ol(this,e);break}case ie.BEFORE_HTML:{Sl(this,e);break}case ie.BEFORE_HEAD:{wl(this,e);break}case ie.IN_HEAD:{Al(this,e);break}case ie.IN_HEAD_NO_SCRIPT:{Cl(this,e);break}case ie.AFTER_HEAD:{Il(this,e);break}case ie.IN_BODY:case ie.IN_TABLE:case ie.IN_CAPTION:case ie.IN_COLUMN_GROUP:case ie.IN_TABLE_BODY:case ie.IN_ROW:case ie.IN_CELL:case ie.IN_SELECT:case ie.IN_SELECT_IN_TABLE:{YI(this,e);break}case ie.TEXT:{YB(this,e);break}case ie.IN_TABLE_TEXT:{ul(this,e);break}case ie.IN_TEMPLATE:{nR(this,e);break}case ie.AFTER_BODY:case ie.IN_FRAMESET:case ie.AFTER_FRAMESET:case ie.AFTER_AFTER_BODY:case ie.AFTER_AFTER_FRAMESET:{_y(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===K.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case ie.IN_HEAD:case ie.IN_HEAD_NO_SCRIPT:case ie.AFTER_HEAD:case ie.TEXT:case ie.IN_COLUMN_GROUP:case ie.IN_SELECT:case ie.IN_SELECT_IN_TABLE:case ie.IN_FRAMESET:case ie.AFTER_FRAMESET:{this._insertCharacters(e);break}case ie.IN_BODY:case ie.IN_CAPTION:case ie.IN_CELL:case ie.IN_TEMPLATE:case ie.AFTER_BODY:case ie.AFTER_AFTER_BODY:case ie.AFTER_AFTER_FRAMESET:{GI(this,e);break}case ie.IN_TABLE:case ie.IN_TABLE_BODY:case ie.IN_ROW:{G0(this,e);break}case ie.IN_TABLE_TEXT:{XI(this,e);break}}}};function q5(n,e){let t=n.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return t?n.openElements.contains(t.element)?n.openElements.hasInScope(e.tagID)||(t=null):(n.activeFormattingElements.removeEntry(t),t=null):KI(n,e),t}function $5(n,e){let t=null,i=n.openElements.stackTop;for(;i>=0;i--){const r=n.openElements.items[i];if(r===e.element)break;n._isSpecialElement(r,n.openElements.tagIDs[i])&&(t=r)}return t||(n.openElements.shortenToLength(Math.max(i,0)),n.activeFormattingElements.removeEntry(e)),t}function K5(n,e,t){let i=e,r=n.openElements.getCommonAncestor(e);for(let s=0,a=r;a!==t;s++,a=r){r=n.openElements.getCommonAncestor(a);const o=n.activeFormattingElements.getElementEntry(a),l=o&&s>=G5;!o||l?(l&&n.activeFormattingElements.removeEntry(o),n.openElements.remove(a)):(a=Y5(n,o),i===e&&(n.activeFormattingElements.bookmark=o),n.treeAdapter.detachNode(i),n.treeAdapter.appendChild(a,i),i=a)}return i}function Y5(n,e){const t=n.treeAdapter.getNamespaceURI(e.element),i=n.treeAdapter.createElement(e.token.tagName,t,e.token.attrs);return n.openElements.replace(e.element,i),e.element=i,i}function X5(n,e,t){const i=n.treeAdapter.getTagName(e),r=fu(i);if(n._isElementCausesFosterParenting(r))n._fosterParentElement(t);else{const s=n.treeAdapter.getNamespaceURI(e);r===C.TEMPLATE&&s===Oe.HTML&&(e=n.treeAdapter.getTemplateContent(e)),n.treeAdapter.appendChild(e,t)}}function Q5(n,e,t){const i=n.treeAdapter.getNamespaceURI(t.element),{token:r}=t,s=n.treeAdapter.createElement(r.tagName,i,r.attrs);n._adoptNodes(e,s),n.treeAdapter.appendChild(e,s),n.activeFormattingElements.insertElementAfterBookmark(s,r),n.activeFormattingElements.removeEntry(t),n.openElements.remove(t.element),n.openElements.insertAfter(e,s,r.tagID)}function Ry(n,e){for(let t=0;t<V5;t++){const i=q5(n,e);if(!i)break;const r=$5(n,i);if(!r)break;n.activeFormattingElements.bookmark=i;const s=K5(n,r,i.element),a=n.openElements.getCommonAncestor(i.element);n.treeAdapter.detachNode(s),a&&X5(n,a,s),Q5(n,r,i)}}function iv(n,e){n._appendCommentNode(e,n.openElements.currentTmplContentOrNode)}function Z5(n,e){n._appendCommentNode(e,n.openElements.items[0])}function J5(n,e){n._appendCommentNode(e,n.document)}function _y(n,e){if(n.stopped=!0,e.location){const t=n.fragmentContext?0:2;for(let i=n.openElements.stackTop;i>=t;i--)n._setEndLocation(n.openElements.items[i],e);if(!n.fragmentContext&&n.openElements.stackTop>=0){const i=n.openElements.items[0],r=n.treeAdapter.getNodeSourceCodeLocation(i);if(r&&!r.endTag&&(n._setEndLocation(i,e),n.openElements.stackTop>=1)){const s=n.openElements.items[1],a=n.treeAdapter.getNodeSourceCodeLocation(s);a&&!a.endTag&&n._setEndLocation(s,e)}}}}function eB(n,e){n._setDocumentType(e);const t=e.forceQuirks?ki.QUIRKS:L5(e);_5(e)||n._err(e,xe.nonConformingDoctype),n.treeAdapter.setDocumentMode(n.document,t),n.insertionMode=ie.BEFORE_HTML}function ol(n,e){n._err(e,xe.missingDoctype,!0),n.treeAdapter.setDocumentMode(n.document,ki.QUIRKS),n.insertionMode=ie.BEFORE_HTML,n._processToken(e)}function tB(n,e){e.tagID===C.HTML?(n._insertElement(e,Oe.HTML),n.insertionMode=ie.BEFORE_HEAD):Sl(n,e)}function nB(n,e){const t=e.tagID;(t===C.HTML||t===C.HEAD||t===C.BODY||t===C.BR)&&Sl(n,e)}function Sl(n,e){n._insertFakeRootElement(),n.insertionMode=ie.BEFORE_HEAD,n._processToken(e)}function iB(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.HEAD:{n._insertElement(e,Oe.HTML),n.headElement=n.openElements.current,n.insertionMode=ie.IN_HEAD;break}default:wl(n,e)}}function rB(n,e){const t=e.tagID;t===C.HEAD||t===C.BODY||t===C.HTML||t===C.BR?wl(n,e):n._err(e,xe.endTagWithoutMatchingOpenElement)}function wl(n,e){n._insertFakeElement(me.HEAD,C.HEAD),n.headElement=n.openElements.current,n.insertionMode=ie.IN_HEAD,n._processToken(e)}function nr(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.BASE:case C.BASEFONT:case C.BGSOUND:case C.LINK:case C.META:{n._appendElement(e,Oe.HTML),e.ackSelfClosing=!0;break}case C.TITLE:{n._switchToTextParsing(e,on.RCDATA);break}case C.NOSCRIPT:{n.options.scriptingEnabled?n._switchToTextParsing(e,on.RAWTEXT):(n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_HEAD_NO_SCRIPT);break}case C.NOFRAMES:case C.STYLE:{n._switchToTextParsing(e,on.RAWTEXT);break}case C.SCRIPT:{n._switchToTextParsing(e,on.SCRIPT_DATA);break}case C.TEMPLATE:{n._insertTemplate(e),n.activeFormattingElements.insertMarker(),n.framesetOk=!1,n.insertionMode=ie.IN_TEMPLATE,n.tmplInsertionModeStack.unshift(ie.IN_TEMPLATE);break}case C.HEAD:{n._err(e,xe.misplacedStartTagForHeadElement);break}default:Al(n,e)}}function sB(n,e){switch(e.tagID){case C.HEAD:{n.openElements.pop(),n.insertionMode=ie.AFTER_HEAD;break}case C.BODY:case C.BR:case C.HTML:{Al(n,e);break}case C.TEMPLATE:{Ya(n,e);break}default:n._err(e,xe.endTagWithoutMatchingOpenElement)}}function Ya(n,e){n.openElements.tmplCount>0?(n.openElements.generateImpliedEndTagsThoroughly(),n.openElements.currentTagId!==C.TEMPLATE&&n._err(e,xe.closingOfElementWithOpenChildElements),n.openElements.popUntilTagNamePopped(C.TEMPLATE),n.activeFormattingElements.clearToLastMarker(),n.tmplInsertionModeStack.shift(),n._resetInsertionMode()):n._err(e,xe.endTagWithoutMatchingOpenElement)}function Al(n,e){n.openElements.pop(),n.insertionMode=ie.AFTER_HEAD,n._processToken(e)}function aB(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.BASEFONT:case C.BGSOUND:case C.HEAD:case C.LINK:case C.META:case C.NOFRAMES:case C.STYLE:{nr(n,e);break}case C.NOSCRIPT:{n._err(e,xe.nestedNoscriptInHead);break}default:Cl(n,e)}}function oB(n,e){switch(e.tagID){case C.NOSCRIPT:{n.openElements.pop(),n.insertionMode=ie.IN_HEAD;break}case C.BR:{Cl(n,e);break}default:n._err(e,xe.endTagWithoutMatchingOpenElement)}}function Cl(n,e){const t=e.type===At.EOF?xe.openElementsLeftAfterEof:xe.disallowedContentInNoscriptInHead;n._err(e,t),n.openElements.pop(),n.insertionMode=ie.IN_HEAD,n._processToken(e)}function uB(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.BODY:{n._insertElement(e,Oe.HTML),n.framesetOk=!1,n.insertionMode=ie.IN_BODY;break}case C.FRAMESET:{n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_FRAMESET;break}case C.BASE:case C.BASEFONT:case C.BGSOUND:case C.LINK:case C.META:case C.NOFRAMES:case C.SCRIPT:case C.STYLE:case C.TEMPLATE:case C.TITLE:{n._err(e,xe.abandonedHeadElementChild),n.openElements.push(n.headElement,C.HEAD),nr(n,e),n.openElements.remove(n.headElement);break}case C.HEAD:{n._err(e,xe.misplacedStartTagForHeadElement);break}default:Il(n,e)}}function lB(n,e){switch(e.tagID){case C.BODY:case C.HTML:case C.BR:{Il(n,e);break}case C.TEMPLATE:{Ya(n,e);break}default:n._err(e,xe.endTagWithoutMatchingOpenElement)}}function Il(n,e){n._insertFakeElement(me.BODY,C.BODY),n.insertionMode=ie.IN_BODY,lh(n,e)}function lh(n,e){switch(e.type){case At.CHARACTER:{WI(n,e);break}case At.WHITESPACE_CHARACTER:{GI(n,e);break}case At.COMMENT:{iv(n,e);break}case At.START_TAG:{zn(n,e);break}case At.END_TAG:{ch(n,e);break}case At.EOF:{YI(n,e);break}}}function GI(n,e){n._reconstructActiveFormattingElements(),n._insertCharacters(e)}function WI(n,e){n._reconstructActiveFormattingElements(),n._insertCharacters(e),n.framesetOk=!1}function cB(n,e){n.openElements.tmplCount===0&&n.treeAdapter.adoptAttributes(n.openElements.items[0],e.attrs)}function dB(n,e){const t=n.openElements.tryPeekProperlyNestedBodyElement();t&&n.openElements.tmplCount===0&&(n.framesetOk=!1,n.treeAdapter.adoptAttributes(t,e.attrs))}function fB(n,e){const t=n.openElements.tryPeekProperlyNestedBodyElement();n.framesetOk&&t&&(n.treeAdapter.detachNode(t),n.openElements.popAllUpToHtmlElement(),n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_FRAMESET)}function hB(n,e){n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._insertElement(e,Oe.HTML)}function pB(n,e){n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n.openElements.currentTagId!==void 0&&nv.has(n.openElements.currentTagId)&&n.openElements.pop(),n._insertElement(e,Oe.HTML)}function mB(n,e){n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._insertElement(e,Oe.HTML),n.skipNextNewLine=!0,n.framesetOk=!1}function gB(n,e){const t=n.openElements.tmplCount>0;(!n.formElement||t)&&(n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._insertElement(e,Oe.HTML),t||(n.formElement=n.openElements.current))}function vB(n,e){n.framesetOk=!1;const t=e.tagID;for(let i=n.openElements.stackTop;i>=0;i--){const r=n.openElements.tagIDs[i];if(t===C.LI&&r===C.LI||(t===C.DD||t===C.DT)&&(r===C.DD||r===C.DT)){n.openElements.generateImpliedEndTagsWithExclusion(r),n.openElements.popUntilTagNamePopped(r);break}if(r!==C.ADDRESS&&r!==C.DIV&&r!==C.P&&n._isSpecialElement(n.openElements.items[i],r))break}n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._insertElement(e,Oe.HTML)}function yB(n,e){n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._insertElement(e,Oe.HTML),n.tokenizer.state=on.PLAINTEXT}function EB(n,e){n.openElements.hasInScope(C.BUTTON)&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilTagNamePopped(C.BUTTON)),n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML),n.framesetOk=!1}function bB(n,e){const t=n.activeFormattingElements.getElementEntryInScopeWithTagName(me.A);t&&(Ry(n,e),n.openElements.remove(t.element),n.activeFormattingElements.removeEntry(t)),n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML),n.activeFormattingElements.pushElement(n.openElements.current,e)}function TB(n,e){n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML),n.activeFormattingElements.pushElement(n.openElements.current,e)}function xB(n,e){n._reconstructActiveFormattingElements(),n.openElements.hasInScope(C.NOBR)&&(Ry(n,e),n._reconstructActiveFormattingElements()),n._insertElement(e,Oe.HTML),n.activeFormattingElements.pushElement(n.openElements.current,e)}function SB(n,e){n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML),n.activeFormattingElements.insertMarker(),n.framesetOk=!1}function wB(n,e){n.treeAdapter.getDocumentMode(n.document)!==ki.QUIRKS&&n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._insertElement(e,Oe.HTML),n.framesetOk=!1,n.insertionMode=ie.IN_TABLE}function qI(n,e){n._reconstructActiveFormattingElements(),n._appendElement(e,Oe.HTML),n.framesetOk=!1,e.ackSelfClosing=!0}function $I(n){const e=NI(n,Fa.TYPE);return e!=null&&e.toLowerCase()===j5}function AB(n,e){n._reconstructActiveFormattingElements(),n._appendElement(e,Oe.HTML),$I(e)||(n.framesetOk=!1),e.ackSelfClosing=!0}function CB(n,e){n._appendElement(e,Oe.HTML),e.ackSelfClosing=!0}function IB(n,e){n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._appendElement(e,Oe.HTML),n.framesetOk=!1,e.ackSelfClosing=!0}function RB(n,e){e.tagName=me.IMG,e.tagID=C.IMG,qI(n,e)}function _B(n,e){n._insertElement(e,Oe.HTML),n.skipNextNewLine=!0,n.tokenizer.state=on.RCDATA,n.originalInsertionMode=n.insertionMode,n.framesetOk=!1,n.insertionMode=ie.TEXT}function LB(n,e){n.openElements.hasInButtonScope(C.P)&&n._closePElement(),n._reconstructActiveFormattingElements(),n.framesetOk=!1,n._switchToTextParsing(e,on.RAWTEXT)}function PB(n,e){n.framesetOk=!1,n._switchToTextParsing(e,on.RAWTEXT)}function Ux(n,e){n._switchToTextParsing(e,on.RAWTEXT)}function kB(n,e){n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML),n.framesetOk=!1,n.insertionMode=n.insertionMode===ie.IN_TABLE||n.insertionMode===ie.IN_CAPTION||n.insertionMode===ie.IN_TABLE_BODY||n.insertionMode===ie.IN_ROW||n.insertionMode===ie.IN_CELL?ie.IN_SELECT_IN_TABLE:ie.IN_SELECT}function DB(n,e){n.openElements.currentTagId===C.OPTION&&n.openElements.pop(),n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML)}function OB(n,e){n.openElements.hasInScope(C.RUBY)&&n.openElements.generateImpliedEndTags(),n._insertElement(e,Oe.HTML)}function NB(n,e){n.openElements.hasInScope(C.RUBY)&&n.openElements.generateImpliedEndTagsWithExclusion(C.RTC),n._insertElement(e,Oe.HTML)}function MB(n,e){n._reconstructActiveFormattingElements(),zI(e),Iy(e),e.selfClosing?n._appendElement(e,Oe.MATHML):n._insertElement(e,Oe.MATHML),e.ackSelfClosing=!0}function FB(n,e){n._reconstructActiveFormattingElements(),jI(e),Iy(e),e.selfClosing?n._appendElement(e,Oe.SVG):n._insertElement(e,Oe.SVG),e.ackSelfClosing=!0}function Hx(n,e){n._reconstructActiveFormattingElements(),n._insertElement(e,Oe.HTML)}function zn(n,e){switch(e.tagID){case C.I:case C.S:case C.B:case C.U:case C.EM:case C.TT:case C.BIG:case C.CODE:case C.FONT:case C.SMALL:case C.STRIKE:case C.STRONG:{TB(n,e);break}case C.A:{bB(n,e);break}case C.H1:case C.H2:case C.H3:case C.H4:case C.H5:case C.H6:{pB(n,e);break}case C.P:case C.DL:case C.OL:case C.UL:case C.DIV:case C.DIR:case C.NAV:case C.MAIN:case C.MENU:case C.ASIDE:case C.CENTER:case C.FIGURE:case C.FOOTER:case C.HEADER:case C.HGROUP:case C.DIALOG:case C.DETAILS:case C.ADDRESS:case C.ARTICLE:case C.SEARCH:case C.SECTION:case C.SUMMARY:case C.FIELDSET:case C.BLOCKQUOTE:case C.FIGCAPTION:{hB(n,e);break}case C.LI:case C.DD:case C.DT:{vB(n,e);break}case C.BR:case C.IMG:case C.WBR:case C.AREA:case C.EMBED:case C.KEYGEN:{qI(n,e);break}case C.HR:{IB(n,e);break}case C.RB:case C.RTC:{OB(n,e);break}case C.RT:case C.RP:{NB(n,e);break}case C.PRE:case C.LISTING:{mB(n,e);break}case C.XMP:{LB(n,e);break}case C.SVG:{FB(n,e);break}case C.HTML:{cB(n,e);break}case C.BASE:case C.LINK:case C.META:case C.STYLE:case C.TITLE:case C.SCRIPT:case C.BGSOUND:case C.BASEFONT:case C.TEMPLATE:{nr(n,e);break}case C.BODY:{dB(n,e);break}case C.FORM:{gB(n,e);break}case C.NOBR:{xB(n,e);break}case C.MATH:{MB(n,e);break}case C.TABLE:{wB(n,e);break}case C.INPUT:{AB(n,e);break}case C.PARAM:case C.TRACK:case C.SOURCE:{CB(n,e);break}case C.IMAGE:{RB(n,e);break}case C.BUTTON:{EB(n,e);break}case C.APPLET:case C.OBJECT:case C.MARQUEE:{SB(n,e);break}case C.IFRAME:{PB(n,e);break}case C.SELECT:{kB(n,e);break}case C.OPTION:case C.OPTGROUP:{DB(n,e);break}case C.NOEMBED:case C.NOFRAMES:{Ux(n,e);break}case C.FRAMESET:{fB(n,e);break}case C.TEXTAREA:{_B(n,e);break}case C.NOSCRIPT:{n.options.scriptingEnabled?Ux(n,e):Hx(n,e);break}case C.PLAINTEXT:{yB(n,e);break}case C.COL:case C.TH:case C.TD:case C.TR:case C.HEAD:case C.FRAME:case C.TBODY:case C.TFOOT:case C.THEAD:case C.CAPTION:case C.COLGROUP:break;default:Hx(n,e)}}function BB(n,e){if(n.openElements.hasInScope(C.BODY)&&(n.insertionMode=ie.AFTER_BODY,n.options.sourceCodeLocationInfo)){const t=n.openElements.tryPeekProperlyNestedBodyElement();t&&n._setEndLocation(t,e)}}function UB(n,e){n.openElements.hasInScope(C.BODY)&&(n.insertionMode=ie.AFTER_BODY,iR(n,e))}function HB(n,e){const t=e.tagID;n.openElements.hasInScope(t)&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilTagNamePopped(t))}function zB(n){const e=n.openElements.tmplCount>0,{formElement:t}=n;e||(n.formElement=null),(t||e)&&n.openElements.hasInScope(C.FORM)&&(n.openElements.generateImpliedEndTags(),e?n.openElements.popUntilTagNamePopped(C.FORM):t&&n.openElements.remove(t))}function jB(n){n.openElements.hasInButtonScope(C.P)||n._insertFakeElement(me.P,C.P),n._closePElement()}function VB(n){n.openElements.hasInListItemScope(C.LI)&&(n.openElements.generateImpliedEndTagsWithExclusion(C.LI),n.openElements.popUntilTagNamePopped(C.LI))}function GB(n,e){const t=e.tagID;n.openElements.hasInScope(t)&&(n.openElements.generateImpliedEndTagsWithExclusion(t),n.openElements.popUntilTagNamePopped(t))}function WB(n){n.openElements.hasNumberedHeaderInScope()&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilNumberedHeaderPopped())}function qB(n,e){const t=e.tagID;n.openElements.hasInScope(t)&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilTagNamePopped(t),n.activeFormattingElements.clearToLastMarker())}function $B(n){n._reconstructActiveFormattingElements(),n._insertFakeElement(me.BR,C.BR),n.openElements.pop(),n.framesetOk=!1}function KI(n,e){const t=e.tagName,i=e.tagID;for(let r=n.openElements.stackTop;r>0;r--){const s=n.openElements.items[r],a=n.openElements.tagIDs[r];if(i===a&&(i!==C.UNKNOWN||n.treeAdapter.getTagName(s)===t)){n.openElements.generateImpliedEndTagsWithExclusion(i),n.openElements.stackTop>=r&&n.openElements.shortenToLength(r);break}if(n._isSpecialElement(s,a))break}}function ch(n,e){switch(e.tagID){case C.A:case C.B:case C.I:case C.S:case C.U:case C.EM:case C.TT:case C.BIG:case C.CODE:case C.FONT:case C.NOBR:case C.SMALL:case C.STRIKE:case C.STRONG:{Ry(n,e);break}case C.P:{jB(n);break}case C.DL:case C.UL:case C.OL:case C.DIR:case C.DIV:case C.NAV:case C.PRE:case C.MAIN:case C.MENU:case C.ASIDE:case C.BUTTON:case C.CENTER:case C.FIGURE:case C.FOOTER:case C.HEADER:case C.HGROUP:case C.DIALOG:case C.ADDRESS:case C.ARTICLE:case C.DETAILS:case C.SEARCH:case C.SECTION:case C.SUMMARY:case C.LISTING:case C.FIELDSET:case C.BLOCKQUOTE:case C.FIGCAPTION:{HB(n,e);break}case C.LI:{VB(n);break}case C.DD:case C.DT:{GB(n,e);break}case C.H1:case C.H2:case C.H3:case C.H4:case C.H5:case C.H6:{WB(n);break}case C.BR:{$B(n);break}case C.BODY:{BB(n,e);break}case C.HTML:{UB(n,e);break}case C.FORM:{zB(n);break}case C.APPLET:case C.OBJECT:case C.MARQUEE:{qB(n,e);break}case C.TEMPLATE:{Ya(n,e);break}default:KI(n,e)}}function YI(n,e){n.tmplInsertionModeStack.length>0?nR(n,e):_y(n,e)}function KB(n,e){var t;e.tagID===C.SCRIPT&&((t=n.scriptHandler)===null||t===void 0||t.call(n,n.openElements.current)),n.openElements.pop(),n.insertionMode=n.originalInsertionMode}function YB(n,e){n._err(e,xe.eofInElementThatCanContainOnlyText),n.openElements.pop(),n.insertionMode=n.originalInsertionMode,n.onEof(e)}function G0(n,e){if(n.openElements.currentTagId!==void 0&&VI.has(n.openElements.currentTagId))switch(n.pendingCharacterTokens.length=0,n.hasNonWhitespacePendingCharacterToken=!1,n.originalInsertionMode=n.insertionMode,n.insertionMode=ie.IN_TABLE_TEXT,e.type){case At.CHARACTER:{QI(n,e);break}case At.WHITESPACE_CHARACTER:{XI(n,e);break}}else nc(n,e)}function XB(n,e){n.openElements.clearBackToTableContext(),n.activeFormattingElements.insertMarker(),n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_CAPTION}function QB(n,e){n.openElements.clearBackToTableContext(),n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_COLUMN_GROUP}function ZB(n,e){n.openElements.clearBackToTableContext(),n._insertFakeElement(me.COLGROUP,C.COLGROUP),n.insertionMode=ie.IN_COLUMN_GROUP,Ly(n,e)}function JB(n,e){n.openElements.clearBackToTableContext(),n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_TABLE_BODY}function e9(n,e){n.openElements.clearBackToTableContext(),n._insertFakeElement(me.TBODY,C.TBODY),n.insertionMode=ie.IN_TABLE_BODY,dh(n,e)}function t9(n,e){n.openElements.hasInTableScope(C.TABLE)&&(n.openElements.popUntilTagNamePopped(C.TABLE),n._resetInsertionMode(),n._processStartTag(e))}function n9(n,e){$I(e)?n._appendElement(e,Oe.HTML):nc(n,e),e.ackSelfClosing=!0}function i9(n,e){!n.formElement&&n.openElements.tmplCount===0&&(n._insertElement(e,Oe.HTML),n.formElement=n.openElements.current,n.openElements.pop())}function nu(n,e){switch(e.tagID){case C.TD:case C.TH:case C.TR:{e9(n,e);break}case C.STYLE:case C.SCRIPT:case C.TEMPLATE:{nr(n,e);break}case C.COL:{ZB(n,e);break}case C.FORM:{i9(n,e);break}case C.TABLE:{t9(n,e);break}case C.TBODY:case C.TFOOT:case C.THEAD:{JB(n,e);break}case C.INPUT:{n9(n,e);break}case C.CAPTION:{XB(n,e);break}case C.COLGROUP:{QB(n,e);break}default:nc(n,e)}}function Bl(n,e){switch(e.tagID){case C.TABLE:{n.openElements.hasInTableScope(C.TABLE)&&(n.openElements.popUntilTagNamePopped(C.TABLE),n._resetInsertionMode());break}case C.TEMPLATE:{Ya(n,e);break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:case C.TBODY:case C.TD:case C.TFOOT:case C.TH:case C.THEAD:case C.TR:break;default:nc(n,e)}}function nc(n,e){const t=n.fosterParentingEnabled;n.fosterParentingEnabled=!0,lh(n,e),n.fosterParentingEnabled=t}function XI(n,e){n.pendingCharacterTokens.push(e)}function QI(n,e){n.pendingCharacterTokens.push(e),n.hasNonWhitespacePendingCharacterToken=!0}function ul(n,e){let t=0;if(n.hasNonWhitespacePendingCharacterToken)for(;t<n.pendingCharacterTokens.length;t++)nc(n,n.pendingCharacterTokens[t]);else for(;t<n.pendingCharacterTokens.length;t++)n._insertCharacters(n.pendingCharacterTokens[t]);n.insertionMode=n.originalInsertionMode,n._processToken(e)}const ZI=new Set([C.CAPTION,C.COL,C.COLGROUP,C.TBODY,C.TD,C.TFOOT,C.TH,C.THEAD,C.TR]);function r9(n,e){const t=e.tagID;ZI.has(t)?n.openElements.hasInTableScope(C.CAPTION)&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilTagNamePopped(C.CAPTION),n.activeFormattingElements.clearToLastMarker(),n.insertionMode=ie.IN_TABLE,nu(n,e)):zn(n,e)}function s9(n,e){const t=e.tagID;switch(t){case C.CAPTION:case C.TABLE:{n.openElements.hasInTableScope(C.CAPTION)&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilTagNamePopped(C.CAPTION),n.activeFormattingElements.clearToLastMarker(),n.insertionMode=ie.IN_TABLE,t===C.TABLE&&Bl(n,e));break}case C.BODY:case C.COL:case C.COLGROUP:case C.HTML:case C.TBODY:case C.TD:case C.TFOOT:case C.TH:case C.THEAD:case C.TR:break;default:ch(n,e)}}function Ly(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.COL:{n._appendElement(e,Oe.HTML),e.ackSelfClosing=!0;break}case C.TEMPLATE:{nr(n,e);break}default:kf(n,e)}}function a9(n,e){switch(e.tagID){case C.COLGROUP:{n.openElements.currentTagId===C.COLGROUP&&(n.openElements.pop(),n.insertionMode=ie.IN_TABLE);break}case C.TEMPLATE:{Ya(n,e);break}case C.COL:break;default:kf(n,e)}}function kf(n,e){n.openElements.currentTagId===C.COLGROUP&&(n.openElements.pop(),n.insertionMode=ie.IN_TABLE,n._processToken(e))}function dh(n,e){switch(e.tagID){case C.TR:{n.openElements.clearBackToTableBodyContext(),n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_ROW;break}case C.TH:case C.TD:{n.openElements.clearBackToTableBodyContext(),n._insertFakeElement(me.TR,C.TR),n.insertionMode=ie.IN_ROW,fh(n,e);break}case C.CAPTION:case C.COL:case C.COLGROUP:case C.TBODY:case C.TFOOT:case C.THEAD:{n.openElements.hasTableBodyContextInTableScope()&&(n.openElements.clearBackToTableBodyContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE,nu(n,e));break}default:nu(n,e)}}function rv(n,e){const t=e.tagID;switch(e.tagID){case C.TBODY:case C.TFOOT:case C.THEAD:{n.openElements.hasInTableScope(t)&&(n.openElements.clearBackToTableBodyContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE);break}case C.TABLE:{n.openElements.hasTableBodyContextInTableScope()&&(n.openElements.clearBackToTableBodyContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE,Bl(n,e));break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:case C.TD:case C.TH:case C.TR:break;default:Bl(n,e)}}function fh(n,e){switch(e.tagID){case C.TH:case C.TD:{n.openElements.clearBackToTableRowContext(),n._insertElement(e,Oe.HTML),n.insertionMode=ie.IN_CELL,n.activeFormattingElements.insertMarker();break}case C.CAPTION:case C.COL:case C.COLGROUP:case C.TBODY:case C.TFOOT:case C.THEAD:case C.TR:{n.openElements.hasInTableScope(C.TR)&&(n.openElements.clearBackToTableRowContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE_BODY,dh(n,e));break}default:nu(n,e)}}function JI(n,e){switch(e.tagID){case C.TR:{n.openElements.hasInTableScope(C.TR)&&(n.openElements.clearBackToTableRowContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE_BODY);break}case C.TABLE:{n.openElements.hasInTableScope(C.TR)&&(n.openElements.clearBackToTableRowContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE_BODY,rv(n,e));break}case C.TBODY:case C.TFOOT:case C.THEAD:{(n.openElements.hasInTableScope(e.tagID)||n.openElements.hasInTableScope(C.TR))&&(n.openElements.clearBackToTableRowContext(),n.openElements.pop(),n.insertionMode=ie.IN_TABLE_BODY,rv(n,e));break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:case C.TD:case C.TH:break;default:Bl(n,e)}}function o9(n,e){const t=e.tagID;ZI.has(t)?(n.openElements.hasInTableScope(C.TD)||n.openElements.hasInTableScope(C.TH))&&(n._closeTableCell(),fh(n,e)):zn(n,e)}function u9(n,e){const t=e.tagID;switch(t){case C.TD:case C.TH:{n.openElements.hasInTableScope(t)&&(n.openElements.generateImpliedEndTags(),n.openElements.popUntilTagNamePopped(t),n.activeFormattingElements.clearToLastMarker(),n.insertionMode=ie.IN_ROW);break}case C.TABLE:case C.TBODY:case C.TFOOT:case C.THEAD:case C.TR:{n.openElements.hasInTableScope(t)&&(n._closeTableCell(),JI(n,e));break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:break;default:ch(n,e)}}function eR(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.OPTION:{n.openElements.currentTagId===C.OPTION&&n.openElements.pop(),n._insertElement(e,Oe.HTML);break}case C.OPTGROUP:{n.openElements.currentTagId===C.OPTION&&n.openElements.pop(),n.openElements.currentTagId===C.OPTGROUP&&n.openElements.pop(),n._insertElement(e,Oe.HTML);break}case C.HR:{n.openElements.currentTagId===C.OPTION&&n.openElements.pop(),n.openElements.currentTagId===C.OPTGROUP&&n.openElements.pop(),n._appendElement(e,Oe.HTML),e.ackSelfClosing=!0;break}case C.INPUT:case C.KEYGEN:case C.TEXTAREA:case C.SELECT:{n.openElements.hasInSelectScope(C.SELECT)&&(n.openElements.popUntilTagNamePopped(C.SELECT),n._resetInsertionMode(),e.tagID!==C.SELECT&&n._processStartTag(e));break}case C.SCRIPT:case C.TEMPLATE:{nr(n,e);break}}}function tR(n,e){switch(e.tagID){case C.OPTGROUP:{n.openElements.stackTop>0&&n.openElements.currentTagId===C.OPTION&&n.openElements.tagIDs[n.openElements.stackTop-1]===C.OPTGROUP&&n.openElements.pop(),n.openElements.currentTagId===C.OPTGROUP&&n.openElements.pop();break}case C.OPTION:{n.openElements.currentTagId===C.OPTION&&n.openElements.pop();break}case C.SELECT:{n.openElements.hasInSelectScope(C.SELECT)&&(n.openElements.popUntilTagNamePopped(C.SELECT),n._resetInsertionMode());break}case C.TEMPLATE:{Ya(n,e);break}}}function l9(n,e){const t=e.tagID;t===C.CAPTION||t===C.TABLE||t===C.TBODY||t===C.TFOOT||t===C.THEAD||t===C.TR||t===C.TD||t===C.TH?(n.openElements.popUntilTagNamePopped(C.SELECT),n._resetInsertionMode(),n._processStartTag(e)):eR(n,e)}function c9(n,e){const t=e.tagID;t===C.CAPTION||t===C.TABLE||t===C.TBODY||t===C.TFOOT||t===C.THEAD||t===C.TR||t===C.TD||t===C.TH?n.openElements.hasInTableScope(t)&&(n.openElements.popUntilTagNamePopped(C.SELECT),n._resetInsertionMode(),n.onEndTag(e)):tR(n,e)}function d9(n,e){switch(e.tagID){case C.BASE:case C.BASEFONT:case C.BGSOUND:case C.LINK:case C.META:case C.NOFRAMES:case C.SCRIPT:case C.STYLE:case C.TEMPLATE:case C.TITLE:{nr(n,e);break}case C.CAPTION:case C.COLGROUP:case C.TBODY:case C.TFOOT:case C.THEAD:{n.tmplInsertionModeStack[0]=ie.IN_TABLE,n.insertionMode=ie.IN_TABLE,nu(n,e);break}case C.COL:{n.tmplInsertionModeStack[0]=ie.IN_COLUMN_GROUP,n.insertionMode=ie.IN_COLUMN_GROUP,Ly(n,e);break}case C.TR:{n.tmplInsertionModeStack[0]=ie.IN_TABLE_BODY,n.insertionMode=ie.IN_TABLE_BODY,dh(n,e);break}case C.TD:case C.TH:{n.tmplInsertionModeStack[0]=ie.IN_ROW,n.insertionMode=ie.IN_ROW,fh(n,e);break}default:n.tmplInsertionModeStack[0]=ie.IN_BODY,n.insertionMode=ie.IN_BODY,zn(n,e)}}function f9(n,e){e.tagID===C.TEMPLATE&&Ya(n,e)}function nR(n,e){n.openElements.tmplCount>0?(n.openElements.popUntilTagNamePopped(C.TEMPLATE),n.activeFormattingElements.clearToLastMarker(),n.tmplInsertionModeStack.shift(),n._resetInsertionMode(),n.onEof(e)):_y(n,e)}function h9(n,e){e.tagID===C.HTML?zn(n,e):Df(n,e)}function iR(n,e){var t;if(e.tagID===C.HTML){if(n.fragmentContext||(n.insertionMode=ie.AFTER_AFTER_BODY),n.options.sourceCodeLocationInfo&&n.openElements.tagIDs[0]===C.HTML){n._setEndLocation(n.openElements.items[0],e);const i=n.openElements.items[1];i&&!(!((t=n.treeAdapter.getNodeSourceCodeLocation(i))===null||t===void 0)&&t.endTag)&&n._setEndLocation(i,e)}}else Df(n,e)}function Df(n,e){n.insertionMode=ie.IN_BODY,lh(n,e)}function p9(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.FRAMESET:{n._insertElement(e,Oe.HTML);break}case C.FRAME:{n._appendElement(e,Oe.HTML),e.ackSelfClosing=!0;break}case C.NOFRAMES:{nr(n,e);break}}}function m9(n,e){e.tagID===C.FRAMESET&&!n.openElements.isRootHtmlElementCurrent()&&(n.openElements.pop(),!n.fragmentContext&&n.openElements.currentTagId!==C.FRAMESET&&(n.insertionMode=ie.AFTER_FRAMESET))}function g9(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.NOFRAMES:{nr(n,e);break}}}function v9(n,e){e.tagID===C.HTML&&(n.insertionMode=ie.AFTER_AFTER_FRAMESET)}function y9(n,e){e.tagID===C.HTML?zn(n,e):cf(n,e)}function cf(n,e){n.insertionMode=ie.IN_BODY,lh(n,e)}function E9(n,e){switch(e.tagID){case C.HTML:{zn(n,e);break}case C.NOFRAMES:{nr(n,e);break}}}function b9(n,e){e.chars=Kt,n._insertCharacters(e)}function T9(n,e){n._insertCharacters(e),n.framesetOk=!1}function rR(n){for(;n.treeAdapter.getNamespaceURI(n.openElements.current)!==Oe.HTML&&n.openElements.currentTagId!==void 0&&!n._isIntegrationPoint(n.openElements.currentTagId,n.openElements.current);)n.openElements.pop()}function x9(n,e){if(F5(e))rR(n),n._startTagOutsideForeignContent(e);else{const t=n._getAdjustedCurrentElement(),i=n.treeAdapter.getNamespaceURI(t);i===Oe.MATHML?zI(e):i===Oe.SVG&&(B5(e),jI(e)),Iy(e),e.selfClosing?n._appendElement(e,i):n._insertElement(e,i),e.ackSelfClosing=!0}}function S9(n,e){if(e.tagID===C.P||e.tagID===C.BR){rR(n),n._endTagOutsideForeignContent(e);return}for(let t=n.openElements.stackTop;t>0;t--){const i=n.openElements.items[t];if(n.treeAdapter.getNamespaceURI(i)===Oe.HTML){n._endTagOutsideForeignContent(e);break}const r=n.treeAdapter.getTagName(i);if(r.toLowerCase()===e.tagName){e.tagName=r,n.openElements.shortenToLength(t);break}}}me.AREA,me.BASE,me.BASEFONT,me.BGSOUND,me.BR,me.COL,me.EMBED,me.FRAME,me.HR,me.IMG,me.INPUT,me.KEYGEN,me.LINK,me.META,me.PARAM,me.SOURCE,me.TRACK,me.WBR;const hh=sR("end"),rs=sR("start");function sR(n){return e;function e(t){const i=t&&t.position&&t.position[n]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function w9(n){const e=rs(n),t=hh(n);if(e&&t)return{start:e,end:t}}const ph=(function(n){if(n==null)return R9;if(typeof n=="function")return mh(n);if(typeof n=="object")return Array.isArray(n)?A9(n):C9(n);if(typeof n=="string")return I9(n);throw new Error("Expected function, string, or object as test")});function A9(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=ph(n[t]);return mh(i);function i(...r){let s=-1;for(;++s<e.length;)if(e[s].apply(this,r))return!0;return!1}}function C9(n){const e=n;return mh(t);function t(i){const r=i;let s;for(s in n)if(r[s]!==e[s])return!1;return!0}}function I9(n){return mh(e);function e(t){return t&&t.type===n}}function mh(n){return e;function e(t,i,r){return!!(_9(t)&&n.call(this,t,typeof i=="number"?i:void 0,r||void 0))}}function R9(){return!0}function _9(n){return n!==null&&typeof n=="object"&&"type"in n}const aR=[],L9=!0,sv=!1,P9="skip";function oR(n,e,t,i){let r;typeof e=="function"&&typeof t!="function"?(i=t,t=e):r=e;const s=ph(r),a=i?-1:1;o(n,void 0,[])();function o(l,u,c){const d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){const p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return h;function h(){let p=aR,g,v,y;if((!e||s(l,u,c[c.length-1]||void 0))&&(p=k9(t(l,c)),p[0]===sv))return p;if("children"in l&&l.children){const b=l;if(b.children&&p[0]!==P9)for(v=(i?b.children.length:-1)+a,y=c.concat(b);v>-1&&v<b.children.length;){const T=b.children[v];if(g=o(T,v,y)(),g[0]===sv)return g;v=typeof g[1]=="number"?g[1]:v+a}}return p}}}function k9(n){return Array.isArray(n)?n:typeof n=="number"?[L9,n]:n==null?aR:[n]}function Py(n,e,t,i){let r,s,a;typeof e=="function"&&typeof t!="function"?(s=void 0,a=e,r=t):(s=e,a=t,r=i),oR(n,s,o,r);function o(l,u){const c=u[u.length-1],d=c?c.children.indexOf(l):void 0;return a(l,d,c)}}const D9=/<(\/?)(iframe|noembed|noframes|plaintext|script|style|textarea|title|xmp)(?=[\t\n\f\r />])/gi,O9=new Set(["mdxFlowExpression","mdxJsxFlowElement","mdxJsxTextElement","mdxTextExpression","mdxjsEsm"]),zx={sourceCodeLocationInfo:!0,scriptingEnabled:!1};function uR(n,e){const t=G9(n),i=Ay("type",{handlers:{root:N9,element:M9,text:F9,comment:cR,doctype:B9,raw:H9},unknown:z9}),r={parser:t?new Bx(zx):Bx.getFragmentParser(void 0,zx),handle(o){i(o,r)},stitches:!1,options:e||{}};i(n,r),hu(r,rs());const s=t?r.parser.document:r.parser.getFragment(),a=IF(s,{file:r.options.file});return r.stitches&&Py(a,"comment",function(o,l,u){const c=o;if(c.value.stitch&&u&&l!==void 0){const d=u.children;return d[l]=c.value.stitch,l}}),a.type==="root"&&a.children.length===1&&a.children[0].type===n.type?a.children[0]:a}function lR(n,e){let t=-1;if(n)for(;++t<n.length;)e.handle(n[t])}function N9(n,e){lR(n.children,e)}function M9(n,e){j9(n,e),lR(n.children,e),V9(n,e)}function F9(n,e){e.parser.tokenizer.state>4&&(e.parser.tokenizer.state=0);const t={type:At.CHARACTER,chars:n.value,location:ic(n)};hu(e,rs(n)),e.parser.currentToken=t,e.parser._processToken(e.parser.currentToken)}function B9(n,e){const t={type:At.DOCTYPE,name:"html",forceQuirks:!1,publicId:"",systemId:"",location:ic(n)};hu(e,rs(n)),e.parser.currentToken=t,e.parser._processToken(e.parser.currentToken)}function U9(n,e){e.stitches=!0;const t=W9(n);if("children"in n&&"children"in t){const i=uR({type:"root",children:n.children},e.options);t.children=i.children}cR({type:"comment",value:{stitch:t}},e)}function cR(n,e){const t=n.value,i={type:At.COMMENT,data:t,location:ic(n)};hu(e,rs(n)),e.parser.currentToken=i,e.parser._processToken(e.parser.currentToken)}function H9(n,e){if(e.parser.tokenizer.preprocessor.html="",e.parser.tokenizer.preprocessor.pos=-1,e.parser.tokenizer.preprocessor.lastGapPos=-2,e.parser.tokenizer.preprocessor.gapStack=[],e.parser.tokenizer.preprocessor.skipNextNewLine=!1,e.parser.tokenizer.preprocessor.lastChunkWritten=!1,e.parser.tokenizer.preprocessor.endOfChunkHit=!1,e.parser.tokenizer.preprocessor.isEol=!1,dR(e,rs(n)),e.parser.tokenizer.write(e.options.tagfilter?n.value.replace(D9,"&lt;$1$2"):n.value,!1),e.parser.tokenizer._runParsingLoop(),e.parser.tokenizer.state===72||e.parser.tokenizer.state===78){e.parser.tokenizer.preprocessor.lastChunkWritten=!0;const t=e.parser.tokenizer._consume();e.parser.tokenizer._callState(t)}}function z9(n,e){const t=n;if(e.options.passThrough&&e.options.passThrough.includes(t.type))U9(t,e);else{let i="";throw O9.has(t.type)&&(i=". It looks like you are using MDX nodes with `hast-util-raw` (or `rehype-raw`). If you use this because you are using remark or rehype plugins that inject `'html'` nodes, then please raise an issue with that plugin, as its a bad and slow idea. If you use this because you are using markdown syntax, then you have to configure this utility (or plugin) to pass through these nodes (see `passThrough` in docs), but you can also migrate to use the MDX syntax"),new Error("Cannot compile `"+t.type+"` node"+i)}}function hu(n,e){dR(n,e);const t=n.parser.tokenizer.currentCharacterToken;t&&t.location&&(t.location.endLine=n.parser.tokenizer.preprocessor.line,t.location.endCol=n.parser.tokenizer.preprocessor.col+1,t.location.endOffset=n.parser.tokenizer.preprocessor.offset+1,n.parser.currentToken=t,n.parser._processToken(n.parser.currentToken)),n.parser.tokenizer.paused=!1,n.parser.tokenizer.inLoop=!1,n.parser.tokenizer.active=!1,n.parser.tokenizer.returnState=on.DATA,n.parser.tokenizer.charRefCode=-1,n.parser.tokenizer.consumedAfterSnapshot=-1,n.parser.tokenizer.currentLocation=null,n.parser.tokenizer.currentCharacterToken=null,n.parser.tokenizer.currentToken=null,n.parser.tokenizer.currentAttr={name:"",value:""}}function dR(n,e){if(e&&e.offset!==void 0){const t={startLine:e.line,startCol:e.column,startOffset:e.offset,endLine:-1,endCol:-1,endOffset:-1};n.parser.tokenizer.preprocessor.lineStartPos=-e.column+1,n.parser.tokenizer.preprocessor.droppedBufferSize=e.offset,n.parser.tokenizer.preprocessor.line=e.line,n.parser.tokenizer.currentLocation=t}}function j9(n,e){const t=n.tagName.toLowerCase();if(e.parser.tokenizer.state===on.PLAINTEXT)return;hu(e,rs(n));const i=e.parser.openElements.current;let r="namespaceURI"in i?i.namespaceURI:ka.html;r===ka.html&&t==="svg"&&(r=ka.svg);const s=jF({...n,children:[]},{space:r===ka.svg?"svg":"html"}),a={type:At.START_TAG,tagName:t,tagID:fu(t),selfClosing:!1,ackSelfClosing:!1,attrs:"attrs"in s?s.attrs:[],location:ic(n)};e.parser.currentToken=a,e.parser._processToken(e.parser.currentToken),e.parser.tokenizer.lastStartTagName=t}function V9(n,e){const t=n.tagName.toLowerCase();if(!e.parser.tokenizer.inForeignNode&&PI.includes(t)||e.parser.tokenizer.state===on.PLAINTEXT)return;hu(e,hh(n));const i={type:At.END_TAG,tagName:t,tagID:fu(t),selfClosing:!1,ackSelfClosing:!1,attrs:[],location:ic(n)};e.parser.currentToken=i,e.parser._processToken(e.parser.currentToken),t===e.parser.tokenizer.lastStartTagName&&(e.parser.tokenizer.state===on.RCDATA||e.parser.tokenizer.state===on.RAWTEXT||e.parser.tokenizer.state===on.SCRIPT_DATA)&&(e.parser.tokenizer.state=on.DATA)}function G9(n){const e=n.type==="root"?n.children[0]:n;return!!(e&&(e.type==="doctype"||e.type==="element"&&e.tagName.toLowerCase()==="html"))}function ic(n){const e=rs(n)||{line:void 0,column:void 0,offset:void 0},t=hh(n)||{line:void 0,column:void 0,offset:void 0};return{startLine:e.line,startCol:e.column,startOffset:e.offset,endLine:t.line,endCol:t.column,endOffset:t.offset}}function W9(n){return"children"in n?tu({...n,children:[]}):tu(n)}function q9(n){return function(e,t){return uR(e,{...n,file:t})}}const $9=/["&'<>`]/g,K9=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Y9=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,X9=/[|\\{}()[\]^$+*?.]/g,jx=new WeakMap;function Q9(n,e){if(n=n.replace(e.subset?Z9(e.subset):$9,i),e.subset||e.escapeOnly)return n;return n.replace(K9,t).replace(Y9,i);function t(r,s,a){return e.format((r.charCodeAt(0)-55296)*1024+r.charCodeAt(1)-56320+65536,a.charCodeAt(s+2),e)}function i(r,s,a){return e.format(r.charCodeAt(0),a.charCodeAt(s+1),e)}}function Z9(n){let e=jx.get(n);return e||(e=J9(n),jx.set(n,e)),e}function J9(n){const e=[];let t=-1;for(;++t<n.length;)e.push(n[t].replace(X9,"\\$&"));return new RegExp("(?:"+e.join("|")+")","g")}const eU=/[\dA-Fa-f]/;function tU(n,e,t){const i="&#x"+n.toString(16).toUpperCase();return t&&e&&!eU.test(String.fromCharCode(e))?i:i+";"}const nU=/\d/;function iU(n,e,t){const i="&#"+String(n);return t&&e&&!nU.test(String.fromCharCode(e))?i:i+";"}const rU=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],W0={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},sU=["cent","copy","divide","gt","lt","not","para","times"],fR={}.hasOwnProperty,av={};let Ad;for(Ad in W0)fR.call(W0,Ad)&&(av[W0[Ad]]=Ad);const aU=/[^\dA-Za-z]/;function oU(n,e,t,i){const r=String.fromCharCode(n);if(fR.call(av,r)){const s=av[r],a="&"+s;return t&&rU.includes(s)&&!sU.includes(s)&&(!i||e&&e!==61&&aU.test(String.fromCharCode(e)))?a:a+";"}return""}function uU(n,e,t){let i=tU(n,e,t.omitOptionalSemicolons),r;if((t.useNamedReferences||t.useShortestReferences)&&(r=oU(n,e,t.omitOptionalSemicolons,t.attribute)),(t.useShortestReferences||!r)&&t.useShortestReferences){const s=iU(n,e,t.omitOptionalSemicolons);s.length<i.length&&(i=s)}return r&&(!t.useShortestReferences||r.length<i.length)?r:i}function $o(n,e){return Q9(n,Object.assign({format:uU},e))}const lU=/^>|^->|<!--|-->|--!>|<!-$/g,cU=[">"],dU=["<",">"];function fU(n,e,t,i){return i.settings.bogusComments?"<?"+$o(n.value,Object.assign({},i.settings.characterReferences,{subset:cU}))+">":"<!--"+n.value.replace(lU,r)+"-->";function r(s){return $o(s,Object.assign({},i.settings.characterReferences,{subset:dU}))}}function hU(n,e,t,i){return"<!"+(i.settings.upperDoctype?"DOCTYPE":"doctype")+(i.settings.tightDoctype?"":" ")+"html>"}function Of(n,e){const t=String(n);if(typeof e!="string")throw new TypeError("Expected character");let i=0,r=t.indexOf(e);for(;r!==-1;)i++,r=t.indexOf(e,r+e.length);return i}const pU=/[ \t\n\f\r]/g;function ky(n){return typeof n=="object"?n.type==="text"?Vx(n.value):!1:Vx(n)}function Vx(n){return n.replace(pU,"")===""}const yn=pR(1),hR=pR(-1),mU=[];function pR(n){return e;function e(t,i,r){const s=t?t.children:mU;let a=(i||0)+n,o=s[a];if(!r)for(;o&&ky(o);)a+=n,o=s[a];return o}}const gU={}.hasOwnProperty;function mR(n){return e;function e(t,i,r){return gU.call(n,t.tagName)&&n[t.tagName](t,i,r)}}const Dy=mR({body:yU,caption:q0,colgroup:q0,dd:xU,dt:TU,head:q0,html:vU,li:bU,optgroup:SU,option:wU,p:EU,rp:Gx,rt:Gx,tbody:CU,td:Wx,tfoot:IU,th:Wx,thead:AU,tr:RU});function q0(n,e,t){const i=yn(t,e,!0);return!i||i.type!=="comment"&&!(i.type==="text"&&ky(i.value.charAt(0)))}function vU(n,e,t){const i=yn(t,e);return!i||i.type!=="comment"}function yU(n,e,t){const i=yn(t,e);return!i||i.type!=="comment"}function EU(n,e,t){const i=yn(t,e);return i?i.type==="element"&&(i.tagName==="address"||i.tagName==="article"||i.tagName==="aside"||i.tagName==="blockquote"||i.tagName==="details"||i.tagName==="div"||i.tagName==="dl"||i.tagName==="fieldset"||i.tagName==="figcaption"||i.tagName==="figure"||i.tagName==="footer"||i.tagName==="form"||i.tagName==="h1"||i.tagName==="h2"||i.tagName==="h3"||i.tagName==="h4"||i.tagName==="h5"||i.tagName==="h6"||i.tagName==="header"||i.tagName==="hgroup"||i.tagName==="hr"||i.tagName==="main"||i.tagName==="menu"||i.tagName==="nav"||i.tagName==="ol"||i.tagName==="p"||i.tagName==="pre"||i.tagName==="section"||i.tagName==="table"||i.tagName==="ul"):!t||!(t.type==="element"&&(t.tagName==="a"||t.tagName==="audio"||t.tagName==="del"||t.tagName==="ins"||t.tagName==="map"||t.tagName==="noscript"||t.tagName==="video"))}function bU(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&i.tagName==="li"}function TU(n,e,t){const i=yn(t,e);return!!(i&&i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd"))}function xU(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd")}function Gx(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&(i.tagName==="rp"||i.tagName==="rt")}function SU(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&i.tagName==="optgroup"}function wU(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&(i.tagName==="option"||i.tagName==="optgroup")}function AU(n,e,t){const i=yn(t,e);return!!(i&&i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot"))}function CU(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot")}function IU(n,e,t){return!yn(t,e)}function RU(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&i.tagName==="tr"}function Wx(n,e,t){const i=yn(t,e);return!i||i.type==="element"&&(i.tagName==="td"||i.tagName==="th")}const _U=mR({body:kU,colgroup:DU,head:PU,html:LU,tbody:OU});function LU(n){const e=yn(n,-1);return!e||e.type!=="comment"}function PU(n){const e=new Set;for(const i of n.children)if(i.type==="element"&&(i.tagName==="base"||i.tagName==="title")){if(e.has(i.tagName))return!1;e.add(i.tagName)}const t=n.children[0];return!t||t.type==="element"}function kU(n){const e=yn(n,-1,!0);return!e||e.type!=="comment"&&!(e.type==="text"&&ky(e.value.charAt(0)))&&!(e.type==="element"&&(e.tagName==="meta"||e.tagName==="link"||e.tagName==="script"||e.tagName==="style"||e.tagName==="template"))}function DU(n,e,t){const i=hR(t,e),r=yn(n,-1,!0);return t&&i&&i.type==="element"&&i.tagName==="colgroup"&&Dy(i,t.children.indexOf(i),t)?!1:!!(r&&r.type==="element"&&r.tagName==="col")}function OU(n,e,t){const i=hR(t,e),r=yn(n,-1);return t&&i&&i.type==="element"&&(i.tagName==="thead"||i.tagName==="tbody")&&Dy(i,t.children.indexOf(i),t)?!1:!!(r&&r.type==="element"&&r.tagName==="tr")}const Cd={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function NU(n,e,t,i){const r=i.schema,s=r.space==="svg"?!1:i.settings.omitOptionalTags;let a=r.space==="svg"?i.settings.closeEmptyElements:i.settings.voids.includes(n.tagName.toLowerCase());const o=[];let l;r.space==="html"&&n.tagName==="svg"&&(i.schema=ec);const u=MU(i,n.properties),c=i.all(r.space==="html"&&n.tagName==="template"?n.content:n);return i.schema=r,c&&(a=!1),(u||!s||!_U(n,e,t))&&(o.push("<",n.tagName,u?" "+u:""),a&&(r.space==="svg"||i.settings.closeSelfClosing)&&(l=u.charAt(u.length-1),(!i.settings.tightSelfClosing||l==="/"||l&&l!=='"'&&l!=="'")&&o.push(" "),o.push("/")),o.push(">")),o.push(c),!a&&(!s||!Dy(n,e,t))&&o.push("</"+n.tagName+">"),o.join("")}function MU(n,e){const t=[];let i=-1,r;if(e){for(r in e)if(e[r]!==null&&e[r]!==void 0){const s=FU(n,r,e[r]);s&&t.push(s)}}for(;++i<t.length;){const s=n.settings.tightAttributes?t[i].charAt(t[i].length-1):void 0;i!==t.length-1&&s!=='"'&&s!=="'"&&(t[i]+=" ")}return t.join("")}function FU(n,e,t){const i=xy(n.schema,e),r=n.settings.allowParseErrors&&n.schema.space==="html"?0:1,s=n.settings.allowDangerousCharacters?0:1;let a=n.quote,o;if(i.overloadedBoolean&&(t===i.attribute||t==="")?t=!0:(i.boolean||i.overloadedBoolean)&&(typeof t!="string"||t===i.attribute||t==="")&&(t=!!t),t==null||t===!1||typeof t=="number"&&Number.isNaN(t))return"";const l=$o(i.attribute,Object.assign({},n.settings.characterReferences,{subset:Cd.name[r][s]}));return t===!0||(t=Array.isArray(t)?(i.commaSeparated?gI:vI)(t,{padLeft:!n.settings.tightCommaSeparatedLists}):String(t),n.settings.collapseEmptyAttributes&&!t)?l:(n.settings.preferUnquoted&&(o=$o(t,Object.assign({},n.settings.characterReferences,{attribute:!0,subset:Cd.unquoted[r][s]}))),o!==t&&(n.settings.quoteSmart&&Of(t,a)>Of(t,n.alternative)&&(a=n.alternative),o=a+$o(t,Object.assign({},n.settings.characterReferences,{subset:(a==="'"?Cd.single:Cd.double)[r][s],attribute:!0}))+a),l+(o&&"="+o))}const BU=["<","&"];function gR(n,e,t,i){return t&&t.type==="element"&&(t.tagName==="script"||t.tagName==="style")?n.value:$o(n.value,Object.assign({},i.settings.characterReferences,{subset:BU}))}function UU(n,e,t,i){return i.settings.allowDangerousHtml?n.value:gR(n,e,t,i)}function HU(n,e,t,i){return i.all(n)}const zU=Ay("type",{invalid:jU,unknown:VU,handlers:{comment:fU,doctype:hU,element:NU,raw:UU,root:HU,text:gR}});function jU(n){throw new Error("Expected node, not `"+n+"`")}function VU(n){const e=n;throw new Error("Cannot compile unknown node `"+e.type+"`")}const GU={},WU={},qU=[];function $U(n,e){const t=e||GU,i=t.quote||'"',r=i==='"'?"'":'"';if(i!=='"'&&i!=="'")throw new Error("Invalid quote `"+i+"`, expected `'` or `\"`");return{one:KU,all:YU,settings:{omitOptionalTags:t.omitOptionalTags||!1,allowParseErrors:t.allowParseErrors||!1,allowDangerousCharacters:t.allowDangerousCharacters||!1,quoteSmart:t.quoteSmart||!1,preferUnquoted:t.preferUnquoted||!1,tightAttributes:t.tightAttributes||!1,upperDoctype:t.upperDoctype||!1,tightDoctype:t.tightDoctype||!1,bogusComments:t.bogusComments||!1,tightCommaSeparatedLists:t.tightCommaSeparatedLists||!1,tightSelfClosing:t.tightSelfClosing||!1,collapseEmptyAttributes:t.collapseEmptyAttributes||!1,allowDangerousHtml:t.allowDangerousHtml||!1,voids:t.voids||PI,characterReferences:t.characterReferences||WU,closeSelfClosing:t.closeSelfClosing||!1,closeEmptyElements:t.closeEmptyElements||!1},schema:t.space==="svg"?ec:uh,quote:i,alternative:r}.one(Array.isArray(n)?{type:"root",children:n}:n,void 0,void 0)}function KU(n,e,t){return zU(n,e,t,this)}function YU(n){const e=[],t=n&&n.children||qU;let i=-1;for(;++i<t.length;)e[i]=this.one(t[i],i,n);return e.join("")}function XU(n){const e=this,t={...e.data("settings"),...n};e.compiler=i;function i(r){return $U(r,t)}}const qn=ea(/[A-Za-z]/),Bn=ea(/[\dA-Za-z]/),QU=ea(/[#-'*+\--9=?A-Z^-~]/);function Nf(n){return n!==null&&(n<32||n===127)}const ov=ea(/\d/),ZU=ea(/[\dA-Fa-f]/),JU=ea(/[!-/:-@[-`{-~]/);function ct(n){return n!==null&&n<-2}function Ut(n){return n!==null&&(n<0||n===32)}function Ct(n){return n===-2||n===-1||n===32}const gh=ea(new RegExp("\\p{P}|\\p{S}","u")),za=ea(/\s/);function ea(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}function e7(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function t7(n,e,t){const r=ph((t||{}).ignore||[]),s=n7(e);let a=-1;for(;++a<s.length;)oR(n,"text",o);function o(u,c){let d=-1,h;for(;++d<c.length;){const p=c[d],g=h?h.children:void 0;if(r(p,g?g.indexOf(p):void 0,h))return;h=p}if(h)return l(u,c)}function l(u,c){const d=c[c.length-1],h=s[a][0],p=s[a][1];let g=0;const y=d.children.indexOf(u);let b=!1,T=[];h.lastIndex=0;let x=h.exec(u.value);for(;x;){const w=x.index,A={index:x.index,input:x.input,stack:[...c,u]};let R=p(...x,A);if(typeof R=="string"&&(R=R.length>0?{type:"text",value:R}:void 0),R===!1?h.lastIndex=w+1:(g!==w&&T.push({type:"text",value:u.value.slice(g,w)}),Array.isArray(R)?T.push(...R):R&&T.push(R),g=w+x[0].length,b=!0),!h.global)break;x=h.exec(u.value)}return b?(g<u.value.length&&T.push({type:"text",value:u.value.slice(g)}),d.children.splice(y,1,...T)):T=[u],y+T.length}}function n7(n){const e=[];if(!Array.isArray(n))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!n[0]||Array.isArray(n[0])?n:[n];let i=-1;for(;++i<t.length;){const r=t[i];e.push([i7(r[0]),r7(r[1])])}return e}function i7(n){return typeof n=="string"?new RegExp(e7(n),"g"):n}function r7(n){return typeof n=="function"?n:function(){return n}}const $0="phrasing",K0=["autolink","link","image","label"];function s7(){return{transforms:[f7],enter:{literalAutolink:o7,literalAutolinkEmail:Y0,literalAutolinkHttp:Y0,literalAutolinkWww:Y0},exit:{literalAutolink:d7,literalAutolinkEmail:c7,literalAutolinkHttp:u7,literalAutolinkWww:l7}}}function a7(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:$0,notInConstruct:K0},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:$0,notInConstruct:K0},{character:":",before:"[ps]",after:"\\/",inConstruct:$0,notInConstruct:K0}]}}function o7(n){this.enter({type:"link",title:null,url:"",children:[]},n)}function Y0(n){this.config.enter.autolinkProtocol.call(this,n)}function u7(n){this.config.exit.autolinkProtocol.call(this,n)}function l7(n){this.config.exit.data.call(this,n);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(n)}function c7(n){this.config.exit.autolinkEmail.call(this,n)}function d7(n){this.exit(n)}function f7(n){t7(n,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,h7],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),p7]],{ignore:["link","linkReference"]})}function h7(n,e,t,i,r){let s="";if(!vR(r)||(/^w/i.test(e)&&(t=e+t,e="",s="http://"),!m7(t)))return!1;const a=g7(t+i);if(!a[0])return!1;const o={type:"link",title:null,url:s+e+a[0],children:[{type:"text",value:e+a[0]}]};return a[1]?[o,{type:"text",value:a[1]}]:o}function p7(n,e,t,i){return!vR(i,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}function m7(n){const e=n.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function g7(n){const e=/[!"&'),.:;<>?\]}]+$/.exec(n);if(!e)return[n,void 0];n=n.slice(0,e.index);let t=e[0],i=t.indexOf(")");const r=Of(n,"(");let s=Of(n,")");for(;i!==-1&&r>s;)n+=t.slice(0,i+1),t=t.slice(i+1),i=t.indexOf(")"),s++;return[n,t]}function vR(n,e){const t=n.input.charCodeAt(n.index-1);return(n.index===0||za(t)||gh(t))&&(!e||t!==47)}function Ji(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}yR.peek=A7;function v7(){this.buffer()}function y7(n){this.enter({type:"footnoteReference",identifier:"",label:""},n)}function E7(){this.buffer()}function b7(n){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},n)}function T7(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Ji(this.sliceSerialize(n)).toLowerCase(),t.label=e}function x7(n){this.exit(n)}function S7(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Ji(this.sliceSerialize(n)).toLowerCase(),t.label=e}function w7(n){this.exit(n)}function A7(){return"["}function yR(n,e,t,i){const r=t.createTracker(i);let s=r.move("[^");const a=t.enter("footnoteReference"),o=t.enter("reference");return s+=r.move(t.safe(t.associationId(n),{after:"]",before:s})),o(),a(),s+=r.move("]"),s}function C7(){return{enter:{gfmFootnoteCallString:v7,gfmFootnoteCall:y7,gfmFootnoteDefinitionLabelString:E7,gfmFootnoteDefinition:b7},exit:{gfmFootnoteCallString:T7,gfmFootnoteCall:x7,gfmFootnoteDefinitionLabelString:S7,gfmFootnoteDefinition:w7}}}function I7(n){let e=!1;return n&&n.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:t,footnoteReference:yR},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function t(i,r,s,a){const o=s.createTracker(a);let l=o.move("[^");const u=s.enter("footnoteDefinition"),c=s.enter("label");return l+=o.move(s.safe(s.associationId(i),{before:l,after:"]"})),c(),l+=o.move("]:"),i.children&&i.children.length>0&&(o.shift(4),l+=o.move((e?`
`:" ")+s.indentLines(s.containerFlow(i,o.current()),e?ER:R7))),u(),l}}function R7(n,e,t){return e===0?n:ER(n,e,t)}function ER(n,e,t){return(t?"":"    ")+n}const _7=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];bR.peek=O7;function L7(){return{canContainEols:["delete"],enter:{strikethrough:k7},exit:{strikethrough:D7}}}function P7(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:_7}],handlers:{delete:bR}}}function k7(n){this.enter({type:"delete",children:[]},n)}function D7(n){this.exit(n)}function bR(n,e,t,i){const r=t.createTracker(i),s=t.enter("strikethrough");let a=r.move("~~");return a+=t.containerPhrasing(n,{...r.current(),before:a,after:"~"}),a+=r.move("~~"),s(),a}function O7(){return"~"}function N7(n){return n.length}function M7(n,e){const t=e||{},i=(t.align||[]).concat(),r=t.stringLength||N7,s=[],a=[],o=[],l=[];let u=0,c=-1;for(;++c<n.length;){const v=[],y=[];let b=-1;for(n[c].length>u&&(u=n[c].length);++b<n[c].length;){const T=F7(n[c][b]);if(t.alignDelimiters!==!1){const x=r(T);y[b]=x,(l[b]===void 0||x>l[b])&&(l[b]=x)}v.push(T)}a[c]=v,o[c]=y}let d=-1;if(typeof i=="object"&&"length"in i)for(;++d<u;)s[d]=qx(i[d]);else{const v=qx(i);for(;++d<u;)s[d]=v}d=-1;const h=[],p=[];for(;++d<u;){const v=s[d];let y="",b="";v===99?(y=":",b=":"):v===108?y=":":v===114&&(b=":");let T=t.alignDelimiters===!1?1:Math.max(1,l[d]-y.length-b.length);const x=y+"-".repeat(T)+b;t.alignDelimiters!==!1&&(T=y.length+T+b.length,T>l[d]&&(l[d]=T),p[d]=T),h[d]=x}a.splice(1,0,h),o.splice(1,0,p),c=-1;const g=[];for(;++c<a.length;){const v=a[c],y=o[c];d=-1;const b=[];for(;++d<u;){const T=v[d]||"";let x="",w="";if(t.alignDelimiters!==!1){const A=l[d]-(y[d]||0),R=s[d];R===114?x=" ".repeat(A):R===99?A%2?(x=" ".repeat(A/2+.5),w=" ".repeat(A/2-.5)):(x=" ".repeat(A/2),w=x):w=" ".repeat(A)}t.delimiterStart!==!1&&!d&&b.push("|"),t.padding!==!1&&!(t.alignDelimiters===!1&&T==="")&&(t.delimiterStart!==!1||d)&&b.push(" "),t.alignDelimiters!==!1&&b.push(x),b.push(T),t.alignDelimiters!==!1&&b.push(w),t.padding!==!1&&b.push(" "),(t.delimiterEnd!==!1||d!==u-1)&&b.push("|")}g.push(t.delimiterEnd===!1?b.join("").replace(/ +$/,""):b.join(""))}return g.join(`
`)}function F7(n){return n==null?"":String(n)}function qx(n){const e=typeof n=="string"?n.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function B7(n,e,t,i){const r=t.enter("blockquote"),s=t.createTracker(i);s.move("> "),s.shift(2);const a=t.indentLines(t.containerFlow(n,s.current()),U7);return r(),a}function U7(n,e,t){return">"+(t?"":" ")+n}function H7(n,e){return $x(n,e.inConstruct,!0)&&!$x(n,e.notInConstruct,!1)}function $x(n,e,t){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return t;let i=-1;for(;++i<e.length;)if(n.includes(e[i]))return!0;return!1}function Kx(n,e,t,i){let r=-1;for(;++r<t.unsafe.length;)if(t.unsafe[r].character===`
`&&H7(t.stack,t.unsafe[r]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function z7(n,e){const t=String(n);let i=t.indexOf(e),r=i,s=0,a=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===r?++s>a&&(a=s):s=1,r=i+e.length,i=t.indexOf(e,r);return a}function j7(n,e){return!!(e.options.fences===!1&&n.value&&!n.lang&&/[^ \r\n]/.test(n.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(n.value))}function V7(n){const e=n.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function G7(n,e,t,i){const r=V7(t),s=n.value||"",a=r==="`"?"GraveAccent":"Tilde";if(j7(n,t)){const d=t.enter("codeIndented"),h=t.indentLines(s,W7);return d(),h}const o=t.createTracker(i),l=r.repeat(Math.max(z7(s,r)+1,3)),u=t.enter("codeFenced");let c=o.move(l);if(n.lang){const d=t.enter(`codeFencedLang${a}`);c+=o.move(t.safe(n.lang,{before:c,after:" ",encode:["`"],...o.current()})),d()}if(n.lang&&n.meta){const d=t.enter(`codeFencedMeta${a}`);c+=o.move(" "),c+=o.move(t.safe(n.meta,{before:c,after:`
`,encode:["`"],...o.current()})),d()}return c+=o.move(`
`),s&&(c+=o.move(s+`
`)),c+=o.move(l),u(),c}function W7(n,e,t){return(t?"":"    ")+n}function Oy(n){const e=n.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function q7(n,e,t,i){const r=Oy(t),s=r==='"'?"Quote":"Apostrophe",a=t.enter("definition");let o=t.enter("label");const l=t.createTracker(i);let u=l.move("[");return u+=l.move(t.safe(t.associationId(n),{before:u,after:"]",...l.current()})),u+=l.move("]: "),o(),!n.url||/[\0- \u007F]/.test(n.url)?(o=t.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(t.safe(n.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(o=t.enter("destinationRaw"),u+=l.move(t.safe(n.url,{before:u,after:n.title?" ":`
`,...l.current()}))),o(),n.title&&(o=t.enter(`title${s}`),u+=l.move(" "+r),u+=l.move(t.safe(n.title,{before:u,after:r,...l.current()})),u+=l.move(r),o()),a(),u}function $7(n){const e=n.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function Ul(n){return"&#x"+n.toString(16).toUpperCase()+";"}function iu(n){if(n===null||Ut(n)||za(n))return 1;if(gh(n))return 2}function Mf(n,e,t){const i=iu(n),r=iu(e);return i===void 0?r===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}TR.peek=K7;function TR(n,e,t,i){const r=$7(t),s=t.enter("emphasis"),a=t.createTracker(i),o=a.move(r);let l=a.move(t.containerPhrasing(n,{after:r,before:o,...a.current()}));const u=l.charCodeAt(0),c=Mf(i.before.charCodeAt(i.before.length-1),u,r);c.inside&&(l=Ul(u)+l.slice(1));const d=l.charCodeAt(l.length-1),h=Mf(i.after.charCodeAt(0),d,r);h.inside&&(l=l.slice(0,-1)+Ul(d));const p=a.move(r);return s(),t.attentionEncodeSurroundingInfo={after:h.outside,before:c.outside},o+l+p}function K7(n,e,t){return t.options.emphasis||"*"}const Y7={};function Ny(n,e){const t=Y7,i=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,r=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return xR(n,i,r)}function xR(n,e,t){if(X7(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return Yx(n.children,e,t)}return Array.isArray(n)?Yx(n,e,t):""}function Yx(n,e,t){const i=[];let r=-1;for(;++r<n.length;)i[r]=xR(n[r],e,t);return i.join("")}function X7(n){return!!(n&&typeof n=="object")}function Q7(n,e){let t=!1;return Py(n,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return t=!0,sv}),!!((!n.depth||n.depth<3)&&Ny(n)&&(e.options.setext||t))}function Z7(n,e,t,i){const r=Math.max(Math.min(6,n.depth||1),1),s=t.createTracker(i);if(Q7(n,t)){const c=t.enter("headingSetext"),d=t.enter("phrasing"),h=t.containerPhrasing(n,{...s.current(),before:`
`,after:`
`});return d(),c(),h+`
`+(r===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const a="#".repeat(r),o=t.enter("headingAtx"),l=t.enter("phrasing");s.move(a+" ");let u=t.containerPhrasing(n,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(u)&&(u=Ul(u.charCodeAt(0))+u.slice(1)),u=u?a+" "+u:a,t.options.closeAtx&&(u+=" "+a),l(),o(),u}SR.peek=J7;function SR(n){return n.value||""}function J7(){return"<"}wR.peek=eH;function wR(n,e,t,i){const r=Oy(t),s=r==='"'?"Quote":"Apostrophe",a=t.enter("image");let o=t.enter("label");const l=t.createTracker(i);let u=l.move("![");return u+=l.move(t.safe(n.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),o(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(o=t.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(t.safe(n.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(o=t.enter("destinationRaw"),u+=l.move(t.safe(n.url,{before:u,after:n.title?" ":")",...l.current()}))),o(),n.title&&(o=t.enter(`title${s}`),u+=l.move(" "+r),u+=l.move(t.safe(n.title,{before:u,after:r,...l.current()})),u+=l.move(r),o()),u+=l.move(")"),a(),u}function eH(){return"!"}AR.peek=tH;function AR(n,e,t,i){const r=n.referenceType,s=t.enter("imageReference");let a=t.enter("label");const o=t.createTracker(i);let l=o.move("![");const u=t.safe(n.alt,{before:l,after:"]",...o.current()});l+=o.move(u+"]["),a();const c=t.stack;t.stack=[],a=t.enter("reference");const d=t.safe(t.associationId(n),{before:l,after:"]",...o.current()});return a(),t.stack=c,s(),r==="full"||!u||u!==d?l+=o.move(d+"]"):r==="shortcut"?l=l.slice(0,-1):l+=o.move("]"),l}function tH(){return"!"}CR.peek=nH;function CR(n,e,t){let i=n.value||"",r="`",s=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(i);)r+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++s<t.unsafe.length;){const a=t.unsafe[s],o=t.compilePattern(a);let l;if(a.atBreak)for(;l=o.exec(i);){let u=l.index;i.charCodeAt(u)===10&&i.charCodeAt(u-1)===13&&u--,i=i.slice(0,u)+" "+i.slice(l.index+1)}}return r+i+r}function nH(){return"`"}function IR(n,e){const t=Ny(n);return!!(!e.options.resourceLink&&n.url&&!n.title&&n.children&&n.children.length===1&&n.children[0].type==="text"&&(t===n.url||"mailto:"+t===n.url)&&/^[a-z][a-z+.-]+:/i.test(n.url)&&!/[\0- <>\u007F]/.test(n.url))}RR.peek=iH;function RR(n,e,t,i){const r=Oy(t),s=r==='"'?"Quote":"Apostrophe",a=t.createTracker(i);let o,l;if(IR(n,t)){const c=t.stack;t.stack=[],o=t.enter("autolink");let d=a.move("<");return d+=a.move(t.containerPhrasing(n,{before:d,after:">",...a.current()})),d+=a.move(">"),o(),t.stack=c,d}o=t.enter("link"),l=t.enter("label");let u=a.move("[");return u+=a.move(t.containerPhrasing(n,{before:u,after:"](",...a.current()})),u+=a.move("]("),l(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(l=t.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(t.safe(n.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(l=t.enter("destinationRaw"),u+=a.move(t.safe(n.url,{before:u,after:n.title?" ":")",...a.current()}))),l(),n.title&&(l=t.enter(`title${s}`),u+=a.move(" "+r),u+=a.move(t.safe(n.title,{before:u,after:r,...a.current()})),u+=a.move(r),l()),u+=a.move(")"),o(),u}function iH(n,e,t){return IR(n,t)?"<":"["}_R.peek=rH;function _R(n,e,t,i){const r=n.referenceType,s=t.enter("linkReference");let a=t.enter("label");const o=t.createTracker(i);let l=o.move("[");const u=t.containerPhrasing(n,{before:l,after:"]",...o.current()});l+=o.move(u+"]["),a();const c=t.stack;t.stack=[],a=t.enter("reference");const d=t.safe(t.associationId(n),{before:l,after:"]",...o.current()});return a(),t.stack=c,s(),r==="full"||!u||u!==d?l+=o.move(d+"]"):r==="shortcut"?l=l.slice(0,-1):l+=o.move("]"),l}function rH(){return"["}function My(n){const e=n.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function sH(n){const e=My(n),t=n.options.bulletOther;if(!t)return e==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+t+"`) to be different");return t}function aH(n){const e=n.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function LR(n){const e=n.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function oH(n,e,t,i){const r=t.enter("list"),s=t.bulletCurrent;let a=n.ordered?aH(t):My(t);const o=n.ordered?a==="."?")":".":sH(t);let l=e&&t.bulletLastUsed?a===t.bulletLastUsed:!1;if(!n.ordered){const c=n.children?n.children[0]:void 0;if((a==="*"||a==="-")&&c&&(!c.children||!c.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(l=!0),LR(t)===a&&c){let d=-1;for(;++d<n.children.length;){const h=n.children[d];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(a=o),t.bulletCurrent=a;const u=t.containerFlow(n,i);return t.bulletLastUsed=a,t.bulletCurrent=s,r(),u}function uH(n){const e=n.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function lH(n,e,t,i){const r=uH(t);let s=t.bulletCurrent||My(t);e&&e.type==="list"&&e.ordered&&(s=(typeof e.start=="number"&&e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(n))+s);let a=s.length+1;(r==="tab"||r==="mixed"&&(e&&e.type==="list"&&e.spread||n.spread))&&(a=Math.ceil(a/4)*4);const o=t.createTracker(i);o.move(s+" ".repeat(a-s.length)),o.shift(a);const l=t.enter("listItem"),u=t.indentLines(t.containerFlow(n,o.current()),c);return l(),u;function c(d,h,p){return h?(p?"":" ".repeat(a))+d:(p?s:s+" ".repeat(a-s.length))+d}}function cH(n,e,t,i){const r=t.enter("paragraph"),s=t.enter("phrasing"),a=t.containerPhrasing(n,i);return s(),r(),a}const dH=ph(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function fH(n,e,t,i){return(n.children.some(function(a){return dH(a)})?t.containerPhrasing:t.containerFlow).call(t,n,i)}function hH(n){const e=n.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}PR.peek=pH;function PR(n,e,t,i){const r=hH(t),s=t.enter("strong"),a=t.createTracker(i),o=a.move(r+r);let l=a.move(t.containerPhrasing(n,{after:r,before:o,...a.current()}));const u=l.charCodeAt(0),c=Mf(i.before.charCodeAt(i.before.length-1),u,r);c.inside&&(l=Ul(u)+l.slice(1));const d=l.charCodeAt(l.length-1),h=Mf(i.after.charCodeAt(0),d,r);h.inside&&(l=l.slice(0,-1)+Ul(d));const p=a.move(r+r);return s(),t.attentionEncodeSurroundingInfo={after:h.outside,before:c.outside},o+l+p}function pH(n,e,t){return t.options.strong||"*"}function mH(n,e,t,i){return t.safe(n.value,i)}function gH(n){const e=n.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function vH(n,e,t){const i=(LR(t)+(t.options.ruleSpaces?" ":"")).repeat(gH(t));return t.options.ruleSpaces?i.slice(0,-1):i}const kR={blockquote:B7,break:Kx,code:G7,definition:q7,emphasis:TR,hardBreak:Kx,heading:Z7,html:SR,image:wR,imageReference:AR,inlineCode:CR,link:RR,linkReference:_R,list:oH,listItem:lH,paragraph:cH,root:fH,strong:PR,text:mH,thematicBreak:vH},Xx=document.createElement("i");function Fy(n){const e="&"+n+";";Xx.innerHTML=e;const t=Xx.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}function DR(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}const yH=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function EH(n){return n.replace(yH,bH)}function bH(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const r=t.charCodeAt(1),s=r===120||r===88;return DR(t.slice(s?2:1),s?16:10)}return Fy(t)||n}function TH(){return{enter:{table:xH,tableData:Qx,tableHeader:Qx,tableRow:wH},exit:{codeText:AH,table:SH,tableData:X0,tableHeader:X0,tableRow:X0}}}function xH(n){const e=n._align;this.enter({type:"table",align:e.map(function(t){return t==="none"?null:t}),children:[]},n),this.data.inTable=!0}function SH(n){this.exit(n),this.data.inTable=void 0}function wH(n){this.enter({type:"tableRow",children:[]},n)}function X0(n){this.exit(n)}function Qx(n){this.enter({type:"tableCell",children:[]},n)}function AH(n){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,CH));const t=this.stack[this.stack.length-1];t.type,t.value=e,this.exit(n)}function CH(n,e){return e==="|"?e:n}function IH(n){const e=n||{},t=e.tableCellPadding,i=e.tablePipeAlign,r=e.stringLength,s=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:h,table:a,tableCell:l,tableRow:o}};function a(p,g,v,y){return u(c(p,v,y),p.align)}function o(p,g,v,y){const b=d(p,v,y),T=u([b]);return T.slice(0,T.indexOf(`
`))}function l(p,g,v,y){const b=v.enter("tableCell"),T=v.enter("phrasing"),x=v.containerPhrasing(p,{...y,before:s,after:s});return T(),b(),x}function u(p,g){return M7(p,{align:g,alignDelimiters:i,padding:t,stringLength:r})}function c(p,g,v){const y=p.children;let b=-1;const T=[],x=g.enter("table");for(;++b<y.length;)T[b]=d(y[b],g,v);return x(),T}function d(p,g,v){const y=p.children;let b=-1;const T=[],x=g.enter("tableRow");for(;++b<y.length;)T[b]=l(y[b],p,g,v);return x(),T}function h(p,g,v){let y=kR.inlineCode(p,g,v);return v.stack.includes("tableCell")&&(y=y.replace(/\|/g,"\\$&")),y}}function RH(){return{exit:{taskListCheckValueChecked:Zx,taskListCheckValueUnchecked:Zx,paragraph:LH}}}function _H(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:PH}}}function Zx(n){const e=this.stack[this.stack.length-2];e.type,e.checked=n.type==="taskListCheckValueChecked"}function LH(n){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const i=t.children[0];if(i&&i.type==="text"){const r=e.children;let s=-1,a;for(;++s<r.length;){const o=r[s];if(o.type==="paragraph"){a=o;break}}a===t&&(i.value=i.value.slice(1),i.value.length===0?t.children.shift():t.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,t.position.start=Object.assign({},i.position.start)))}}this.exit(n)}function PH(n,e,t,i){const r=n.children[0],s=typeof n.checked=="boolean"&&r&&r.type==="paragraph",a="["+(n.checked?"x":" ")+"] ",o=t.createTracker(i);s&&o.move(a);let l=kR.listItem(n,e,t,{...i,...o.current()});return s&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),l;function u(c){return c+a}}function kH(){return[s7(),C7(),L7(),TH(),RH()]}function DH(n){return{extensions:[a7(),I7(n),P7(),IH(n),_H()]}}function Ei(n,e,t,i){const r=n.length;let s=0,a;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,t=t>0?t:0,i.length<1e4)a=Array.from(i),a.unshift(e,t),n.splice(...a);else for(t&&n.splice(e,t);s<i.length;)a=i.slice(s,s+1e4),a.unshift(e,0),n.splice(...a),s+=1e4,e+=1e4}function Di(n,e){return n.length>0?(Ei(n,n.length,0,e),n):e}const Jx={}.hasOwnProperty;function OR(n){const e={};let t=-1;for(;++t<n.length;)OH(e,n[t]);return e}function OH(n,e){let t;for(t in e){const r=(Jx.call(n,t)?n[t]:void 0)||(n[t]={}),s=e[t];let a;if(s)for(a in s){Jx.call(r,a)||(r[a]=[]);const o=s[a];NH(r[a],Array.isArray(o)?o:o?[o]:[])}}}function NH(n,e){let t=-1;const i=[];for(;++t<e.length;)(e[t].add==="after"?n:i).push(e[t]);Ei(n,0,0,i)}const MH={tokenize:jH,partial:!0},NR={tokenize:VH,partial:!0},MR={tokenize:GH,partial:!0},FR={tokenize:WH,partial:!0},FH={tokenize:qH,partial:!0},BR={name:"wwwAutolink",tokenize:HH,previous:HR},UR={name:"protocolAutolink",tokenize:zH,previous:zR},ss={name:"emailAutolink",tokenize:UH,previous:jR},Ir={};function BH(){return{text:Ir}}let ba=48;for(;ba<123;)Ir[ba]=ss,ba++,ba===58?ba=65:ba===91&&(ba=97);Ir[43]=ss;Ir[45]=ss;Ir[46]=ss;Ir[95]=ss;Ir[72]=[ss,UR];Ir[104]=[ss,UR];Ir[87]=[ss,BR];Ir[119]=[ss,BR];function UH(n,e,t){const i=this;let r,s;return a;function a(d){return!uv(d)||!jR.call(i,i.previous)||By(i.events)?t(d):(n.enter("literalAutolink"),n.enter("literalAutolinkEmail"),o(d))}function o(d){return uv(d)?(n.consume(d),o):d===64?(n.consume(d),l):t(d)}function l(d){return d===46?n.check(FH,c,u)(d):d===45||d===95||Bn(d)?(s=!0,n.consume(d),l):c(d)}function u(d){return n.consume(d),r=!0,l}function c(d){return s&&r&&qn(i.previous)?(n.exit("literalAutolinkEmail"),n.exit("literalAutolink"),e(d)):t(d)}}function HH(n,e,t){const i=this;return r;function r(a){return a!==87&&a!==119||!HR.call(i,i.previous)||By(i.events)?t(a):(n.enter("literalAutolink"),n.enter("literalAutolinkWww"),n.check(MH,n.attempt(NR,n.attempt(MR,s),t),t)(a))}function s(a){return n.exit("literalAutolinkWww"),n.exit("literalAutolink"),e(a)}}function zH(n,e,t){const i=this;let r="",s=!1;return a;function a(d){return(d===72||d===104)&&zR.call(i,i.previous)&&!By(i.events)?(n.enter("literalAutolink"),n.enter("literalAutolinkHttp"),r+=String.fromCodePoint(d),n.consume(d),o):t(d)}function o(d){if(qn(d)&&r.length<5)return r+=String.fromCodePoint(d),n.consume(d),o;if(d===58){const h=r.toLowerCase();if(h==="http"||h==="https")return n.consume(d),l}return t(d)}function l(d){return d===47?(n.consume(d),s?u:(s=!0,l)):t(d)}function u(d){return d===null||Nf(d)||Ut(d)||za(d)||gh(d)?t(d):n.attempt(NR,n.attempt(MR,c),t)(d)}function c(d){return n.exit("literalAutolinkHttp"),n.exit("literalAutolink"),e(d)}}function jH(n,e,t){let i=0;return r;function r(a){return(a===87||a===119)&&i<3?(i++,n.consume(a),r):a===46&&i===3?(n.consume(a),s):t(a)}function s(a){return a===null?t(a):e(a)}}function VH(n,e,t){let i,r,s;return a;function a(u){return u===46||u===95?n.check(FR,l,o)(u):u===null||Ut(u)||za(u)||u!==45&&gh(u)?l(u):(s=!0,n.consume(u),a)}function o(u){return u===95?i=!0:(r=i,i=void 0),n.consume(u),a}function l(u){return r||i||!s?t(u):e(u)}}function GH(n,e){let t=0,i=0;return r;function r(a){return a===40?(t++,n.consume(a),r):a===41&&i<t?s(a):a===33||a===34||a===38||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===60||a===63||a===93||a===95||a===126?n.check(FR,e,s)(a):a===null||Ut(a)||za(a)?e(a):(n.consume(a),r)}function s(a){return a===41&&i++,n.consume(a),r}}function WH(n,e,t){return i;function i(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(n.consume(o),i):o===38?(n.consume(o),s):o===93?(n.consume(o),r):o===60||o===null||Ut(o)||za(o)?e(o):t(o)}function r(o){return o===null||o===40||o===91||Ut(o)||za(o)?e(o):i(o)}function s(o){return qn(o)?a(o):t(o)}function a(o){return o===59?(n.consume(o),i):qn(o)?(n.consume(o),a):t(o)}}function qH(n,e,t){return i;function i(s){return n.consume(s),r}function r(s){return Bn(s)?t(s):e(s)}}function HR(n){return n===null||n===40||n===42||n===95||n===91||n===93||n===126||Ut(n)}function zR(n){return!qn(n)}function jR(n){return!(n===47||uv(n))}function uv(n){return n===43||n===45||n===46||n===95||Bn(n)}function By(n){let e=n.length,t=!1;for(;e--;){const i=n[e][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){t=!0;break}if(i._gfmAutolinkLiteralWalkedInto){t=!1;break}}return n.length>0&&!t&&(n[n.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}function pu(n){const e=[];let t=-1,i=0,r=0;for(;++t<n.length;){const s=n.charCodeAt(t);let a="";if(s===37&&Bn(n.charCodeAt(t+1))&&Bn(n.charCodeAt(t+2)))r=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(a=String.fromCharCode(s));else if(s>55295&&s<57344){const o=n.charCodeAt(t+1);s<56320&&o>56319&&o<57344?(a=String.fromCharCode(s,o),r=1):a=""}else a=String.fromCharCode(s);a&&(e.push(n.slice(i,t),encodeURIComponent(a)),i=t+r+1,a=""),r&&(t+=r,r=0)}return e.join("")+n.slice(i)}function vh(n,e,t){const i=[];let r=-1;for(;++r<n.length;){const s=n[r].resolveAll;s&&!i.includes(s)&&(e=s(e,t),i.push(s))}return e}const lv={name:"attention",resolveAll:$H,tokenize:KH};function $H(n,e){let t=-1,i,r,s,a,o,l,u,c;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(i=t;i--;)if(n[i][0]==="exit"&&n[i][1].type==="attentionSequence"&&n[i][1]._open&&e.sliceSerialize(n[i][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[i][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[i][1].end.offset-n[i][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;l=n[i][1].end.offset-n[i][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const d={...n[i][1].end},h={...n[t][1].start};eS(d,-l),eS(h,l),a={type:l>1?"strongSequence":"emphasisSequence",start:d,end:{...n[i][1].end}},o={type:l>1?"strongSequence":"emphasisSequence",start:{...n[t][1].start},end:h},s={type:l>1?"strongText":"emphasisText",start:{...n[i][1].end},end:{...n[t][1].start}},r={type:l>1?"strong":"emphasis",start:{...a.start},end:{...o.end}},n[i][1].end={...a.start},n[t][1].start={...o.end},u=[],n[i][1].end.offset-n[i][1].start.offset&&(u=Di(u,[["enter",n[i][1],e],["exit",n[i][1],e]])),u=Di(u,[["enter",r,e],["enter",a,e],["exit",a,e],["enter",s,e]]),u=Di(u,vh(e.parser.constructs.insideSpan.null,n.slice(i+1,t),e)),u=Di(u,[["exit",s,e],["enter",o,e],["exit",o,e],["exit",r,e]]),n[t][1].end.offset-n[t][1].start.offset?(c=2,u=Di(u,[["enter",n[t][1],e],["exit",n[t][1],e]])):c=0,Ei(n,i-1,t-i+3,u),t=i+u.length-c-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}function KH(n,e){const t=this.parser.constructs.attentionMarkers.null,i=this.previous,r=iu(i);let s;return a;function a(l){return s=l,n.enter("attentionSequence"),o(l)}function o(l){if(l===s)return n.consume(l),o;const u=n.exit("attentionSequence"),c=iu(l),d=!c||c===2&&r||t.includes(l),h=!r||r===2&&c||t.includes(i);return u._open=!!(s===42?d:d&&(r||!h)),u._close=!!(s===42?h:h&&(c||!d)),e(l)}}function eS(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}const YH={name:"autolink",tokenize:XH};function XH(n,e,t){let i=0;return r;function r(p){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),s}function s(p){return qn(p)?(n.consume(p),a):p===64?t(p):u(p)}function a(p){return p===43||p===45||p===46||Bn(p)?(i=1,o(p)):u(p)}function o(p){return p===58?(n.consume(p),i=0,l):(p===43||p===45||p===46||Bn(p))&&i++<32?(n.consume(p),o):(i=0,u(p))}function l(p){return p===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):p===null||p===32||p===60||Nf(p)?t(p):(n.consume(p),l)}function u(p){return p===64?(n.consume(p),c):QU(p)?(n.consume(p),u):t(p)}function c(p){return Bn(p)?d(p):t(p)}function d(p){return p===46?(n.consume(p),i=0,c):p===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):h(p)}function h(p){if((p===45||Bn(p))&&i++<63){const g=p===45?h:d;return n.consume(p),g}return t(p)}}function Rt(n,e,t,i){const r=i?i-1:Number.POSITIVE_INFINITY;let s=0;return a;function a(l){return Ct(l)?(n.enter(t),o(l)):e(l)}function o(l){return Ct(l)&&s++<r?(n.consume(l),o):(n.exit(t),e(l))}}const rc={partial:!0,tokenize:QH};function QH(n,e,t){return i;function i(s){return Ct(s)?Rt(n,r,"linePrefix")(s):r(s)}function r(s){return s===null||ct(s)?e(s):t(s)}}const VR={continuation:{tokenize:JH},exit:ez,name:"blockQuote",tokenize:ZH};function ZH(n,e,t){const i=this;return r;function r(a){if(a===62){const o=i.containerState;return o.open||(n.enter("blockQuote",{_container:!0}),o.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(a),n.exit("blockQuoteMarker"),s}return t(a)}function s(a){return Ct(a)?(n.enter("blockQuotePrefixWhitespace"),n.consume(a),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(a))}}function JH(n,e,t){const i=this;return r;function r(a){return Ct(a)?Rt(n,s,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):s(a)}function s(a){return n.attempt(VR,e,t)(a)}}function ez(n){n.exit("blockQuote")}const GR={name:"characterEscape",tokenize:tz};function tz(n,e,t){return i;function i(s){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(s),n.exit("escapeMarker"),r}function r(s){return JU(s)?(n.enter("characterEscapeValue"),n.consume(s),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(s)}}const WR={name:"characterReference",tokenize:nz};function nz(n,e,t){const i=this;let r=0,s,a;return o;function o(d){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),l}function l(d){return d===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(d),n.exit("characterReferenceMarkerNumeric"),u):(n.enter("characterReferenceValue"),s=31,a=Bn,c(d))}function u(d){return d===88||d===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(d),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),s=6,a=ZU,c):(n.enter("characterReferenceValue"),s=7,a=ov,c(d))}function c(d){if(d===59&&r){const h=n.exit("characterReferenceValue");return a===Bn&&!Fy(i.sliceSerialize(h))?t(d):(n.enter("characterReferenceMarker"),n.consume(d),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return a(d)&&r++<s?(n.consume(d),c):t(d)}}const tS={partial:!0,tokenize:rz},nS={concrete:!0,name:"codeFenced",tokenize:iz};function iz(n,e,t){const i=this,r={partial:!0,tokenize:A};let s=0,a=0,o;return l;function l(R){return u(R)}function u(R){const _=i.events[i.events.length-1];return s=_&&_[1].type==="linePrefix"?_[2].sliceSerialize(_[1],!0).length:0,o=R,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),c(R)}function c(R){return R===o?(a++,n.consume(R),c):a<3?t(R):(n.exit("codeFencedFenceSequence"),Ct(R)?Rt(n,d,"whitespace")(R):d(R))}function d(R){return R===null||ct(R)?(n.exit("codeFencedFence"),i.interrupt?e(R):n.check(tS,v,w)(R)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),h(R))}function h(R){return R===null||ct(R)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),d(R)):Ct(R)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),Rt(n,p,"whitespace")(R)):R===96&&R===o?t(R):(n.consume(R),h)}function p(R){return R===null||ct(R)?d(R):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),g(R))}function g(R){return R===null||ct(R)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),d(R)):R===96&&R===o?t(R):(n.consume(R),g)}function v(R){return n.attempt(r,w,y)(R)}function y(R){return n.enter("lineEnding"),n.consume(R),n.exit("lineEnding"),b}function b(R){return s>0&&Ct(R)?Rt(n,T,"linePrefix",s+1)(R):T(R)}function T(R){return R===null||ct(R)?n.check(tS,v,w)(R):(n.enter("codeFlowValue"),x(R))}function x(R){return R===null||ct(R)?(n.exit("codeFlowValue"),T(R)):(n.consume(R),x)}function w(R){return n.exit("codeFenced"),e(R)}function A(R,_,D){let H=0;return P;function P(Q){return R.enter("lineEnding"),R.consume(Q),R.exit("lineEnding"),N}function N(Q){return R.enter("codeFencedFence"),Ct(Q)?Rt(R,G,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Q):G(Q)}function G(Q){return Q===o?(R.enter("codeFencedFenceSequence"),X(Q)):D(Q)}function X(Q){return Q===o?(H++,R.consume(Q),X):H>=a?(R.exit("codeFencedFenceSequence"),Ct(Q)?Rt(R,te,"whitespace")(Q):te(Q)):D(Q)}function te(Q){return Q===null||ct(Q)?(R.exit("codeFencedFence"),_(Q)):D(Q)}}}function rz(n,e,t){const i=this;return r;function r(a){return a===null?t(a):(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),s)}function s(a){return i.parser.lazy[i.now().line]?t(a):e(a)}}const Q0={name:"codeIndented",tokenize:az},sz={partial:!0,tokenize:oz};function az(n,e,t){const i=this;return r;function r(u){return n.enter("codeIndented"),Rt(n,s,"linePrefix",5)(u)}function s(u){const c=i.events[i.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?a(u):t(u)}function a(u){return u===null?l(u):ct(u)?n.attempt(sz,a,l)(u):(n.enter("codeFlowValue"),o(u))}function o(u){return u===null||ct(u)?(n.exit("codeFlowValue"),a(u)):(n.consume(u),o)}function l(u){return n.exit("codeIndented"),e(u)}}function oz(n,e,t){const i=this;return r;function r(a){return i.parser.lazy[i.now().line]?t(a):ct(a)?(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),r):Rt(n,s,"linePrefix",5)(a)}function s(a){const o=i.events[i.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(a):ct(a)?r(a):t(a)}}const uz={name:"codeText",previous:cz,resolve:lz,tokenize:dz};function lz(n){let e=n.length-4,t=3,i,r;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(i=t;++i<e;)if(n[i][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(i=t-1,e++;++i<=e;)r===void 0?i!==e&&n[i][1].type!=="lineEnding"&&(r=i):(i===e||n[i][1].type==="lineEnding")&&(n[r][1].type="codeTextData",i!==r+2&&(n[r][1].end=n[i-1][1].end,n.splice(r+2,i-r-2),e-=i-r-2,i=r+2),r=void 0);return n}function cz(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}function dz(n,e,t){let i=0,r,s;return a;function a(d){return n.enter("codeText"),n.enter("codeTextSequence"),o(d)}function o(d){return d===96?(n.consume(d),i++,o):(n.exit("codeTextSequence"),l(d))}function l(d){return d===null?t(d):d===32?(n.enter("space"),n.consume(d),n.exit("space"),l):d===96?(s=n.enter("codeTextSequence"),r=0,c(d)):ct(d)?(n.enter("lineEnding"),n.consume(d),n.exit("lineEnding"),l):(n.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||ct(d)?(n.exit("codeTextData"),l(d)):(n.consume(d),u)}function c(d){return d===96?(n.consume(d),r++,c):r===i?(n.exit("codeTextSequence"),n.exit("codeText"),e(d)):(s.type="codeTextData",u(d))}}class fz{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const i=t??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(e,i):e>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(e,t,i){const r=t||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return i&&ll(this.left,i),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),ll(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),ll(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);ll(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);ll(this.left,t.reverse())}}}function ll(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}function qR(n){const e={};let t=-1,i,r,s,a,o,l,u;const c=new fz(n);for(;++t<c.length;){for(;t in e;)t=e[t];if(i=c.get(t),t&&i[1].type==="chunkFlow"&&c.get(t-1)[1].type==="listItemPrefix"&&(l=i[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1]._isInFirstContentOfListItem=!0,s++);if(i[0]==="enter")i[1].contentType&&(Object.assign(e,hz(c,t)),t=e[t],u=!0);else if(i[1]._container){for(s=t,r=void 0;s--;)if(a=c.get(s),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank")a[0]==="enter"&&(r&&(c.get(r)[1].type="lineEndingBlank"),a[1].type="lineEnding",r=s);else if(!(a[1].type==="linePrefix"||a[1].type==="listItemIndent"))break;r&&(i[1].end={...c.get(r)[1].start},o=c.slice(r,t),o.unshift(i),c.splice(r,t-r+1,o))}}return Ei(n,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function hz(n,e){const t=n.get(e)[1],i=n.get(e)[2];let r=e-1;const s=[];let a=t._tokenizer;a||(a=i.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));const o=a.events,l=[],u={};let c,d,h=-1,p=t,g=0,v=0;const y=[v];for(;p;){for(;n.get(++r)[1]!==p;);s.push(r),p._tokenizer||(c=i.sliceStream(p),p.next||c.push(null),d&&a.defineSkip(p.start),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(c),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=t;++h<o.length;)o[h][0]==="exit"&&o[h-1][0]==="enter"&&o[h][1].type===o[h-1][1].type&&o[h][1].start.line!==o[h][1].end.line&&(v=h+1,y.push(v),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(a.events=[],p?(p._tokenizer=void 0,p.previous=void 0):y.pop(),h=y.length;h--;){const b=o.slice(y[h],y[h+1]),T=s.pop();l.push([T,T+b.length-1]),n.splice(T,2,b)}for(l.reverse(),h=-1;++h<l.length;)u[g+l[h][0]]=g+l[h][1],g+=l[h][1]-l[h][0]-1;return u}const pz={resolve:gz,tokenize:vz},mz={partial:!0,tokenize:yz};function gz(n){return qR(n),n}function vz(n,e){let t;return i;function i(o){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),r(o)}function r(o){return o===null?s(o):ct(o)?n.check(mz,a,s)(o):(n.consume(o),r)}function s(o){return n.exit("chunkContent"),n.exit("content"),e(o)}function a(o){return n.consume(o),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,r}}function yz(n,e,t){const i=this;return r;function r(a){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),Rt(n,s,"linePrefix")}function s(a){if(a===null||ct(a))return t(a);const o=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(a):n.interrupt(i.parser.constructs.flow,t,e)(a)}}function $R(n,e,t,i,r,s,a,o,l){const u=l||Number.POSITIVE_INFINITY;let c=0;return d;function d(b){return b===60?(n.enter(i),n.enter(r),n.enter(s),n.consume(b),n.exit(s),h):b===null||b===32||b===41||Nf(b)?t(b):(n.enter(i),n.enter(a),n.enter(o),n.enter("chunkString",{contentType:"string"}),v(b))}function h(b){return b===62?(n.enter(s),n.consume(b),n.exit(s),n.exit(r),n.exit(i),e):(n.enter(o),n.enter("chunkString",{contentType:"string"}),p(b))}function p(b){return b===62?(n.exit("chunkString"),n.exit(o),h(b)):b===null||b===60||ct(b)?t(b):(n.consume(b),b===92?g:p)}function g(b){return b===60||b===62||b===92?(n.consume(b),p):p(b)}function v(b){return!c&&(b===null||b===41||Ut(b))?(n.exit("chunkString"),n.exit(o),n.exit(a),n.exit(i),e(b)):c<u&&b===40?(n.consume(b),c++,v):b===41?(n.consume(b),c--,v):b===null||b===32||b===40||Nf(b)?t(b):(n.consume(b),b===92?y:v)}function y(b){return b===40||b===41||b===92?(n.consume(b),v):v(b)}}function KR(n,e,t,i,r,s){const a=this;let o=0,l;return u;function u(p){return n.enter(i),n.enter(r),n.consume(p),n.exit(r),n.enter(s),c}function c(p){return o>999||p===null||p===91||p===93&&!l||p===94&&!o&&"_hiddenFootnoteSupport"in a.parser.constructs?t(p):p===93?(n.exit(s),n.enter(r),n.consume(p),n.exit(r),n.exit(i),e):ct(p)?(n.enter("lineEnding"),n.consume(p),n.exit("lineEnding"),c):(n.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===null||p===91||p===93||ct(p)||o++>999?(n.exit("chunkString"),c(p)):(n.consume(p),l||(l=!Ct(p)),p===92?h:d)}function h(p){return p===91||p===92||p===93?(n.consume(p),o++,d):d(p)}}function YR(n,e,t,i,r,s){let a;return o;function o(h){return h===34||h===39||h===40?(n.enter(i),n.enter(r),n.consume(h),n.exit(r),a=h===40?41:h,l):t(h)}function l(h){return h===a?(n.enter(r),n.consume(h),n.exit(r),n.exit(i),e):(n.enter(s),u(h))}function u(h){return h===a?(n.exit(s),l(a)):h===null?t(h):ct(h)?(n.enter("lineEnding"),n.consume(h),n.exit("lineEnding"),Rt(n,u,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),c(h))}function c(h){return h===a||h===null||ct(h)?(n.exit("chunkString"),u(h)):(n.consume(h),h===92?d:c)}function d(h){return h===a||h===92?(n.consume(h),c):c(h)}}function Rl(n,e){let t;return i;function i(r){return ct(r)?(n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),t=!0,i):Ct(r)?Rt(n,i,t?"linePrefix":"lineSuffix")(r):e(r)}}const Ez={name:"definition",tokenize:Tz},bz={partial:!0,tokenize:xz};function Tz(n,e,t){const i=this;let r;return s;function s(p){return n.enter("definition"),a(p)}function a(p){return KR.call(i,n,o,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function o(p){return r=Ji(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),p===58?(n.enter("definitionMarker"),n.consume(p),n.exit("definitionMarker"),l):t(p)}function l(p){return Ut(p)?Rl(n,u)(p):u(p)}function u(p){return $R(n,c,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function c(p){return n.attempt(bz,d,d)(p)}function d(p){return Ct(p)?Rt(n,h,"whitespace")(p):h(p)}function h(p){return p===null||ct(p)?(n.exit("definition"),i.parser.defined.push(r),e(p)):t(p)}}function xz(n,e,t){return i;function i(o){return Ut(o)?Rl(n,r)(o):t(o)}function r(o){return YR(n,s,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function s(o){return Ct(o)?Rt(n,a,"whitespace")(o):a(o)}function a(o){return o===null||ct(o)?e(o):t(o)}}const Sz={name:"hardBreakEscape",tokenize:wz};function wz(n,e,t){return i;function i(s){return n.enter("hardBreakEscape"),n.consume(s),r}function r(s){return ct(s)?(n.exit("hardBreakEscape"),e(s)):t(s)}}const Az={name:"headingAtx",resolve:Cz,tokenize:Iz};function Cz(n,e){let t=n.length-2,i=3,r,s;return n[i][1].type==="whitespace"&&(i+=2),t-2>i&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(i===t-1||t-4>i&&n[t-2][1].type==="whitespace")&&(t-=i+1===t?2:4),t>i&&(r={type:"atxHeadingText",start:n[i][1].start,end:n[t][1].end},s={type:"chunkText",start:n[i][1].start,end:n[t][1].end,contentType:"text"},Ei(n,i,t-i+1,[["enter",r,e],["enter",s,e],["exit",s,e],["exit",r,e]])),n}function Iz(n,e,t){let i=0;return r;function r(c){return n.enter("atxHeading"),s(c)}function s(c){return n.enter("atxHeadingSequence"),a(c)}function a(c){return c===35&&i++<6?(n.consume(c),a):c===null||Ut(c)?(n.exit("atxHeadingSequence"),o(c)):t(c)}function o(c){return c===35?(n.enter("atxHeadingSequence"),l(c)):c===null||ct(c)?(n.exit("atxHeading"),e(c)):Ct(c)?Rt(n,o,"whitespace")(c):(n.enter("atxHeadingText"),u(c))}function l(c){return c===35?(n.consume(c),l):(n.exit("atxHeadingSequence"),o(c))}function u(c){return c===null||c===35||Ut(c)?(n.exit("atxHeadingText"),o(c)):(n.consume(c),u)}}const Rz=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],iS=["pre","script","style","textarea"],_z={concrete:!0,name:"htmlFlow",resolveTo:kz,tokenize:Dz},Lz={partial:!0,tokenize:Nz},Pz={partial:!0,tokenize:Oz};function kz(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}function Dz(n,e,t){const i=this;let r,s,a,o,l;return u;function u(z){return c(z)}function c(z){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(z),d}function d(z){return z===33?(n.consume(z),h):z===47?(n.consume(z),s=!0,v):z===63?(n.consume(z),r=3,i.interrupt?e:j):qn(z)?(n.consume(z),a=String.fromCharCode(z),y):t(z)}function h(z){return z===45?(n.consume(z),r=2,p):z===91?(n.consume(z),r=5,o=0,g):qn(z)?(n.consume(z),r=4,i.interrupt?e:j):t(z)}function p(z){return z===45?(n.consume(z),i.interrupt?e:j):t(z)}function g(z){const ve="CDATA[";return z===ve.charCodeAt(o++)?(n.consume(z),o===ve.length?i.interrupt?e:G:g):t(z)}function v(z){return qn(z)?(n.consume(z),a=String.fromCharCode(z),y):t(z)}function y(z){if(z===null||z===47||z===62||Ut(z)){const ve=z===47,Le=a.toLowerCase();return!ve&&!s&&iS.includes(Le)?(r=1,i.interrupt?e(z):G(z)):Rz.includes(a.toLowerCase())?(r=6,ve?(n.consume(z),b):i.interrupt?e(z):G(z)):(r=7,i.interrupt&&!i.parser.lazy[i.now().line]?t(z):s?T(z):x(z))}return z===45||Bn(z)?(n.consume(z),a+=String.fromCharCode(z),y):t(z)}function b(z){return z===62?(n.consume(z),i.interrupt?e:G):t(z)}function T(z){return Ct(z)?(n.consume(z),T):P(z)}function x(z){return z===47?(n.consume(z),P):z===58||z===95||qn(z)?(n.consume(z),w):Ct(z)?(n.consume(z),x):P(z)}function w(z){return z===45||z===46||z===58||z===95||Bn(z)?(n.consume(z),w):A(z)}function A(z){return z===61?(n.consume(z),R):Ct(z)?(n.consume(z),A):x(z)}function R(z){return z===null||z===60||z===61||z===62||z===96?t(z):z===34||z===39?(n.consume(z),l=z,_):Ct(z)?(n.consume(z),R):D(z)}function _(z){return z===l?(n.consume(z),l=null,H):z===null||ct(z)?t(z):(n.consume(z),_)}function D(z){return z===null||z===34||z===39||z===47||z===60||z===61||z===62||z===96||Ut(z)?A(z):(n.consume(z),D)}function H(z){return z===47||z===62||Ct(z)?x(z):t(z)}function P(z){return z===62?(n.consume(z),N):t(z)}function N(z){return z===null||ct(z)?G(z):Ct(z)?(n.consume(z),N):t(z)}function G(z){return z===45&&r===2?(n.consume(z),ne):z===60&&r===1?(n.consume(z),oe):z===62&&r===4?(n.consume(z),q):z===63&&r===3?(n.consume(z),j):z===93&&r===5?(n.consume(z),se):ct(z)&&(r===6||r===7)?(n.exit("htmlFlowData"),n.check(Lz,re,X)(z)):z===null||ct(z)?(n.exit("htmlFlowData"),X(z)):(n.consume(z),G)}function X(z){return n.check(Pz,te,re)(z)}function te(z){return n.enter("lineEnding"),n.consume(z),n.exit("lineEnding"),Q}function Q(z){return z===null||ct(z)?X(z):(n.enter("htmlFlowData"),G(z))}function ne(z){return z===45?(n.consume(z),j):G(z)}function oe(z){return z===47?(n.consume(z),a="",Z):G(z)}function Z(z){if(z===62){const ve=a.toLowerCase();return iS.includes(ve)?(n.consume(z),q):G(z)}return qn(z)&&a.length<8?(n.consume(z),a+=String.fromCharCode(z),Z):G(z)}function se(z){return z===93?(n.consume(z),j):G(z)}function j(z){return z===62?(n.consume(z),q):z===45&&r===2?(n.consume(z),j):G(z)}function q(z){return z===null||ct(z)?(n.exit("htmlFlowData"),re(z)):(n.consume(z),q)}function re(z){return n.exit("htmlFlow"),e(z)}}function Oz(n,e,t){const i=this;return r;function r(a){return ct(a)?(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),s):t(a)}function s(a){return i.parser.lazy[i.now().line]?t(a):e(a)}}function Nz(n,e,t){return i;function i(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),n.attempt(rc,e,t)}}const Mz={name:"htmlText",tokenize:Fz};function Fz(n,e,t){const i=this;let r,s,a;return o;function o(j){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(j),l}function l(j){return j===33?(n.consume(j),u):j===47?(n.consume(j),A):j===63?(n.consume(j),x):qn(j)?(n.consume(j),D):t(j)}function u(j){return j===45?(n.consume(j),c):j===91?(n.consume(j),s=0,g):qn(j)?(n.consume(j),T):t(j)}function c(j){return j===45?(n.consume(j),p):t(j)}function d(j){return j===null?t(j):j===45?(n.consume(j),h):ct(j)?(a=d,oe(j)):(n.consume(j),d)}function h(j){return j===45?(n.consume(j),p):d(j)}function p(j){return j===62?ne(j):j===45?h(j):d(j)}function g(j){const q="CDATA[";return j===q.charCodeAt(s++)?(n.consume(j),s===q.length?v:g):t(j)}function v(j){return j===null?t(j):j===93?(n.consume(j),y):ct(j)?(a=v,oe(j)):(n.consume(j),v)}function y(j){return j===93?(n.consume(j),b):v(j)}function b(j){return j===62?ne(j):j===93?(n.consume(j),b):v(j)}function T(j){return j===null||j===62?ne(j):ct(j)?(a=T,oe(j)):(n.consume(j),T)}function x(j){return j===null?t(j):j===63?(n.consume(j),w):ct(j)?(a=x,oe(j)):(n.consume(j),x)}function w(j){return j===62?ne(j):x(j)}function A(j){return qn(j)?(n.consume(j),R):t(j)}function R(j){return j===45||Bn(j)?(n.consume(j),R):_(j)}function _(j){return ct(j)?(a=_,oe(j)):Ct(j)?(n.consume(j),_):ne(j)}function D(j){return j===45||Bn(j)?(n.consume(j),D):j===47||j===62||Ut(j)?H(j):t(j)}function H(j){return j===47?(n.consume(j),ne):j===58||j===95||qn(j)?(n.consume(j),P):ct(j)?(a=H,oe(j)):Ct(j)?(n.consume(j),H):ne(j)}function P(j){return j===45||j===46||j===58||j===95||Bn(j)?(n.consume(j),P):N(j)}function N(j){return j===61?(n.consume(j),G):ct(j)?(a=N,oe(j)):Ct(j)?(n.consume(j),N):H(j)}function G(j){return j===null||j===60||j===61||j===62||j===96?t(j):j===34||j===39?(n.consume(j),r=j,X):ct(j)?(a=G,oe(j)):Ct(j)?(n.consume(j),G):(n.consume(j),te)}function X(j){return j===r?(n.consume(j),r=void 0,Q):j===null?t(j):ct(j)?(a=X,oe(j)):(n.consume(j),X)}function te(j){return j===null||j===34||j===39||j===60||j===61||j===96?t(j):j===47||j===62||Ut(j)?H(j):(n.consume(j),te)}function Q(j){return j===47||j===62||Ut(j)?H(j):t(j)}function ne(j){return j===62?(n.consume(j),n.exit("htmlTextData"),n.exit("htmlText"),e):t(j)}function oe(j){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(j),n.exit("lineEnding"),Z}function Z(j){return Ct(j)?Rt(n,se,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(j):se(j)}function se(j){return n.enter("htmlTextData"),a(j)}}const Uy={name:"labelEnd",resolveAll:zz,resolveTo:jz,tokenize:Vz},Bz={tokenize:Gz},Uz={tokenize:Wz},Hz={tokenize:qz};function zz(n){let e=-1;const t=[];for(;++e<n.length;){const i=n[e][1];if(t.push(n[e]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const r=i.type==="labelImage"?4:2;i.type="data",e+=r}}return n.length!==t.length&&Ei(n,0,n.length,t),n}function jz(n,e){let t=n.length,i=0,r,s,a,o;for(;t--;)if(r=n[t][1],s){if(r.type==="link"||r.type==="labelLink"&&r._inactive)break;n[t][0]==="enter"&&r.type==="labelLink"&&(r._inactive=!0)}else if(a){if(n[t][0]==="enter"&&(r.type==="labelImage"||r.type==="labelLink")&&!r._balanced&&(s=t,r.type!=="labelLink")){i=2;break}}else r.type==="labelEnd"&&(a=t);const l={type:n[s][1].type==="labelLink"?"link":"image",start:{...n[s][1].start},end:{...n[n.length-1][1].end}},u={type:"label",start:{...n[s][1].start},end:{...n[a][1].end}},c={type:"labelText",start:{...n[s+i+2][1].end},end:{...n[a-2][1].start}};return o=[["enter",l,e],["enter",u,e]],o=Di(o,n.slice(s+1,s+i+3)),o=Di(o,[["enter",c,e]]),o=Di(o,vh(e.parser.constructs.insideSpan.null,n.slice(s+i+4,a-3),e)),o=Di(o,[["exit",c,e],n[a-2],n[a-1],["exit",u,e]]),o=Di(o,n.slice(a+1)),o=Di(o,[["exit",l,e]]),Ei(n,s,n.length,o),n}function Vz(n,e,t){const i=this;let r=i.events.length,s,a;for(;r--;)if((i.events[r][1].type==="labelImage"||i.events[r][1].type==="labelLink")&&!i.events[r][1]._balanced){s=i.events[r][1];break}return o;function o(h){return s?s._inactive?d(h):(a=i.parser.defined.includes(Ji(i.sliceSerialize({start:s.end,end:i.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(h),n.exit("labelMarker"),n.exit("labelEnd"),l):t(h)}function l(h){return h===40?n.attempt(Bz,c,a?c:d)(h):h===91?n.attempt(Uz,c,a?u:d)(h):a?c(h):d(h)}function u(h){return n.attempt(Hz,c,d)(h)}function c(h){return e(h)}function d(h){return s._balanced=!0,t(h)}}function Gz(n,e,t){return i;function i(d){return n.enter("resource"),n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),r}function r(d){return Ut(d)?Rl(n,s)(d):s(d)}function s(d){return d===41?c(d):$R(n,a,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function a(d){return Ut(d)?Rl(n,l)(d):c(d)}function o(d){return t(d)}function l(d){return d===34||d===39||d===40?YR(n,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function u(d){return Ut(d)?Rl(n,c)(d):c(d)}function c(d){return d===41?(n.enter("resourceMarker"),n.consume(d),n.exit("resourceMarker"),n.exit("resource"),e):t(d)}}function Wz(n,e,t){const i=this;return r;function r(o){return KR.call(i,n,s,a,"reference","referenceMarker","referenceString")(o)}function s(o){return i.parser.defined.includes(Ji(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?e(o):t(o)}function a(o){return t(o)}}function qz(n,e,t){return i;function i(s){return n.enter("reference"),n.enter("referenceMarker"),n.consume(s),n.exit("referenceMarker"),r}function r(s){return s===93?(n.enter("referenceMarker"),n.consume(s),n.exit("referenceMarker"),n.exit("reference"),e):t(s)}}const $z={name:"labelStartImage",resolveAll:Uy.resolveAll,tokenize:Kz};function Kz(n,e,t){const i=this;return r;function r(o){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(o),n.exit("labelImageMarker"),s}function s(o){return o===91?(n.enter("labelMarker"),n.consume(o),n.exit("labelMarker"),n.exit("labelImage"),a):t(o)}function a(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?t(o):e(o)}}const Yz={name:"labelStartLink",resolveAll:Uy.resolveAll,tokenize:Xz};function Xz(n,e,t){const i=this;return r;function r(a){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(a),n.exit("labelMarker"),n.exit("labelLink"),s}function s(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?t(a):e(a)}}const Z0={name:"lineEnding",tokenize:Qz};function Qz(n,e){return t;function t(i){return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),Rt(n,e,"linePrefix")}}const df={name:"thematicBreak",tokenize:Zz};function Zz(n,e,t){let i=0,r;return s;function s(u){return n.enter("thematicBreak"),a(u)}function a(u){return r=u,o(u)}function o(u){return u===r?(n.enter("thematicBreakSequence"),l(u)):i>=3&&(u===null||ct(u))?(n.exit("thematicBreak"),e(u)):t(u)}function l(u){return u===r?(n.consume(u),i++,l):(n.exit("thematicBreakSequence"),Ct(u)?Rt(n,o,"whitespace")(u):o(u))}}const ii={continuation:{tokenize:nj},exit:rj,name:"list",tokenize:tj},Jz={partial:!0,tokenize:sj},ej={partial:!0,tokenize:ij};function tj(n,e,t){const i=this,r=i.events[i.events.length-1];let s=r&&r[1].type==="linePrefix"?r[2].sliceSerialize(r[1],!0).length:0,a=0;return o;function o(p){const g=i.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(g==="listUnordered"?!i.containerState.marker||p===i.containerState.marker:ov(p)){if(i.containerState.type||(i.containerState.type=g,n.enter(g,{_container:!0})),g==="listUnordered")return n.enter("listItemPrefix"),p===42||p===45?n.check(df,t,u)(p):u(p);if(!i.interrupt||p===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),l(p)}return t(p)}function l(p){return ov(p)&&++a<10?(n.consume(p),l):(!i.interrupt||a<2)&&(i.containerState.marker?p===i.containerState.marker:p===41||p===46)?(n.exit("listItemValue"),u(p)):t(p)}function u(p){return n.enter("listItemMarker"),n.consume(p),n.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||p,n.check(rc,i.interrupt?t:c,n.attempt(Jz,h,d))}function c(p){return i.containerState.initialBlankLine=!0,s++,h(p)}function d(p){return Ct(p)?(n.enter("listItemPrefixWhitespace"),n.consume(p),n.exit("listItemPrefixWhitespace"),h):t(p)}function h(p){return i.containerState.size=s+i.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(p)}}function nj(n,e,t){const i=this;return i.containerState._closeFlow=void 0,n.check(rc,r,s);function r(o){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,Rt(n,e,"listItemIndent",i.containerState.size+1)(o)}function s(o){return i.containerState.furtherBlankLines||!Ct(o)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,a(o)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,n.attempt(ej,e,a)(o))}function a(o){return i.containerState._closeFlow=!0,i.interrupt=void 0,Rt(n,n.attempt(ii,e,t),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function ij(n,e,t){const i=this;return Rt(n,r,"listItemIndent",i.containerState.size+1);function r(s){const a=i.events[i.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===i.containerState.size?e(s):t(s)}}function rj(n){n.exit(this.containerState.type)}function sj(n,e,t){const i=this;return Rt(n,r,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function r(s){const a=i.events[i.events.length-1];return!Ct(s)&&a&&a[1].type==="listItemPrefixWhitespace"?e(s):t(s)}}const rS={name:"setextUnderline",resolveTo:aj,tokenize:oj};function aj(n,e){let t=n.length,i,r,s;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){i=t;break}n[t][1].type==="paragraph"&&(r=t)}else n[t][1].type==="content"&&n.splice(t,1),!s&&n[t][1].type==="definition"&&(s=t);const a={type:"setextHeading",start:{...n[i][1].start},end:{...n[n.length-1][1].end}};return n[r][1].type="setextHeadingText",s?(n.splice(r,0,["enter",a,e]),n.splice(s+1,0,["exit",n[i][1],e]),n[i][1].end={...n[s][1].end}):n[i][1]=a,n.push(["exit",a,e]),n}function oj(n,e,t){const i=this;let r;return s;function s(u){let c=i.events.length,d;for(;c--;)if(i.events[c][1].type!=="lineEnding"&&i.events[c][1].type!=="linePrefix"&&i.events[c][1].type!=="content"){d=i.events[c][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||d)?(n.enter("setextHeadingLine"),r=u,a(u)):t(u)}function a(u){return n.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===r?(n.consume(u),o):(n.exit("setextHeadingLineSequence"),Ct(u)?Rt(n,l,"lineSuffix")(u):l(u))}function l(u){return u===null||ct(u)?(n.exit("setextHeadingLine"),e(u)):t(u)}}const uj={tokenize:gj,partial:!0};function lj(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:hj,continuation:{tokenize:pj},exit:mj}},text:{91:{name:"gfmFootnoteCall",tokenize:fj},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:cj,resolveTo:dj}}}}function cj(n,e,t){const i=this;let r=i.events.length;const s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a;for(;r--;){const l=i.events[r][1];if(l.type==="labelImage"){a=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return o;function o(l){if(!a||!a._balanced)return t(l);const u=Ji(i.sliceSerialize({start:a.end,end:i.now()}));return u.codePointAt(0)!==94||!s.includes(u.slice(1))?t(l):(n.enter("gfmFootnoteCallLabelMarker"),n.consume(l),n.exit("gfmFootnoteCallLabelMarker"),e(l))}}function dj(n,e){let t=n.length;for(;t--;)if(n[t][1].type==="labelImage"&&n[t][0]==="enter"){n[t][1];break}n[t+1][1].type="data",n[t+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},n[t+3][1].start),end:Object.assign({},n[n.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},n[t+3][1].end),end:Object.assign({},n[t+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},n[n.length-1][1].start)},a={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},o=[n[t+1],n[t+2],["enter",i,e],n[t+3],n[t+4],["enter",r,e],["exit",r,e],["enter",s,e],["enter",a,e],["exit",a,e],["exit",s,e],n[n.length-2],n[n.length-1],["exit",i,e]];return n.splice(t,n.length-t+1,...o),n}function fj(n,e,t){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let s=0,a;return o;function o(d){return n.enter("gfmFootnoteCall"),n.enter("gfmFootnoteCallLabelMarker"),n.consume(d),n.exit("gfmFootnoteCallLabelMarker"),l}function l(d){return d!==94?t(d):(n.enter("gfmFootnoteCallMarker"),n.consume(d),n.exit("gfmFootnoteCallMarker"),n.enter("gfmFootnoteCallString"),n.enter("chunkString").contentType="string",u)}function u(d){if(s>999||d===93&&!a||d===null||d===91||Ut(d))return t(d);if(d===93){n.exit("chunkString");const h=n.exit("gfmFootnoteCallString");return r.includes(Ji(i.sliceSerialize(h)))?(n.enter("gfmFootnoteCallLabelMarker"),n.consume(d),n.exit("gfmFootnoteCallLabelMarker"),n.exit("gfmFootnoteCall"),e):t(d)}return Ut(d)||(a=!0),s++,n.consume(d),d===92?c:u}function c(d){return d===91||d===92||d===93?(n.consume(d),s++,u):u(d)}}function hj(n,e,t){const i=this,r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let s,a=0,o;return l;function l(g){return n.enter("gfmFootnoteDefinition")._container=!0,n.enter("gfmFootnoteDefinitionLabel"),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(g),n.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(g){return g===94?(n.enter("gfmFootnoteDefinitionMarker"),n.consume(g),n.exit("gfmFootnoteDefinitionMarker"),n.enter("gfmFootnoteDefinitionLabelString"),n.enter("chunkString").contentType="string",c):t(g)}function c(g){if(a>999||g===93&&!o||g===null||g===91||Ut(g))return t(g);if(g===93){n.exit("chunkString");const v=n.exit("gfmFootnoteDefinitionLabelString");return s=Ji(i.sliceSerialize(v)),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(g),n.exit("gfmFootnoteDefinitionLabelMarker"),n.exit("gfmFootnoteDefinitionLabel"),h}return Ut(g)||(o=!0),a++,n.consume(g),g===92?d:c}function d(g){return g===91||g===92||g===93?(n.consume(g),a++,c):c(g)}function h(g){return g===58?(n.enter("definitionMarker"),n.consume(g),n.exit("definitionMarker"),r.includes(s)||r.push(s),Rt(n,p,"gfmFootnoteDefinitionWhitespace")):t(g)}function p(g){return e(g)}}function pj(n,e,t){return n.check(rc,e,n.attempt(uj,e,t))}function mj(n){n.exit("gfmFootnoteDefinition")}function gj(n,e,t){const i=this;return Rt(n,r,"gfmFootnoteDefinitionIndent",5);function r(s){const a=i.events[i.events.length-1];return a&&a[1].type==="gfmFootnoteDefinitionIndent"&&a[2].sliceSerialize(a[1],!0).length===4?e(s):t(s)}}function vj(n){let t=(n||{}).singleTilde;const i={name:"strikethrough",tokenize:s,resolveAll:r};return t==null&&(t=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function r(a,o){let l=-1;for(;++l<a.length;)if(a[l][0]==="enter"&&a[l][1].type==="strikethroughSequenceTemporary"&&a[l][1]._close){let u=l;for(;u--;)if(a[u][0]==="exit"&&a[u][1].type==="strikethroughSequenceTemporary"&&a[u][1]._open&&a[l][1].end.offset-a[l][1].start.offset===a[u][1].end.offset-a[u][1].start.offset){a[l][1].type="strikethroughSequence",a[u][1].type="strikethroughSequence";const c={type:"strikethrough",start:Object.assign({},a[u][1].start),end:Object.assign({},a[l][1].end)},d={type:"strikethroughText",start:Object.assign({},a[u][1].end),end:Object.assign({},a[l][1].start)},h=[["enter",c,o],["enter",a[u][1],o],["exit",a[u][1],o],["enter",d,o]],p=o.parser.constructs.insideSpan.null;p&&Ei(h,h.length,0,vh(p,a.slice(u+1,l),o)),Ei(h,h.length,0,[["exit",d,o],["enter",a[l][1],o],["exit",a[l][1],o],["exit",c,o]]),Ei(a,u-1,l-u+3,h),l=u+h.length-2;break}}for(l=-1;++l<a.length;)a[l][1].type==="strikethroughSequenceTemporary"&&(a[l][1].type="data");return a}function s(a,o,l){const u=this.previous,c=this.events;let d=0;return h;function h(g){return u===126&&c[c.length-1][1].type!=="characterEscape"?l(g):(a.enter("strikethroughSequenceTemporary"),p(g))}function p(g){const v=iu(u);if(g===126)return d>1?l(g):(a.consume(g),d++,p);if(d<2&&!t)return l(g);const y=a.exit("strikethroughSequenceTemporary"),b=iu(g);return y._open=!b||b===2&&!!v,y._close=!v||v===2&&!!b,o(g)}}}class yj{constructor(){this.map=[]}add(e,t,i){Ej(this,e,t,i)}consume(e){if(this.map.sort(function(s,a){return s[0]-a[0]}),this.map.length===0)return;let t=this.map.length;const i=[];for(;t>0;)t-=1,i.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];i.push(e.slice()),e.length=0;let r=i.pop();for(;r;){for(const s of r)e.push(s);r=i.pop()}this.map.length=0}}function Ej(n,e,t,i){let r=0;if(!(t===0&&i.length===0)){for(;r<n.map.length;){if(n.map[r][0]===e){n.map[r][1]+=t,n.map[r][2].push(...i);return}r+=1}n.map.push([e,t,i])}}function bj(n,e){let t=!1;const i=[];for(;e<n.length;){const r=n[e];if(t){if(r[0]==="enter")r[1].type==="tableContent"&&i.push(n[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(n[e-1][1].type==="tableDelimiterMarker"){const s=i.length-1;i[s]=i[s]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(t=!0);e+=1}return i}function Tj(){return{flow:{null:{name:"table",tokenize:xj,resolveAll:Sj}}}}function xj(n,e,t){const i=this;let r=0,s=0,a;return o;function o(P){let N=i.events.length-1;for(;N>-1;){const te=i.events[N][1].type;if(te==="lineEnding"||te==="linePrefix")N--;else break}const G=N>-1?i.events[N][1].type:null,X=G==="tableHead"||G==="tableRow"?R:l;return X===R&&i.parser.lazy[i.now().line]?t(P):X(P)}function l(P){return n.enter("tableHead"),n.enter("tableRow"),u(P)}function u(P){return P===124||(a=!0,s+=1),c(P)}function c(P){return P===null?t(P):ct(P)?s>1?(s=0,i.interrupt=!0,n.exit("tableRow"),n.enter("lineEnding"),n.consume(P),n.exit("lineEnding"),p):t(P):Ct(P)?Rt(n,c,"whitespace")(P):(s+=1,a&&(a=!1,r+=1),P===124?(n.enter("tableCellDivider"),n.consume(P),n.exit("tableCellDivider"),a=!0,c):(n.enter("data"),d(P)))}function d(P){return P===null||P===124||Ut(P)?(n.exit("data"),c(P)):(n.consume(P),P===92?h:d)}function h(P){return P===92||P===124?(n.consume(P),d):d(P)}function p(P){return i.interrupt=!1,i.parser.lazy[i.now().line]?t(P):(n.enter("tableDelimiterRow"),a=!1,Ct(P)?Rt(n,g,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(P):g(P))}function g(P){return P===45||P===58?y(P):P===124?(a=!0,n.enter("tableCellDivider"),n.consume(P),n.exit("tableCellDivider"),v):A(P)}function v(P){return Ct(P)?Rt(n,y,"whitespace")(P):y(P)}function y(P){return P===58?(s+=1,a=!0,n.enter("tableDelimiterMarker"),n.consume(P),n.exit("tableDelimiterMarker"),b):P===45?(s+=1,b(P)):P===null||ct(P)?w(P):A(P)}function b(P){return P===45?(n.enter("tableDelimiterFiller"),T(P)):A(P)}function T(P){return P===45?(n.consume(P),T):P===58?(a=!0,n.exit("tableDelimiterFiller"),n.enter("tableDelimiterMarker"),n.consume(P),n.exit("tableDelimiterMarker"),x):(n.exit("tableDelimiterFiller"),x(P))}function x(P){return Ct(P)?Rt(n,w,"whitespace")(P):w(P)}function w(P){return P===124?g(P):P===null||ct(P)?!a||r!==s?A(P):(n.exit("tableDelimiterRow"),n.exit("tableHead"),e(P)):A(P)}function A(P){return t(P)}function R(P){return n.enter("tableRow"),_(P)}function _(P){return P===124?(n.enter("tableCellDivider"),n.consume(P),n.exit("tableCellDivider"),_):P===null||ct(P)?(n.exit("tableRow"),e(P)):Ct(P)?Rt(n,_,"whitespace")(P):(n.enter("data"),D(P))}function D(P){return P===null||P===124||Ut(P)?(n.exit("data"),_(P)):(n.consume(P),P===92?H:D)}function H(P){return P===92||P===124?(n.consume(P),D):D(P)}}function Sj(n,e){let t=-1,i=!0,r=0,s=[0,0,0,0],a=[0,0,0,0],o=!1,l=0,u,c,d;const h=new yj;for(;++t<n.length;){const p=n[t],g=p[1];p[0]==="enter"?g.type==="tableHead"?(o=!1,l!==0&&(sS(h,e,l,u,c),c=void 0,l=0),u={type:"table",start:Object.assign({},g.start),end:Object.assign({},g.end)},h.add(t,0,[["enter",u,e]])):g.type==="tableRow"||g.type==="tableDelimiterRow"?(i=!0,d=void 0,s=[0,0,0,0],a=[0,t+1,0,0],o&&(o=!1,c={type:"tableBody",start:Object.assign({},g.start),end:Object.assign({},g.end)},h.add(t,0,[["enter",c,e]])),r=g.type==="tableDelimiterRow"?2:c?3:1):r&&(g.type==="data"||g.type==="tableDelimiterMarker"||g.type==="tableDelimiterFiller")?(i=!1,a[2]===0&&(s[1]!==0&&(a[0]=a[1],d=Id(h,e,s,r,void 0,d),s=[0,0,0,0]),a[2]=t)):g.type==="tableCellDivider"&&(i?i=!1:(s[1]!==0&&(a[0]=a[1],d=Id(h,e,s,r,void 0,d)),s=a,a=[s[1],t,0,0])):g.type==="tableHead"?(o=!0,l=t):g.type==="tableRow"||g.type==="tableDelimiterRow"?(l=t,s[1]!==0?(a[0]=a[1],d=Id(h,e,s,r,t,d)):a[1]!==0&&(d=Id(h,e,a,r,t,d)),r=0):r&&(g.type==="data"||g.type==="tableDelimiterMarker"||g.type==="tableDelimiterFiller")&&(a[3]=t)}for(l!==0&&sS(h,e,l,u,c),h.consume(e.events),t=-1;++t<e.events.length;){const p=e.events[t];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=bj(e.events,t))}return n}function Id(n,e,t,i,r,s){const a=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",o="tableContent";t[0]!==0&&(s.end=Object.assign({},Ho(e.events,t[0])),n.add(t[0],0,[["exit",s,e]]));const l=Ho(e.events,t[1]);if(s={type:a,start:Object.assign({},l),end:Object.assign({},l)},n.add(t[1],0,[["enter",s,e]]),t[2]!==0){const u=Ho(e.events,t[2]),c=Ho(e.events,t[3]),d={type:o,start:Object.assign({},u),end:Object.assign({},c)};if(n.add(t[2],0,[["enter",d,e]]),i!==2){const h=e.events[t[2]],p=e.events[t[3]];if(h[1].end=Object.assign({},p[1].end),h[1].type="chunkText",h[1].contentType="text",t[3]>t[2]+1){const g=t[2]+1,v=t[3]-t[2]-1;n.add(g,v,[])}}n.add(t[3]+1,0,[["exit",d,e]])}return r!==void 0&&(s.end=Object.assign({},Ho(e.events,r)),n.add(r,0,[["exit",s,e]]),s=void 0),s}function sS(n,e,t,i,r){const s=[],a=Ho(e.events,t);r&&(r.end=Object.assign({},a),s.push(["exit",r,e])),i.end=Object.assign({},a),s.push(["exit",i,e]),n.add(t+1,0,s)}function Ho(n,e){const t=n[e],i=t[0]==="enter"?"start":"end";return t[1][i]}const wj={name:"tasklistCheck",tokenize:Cj};function Aj(){return{text:{91:wj}}}function Cj(n,e,t){const i=this;return r;function r(l){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?t(l):(n.enter("taskListCheck"),n.enter("taskListCheckMarker"),n.consume(l),n.exit("taskListCheckMarker"),s)}function s(l){return Ut(l)?(n.enter("taskListCheckValueUnchecked"),n.consume(l),n.exit("taskListCheckValueUnchecked"),a):l===88||l===120?(n.enter("taskListCheckValueChecked"),n.consume(l),n.exit("taskListCheckValueChecked"),a):t(l)}function a(l){return l===93?(n.enter("taskListCheckMarker"),n.consume(l),n.exit("taskListCheckMarker"),n.exit("taskListCheck"),o):t(l)}function o(l){return ct(l)?e(l):Ct(l)?n.check({tokenize:Ij},e,t)(l):t(l)}}function Ij(n,e,t){return Rt(n,i,"whitespace");function i(r){return r===null?t(r):e(r)}}function Rj(n){return OR([BH(),lj(),vj(n),Tj(),Aj()])}const _j={};function Lj(n){const e=this,t=n||_j,i=e.data(),r=i.micromarkExtensions||(i.micromarkExtensions=[]),s=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),a=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);r.push(Rj(t)),s.push(kH()),a.push(DH(t))}const Pj={tokenize:kj};function kj(n){const e=n.attempt(this.parser.constructs.contentInitial,i,r);let t;return e;function i(o){if(o===null){n.consume(o);return}return n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),Rt(n,e,"linePrefix")}function r(o){return n.enter("paragraph"),s(o)}function s(o){const l=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=l),t=l,a(o)}function a(o){if(o===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(o);return}return ct(o)?(n.consume(o),n.exit("chunkText"),s):(n.consume(o),a)}}const Dj={tokenize:Oj},aS={tokenize:Nj};function Oj(n){const e=this,t=[];let i=0,r,s,a;return o;function o(x){if(i<t.length){const w=t[i];return e.containerState=w[1],n.attempt(w[0].continuation,l,u)(x)}return u(x)}function l(x){if(i++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&T();const w=e.events.length;let A=w,R;for(;A--;)if(e.events[A][0]==="exit"&&e.events[A][1].type==="chunkFlow"){R=e.events[A][1].end;break}b(i);let _=w;for(;_<e.events.length;)e.events[_][1].end={...R},_++;return Ei(e.events,A+1,0,e.events.slice(w)),e.events.length=_,u(x)}return o(x)}function u(x){if(i===t.length){if(!r)return h(x);if(r.currentConstruct&&r.currentConstruct.concrete)return g(x);e.interrupt=!!(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(aS,c,d)(x)}function c(x){return r&&T(),b(i),h(x)}function d(x){return e.parser.lazy[e.now().line]=i!==t.length,a=e.now().offset,g(x)}function h(x){return e.containerState={},n.attempt(aS,p,g)(x)}function p(x){return i++,t.push([e.currentConstruct,e.containerState]),h(x)}function g(x){if(x===null){r&&T(),b(0),n.consume(x);return}return r=r||e.parser.flow(e.now()),n.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:s}),v(x)}function v(x){if(x===null){y(n.exit("chunkFlow"),!0),b(0),n.consume(x);return}return ct(x)?(n.consume(x),y(n.exit("chunkFlow")),i=0,e.interrupt=void 0,o):(n.consume(x),v)}function y(x,w){const A=e.sliceStream(x);if(w&&A.push(null),x.previous=s,s&&(s.next=x),s=x,r.defineSkip(x.start),r.write(A),e.parser.lazy[x.start.line]){let R=r.events.length;for(;R--;)if(r.events[R][1].start.offset<a&&(!r.events[R][1].end||r.events[R][1].end.offset>a))return;const _=e.events.length;let D=_,H,P;for(;D--;)if(e.events[D][0]==="exit"&&e.events[D][1].type==="chunkFlow"){if(H){P=e.events[D][1].end;break}H=!0}for(b(i),R=_;R<e.events.length;)e.events[R][1].end={...P},R++;Ei(e.events,D+1,0,e.events.slice(_)),e.events.length=R}}function b(x){let w=t.length;for(;w-- >x;){const A=t[w];e.containerState=A[1],A[0].exit.call(e,n)}t.length=x}function T(){r.write([null]),s=void 0,r=void 0,e.containerState._closeFlow=void 0}}function Nj(n,e,t){return Rt(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}const Mj={tokenize:Fj};function Fj(n){const e=this,t=n.attempt(rc,i,n.attempt(this.parser.constructs.flowInitial,r,Rt(n,n.attempt(this.parser.constructs.flow,r,n.attempt(pz,r)),"linePrefix")));return t;function i(s){if(s===null){n.consume(s);return}return n.enter("lineEndingBlank"),n.consume(s),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function r(s){if(s===null){n.consume(s);return}return n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),e.currentConstruct=void 0,t}}const Bj={resolveAll:QR()},Uj=XR("string"),Hj=XR("text");function XR(n){return{resolveAll:QR(n==="text"?zj:void 0),tokenize:e};function e(t){const i=this,r=this.parser.constructs[n],s=t.attempt(r,a,o);return a;function a(c){return u(c)?s(c):o(c)}function o(c){if(c===null){t.consume(c);return}return t.enter("data"),t.consume(c),l}function l(c){return u(c)?(t.exit("data"),s(c)):(t.consume(c),l)}function u(c){if(c===null)return!0;const d=r[c];let h=-1;if(d)for(;++h<d.length;){const p=d[h];if(!p.previous||p.previous.call(i,i.previous))return!0}return!1}}}function QR(n){return e;function e(t,i){let r=-1,s;for(;++r<=t.length;)s===void 0?t[r]&&t[r][1].type==="data"&&(s=r,r++):(!t[r]||t[r][1].type!=="data")&&(r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),r=s+2),s=void 0);return n?n(t,i):t}}function zj(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const i=n[t-1][1],r=e.sliceStream(i);let s=r.length,a=-1,o=0,l;for(;s--;){const u=r[s];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)o++,a--;if(a)break;a=-1}else if(u===-2)l=!0,o++;else if(u!==-1){s++;break}}if(e._contentTypeTextTrailing&&t===n.length&&(o=0),o){const u={type:t===n.length||l||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?a:i.start._bufferIndex+a,_index:i.start._index+s,line:i.end.line,column:i.end.column-o,offset:i.end.offset-o},end:{...i.end}};i.end={...u.start},i.start.offset===i.end.offset?Object.assign(i,u):(n.splice(t,0,["enter",u,e],["exit",u,e]),t+=2)}t++}return n}const jj={42:ii,43:ii,45:ii,48:ii,49:ii,50:ii,51:ii,52:ii,53:ii,54:ii,55:ii,56:ii,57:ii,62:VR},Vj={91:Ez},Gj={[-2]:Q0,[-1]:Q0,32:Q0},Wj={35:Az,42:df,45:[rS,df],60:_z,61:rS,95:df,96:nS,126:nS},qj={38:WR,92:GR},$j={[-5]:Z0,[-4]:Z0,[-3]:Z0,33:$z,38:WR,42:lv,60:[YH,Mz],91:Yz,92:[Sz,GR],93:Uy,95:lv,96:uz},Kj={null:[lv,Bj]},Yj={null:[42,95]},Xj={null:[]},Qj=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Yj,contentInitial:Vj,disable:Xj,document:jj,flow:Wj,flowInitial:Gj,insideSpan:Kj,string:qj,text:$j},Symbol.toStringTag,{value:"Module"}));function Zj(n,e,t){let i={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const r={},s=[];let a=[],o=[];const l={attempt:_(A),check:_(R),consume:T,enter:x,exit:w,interrupt:_(R,{interrupt:!0})},u={code:null,containerState:{},defineSkip:v,events:[],now:g,parser:n,previous:null,sliceSerialize:h,sliceStream:p,write:d};let c=e.tokenize.call(u,l);return e.resolveAll&&s.push(e),u;function d(N){return a=Di(a,N),y(),a[a.length-1]!==null?[]:(D(e,0),u.events=vh(s,u.events,u),u.events)}function h(N,G){return eV(p(N),G)}function p(N){return Jj(a,N)}function g(){const{_bufferIndex:N,_index:G,line:X,column:te,offset:Q}=i;return{_bufferIndex:N,_index:G,line:X,column:te,offset:Q}}function v(N){r[N.line]=N.column,P()}function y(){let N;for(;i._index<a.length;){const G=a[i._index];if(typeof G=="string")for(N=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===N&&i._bufferIndex<G.length;)b(G.charCodeAt(i._bufferIndex));else b(G)}}function b(N){c=c(N)}function T(N){ct(N)?(i.line++,i.column=1,i.offset+=N===-3?2:1,P()):N!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===a[i._index].length&&(i._bufferIndex=-1,i._index++)),u.previous=N}function x(N,G){const X=G||{};return X.type=N,X.start=g(),u.events.push(["enter",X,u]),o.push(X),X}function w(N){const G=o.pop();return G.end=g(),u.events.push(["exit",G,u]),G}function A(N,G){D(N,G.from)}function R(N,G){G.restore()}function _(N,G){return X;function X(te,Q,ne){let oe,Z,se,j;return Array.isArray(te)?re(te):"tokenize"in te?re([te]):q(te);function q(Ce){return Ae;function Ae(ke){const je=ke!==null&&Ce[ke],We=ke!==null&&Ce.null,de=[...Array.isArray(je)?je:je?[je]:[],...Array.isArray(We)?We:We?[We]:[]];return re(de)(ke)}}function re(Ce){return oe=Ce,Z=0,Ce.length===0?ne:z(Ce[Z])}function z(Ce){return Ae;function Ae(ke){return j=H(),se=Ce,Ce.partial||(u.currentConstruct=Ce),Ce.name&&u.parser.constructs.disable.null.includes(Ce.name)?Le():Ce.tokenize.call(G?Object.assign(Object.create(u),G):u,l,ve,Le)(ke)}}function ve(Ce){return N(se,j),Q}function Le(Ce){return j.restore(),++Z<oe.length?z(oe[Z]):ne}}}function D(N,G){N.resolveAll&&!s.includes(N)&&s.push(N),N.resolve&&Ei(u.events,G,u.events.length-G,N.resolve(u.events.slice(G),u)),N.resolveTo&&(u.events=N.resolveTo(u.events,u))}function H(){const N=g(),G=u.previous,X=u.currentConstruct,te=u.events.length,Q=Array.from(o);return{from:te,restore:ne};function ne(){i=N,u.previous=G,u.currentConstruct=X,u.events.length=te,o=Q,P()}}function P(){i.line in r&&i.column<2&&(i.column=r[i.line],i.offset+=r[i.line]-1)}}function Jj(n,e){const t=e.start._index,i=e.start._bufferIndex,r=e.end._index,s=e.end._bufferIndex;let a;if(t===r)a=[n[t].slice(i,s)];else{if(a=n.slice(t,r),i>-1){const o=a[0];typeof o=="string"?a[0]=o.slice(i):a.shift()}s>0&&a.push(n[r].slice(0,s))}return a}function eV(n,e){let t=-1;const i=[];let r;for(;++t<n.length;){const s=n[t];let a;if(typeof s=="string")a=s;else switch(s){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=e?" ":"	";break}case-1:{if(!e&&r)continue;a=" ";break}default:a=String.fromCharCode(s)}r=s===-2,i.push(a)}return i.join("")}function tV(n){const i={constructs:OR([Qj,...(n||{}).extensions||[]]),content:r(Pj),defined:[],document:r(Dj),flow:r(Mj),lazy:{},string:r(Uj),text:r(Hj)};return i;function r(s){return a;function a(o){return Zj(i,s,o)}}}function nV(n){for(;!qR(n););return n}const oS=/[\0\t\n\r]/g;function iV(){let n=1,e="",t=!0,i;return r;function r(s,a,o){const l=[];let u,c,d,h,p;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(a||void 0).decode(s)),d=0,e="",t&&(s.charCodeAt(0)===65279&&d++,t=void 0);d<s.length;){if(oS.lastIndex=d,u=oS.exec(s),h=u&&u.index!==void 0?u.index:s.length,p=s.charCodeAt(h),!u){e=s.slice(d);break}if(p===10&&d===h&&i)l.push(-3),i=void 0;else switch(i&&(l.push(-5),i=void 0),d<h&&(l.push(s.slice(d,h)),n+=h-d),p){case 0:{l.push(65533),n++;break}case 9:{for(c=Math.ceil(n/4)*4,l.push(-2);n++<c;)l.push(-1);break}case 10:{l.push(-4),n=1;break}default:i=!0,n=1}d=h+1}return o&&(i&&l.push(-5),e&&l.push(e),l.push(null)),l}}function _l(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?uS(n.position):"start"in n||"end"in n?uS(n):"line"in n||"column"in n?cv(n):""}function cv(n){return lS(n&&n.line)+":"+lS(n&&n.column)}function uS(n){return cv(n&&n.start)+"-"+cv(n&&n.end)}function lS(n){return n&&typeof n=="number"?n:1}const ZR={}.hasOwnProperty;function rV(n,e,t){return typeof e!="string"&&(t=e,e=void 0),sV(t)(nV(tV(t).document().write(iV()(n,e,!0))))}function sV(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(ue),autolinkProtocol:H,autolinkEmail:H,atxHeading:s(It),blockQuote:s(We),characterEscape:H,characterReference:H,codeFenced:s(de),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:s(de,a),codeText:s(Re,a),codeTextData:H,data:H,codeFlowValue:H,definition:s(Ie),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:s(Ye),hardBreakEscape:s(Qe),hardBreakTrailing:s(Qe),htmlFlow:s(k,a),htmlFlowData:H,htmlText:s(k,a),htmlTextData:H,image:s($),label:a,link:s(ue),listItem:s(_e),listItemValue:h,listOrdered:s(Ee,d),listUnordered:s(Ee),paragraph:s(Fe),reference:z,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:s(It),strong:s(Pe),thematicBreak:s(mt)},exit:{atxHeading:l(),atxHeadingSequence:A,autolink:l(),autolinkEmail:je,autolinkProtocol:ke,blockQuote:l(),characterEscapeValue:P,characterReferenceMarkerHexadecimal:Le,characterReferenceMarkerNumeric:Le,characterReferenceValue:Ce,characterReference:Ae,codeFenced:l(y),codeFencedFence:v,codeFencedFenceInfo:p,codeFencedFenceMeta:g,codeFlowValue:P,codeIndented:l(b),codeText:l(Q),codeTextData:P,data:P,definition:l(),definitionDestinationString:w,definitionLabelString:T,definitionTitleString:x,emphasis:l(),hardBreakEscape:l(G),hardBreakTrailing:l(G),htmlFlow:l(X),htmlFlowData:P,htmlText:l(te),htmlTextData:P,image:l(oe),label:se,labelText:Z,lineEnding:N,link:l(ne),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:ve,resourceDestinationString:j,resourceTitleString:q,resource:re,setextHeading:l(D),setextHeadingLineSequence:_,setextHeadingText:R,strong:l(),thematicBreak:l()}};JR(e,(n||{}).mdastExtensions||[]);const t={};return i;function i(he){let Se={type:"root",children:[]};const qe={stack:[Se],tokenStack:[],config:e,enter:o,exit:u,buffer:a,resume:c,data:t},F=[];let M=-1;for(;++M<he.length;)if(he[M][1].type==="listOrdered"||he[M][1].type==="listUnordered")if(he[M][0]==="enter")F.push(M);else{const W=F.pop();M=r(he,W,M)}for(M=-1;++M<he.length;){const W=e[he[M][0]];ZR.call(W,he[M][1].type)&&W[he[M][1].type].call(Object.assign({sliceSerialize:he[M][2].sliceSerialize},qe),he[M][1])}if(qe.tokenStack.length>0){const W=qe.tokenStack[qe.tokenStack.length-1];(W[1]||cS).call(qe,void 0,W[0])}for(Se.position={start:Ls(he.length>0?he[0][1].start:{line:1,column:1,offset:0}),end:Ls(he.length>0?he[he.length-2][1].end:{line:1,column:1,offset:0})},M=-1;++M<e.transforms.length;)Se=e.transforms[M](Se)||Se;return Se}function r(he,Se,qe){let F=Se-1,M=-1,W=!1,Y,Te,Ne,st;for(;++F<=qe;){const ft=he[F];switch(ft[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ft[0]==="enter"?M++:M--,st=void 0;break}case"lineEndingBlank":{ft[0]==="enter"&&(Y&&!st&&!M&&!Ne&&(Ne=F),st=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:st=void 0}if(!M&&ft[0]==="enter"&&ft[1].type==="listItemPrefix"||M===-1&&ft[0]==="exit"&&(ft[1].type==="listUnordered"||ft[1].type==="listOrdered")){if(Y){let nt=F;for(Te=void 0;nt--;){const Mt=he[nt];if(Mt[1].type==="lineEnding"||Mt[1].type==="lineEndingBlank"){if(Mt[0]==="exit")continue;Te&&(he[Te][1].type="lineEndingBlank",W=!0),Mt[1].type="lineEnding",Te=nt}else if(!(Mt[1].type==="linePrefix"||Mt[1].type==="blockQuotePrefix"||Mt[1].type==="blockQuotePrefixWhitespace"||Mt[1].type==="blockQuoteMarker"||Mt[1].type==="listItemIndent"))break}Ne&&(!Te||Ne<Te)&&(Y._spread=!0),Y.end=Object.assign({},Te?he[Te][1].start:ft[1].end),he.splice(Te||F,0,["exit",Y,ft[2]]),F++,qe++}if(ft[1].type==="listItemPrefix"){const nt={type:"listItem",_spread:!1,start:Object.assign({},ft[1].start),end:void 0};Y=nt,he.splice(F,0,["enter",nt,ft[2]]),F++,qe++,Ne=void 0,st=!0}}}return he[Se][1]._spread=W,qe}function s(he,Se){return qe;function qe(F){o.call(this,he(F),F),Se&&Se.call(this,F)}}function a(){this.stack.push({type:"fragment",children:[]})}function o(he,Se,qe){this.stack[this.stack.length-1].children.push(he),this.stack.push(he),this.tokenStack.push([Se,qe||void 0]),he.position={start:Ls(Se.start),end:void 0}}function l(he){return Se;function Se(qe){he&&he.call(this,qe),u.call(this,qe)}}function u(he,Se){const qe=this.stack.pop(),F=this.tokenStack.pop();if(F)F[0].type!==he.type&&(Se?Se.call(this,he,F[0]):(F[1]||cS).call(this,he,F[0]));else throw new Error("Cannot close `"+he.type+"` ("+_l({start:he.start,end:he.end})+"): its not open");qe.position.end=Ls(he.end)}function c(){return Ny(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function h(he){if(this.data.expectingFirstListItemValue){const Se=this.stack[this.stack.length-2];Se.start=Number.parseInt(this.sliceSerialize(he),10),this.data.expectingFirstListItemValue=void 0}}function p(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.lang=he}function g(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.meta=he}function v(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function y(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.value=he.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function b(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.value=he.replace(/(\r?\n|\r)$/g,"")}function T(he){const Se=this.resume(),qe=this.stack[this.stack.length-1];qe.label=Se,qe.identifier=Ji(this.sliceSerialize(he)).toLowerCase()}function x(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.title=he}function w(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.url=he}function A(he){const Se=this.stack[this.stack.length-1];if(!Se.depth){const qe=this.sliceSerialize(he).length;Se.depth=qe}}function R(){this.data.setextHeadingSlurpLineEnding=!0}function _(he){const Se=this.stack[this.stack.length-1];Se.depth=this.sliceSerialize(he).codePointAt(0)===61?1:2}function D(){this.data.setextHeadingSlurpLineEnding=void 0}function H(he){const qe=this.stack[this.stack.length-1].children;let F=qe[qe.length-1];(!F||F.type!=="text")&&(F=dt(),F.position={start:Ls(he.start),end:void 0},qe.push(F)),this.stack.push(F)}function P(he){const Se=this.stack.pop();Se.value+=this.sliceSerialize(he),Se.position.end=Ls(he.end)}function N(he){const Se=this.stack[this.stack.length-1];if(this.data.atHardBreak){const qe=Se.children[Se.children.length-1];qe.position.end=Ls(he.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Se.type)&&(H.call(this,he),P.call(this,he))}function G(){this.data.atHardBreak=!0}function X(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.value=he}function te(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.value=he}function Q(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.value=he}function ne(){const he=this.stack[this.stack.length-1];if(this.data.inReference){const Se=this.data.referenceType||"shortcut";he.type+="Reference",he.referenceType=Se,delete he.url,delete he.title}else delete he.identifier,delete he.label;this.data.referenceType=void 0}function oe(){const he=this.stack[this.stack.length-1];if(this.data.inReference){const Se=this.data.referenceType||"shortcut";he.type+="Reference",he.referenceType=Se,delete he.url,delete he.title}else delete he.identifier,delete he.label;this.data.referenceType=void 0}function Z(he){const Se=this.sliceSerialize(he),qe=this.stack[this.stack.length-2];qe.label=EH(Se),qe.identifier=Ji(Se).toLowerCase()}function se(){const he=this.stack[this.stack.length-1],Se=this.resume(),qe=this.stack[this.stack.length-1];if(this.data.inReference=!0,qe.type==="link"){const F=he.children;qe.children=F}else qe.alt=Se}function j(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.url=he}function q(){const he=this.resume(),Se=this.stack[this.stack.length-1];Se.title=he}function re(){this.data.inReference=void 0}function z(){this.data.referenceType="collapsed"}function ve(he){const Se=this.resume(),qe=this.stack[this.stack.length-1];qe.label=Se,qe.identifier=Ji(this.sliceSerialize(he)).toLowerCase(),this.data.referenceType="full"}function Le(he){this.data.characterReferenceType=he.type}function Ce(he){const Se=this.sliceSerialize(he),qe=this.data.characterReferenceType;let F;qe?(F=DR(Se,qe==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):F=Fy(Se);const M=this.stack[this.stack.length-1];M.value+=F}function Ae(he){const Se=this.stack.pop();Se.position.end=Ls(he.end)}function ke(he){P.call(this,he);const Se=this.stack[this.stack.length-1];Se.url=this.sliceSerialize(he)}function je(he){P.call(this,he);const Se=this.stack[this.stack.length-1];Se.url="mailto:"+this.sliceSerialize(he)}function We(){return{type:"blockquote",children:[]}}function de(){return{type:"code",lang:null,meta:null,value:""}}function Re(){return{type:"inlineCode",value:""}}function Ie(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Ye(){return{type:"emphasis",children:[]}}function It(){return{type:"heading",depth:0,children:[]}}function Qe(){return{type:"break"}}function k(){return{type:"html",value:""}}function $(){return{type:"image",title:null,url:"",alt:null}}function ue(){return{type:"link",title:null,url:"",children:[]}}function Ee(he){return{type:"list",ordered:he.type==="listOrdered",start:null,spread:he._spread,children:[]}}function _e(he){return{type:"listItem",spread:he._spread,checked:null,children:[]}}function Fe(){return{type:"paragraph",children:[]}}function Pe(){return{type:"strong",children:[]}}function dt(){return{type:"text",value:""}}function mt(){return{type:"thematicBreak"}}}function Ls(n){return{line:n.line,column:n.column,offset:n.offset}}function JR(n,e){let t=-1;for(;++t<e.length;){const i=e[t];Array.isArray(i)?JR(n,i):aV(n,i)}}function aV(n,e){let t;for(t in e)if(ZR.call(e,t))switch(t){case"canContainEols":{const i=e[t];i&&n[t].push(...i);break}case"transforms":{const i=e[t];i&&n[t].push(...i);break}case"enter":case"exit":{const i=e[t];i&&Object.assign(n[t],i);break}}}function cS(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+_l({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+_l({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+_l({start:e.start,end:e.end})+") is still open")}function oV(n){const e=this;e.parser=t;function t(i){return rV(i,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function uV(n,e){const t={type:"element",tagName:"blockquote",properties:{},children:n.wrap(n.all(e),!0)};return n.patch(e,t),n.applyData(e,t)}function lV(n,e){const t={type:"element",tagName:"br",properties:{},children:[]};return n.patch(e,t),[n.applyData(e,t),{type:"text",value:`
`}]}function cV(n,e){const t=e.value?e.value+`
`:"",i={},r=e.lang?e.lang.split(/\s+/):[];r.length>0&&(i.className=["language-"+r[0]]);let s={type:"element",tagName:"code",properties:i,children:[{type:"text",value:t}]};return e.meta&&(s.data={meta:e.meta}),n.patch(e,s),s=n.applyData(e,s),s={type:"element",tagName:"pre",properties:{},children:[s]},n.patch(e,s),s}function dV(n,e){const t={type:"element",tagName:"del",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function fV(n,e){const t={type:"element",tagName:"em",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function hV(n,e){const t=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",i=String(e.identifier).toUpperCase(),r=pu(i.toLowerCase()),s=n.footnoteOrder.indexOf(i);let a,o=n.footnoteCounts.get(i);o===void 0?(o=0,n.footnoteOrder.push(i),a=n.footnoteOrder.length):a=s+1,o+=1,n.footnoteCounts.set(i,o);const l={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+r,id:t+"fnref-"+r+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};n.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return n.patch(e,u),n.applyData(e,u)}function pV(n,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function mV(n,e){if(n.options.allowDangerousHtml){const t={type:"raw",value:e.value};return n.patch(e,t),n.applyData(e,t)}}function e_(n,e){const t=e.referenceType;let i="]";if(t==="collapsed"?i+="[]":t==="full"&&(i+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+i}];const r=n.all(e),s=r[0];s&&s.type==="text"?s.value="["+s.value:r.unshift({type:"text",value:"["});const a=r[r.length-1];return a&&a.type==="text"?a.value+=i:r.push({type:"text",value:i}),r}function gV(n,e){const t=String(e.identifier).toUpperCase(),i=n.definitionById.get(t);if(!i)return e_(n,e);const r={src:pu(i.url||""),alt:e.alt};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"img",properties:r,children:[]};return n.patch(e,s),n.applyData(e,s)}function vV(n,e){const t={src:pu(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const i={type:"element",tagName:"img",properties:t,children:[]};return n.patch(e,i),n.applyData(e,i)}function yV(n,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};n.patch(e,t);const i={type:"element",tagName:"code",properties:{},children:[t]};return n.patch(e,i),n.applyData(e,i)}function EV(n,e){const t=String(e.identifier).toUpperCase(),i=n.definitionById.get(t);if(!i)return e_(n,e);const r={href:pu(i.url||"")};i.title!==null&&i.title!==void 0&&(r.title=i.title);const s={type:"element",tagName:"a",properties:r,children:n.all(e)};return n.patch(e,s),n.applyData(e,s)}function bV(n,e){const t={href:pu(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const i={type:"element",tagName:"a",properties:t,children:n.all(e)};return n.patch(e,i),n.applyData(e,i)}function TV(n,e,t){const i=n.all(e),r=t?xV(t):t_(e),s={},a=[];if(typeof e.checked=="boolean"){const c=i[0];let d;c&&c.type==="element"&&c.tagName==="p"?d=c:(d={type:"element",tagName:"p",properties:{},children:[]},i.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let o=-1;for(;++o<i.length;){const c=i[o];(r||o!==0||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!r?a.push(...c.children):a.push(c)}const l=i[i.length-1];l&&(r||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:s,children:a};return n.patch(e,u),n.applyData(e,u)}function xV(n){let e=!1;if(n.type==="list"){e=n.spread||!1;const t=n.children;let i=-1;for(;!e&&++i<t.length;)e=t_(t[i])}return e}function t_(n){const e=n.spread;return e??n.children.length>1}function SV(n,e){const t={},i=n.all(e);let r=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++r<i.length;){const a=i[r];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:n.wrap(i,!0)};return n.patch(e,s),n.applyData(e,s)}function wV(n,e){const t={type:"element",tagName:"p",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function AV(n,e){const t={type:"root",children:n.wrap(n.all(e))};return n.patch(e,t),n.applyData(e,t)}function CV(n,e){const t={type:"element",tagName:"strong",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function IV(n,e){const t=n.all(e),i=t.shift(),r=[];if(i){const a={type:"element",tagName:"thead",properties:{},children:n.wrap([i],!0)};n.patch(e.children[0],a),r.push(a)}if(t.length>0){const a={type:"element",tagName:"tbody",properties:{},children:n.wrap(t,!0)},o=rs(e.children[1]),l=hh(e.children[e.children.length-1]);o&&l&&(a.position={start:o,end:l}),r.push(a)}const s={type:"element",tagName:"table",properties:{},children:n.wrap(r,!0)};return n.patch(e,s),n.applyData(e,s)}function RV(n,e,t){const i=t?t.children:void 0,s=(i?i.indexOf(e):1)===0?"th":"td",a=t&&t.type==="table"?t.align:void 0,o=a?a.length:e.children.length;let l=-1;const u=[];for(;++l<o;){const d=e.children[l],h={},p=a?a[l]:void 0;p&&(h.align=p);let g={type:"element",tagName:s,properties:h,children:[]};d&&(g.children=n.all(d),n.patch(d,g),g=n.applyData(d,g)),u.push(g)}const c={type:"element",tagName:"tr",properties:{},children:n.wrap(u,!0)};return n.patch(e,c),n.applyData(e,c)}function _V(n,e){const t={type:"element",tagName:"td",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}const dS=9,fS=32;function LV(n){const e=String(n),t=/\r?\n|\r/g;let i=t.exec(e),r=0;const s=[];for(;i;)s.push(hS(e.slice(r,i.index),r>0,!0),i[0]),r=i.index+i[0].length,i=t.exec(e);return s.push(hS(e.slice(r),r>0,!1)),s.join("")}function hS(n,e,t){let i=0,r=n.length;if(e){let s=n.codePointAt(i);for(;s===dS||s===fS;)i++,s=n.codePointAt(i)}if(t){let s=n.codePointAt(r-1);for(;s===dS||s===fS;)r--,s=n.codePointAt(r-1)}return r>i?n.slice(i,r):""}function PV(n,e){const t={type:"text",value:LV(String(e.value))};return n.patch(e,t),n.applyData(e,t)}function kV(n,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return n.patch(e,t),n.applyData(e,t)}const DV={blockquote:uV,break:lV,code:cV,delete:dV,emphasis:fV,footnoteReference:hV,heading:pV,html:mV,imageReference:gV,image:vV,inlineCode:yV,linkReference:EV,link:bV,listItem:TV,list:SV,paragraph:wV,root:AV,strong:CV,table:IV,tableCell:_V,tableRow:RV,text:PV,thematicBreak:kV,toml:Rd,yaml:Rd,definition:Rd,footnoteDefinition:Rd};function Rd(){}function OV(n,e){const t=[{type:"text",value:""}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function NV(n,e){return"Back to reference "+(n+1)+(e>1?"-"+e:"")}function MV(n){const e=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",t=n.options.footnoteBackContent||OV,i=n.options.footnoteBackLabel||NV,r=n.options.footnoteLabel||"Footnotes",s=n.options.footnoteLabelTagName||"h2",a=n.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let l=-1;for(;++l<n.footnoteOrder.length;){const u=n.footnoteById.get(n.footnoteOrder[l]);if(!u)continue;const c=n.all(u),d=String(u.identifier).toUpperCase(),h=pu(d.toLowerCase());let p=0;const g=[],v=n.footnoteCounts.get(d);for(;v!==void 0&&++p<=v;){g.length>0&&g.push({type:"text",value:" "});let T=typeof t=="string"?t:t(l,p);typeof T=="string"&&(T={type:"text",value:T}),g.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(l,p),className:["data-footnote-backref"]},children:Array.isArray(T)?T:[T]})}const y=c[c.length-1];if(y&&y.type==="element"&&y.tagName==="p"){const T=y.children[y.children.length-1];T&&T.type==="text"?T.value+=" ":y.children.push({type:"text",value:" "}),y.children.push(...g)}else c.push(...g);const b={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:n.wrap(c,!0)};n.patch(u,b),o.push(b)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...tu(a),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:n.wrap(o,!0)},{type:"text",value:`
`}]}}const dv={}.hasOwnProperty,FV={};function BV(n,e){const t=e||FV,i=new Map,r=new Map,s=new Map,a={...DV,...t.handlers},o={all:u,applyData:HV,definitionById:i,footnoteById:r,footnoteCounts:s,footnoteOrder:[],handlers:a,one:l,options:t,patch:UV,wrap:jV};return Py(n,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){const d=c.type==="definition"?i:r,h=String(c.identifier).toUpperCase();d.has(h)||d.set(h,c)}}),o;function l(c,d){const h=c.type,p=o.handlers[h];if(dv.call(o.handlers,h)&&p)return p(o,c,d);if(o.options.passThrough&&o.options.passThrough.includes(h)){if("children"in c){const{children:v,...y}=c,b=tu(y);return b.children=o.all(c),b}return tu(c)}return(o.options.unknownHandler||zV)(o,c,d)}function u(c){const d=[];if("children"in c){const h=c.children;let p=-1;for(;++p<h.length;){const g=o.one(h[p],c);if(g){if(p&&h[p-1].type==="break"&&(!Array.isArray(g)&&g.type==="text"&&(g.value=pS(g.value)),!Array.isArray(g)&&g.type==="element")){const v=g.children[0];v&&v.type==="text"&&(v.value=pS(v.value))}Array.isArray(g)?d.push(...g):d.push(g)}}}return d}}function UV(n,e){n.position&&(e.position=w9(n))}function HV(n,e){let t=e;if(n&&n.data){const i=n.data.hName,r=n.data.hChildren,s=n.data.hProperties;if(typeof i=="string")if(t.type==="element")t.tagName=i;else{const a="children"in t?t.children:[t];t={type:"element",tagName:i,properties:{},children:a}}t.type==="element"&&s&&Object.assign(t.properties,tu(s)),"children"in t&&t.children&&r!==null&&r!==void 0&&(t.children=r)}return t}function zV(n,e){const t=e.data||{},i="value"in e&&!(dv.call(t,"hProperties")||dv.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:n.all(e)};return n.patch(e,i),n.applyData(e,i)}function jV(n,e){const t=[];let i=-1;for(e&&t.push({type:"text",value:`
`});++i<n.length;)i&&t.push({type:"text",value:`
`}),t.push(n[i]);return e&&n.length>0&&t.push({type:"text",value:`
`}),t}function pS(n){let e=0,t=n.charCodeAt(e);for(;t===9||t===32;)e++,t=n.charCodeAt(e);return n.slice(e)}function mS(n,e){const t=BV(n,e),i=t.one(n,void 0),r=MV(t),s=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return r&&s.children.push({type:"text",value:`
`},r),s}function VV(n,e){return n&&"run"in n?async function(t,i){const r=mS(t,{file:i,...e});await n.run(r,i)}:function(t,i){return mS(t,{file:i,...n||e})}}function gS(n){if(n)throw n}var J0,vS;function GV(){if(vS)return J0;vS=1;var n=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Object.defineProperty,i=Object.getOwnPropertyDescriptor,r=function(u){return typeof Array.isArray=="function"?Array.isArray(u):e.call(u)==="[object Array]"},s=function(u){if(!u||e.call(u)!=="[object Object]")return!1;var c=n.call(u,"constructor"),d=u.constructor&&u.constructor.prototype&&n.call(u.constructor.prototype,"isPrototypeOf");if(u.constructor&&!c&&!d)return!1;var h;for(h in u);return typeof h>"u"||n.call(u,h)},a=function(u,c){t&&c.name==="__proto__"?t(u,c.name,{enumerable:!0,configurable:!0,value:c.newValue,writable:!0}):u[c.name]=c.newValue},o=function(u,c){if(c==="__proto__")if(n.call(u,c)){if(i)return i(u,c).value}else return;return u[c]};return J0=function l(){var u,c,d,h,p,g,v=arguments[0],y=1,b=arguments.length,T=!1;for(typeof v=="boolean"&&(T=v,v=arguments[1]||{},y=2),(v==null||typeof v!="object"&&typeof v!="function")&&(v={});y<b;++y)if(u=arguments[y],u!=null)for(c in u)d=o(v,c),h=o(u,c),v!==h&&(T&&h&&(s(h)||(p=r(h)))?(p?(p=!1,g=d&&r(d)?d:[]):g=d&&s(d)?d:{},a(v,{name:c,newValue:l(T,g,h)})):typeof h<"u"&&a(v,{name:c,newValue:h}));return v},J0}var WV=GV();const em=Yl(WV);function fv(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function qV(){const n=[],e={run:t,use:i};return e;function t(...r){let s=-1;const a=r.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);o(null,...r);function o(l,...u){const c=n[++s];let d=-1;if(l){a(l);return}for(;++d<r.length;)(u[d]===null||u[d]===void 0)&&(u[d]=r[d]);r=u,c?$V(c,o)(...u):a(null,...u)}}function i(r){if(typeof r!="function")throw new TypeError("Expected `middelware` to be a function, not "+r);return n.push(r),e}}function $V(n,e){let t;return i;function i(...a){const o=n.length>a.length;let l;o&&a.push(r);try{l=n.apply(this,a)}catch(u){const c=u;if(o&&t)throw c;return r(c)}o||(l&&l.then&&typeof l.then=="function"?l.then(s,r):l instanceof Error?r(l):s(l))}function r(a,...o){t||(t=!0,e(a,...o))}function s(a){r(null,a)}}class oi extends Error{constructor(e,t,i){super(),typeof t=="string"&&(i=t,t=void 0);let r="",s={},a=!1;if(t&&("line"in t&&"column"in t?s={place:t}:"start"in t&&"end"in t?s={place:t}:"type"in t?s={ancestors:[t],place:t.position}:s={...t}),typeof e=="string"?r=e:!s.cause&&e&&(a=!0,r=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof i=="string"){const l=i.indexOf(":");l===-1?s.ruleId=i:(s.source=i.slice(0,l),s.ruleId=i.slice(l+1))}if(!s.place&&s.ancestors&&s.ancestors){const l=s.ancestors[s.ancestors.length-1];l&&(s.place=l.position)}const o=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=o?o.line:void 0,this.name=_l(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=a&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}oi.prototype.file="";oi.prototype.name="";oi.prototype.reason="";oi.prototype.message="";oi.prototype.stack="";oi.prototype.column=void 0;oi.prototype.line=void 0;oi.prototype.ancestors=void 0;oi.prototype.cause=void 0;oi.prototype.fatal=void 0;oi.prototype.place=void 0;oi.prototype.ruleId=void 0;oi.prototype.source=void 0;const fr={basename:KV,dirname:YV,extname:XV,join:QV,sep:"/"};function KV(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');sc(n);let t=0,i=-1,r=n.length,s;if(e===void 0||e.length===0||e.length>n.length){for(;r--;)if(n.codePointAt(r)===47){if(s){t=r+1;break}}else i<0&&(s=!0,i=r+1);return i<0?"":n.slice(t,i)}if(e===n)return"";let a=-1,o=e.length-1;for(;r--;)if(n.codePointAt(r)===47){if(s){t=r+1;break}}else a<0&&(s=!0,a=r+1),o>-1&&(n.codePointAt(r)===e.codePointAt(o--)?o<0&&(i=r):(o=-1,i=a));return t===i?i=a:i<0&&(i=n.length),n.slice(t,i)}function YV(n){if(sc(n),n.length===0)return".";let e=-1,t=n.length,i;for(;--t;)if(n.codePointAt(t)===47){if(i){e=t;break}}else i||(i=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}function XV(n){sc(n);let e=n.length,t=-1,i=0,r=-1,s=0,a;for(;e--;){const o=n.codePointAt(e);if(o===47){if(a){i=e+1;break}continue}t<0&&(a=!0,t=e+1),o===46?r<0?r=e:s!==1&&(s=1):r>-1&&(s=-1)}return r<0||t<0||s===0||s===1&&r===t-1&&r===i+1?"":n.slice(r,t)}function QV(...n){let e=-1,t;for(;++e<n.length;)sc(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":ZV(t)}function ZV(n){sc(n);const e=n.codePointAt(0)===47;let t=JV(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}function JV(n,e){let t="",i=0,r=-1,s=0,a=-1,o,l;for(;++a<=n.length;){if(a<n.length)o=n.codePointAt(a);else{if(o===47)break;o=47}if(o===47){if(!(r===a-1||s===1))if(r!==a-1&&s===2){if(t.length<2||i!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(l=t.lastIndexOf("/"),l!==t.length-1){l<0?(t="",i=0):(t=t.slice(0,l),i=t.length-1-t.lastIndexOf("/")),r=a,s=0;continue}}else if(t.length>0){t="",i=0,r=a,s=0;continue}}e&&(t=t.length>0?t+"/..":"..",i=2)}else t.length>0?t+="/"+n.slice(r+1,a):t=n.slice(r+1,a),i=a-r-1;r=a,s=0}else o===46&&s>-1?s++:s=-1}return t}function sc(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}const eG={cwd:tG};function tG(){return"/"}function hv(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}function nG(n){if(typeof n=="string")n=new URL(n);else if(!hv(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return iG(n)}function iG(n){if(n.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const i=e.codePointAt(t+2);if(i===70||i===102){const r=new TypeError("File URL path must not include encoded / characters");throw r.code="ERR_INVALID_FILE_URL_PATH",r}}return decodeURIComponent(e)}const tm=["history","path","basename","stem","extname","dirname"];class rG{constructor(e){let t;e?hv(e)?t={path:e}:typeof e=="string"||sG(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":eG.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<tm.length;){const s=tm[i];s in t&&t[s]!==void 0&&t[s]!==null&&(this[s]=s==="history"?[...t[s]]:t[s])}let r;for(r in t)tm.includes(r)||(this[r]=t[r])}get basename(){return typeof this.path=="string"?fr.basename(this.path):void 0}set basename(e){im(e,"basename"),nm(e,"basename"),this.path=fr.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?fr.dirname(this.path):void 0}set dirname(e){yS(this.basename,"dirname"),this.path=fr.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?fr.extname(this.path):void 0}set extname(e){if(nm(e,"extname"),yS(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=fr.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){hv(e)&&(e=nG(e)),im(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?fr.basename(this.path,this.extname):void 0}set stem(e){im(e,"stem"),nm(e,"stem"),this.path=fr.join(this.dirname||"",e+(this.extname||""))}fail(e,t,i){const r=this.message(e,t,i);throw r.fatal=!0,r}info(e,t,i){const r=this.message(e,t,i);return r.fatal=void 0,r}message(e,t,i){const r=new oi(e,t,i);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function nm(n,e){if(n&&n.includes(fr.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+fr.sep+"`")}function im(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}function yS(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}function sG(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const aG=(function(n){const i=this.constructor.prototype,r=i[n],s=function(){return r.apply(s,arguments)};return Object.setPrototypeOf(s,i),s}),oG={}.hasOwnProperty;class Hy extends aG{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=qV()}copy(){const e=new Hy;let t=-1;for(;++t<this.attachers.length;){const i=this.attachers[t];e.use(...i)}return e.data(em(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(am("data",this.frozen),this.namespace[e]=t,this):oG.call(this.namespace,e)&&this.namespace[e]||void 0:e?(am("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const r=t.call(e,...i);typeof r=="function"&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=_d(e),i=this.parser||this.Parser;return rm("parse",i),i(String(t),t)}process(e,t){const i=this;return this.freeze(),rm("process",this.parser||this.Parser),sm("process",this.compiler||this.Compiler),t?r(void 0,t):new Promise(r);function r(s,a){const o=_d(e),l=i.parse(o);i.run(l,o,function(c,d,h){if(c||!d||!h)return u(c);const p=d,g=i.stringify(p,h);cG(g)?h.value=g:h.result=g,u(c,h)});function u(c,d){c||!d?a(c):s?s(d):t(void 0,d)}}}processSync(e){let t=!1,i;return this.freeze(),rm("processSync",this.parser||this.Parser),sm("processSync",this.compiler||this.Compiler),this.process(e,r),bS("processSync","process",t),i;function r(s,a){t=!0,gS(s),i=a}}run(e,t,i){ES(e),this.freeze();const r=this.transformers;return!i&&typeof t=="function"&&(i=t,t=void 0),i?s(void 0,i):new Promise(s);function s(a,o){const l=_d(t);r.run(e,l,u);function u(c,d,h){const p=d||e;c?o(c):a?a(p):i(void 0,p,h)}}}runSync(e,t){let i=!1,r;return this.run(e,t,s),bS("runSync","run",i),r;function s(a,o){gS(a),r=o,i=!0}}stringify(e,t){this.freeze();const i=_d(t),r=this.compiler||this.Compiler;return sm("stringify",r),ES(e),r(e,i)}use(e,...t){const i=this.attachers,r=this.namespace;if(am("use",this.frozen),e!=null)if(typeof e=="function")l(e,t);else if(typeof e=="object")Array.isArray(e)?o(e):a(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[c,...d]=u;l(c,d)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(r.settings=em(!0,r.settings,u.settings))}function o(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){const d=u[c];s(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let d=-1,h=-1;for(;++d<i.length;)if(i[d][0]===u){h=d;break}if(h===-1)i.push([u,...c]);else if(c.length>0){let[p,...g]=c;const v=i[h][1];fv(v)&&fv(p)&&(p=em(!0,v,p)),i[h]=[u,p,...g]}}}}const uG=new Hy().freeze();function rm(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}function sm(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}function am(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function ES(n){if(!fv(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}function bS(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}function _d(n){return lG(n)?n:new rG(n)}function lG(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}function cG(n){return typeof n=="string"||dG(n)}function dG(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}var n_={exports:{}},cl={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TS;function fG(){if(TS)return cl;TS=1;var n=B,e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,u){var c,d={},h=null,p=null;u!==void 0&&(h=""+u),l.key!==void 0&&(h=""+l.key),l.ref!==void 0&&(p=l.ref);for(c in l)i.call(l,c)&&!s.hasOwnProperty(c)&&(d[c]=l[c]);if(o&&o.defaultProps)for(c in l=o.defaultProps,l)d[c]===void 0&&(d[c]=l[c]);return{$$typeof:e,type:o,key:h,ref:p,props:d,_owner:r.current}}return cl.Fragment=t,cl.jsx=a,cl.jsxs=a,cl}n_.exports=fG();var hG=n_.exports;async function pG(n){const e=await uG().use(oV).use(Lj).use(VV,{allowDangerousHtml:!0}).use(q9).use(XU).processSync(n);return String(e)}function mG(n){const[e,t]=B.useState("");return B.useEffect(()=>{(async()=>{const i=await pG(n);t(i)})()},[n]),{html:e,jsx:hG.jsx("div",{dangerouslySetInnerHTML:{__html:e}})}}var om,xS;function i_(){if(xS)return om;xS=1;function n(l,u){this.message=l,this.error=u}n.prototype=Object.create(Error.prototype);const e=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function t(l,u){u||(u={});const{meta:c=!1,strict:d=!0}=u;if(typeof l!="string")throw new n("Input must be a string");l=l.trim(),l=l.replace(/\r\n/g,`
`),l=l.replace(/\r/g,`
`);const h=l.split(`

`),p=h.shift();if(!p.startsWith("WEBVTT"))throw new n('Must start with "WEBVTT"');const g=p.split(`
`),v=g[0].replace("WEBVTT","");if(v.length>0&&v[0]!==" "&&v[0]!=="	")throw new n("Header comment must start with space or tab");if(h.length===0&&g.length===1)return{valid:!0,strict:d,cues:[],errors:[]};if(!c&&g.length>1&&g[1]!=="")throw new n("Missing blank line after signature");const{cues:y,errors:b}=r(h,d);if(d&&b.length>0)throw b[0];const T=c?i(g):null,x={valid:b.length===0,strict:d,cues:y,errors:b};return c&&(x.meta=T),x}function i(l){const u={};return l.slice(1).forEach(c=>{const d=c.indexOf(":"),h=c.slice(0,d).trim(),p=c.slice(d+1).trim();u[h]=p}),Object.keys(u).length>0?u:null}function r(l,u){const c=[];return{cues:l.map((h,p)=>{try{return s(h,p,u)}catch(g){return c.push(g),null}}).filter(Boolean),errors:c}}function s(l,u,c){let d="",h=0,p=.01,g="",v="";const y=l.split(`
`).filter(Boolean);if(y.length>0&&y[0].trim().startsWith("NOTE"))return null;if(y.length===1&&!y[0].includes("-->"))throw new n(`Cue identifier cannot be standalone (cue #${u})`);if(y.length>1&&!(y[0].includes("-->")||y[1].includes("-->"))){const T=`Cue identifier needs to be followed by timestamp (cue #${u})`;throw new n(T)}y.length>1&&y[1].includes("-->")&&(d=y.shift());const b=typeof y[0]=="string"&&y[0].split(" --> ");if(b.length!==2||!a(b[0])||!a(b[1]))throw new n(`Invalid cue timestamp (cue #${u})`);if(h=o(b[0]),p=o(b[1]),c){if(h>p)throw new n(`Start timestamp greater than end (cue #${u})`);if(p<=h)throw new n(`End must be greater than start (cue #${u})`)}if(!c&&p<h)throw new n(`End must be greater or equal to start when not strict (cue #${u})`);return v=b[1].replace(e,"").trim(),y.shift(),g=y.join(`
`),g?{identifier:d,start:h,end:p,text:g,styles:v}:!1}function a(l){return e.test(l)}function o(l){const u=l.match(e);let c=parseFloat(u[1]||0)*60*60;return c+=parseFloat(u[2])*60,c+=parseFloat(u[3]),c}return om={ParserError:n,parse:t},om}var um,SS;function gG(){if(SS)return um;SS=1;function n(u,c){this.message=u,this.error=c}n.prototype=Object.create(Error.prototype);function e(u){if(!u)throw new n("Input must be non-null");if(typeof u!="object")throw new n("Input must be an object");if(Array.isArray(u))throw new n("Input cannot be array");if(!u.valid)throw new n("Input must be valid");let c=`WEBVTT
`;if(u.meta){if(typeof u.meta!="object"||Array.isArray(u.meta))throw new n("Metadata must be an object");Object.entries(u.meta).forEach(h=>{if(typeof h[1]!="string")throw new n(`Metadata value for "${h[0]}" must be string`);c+=`${h[0]}: ${h[1]}
`})}let d=null;return u.cues.forEach((h,p)=>{if(d&&d>h.start)throw new n(`Cue number ${p} is not in chronological order`);d=h.start,c+=`
`,c+=t(h),c+=`
`}),c}function t(u){if(typeof u!="object")throw new n("Cue malformed: not of type object");if(typeof u.identifier!="string"&&typeof u.identifier!="number"&&u.identifier!==null)throw new n(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(u)}`);if(isNaN(u.start))throw new n(`Cue malformed: null start value.
    ${JSON.stringify(u)}`);if(isNaN(u.end))throw new n(`Cue malformed: null end value.
    ${JSON.stringify(u)}`);if(u.start>=u.end)throw new n(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(u)}`);if(typeof u.text!="string")throw new n(`Cue malformed: null text value.
    ${JSON.stringify(u)}`);if(typeof u.styles!="string")throw new n(`Cue malformed: null styles value.
    ${JSON.stringify(u)}`);let c="";u.identifier.length>0&&(c+=`${u.identifier}
`);const d=i(u.start),h=i(u.end);return c+=`${d} --> ${h}`,c+=u.styles?` ${u.styles}`:"",c+=`
${u.text}`,c}function i(u){const c=r(s(u),2),d=r(a(u),2),h=r(o(u),2),p=r(l(u),3);return`${c}:${d}:${h}.${p}`}function r(u,c){let d=`${u}`;for(;d.length<c;)d=`0${d}`;return d}function s(u){return Math.floor(u/60/60)}function a(u){return Math.floor(u/60)%60}function o(u){return Math.floor(u%60)}function l(u){return Math.floor((u%1).toFixed(4)*1e3)}return um={CompilerError:n,compile:e},um}var lm,wS;function r_(){if(wS)return lm;wS=1;const n=i_().parse;function e(a,o){o=o||10;const l=n(a),u=[];let c=[],d=null,h=0,p=0;return l.cues.forEach((g,v)=>{const y=v===0,b=v===l.cues.length-1,T=g.start,x=g.end,w=b?1/0:l.cues[v+1].start,A=y?x:x-T,R=y?0:T-l.cues[v-1].end;h=h+A+R,`${v}`,u.length+1,d&&(c.push(d),h+=d.end-p,d=null),c.push(g);let _=w-x<o&&R<o&&h>o;if(t(p,o,w,R)){const D=i(b,x,o,h,p);u.push({duration:D,cues:c}),p+=D,h=0,c=[]}else _=!1;_&&(d=g)}),u}function t(a,o,l,u){const c=r(u,o);return(u<=o||c+a<l)&&l-a>=o}function i(a,o,l,u,c){let d=l;return u>l&&(d=r(u-l,l)),a?d=parseFloat((o-c).toFixed(2)):d=Math.round(d),d}function r(a,o){return a+=o-a%o,a}function s(a){}return lm={segment:e},lm}var cm,AS;function vG(){if(AS)return cm;AS=1;const n=r_().segment;function e(c,d,h){typeof h>"u"&&(h="900000");const p=n(c,d),g=[];return p.forEach((v,y)=>{const b=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${h},LOCAL:00:00:00.000

${o(v.cues)}
`,T=r(y);g.push({filename:T,content:b})}),g}function t(c,d){const h=n(c,d),p=s(h);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(a(h))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${p}
#EXT-X-ENDLIST
`}function i(c,d){return`${"0".repeat(Math.max(0,d-c.toString().length))}${c}`}function r(c){return`${c}.vtt`}function s(c){const d=[];return c.forEach((h,p)=>{d.push(`#EXTINF:${h.duration.toFixed(5)},
${r(p)}`)}),d.join(`
`)}function a(c){let d=0;return c.forEach(h=>{h.duration>d&&(d=h.duration)}),d}function o(c){const d=[];return c.forEach(h=>{d.push(l(h))}),d.join(`

`)}function l(c){const d=[];c.identifier&&d.push(c.identifier);const h=u(c.start),p=u(c.end),g=c.styles?`${c.styles}`:"";return d.push(`${h} --> ${p} ${g}`),d.push(c.text),d.join(`
`)}function u(c){const d=(c%1).toFixed(3);c=Math.round(c-d);const h=Math.floor(c/3600),p=Math.floor((c-h*3600)/60),g=c-h*3600-p*60;return`${`${i(h,2)}:`}${i(p,2)}:${i(g,2)}.${i(d*1e3,3)}`}return cm={hlsSegment:e,hlsSegmentPlaylist:t},cm}var dm,CS;function yG(){if(CS)return dm;CS=1;const n=i_().parse,e=gG().compile,t=r_().segment,i=vG();return dm={parse:n,compile:e,segment:t,hls:i},dm}var EG=yG(),bG=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],yh=bG.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function zy(n){const[e,t]=U.useState(void 0);return kn(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let a,o;if("borderBoxSize"in s){const l=s.borderBoxSize,u=Array.isArray(l)?l[0]:l;a=u.inlineSize,o=u.blockSize}else a=n.offsetWidth,o=n.offsetHeight;t({width:a,height:o})});return i.observe(n,{box:"border-box"}),()=>i.unobserve(n)}else t(void 0)},[n]),e}function jy(n){const e=U.useRef({value:n,previous:n});return U.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var Vy="Radio",[TG,s_]=Cr(Vy),[xG,SG]=TG(Vy),a_=U.forwardRef((n,e)=>{const{__scopeRadio:t,name:i,checked:r=!1,required:s,disabled:a,value:o="on",onCheck:l,form:u,...c}=n,[d,h]=U.useState(null),p=Ht(e,y=>h(y)),g=U.useRef(!1),v=d?u||!!d.closest("form"):!0;return be.jsxs(xG,{scope:t,checked:r,disabled:a,children:[be.jsx(yh.button,{type:"button",role:"radio","aria-checked":r,"data-state":c_(r),"data-disabled":a?"":void 0,disabled:a,value:o,...c,ref:p,onClick:xt(n.onClick,y=>{r||l==null||l(),v&&(g.current=y.isPropagationStopped(),g.current||y.stopPropagation())})}),v&&be.jsx(l_,{control:d,bubbles:!g.current,name:i,value:o,checked:r,required:s,disabled:a,form:u,style:{transform:"translateX(-100%)"}})]})});a_.displayName=Vy;var o_="RadioIndicator",u_=U.forwardRef((n,e)=>{const{__scopeRadio:t,forceMount:i,...r}=n,s=SG(o_,t);return be.jsx(Ql,{present:i||s.checked,children:be.jsx(yh.span,{"data-state":c_(s.checked),"data-disabled":s.disabled?"":void 0,...r,ref:e})})});u_.displayName=o_;var wG="RadioBubbleInput",l_=U.forwardRef(({__scopeRadio:n,control:e,checked:t,bubbles:i=!0,...r},s)=>{const a=U.useRef(null),o=Ht(a,s),l=jy(t),u=zy(e);return U.useEffect(()=>{const c=a.current;if(!c)return;const d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"checked").set;if(l!==t&&p){const g=new Event("click",{bubbles:i});p.call(c,t),c.dispatchEvent(g)}},[l,t,i]),be.jsx(yh.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...r,tabIndex:-1,ref:o,style:{...r.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});l_.displayName=wG;function c_(n){return n?"checked":"unchecked"}var AG=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Eh="RadioGroup",[CG]=Cr(Eh,[rh,s_]),d_=rh(),f_=s_(),[IG,RG]=CG(Eh),h_=U.forwardRef((n,e)=>{const{__scopeRadioGroup:t,name:i,defaultValue:r,value:s,required:a=!1,disabled:o=!1,orientation:l,dir:u,loop:c=!0,onValueChange:d,...h}=n,p=d_(t),g=ih(u),[v,y]=Gs({prop:s,defaultProp:r??null,onChange:d,caller:Eh});return be.jsx(IG,{scope:t,name:i,required:a,disabled:o,value:v,onValueChange:y,children:be.jsx(KC,{asChild:!0,...p,orientation:l,dir:g,loop:c,children:be.jsx(yh.div,{role:"radiogroup","aria-required":a,"aria-orientation":l,"data-disabled":o?"":void 0,dir:g,...h,ref:e})})})});h_.displayName=Eh;var p_="RadioGroupItem",m_=U.forwardRef((n,e)=>{const{__scopeRadioGroup:t,disabled:i,...r}=n,s=RG(p_,t),a=s.disabled||i,o=d_(t),l=f_(t),u=U.useRef(null),c=Ht(e,u),d=s.value===r.value,h=U.useRef(!1);return U.useEffect(()=>{const p=v=>{AG.includes(v.key)&&(h.current=!0)},g=()=>h.current=!1;return document.addEventListener("keydown",p),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",g)}},[]),be.jsx(YC,{asChild:!0,...o,focusable:!a,active:d,children:be.jsx(a_,{disabled:a,required:s.required,checked:d,...l,...r,name:s.name,ref:c,onCheck:()=>s.onValueChange(r.value),onKeyDown:xt(p=>{p.key==="Enter"&&p.preventDefault()}),onFocus:xt(r.onFocus,()=>{var p;h.current&&((p=u.current)==null||p.click())})})})});m_.displayName=p_;var _G="RadioGroupIndicator",LG=U.forwardRef((n,e)=>{const{__scopeRadioGroup:t,...i}=n,r=f_(t);return be.jsx(u_,{...r,...i,ref:e})});LG.displayName=_G;var g_=h_,v_=m_,Gi={},Wi={},fm={},qi={},Ld={},IS;function PG(){return IS||(IS=1,Object.defineProperty(Ld,"__esModule",{value:!0}),Ld.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(n){return n.charCodeAt(0)}))),Ld}var Pd={},RS;function kG(){return RS||(RS=1,Object.defineProperty(Pd,"__esModule",{value:!0}),Pd.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(n){return n.charCodeAt(0)}))),Pd}var hm={},_S;function LS(){return _S||(_S=1,(function(n){var e;Object.defineProperty(n,"__esModule",{value:!0}),n.replaceCodePoint=n.fromCodePoint=void 0;var t=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);n.fromCodePoint=(e=String.fromCodePoint)!==null&&e!==void 0?e:function(s){var a="";return s>65535&&(s-=65536,a+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),a+=String.fromCharCode(s),a};function i(s){var a;return s>=55296&&s<=57343||s>1114111?65533:(a=t.get(s))!==null&&a!==void 0?a:s}n.replaceCodePoint=i;function r(s){return(0,n.fromCodePoint)(i(s))}n.default=r})(hm)),hm}var PS;function Ff(){return PS||(PS=1,(function(n){var e=qi&&qi.__createBinding||(Object.create?(function(N,G,X,te){te===void 0&&(te=X);var Q=Object.getOwnPropertyDescriptor(G,X);(!Q||("get"in Q?!G.__esModule:Q.writable||Q.configurable))&&(Q={enumerable:!0,get:function(){return G[X]}}),Object.defineProperty(N,te,Q)}):(function(N,G,X,te){te===void 0&&(te=X),N[te]=G[X]})),t=qi&&qi.__setModuleDefault||(Object.create?(function(N,G){Object.defineProperty(N,"default",{enumerable:!0,value:G})}):function(N,G){N.default=G}),i=qi&&qi.__importStar||function(N){if(N&&N.__esModule)return N;var G={};if(N!=null)for(var X in N)X!=="default"&&Object.prototype.hasOwnProperty.call(N,X)&&e(G,N,X);return t(G,N),G},r=qi&&qi.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(n,"__esModule",{value:!0}),n.decodeXML=n.decodeHTMLStrict=n.decodeHTMLAttribute=n.decodeHTML=n.determineBranch=n.EntityDecoder=n.DecodingMode=n.BinTrieFlags=n.fromCodePoint=n.replaceCodePoint=n.decodeCodePoint=n.xmlDecodeTree=n.htmlDecodeTree=void 0;var s=r(PG());n.htmlDecodeTree=s.default;var a=r(kG());n.xmlDecodeTree=a.default;var o=i(LS());n.decodeCodePoint=o.default;var l=LS();Object.defineProperty(n,"replaceCodePoint",{enumerable:!0,get:function(){return l.replaceCodePoint}}),Object.defineProperty(n,"fromCodePoint",{enumerable:!0,get:function(){return l.fromCodePoint}});var u;(function(N){N[N.NUM=35]="NUM",N[N.SEMI=59]="SEMI",N[N.EQUALS=61]="EQUALS",N[N.ZERO=48]="ZERO",N[N.NINE=57]="NINE",N[N.LOWER_A=97]="LOWER_A",N[N.LOWER_F=102]="LOWER_F",N[N.LOWER_X=120]="LOWER_X",N[N.LOWER_Z=122]="LOWER_Z",N[N.UPPER_A=65]="UPPER_A",N[N.UPPER_F=70]="UPPER_F",N[N.UPPER_Z=90]="UPPER_Z"})(u||(u={}));var c=32,d;(function(N){N[N.VALUE_LENGTH=49152]="VALUE_LENGTH",N[N.BRANCH_LENGTH=16256]="BRANCH_LENGTH",N[N.JUMP_TABLE=127]="JUMP_TABLE"})(d=n.BinTrieFlags||(n.BinTrieFlags={}));function h(N){return N>=u.ZERO&&N<=u.NINE}function p(N){return N>=u.UPPER_A&&N<=u.UPPER_F||N>=u.LOWER_A&&N<=u.LOWER_F}function g(N){return N>=u.UPPER_A&&N<=u.UPPER_Z||N>=u.LOWER_A&&N<=u.LOWER_Z||h(N)}function v(N){return N===u.EQUALS||g(N)}var y;(function(N){N[N.EntityStart=0]="EntityStart",N[N.NumericStart=1]="NumericStart",N[N.NumericDecimal=2]="NumericDecimal",N[N.NumericHex=3]="NumericHex",N[N.NamedEntity=4]="NamedEntity"})(y||(y={}));var b;(function(N){N[N.Legacy=0]="Legacy",N[N.Strict=1]="Strict",N[N.Attribute=2]="Attribute"})(b=n.DecodingMode||(n.DecodingMode={}));var T=(function(){function N(G,X,te){this.decodeTree=G,this.emitCodePoint=X,this.errors=te,this.state=y.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=b.Strict}return N.prototype.startEntity=function(G){this.decodeMode=G,this.state=y.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},N.prototype.write=function(G,X){switch(this.state){case y.EntityStart:return G.charCodeAt(X)===u.NUM?(this.state=y.NumericStart,this.consumed+=1,this.stateNumericStart(G,X+1)):(this.state=y.NamedEntity,this.stateNamedEntity(G,X));case y.NumericStart:return this.stateNumericStart(G,X);case y.NumericDecimal:return this.stateNumericDecimal(G,X);case y.NumericHex:return this.stateNumericHex(G,X);case y.NamedEntity:return this.stateNamedEntity(G,X)}},N.prototype.stateNumericStart=function(G,X){return X>=G.length?-1:(G.charCodeAt(X)|c)===u.LOWER_X?(this.state=y.NumericHex,this.consumed+=1,this.stateNumericHex(G,X+1)):(this.state=y.NumericDecimal,this.stateNumericDecimal(G,X))},N.prototype.addToNumericResult=function(G,X,te,Q){if(X!==te){var ne=te-X;this.result=this.result*Math.pow(Q,ne)+parseInt(G.substr(X,ne),Q),this.consumed+=ne}},N.prototype.stateNumericHex=function(G,X){for(var te=X;X<G.length;){var Q=G.charCodeAt(X);if(h(Q)||p(Q))X+=1;else return this.addToNumericResult(G,te,X,16),this.emitNumericEntity(Q,3)}return this.addToNumericResult(G,te,X,16),-1},N.prototype.stateNumericDecimal=function(G,X){for(var te=X;X<G.length;){var Q=G.charCodeAt(X);if(h(Q))X+=1;else return this.addToNumericResult(G,te,X,10),this.emitNumericEntity(Q,2)}return this.addToNumericResult(G,te,X,10),-1},N.prototype.emitNumericEntity=function(G,X){var te;if(this.consumed<=X)return(te=this.errors)===null||te===void 0||te.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(G===u.SEMI)this.consumed+=1;else if(this.decodeMode===b.Strict)return 0;return this.emitCodePoint((0,o.replaceCodePoint)(this.result),this.consumed),this.errors&&(G!==u.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},N.prototype.stateNamedEntity=function(G,X){for(var te=this.decodeTree,Q=te[this.treeIndex],ne=(Q&d.VALUE_LENGTH)>>14;X<G.length;X++,this.excess++){var oe=G.charCodeAt(X);if(this.treeIndex=w(te,Q,this.treeIndex+Math.max(1,ne),oe),this.treeIndex<0)return this.result===0||this.decodeMode===b.Attribute&&(ne===0||v(oe))?0:this.emitNotTerminatedNamedEntity();if(Q=te[this.treeIndex],ne=(Q&d.VALUE_LENGTH)>>14,ne!==0){if(oe===u.SEMI)return this.emitNamedEntityData(this.treeIndex,ne,this.consumed+this.excess);this.decodeMode!==b.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},N.prototype.emitNotTerminatedNamedEntity=function(){var G,X=this,te=X.result,Q=X.decodeTree,ne=(Q[te]&d.VALUE_LENGTH)>>14;return this.emitNamedEntityData(te,ne,this.consumed),(G=this.errors)===null||G===void 0||G.missingSemicolonAfterCharacterReference(),this.consumed},N.prototype.emitNamedEntityData=function(G,X,te){var Q=this.decodeTree;return this.emitCodePoint(X===1?Q[G]&~d.VALUE_LENGTH:Q[G+1],te),X===3&&this.emitCodePoint(Q[G+2],te),te},N.prototype.end=function(){var G;switch(this.state){case y.NamedEntity:return this.result!==0&&(this.decodeMode!==b.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case y.NumericDecimal:return this.emitNumericEntity(0,2);case y.NumericHex:return this.emitNumericEntity(0,3);case y.NumericStart:return(G=this.errors)===null||G===void 0||G.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case y.EntityStart:return 0}},N})();n.EntityDecoder=T;function x(N){var G="",X=new T(N,function(te){return G+=(0,o.fromCodePoint)(te)});return function(Q,ne){for(var oe=0,Z=0;(Z=Q.indexOf("&",Z))>=0;){G+=Q.slice(oe,Z),X.startEntity(ne);var se=X.write(Q,Z+1);if(se<0){oe=Z+X.end();break}oe=Z+se,Z=se===0?oe+1:oe}var j=G+Q.slice(oe);return G="",j}}function w(N,G,X,te){var Q=(G&d.BRANCH_LENGTH)>>7,ne=G&d.JUMP_TABLE;if(Q===0)return ne!==0&&te===ne?X:-1;if(ne){var oe=te-ne;return oe<0||oe>=Q?-1:N[X+oe]-1}for(var Z=X,se=Z+Q-1;Z<=se;){var j=Z+se>>>1,q=N[j];if(q<te)Z=j+1;else if(q>te)se=j-1;else return N[j+Q]}return-1}n.determineBranch=w;var A=x(s.default),R=x(a.default);function _(N,G){return G===void 0&&(G=b.Legacy),A(N,G)}n.decodeHTML=_;function D(N){return A(N,b.Attribute)}n.decodeHTMLAttribute=D;function H(N){return A(N,b.Strict)}n.decodeHTMLStrict=H;function P(N){return R(N,b.Strict)}n.decodeXML=P})(qi)),qi}var kS;function y_(){return kS||(kS=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteType=void 0;var e=Ff(),t;(function(h){h[h.Tab=9]="Tab",h[h.NewLine=10]="NewLine",h[h.FormFeed=12]="FormFeed",h[h.CarriageReturn=13]="CarriageReturn",h[h.Space=32]="Space",h[h.ExclamationMark=33]="ExclamationMark",h[h.Number=35]="Number",h[h.Amp=38]="Amp",h[h.SingleQuote=39]="SingleQuote",h[h.DoubleQuote=34]="DoubleQuote",h[h.Dash=45]="Dash",h[h.Slash=47]="Slash",h[h.Zero=48]="Zero",h[h.Nine=57]="Nine",h[h.Semi=59]="Semi",h[h.Lt=60]="Lt",h[h.Eq=61]="Eq",h[h.Gt=62]="Gt",h[h.Questionmark=63]="Questionmark",h[h.UpperA=65]="UpperA",h[h.LowerA=97]="LowerA",h[h.UpperF=70]="UpperF",h[h.LowerF=102]="LowerF",h[h.UpperZ=90]="UpperZ",h[h.LowerZ=122]="LowerZ",h[h.LowerX=120]="LowerX",h[h.OpeningSquareBracket=91]="OpeningSquareBracket"})(t||(t={}));var i;(function(h){h[h.Text=1]="Text",h[h.BeforeTagName=2]="BeforeTagName",h[h.InTagName=3]="InTagName",h[h.InSelfClosingTag=4]="InSelfClosingTag",h[h.BeforeClosingTagName=5]="BeforeClosingTagName",h[h.InClosingTagName=6]="InClosingTagName",h[h.AfterClosingTagName=7]="AfterClosingTagName",h[h.BeforeAttributeName=8]="BeforeAttributeName",h[h.InAttributeName=9]="InAttributeName",h[h.AfterAttributeName=10]="AfterAttributeName",h[h.BeforeAttributeValue=11]="BeforeAttributeValue",h[h.InAttributeValueDq=12]="InAttributeValueDq",h[h.InAttributeValueSq=13]="InAttributeValueSq",h[h.InAttributeValueNq=14]="InAttributeValueNq",h[h.BeforeDeclaration=15]="BeforeDeclaration",h[h.InDeclaration=16]="InDeclaration",h[h.InProcessingInstruction=17]="InProcessingInstruction",h[h.BeforeComment=18]="BeforeComment",h[h.CDATASequence=19]="CDATASequence",h[h.InSpecialComment=20]="InSpecialComment",h[h.InCommentLike=21]="InCommentLike",h[h.BeforeSpecialS=22]="BeforeSpecialS",h[h.SpecialStartSequence=23]="SpecialStartSequence",h[h.InSpecialTag=24]="InSpecialTag",h[h.BeforeEntity=25]="BeforeEntity",h[h.BeforeNumericEntity=26]="BeforeNumericEntity",h[h.InNamedEntity=27]="InNamedEntity",h[h.InNumericEntity=28]="InNumericEntity",h[h.InHexEntity=29]="InHexEntity"})(i||(i={}));function r(h){return h===t.Space||h===t.NewLine||h===t.Tab||h===t.FormFeed||h===t.CarriageReturn}function s(h){return h===t.Slash||h===t.Gt||r(h)}function a(h){return h>=t.Zero&&h<=t.Nine}function o(h){return h>=t.LowerA&&h<=t.LowerZ||h>=t.UpperA&&h<=t.UpperZ}function l(h){return h>=t.UpperA&&h<=t.UpperF||h>=t.LowerA&&h<=t.LowerF}var u;(function(h){h[h.NoValue=0]="NoValue",h[h.Unquoted=1]="Unquoted",h[h.Single=2]="Single",h[h.Double=3]="Double"})(u=n.QuoteType||(n.QuoteType={}));var c={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},d=(function(){function h(p,g){var v=p.xmlMode,y=v===void 0?!1:v,b=p.decodeEntities,T=b===void 0?!0:b;this.cbs=g,this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=y,this.decodeEntities=T,this.entityTrie=y?e.xmlDecodeTree:e.htmlDecodeTree}return h.prototype.reset=function(){this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},h.prototype.write=function(p){this.offset+=this.buffer.length,this.buffer=p,this.parse()},h.prototype.end=function(){this.running&&this.finish()},h.prototype.pause=function(){this.running=!1},h.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},h.prototype.getIndex=function(){return this.index},h.prototype.getSectionStart=function(){return this.sectionStart},h.prototype.stateText=function(p){p===t.Lt||!this.decodeEntities&&this.fastForwardTo(t.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=i.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&p===t.Amp&&(this.state=i.BeforeEntity)},h.prototype.stateSpecialStartSequence=function(p){var g=this.sequenceIndex===this.currentSequence.length,v=g?s(p):(p|32)===this.currentSequence[this.sequenceIndex];if(!v)this.isSpecial=!1;else if(!g){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=i.InTagName,this.stateInTagName(p)},h.prototype.stateInSpecialTag=function(p){if(this.sequenceIndex===this.currentSequence.length){if(p===t.Gt||r(p)){var g=this.index-this.currentSequence.length;if(this.sectionStart<g){var v=this.index;this.index=g,this.cbs.ontext(this.sectionStart,g),this.index=v}this.isSpecial=!1,this.sectionStart=g+2,this.stateInClosingTagName(p);return}this.sequenceIndex=0}(p|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===c.TitleEnd?this.decodeEntities&&p===t.Amp&&(this.state=i.BeforeEntity):this.fastForwardTo(t.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(p===t.Lt)},h.prototype.stateCDATASequence=function(p){p===c.Cdata[this.sequenceIndex]?++this.sequenceIndex===c.Cdata.length&&(this.state=i.InCommentLike,this.currentSequence=c.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=i.InDeclaration,this.stateInDeclaration(p))},h.prototype.fastForwardTo=function(p){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===p)return!0;return this.index=this.buffer.length+this.offset-1,!1},h.prototype.stateInCommentLike=function(p){p===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===c.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=i.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):p!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},h.prototype.isTagStartChar=function(p){return this.xmlMode?!s(p):o(p)},h.prototype.startSpecial=function(p,g){this.isSpecial=!0,this.currentSequence=p,this.sequenceIndex=g,this.state=i.SpecialStartSequence},h.prototype.stateBeforeTagName=function(p){if(p===t.ExclamationMark)this.state=i.BeforeDeclaration,this.sectionStart=this.index+1;else if(p===t.Questionmark)this.state=i.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(p)){var g=p|32;this.sectionStart=this.index,!this.xmlMode&&g===c.TitleEnd[2]?this.startSpecial(c.TitleEnd,3):this.state=!this.xmlMode&&g===c.ScriptEnd[2]?i.BeforeSpecialS:i.InTagName}else p===t.Slash?this.state=i.BeforeClosingTagName:(this.state=i.Text,this.stateText(p))},h.prototype.stateInTagName=function(p){s(p)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(p))},h.prototype.stateBeforeClosingTagName=function(p){r(p)||(p===t.Gt?this.state=i.Text:(this.state=this.isTagStartChar(p)?i.InClosingTagName:i.InSpecialComment,this.sectionStart=this.index))},h.prototype.stateInClosingTagName=function(p){(p===t.Gt||r(p))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterClosingTagName,this.stateAfterClosingTagName(p))},h.prototype.stateAfterClosingTagName=function(p){(p===t.Gt||this.fastForwardTo(t.Gt))&&(this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1)},h.prototype.stateBeforeAttributeName=function(p){p===t.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=i.InSpecialTag,this.sequenceIndex=0):this.state=i.Text,this.baseState=this.state,this.sectionStart=this.index+1):p===t.Slash?this.state=i.InSelfClosingTag:r(p)||(this.state=i.InAttributeName,this.sectionStart=this.index)},h.prototype.stateInSelfClosingTag=function(p){p===t.Gt?(this.cbs.onselfclosingtag(this.index),this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1,this.isSpecial=!1):r(p)||(this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(p))},h.prototype.stateInAttributeName=function(p){(p===t.Eq||s(p))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterAttributeName,this.stateAfterAttributeName(p))},h.prototype.stateAfterAttributeName=function(p){p===t.Eq?this.state=i.BeforeAttributeValue:p===t.Slash||p===t.Gt?(this.cbs.onattribend(u.NoValue,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(p)):r(p)||(this.cbs.onattribend(u.NoValue,this.index),this.state=i.InAttributeName,this.sectionStart=this.index)},h.prototype.stateBeforeAttributeValue=function(p){p===t.DoubleQuote?(this.state=i.InAttributeValueDq,this.sectionStart=this.index+1):p===t.SingleQuote?(this.state=i.InAttributeValueSq,this.sectionStart=this.index+1):r(p)||(this.sectionStart=this.index,this.state=i.InAttributeValueNq,this.stateInAttributeValueNoQuotes(p))},h.prototype.handleInAttributeValue=function(p,g){p===g||!this.decodeEntities&&this.fastForwardTo(g)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(g===t.DoubleQuote?u.Double:u.Single,this.index),this.state=i.BeforeAttributeName):this.decodeEntities&&p===t.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)},h.prototype.stateInAttributeValueDoubleQuotes=function(p){this.handleInAttributeValue(p,t.DoubleQuote)},h.prototype.stateInAttributeValueSingleQuotes=function(p){this.handleInAttributeValue(p,t.SingleQuote)},h.prototype.stateInAttributeValueNoQuotes=function(p){r(p)||p===t.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(u.Unquoted,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(p)):this.decodeEntities&&p===t.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)},h.prototype.stateBeforeDeclaration=function(p){p===t.OpeningSquareBracket?(this.state=i.CDATASequence,this.sequenceIndex=0):this.state=p===t.Dash?i.BeforeComment:i.InDeclaration},h.prototype.stateInDeclaration=function(p){(p===t.Gt||this.fastForwardTo(t.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)},h.prototype.stateInProcessingInstruction=function(p){(p===t.Gt||this.fastForwardTo(t.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)},h.prototype.stateBeforeComment=function(p){p===t.Dash?(this.state=i.InCommentLike,this.currentSequence=c.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=i.InDeclaration},h.prototype.stateInSpecialComment=function(p){(p===t.Gt||this.fastForwardTo(t.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=i.Text,this.sectionStart=this.index+1)},h.prototype.stateBeforeSpecialS=function(p){var g=p|32;g===c.ScriptEnd[3]?this.startSpecial(c.ScriptEnd,4):g===c.StyleEnd[3]?this.startSpecial(c.StyleEnd,4):(this.state=i.InTagName,this.stateInTagName(p))},h.prototype.stateBeforeEntity=function(p){this.entityExcess=1,this.entityResult=0,p===t.Number?this.state=i.BeforeNumericEntity:p===t.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=i.InNamedEntity,this.stateInNamedEntity(p))},h.prototype.stateInNamedEntity=function(p){if(this.entityExcess+=1,this.trieIndex=(0,e.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,p),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var g=this.trieCurrent&e.BinTrieFlags.VALUE_LENGTH;if(g){var v=(g>>14)-1;if(!this.allowLegacyEntity()&&p!==t.Semi)this.trieIndex+=v;else{var y=this.index-this.entityExcess+1;y>this.sectionStart&&this.emitPartial(this.sectionStart,y),this.entityResult=this.trieIndex,this.trieIndex+=v,this.entityExcess=0,this.sectionStart=this.index+1,v===0&&this.emitNamedEntity()}}},h.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var p=(this.entityTrie[this.entityResult]&e.BinTrieFlags.VALUE_LENGTH)>>14;switch(p){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~e.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},h.prototype.stateBeforeNumericEntity=function(p){(p|32)===t.LowerX?(this.entityExcess++,this.state=i.InHexEntity):(this.state=i.InNumericEntity,this.stateInNumericEntity(p))},h.prototype.emitNumericEntity=function(p){var g=this.index-this.entityExcess-1,v=g+2+ +(this.state===i.InHexEntity);v!==this.index&&(g>this.sectionStart&&this.emitPartial(this.sectionStart,g),this.sectionStart=this.index+Number(p),this.emitCodePoint((0,e.replaceCodePoint)(this.entityResult))),this.state=this.baseState},h.prototype.stateInNumericEntity=function(p){p===t.Semi?this.emitNumericEntity(!0):a(p)?(this.entityResult=this.entityResult*10+(p-t.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},h.prototype.stateInHexEntity=function(p){p===t.Semi?this.emitNumericEntity(!0):a(p)?(this.entityResult=this.entityResult*16+(p-t.Zero),this.entityExcess++):l(p)?(this.entityResult=this.entityResult*16+((p|32)-t.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},h.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===i.Text||this.baseState===i.InSpecialTag)},h.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===i.Text||this.state===i.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===i.InAttributeValueDq||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},h.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},h.prototype.parse=function(){for(;this.shouldContinue();){var p=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case i.Text:{this.stateText(p);break}case i.SpecialStartSequence:{this.stateSpecialStartSequence(p);break}case i.InSpecialTag:{this.stateInSpecialTag(p);break}case i.CDATASequence:{this.stateCDATASequence(p);break}case i.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(p);break}case i.InAttributeName:{this.stateInAttributeName(p);break}case i.InCommentLike:{this.stateInCommentLike(p);break}case i.InSpecialComment:{this.stateInSpecialComment(p);break}case i.BeforeAttributeName:{this.stateBeforeAttributeName(p);break}case i.InTagName:{this.stateInTagName(p);break}case i.InClosingTagName:{this.stateInClosingTagName(p);break}case i.BeforeTagName:{this.stateBeforeTagName(p);break}case i.AfterAttributeName:{this.stateAfterAttributeName(p);break}case i.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(p);break}case i.BeforeAttributeValue:{this.stateBeforeAttributeValue(p);break}case i.BeforeClosingTagName:{this.stateBeforeClosingTagName(p);break}case i.AfterClosingTagName:{this.stateAfterClosingTagName(p);break}case i.BeforeSpecialS:{this.stateBeforeSpecialS(p);break}case i.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(p);break}case i.InSelfClosingTag:{this.stateInSelfClosingTag(p);break}case i.InDeclaration:{this.stateInDeclaration(p);break}case i.BeforeDeclaration:{this.stateBeforeDeclaration(p);break}case i.BeforeComment:{this.stateBeforeComment(p);break}case i.InProcessingInstruction:{this.stateInProcessingInstruction(p);break}case i.InNamedEntity:{this.stateInNamedEntity(p);break}case i.BeforeEntity:{this.stateBeforeEntity(p);break}case i.InHexEntity:{this.stateInHexEntity(p);break}case i.InNumericEntity:{this.stateInNumericEntity(p);break}default:this.stateBeforeNumericEntity(p)}this.index++}this.cleanup()},h.prototype.finish=function(){this.state===i.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},h.prototype.handleTrailingData=function(){var p=this.buffer.length+this.offset;this.state===i.InCommentLike?this.currentSequence===c.CdataEnd?this.cbs.oncdata(this.sectionStart,p,0):this.cbs.oncomment(this.sectionStart,p,0):this.state===i.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InTagName||this.state===i.BeforeAttributeName||this.state===i.BeforeAttributeValue||this.state===i.AfterAttributeName||this.state===i.InAttributeName||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueDq||this.state===i.InAttributeValueNq||this.state===i.InClosingTagName||this.cbs.ontext(this.sectionStart,p)},h.prototype.emitPartial=function(p,g){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribdata(p,g):this.cbs.ontext(p,g)},h.prototype.emitCodePoint=function(p){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribentity(p):this.cbs.ontextentity(p)},h})();n.default=d})(fm)),fm}var DS;function OS(){if(DS)return Wi;DS=1;var n=Wi&&Wi.__createBinding||(Object.create?(function(y,b,T,x){x===void 0&&(x=T);var w=Object.getOwnPropertyDescriptor(b,T);(!w||("get"in w?!b.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return b[T]}}),Object.defineProperty(y,x,w)}):(function(y,b,T,x){x===void 0&&(x=T),y[x]=b[T]})),e=Wi&&Wi.__setModuleDefault||(Object.create?(function(y,b){Object.defineProperty(y,"default",{enumerable:!0,value:b})}):function(y,b){y.default=b}),t=Wi&&Wi.__importStar||function(y){if(y&&y.__esModule)return y;var b={};if(y!=null)for(var T in y)T!=="default"&&Object.prototype.hasOwnProperty.call(y,T)&&n(b,y,T);return e(b,y),b};Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.Parser=void 0;var i=t(y_()),r=Ff(),s=new Set(["input","option","optgroup","select","button","datalist","textarea"]),a=new Set(["p"]),o=new Set(["thead","tbody"]),l=new Set(["dd","dt"]),u=new Set(["rt","rp"]),c=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",a],["h1",a],["h2",a],["h3",a],["h4",a],["h5",a],["h6",a],["select",s],["input",s],["output",s],["button",s],["datalist",s],["textarea",s],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",l],["dt",l],["address",a],["article",a],["aside",a],["blockquote",a],["details",a],["div",a],["dl",a],["fieldset",a],["figcaption",a],["figure",a],["footer",a],["form",a],["header",a],["hr",a],["main",a],["nav",a],["ol",a],["pre",a],["section",a],["table",a],["ul",a],["rt",u],["rp",u],["tbody",o],["tfoot",o]]),d=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),h=new Set(["math","svg"]),p=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),g=/\s|\//,v=(function(){function y(b,T){T===void 0&&(T={});var x,w,A,R,_;this.options=T,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=b??{},this.lowerCaseTagNames=(x=T.lowerCaseTags)!==null&&x!==void 0?x:!T.xmlMode,this.lowerCaseAttributeNames=(w=T.lowerCaseAttributeNames)!==null&&w!==void 0?w:!T.xmlMode,this.tokenizer=new((A=T.Tokenizer)!==null&&A!==void 0?A:i.default)(this.options,this),(_=(R=this.cbs).onparserinit)===null||_===void 0||_.call(R,this)}return y.prototype.ontext=function(b,T){var x,w,A=this.getSlice(b,T);this.endIndex=T-1,(w=(x=this.cbs).ontext)===null||w===void 0||w.call(x,A),this.startIndex=T},y.prototype.ontextentity=function(b){var T,x,w=this.tokenizer.getSectionStart();this.endIndex=w-1,(x=(T=this.cbs).ontext)===null||x===void 0||x.call(T,(0,r.fromCodePoint)(b)),this.startIndex=w},y.prototype.isVoidElement=function(b){return!this.options.xmlMode&&d.has(b)},y.prototype.onopentagname=function(b,T){this.endIndex=T;var x=this.getSlice(b,T);this.lowerCaseTagNames&&(x=x.toLowerCase()),this.emitOpenTag(x)},y.prototype.emitOpenTag=function(b){var T,x,w,A;this.openTagStart=this.startIndex,this.tagname=b;var R=!this.options.xmlMode&&c.get(b);if(R)for(;this.stack.length>0&&R.has(this.stack[this.stack.length-1]);){var _=this.stack.pop();(x=(T=this.cbs).onclosetag)===null||x===void 0||x.call(T,_,!0)}this.isVoidElement(b)||(this.stack.push(b),h.has(b)?this.foreignContext.push(!0):p.has(b)&&this.foreignContext.push(!1)),(A=(w=this.cbs).onopentagname)===null||A===void 0||A.call(w,b),this.cbs.onopentag&&(this.attribs={})},y.prototype.endOpenTag=function(b){var T,x;this.startIndex=this.openTagStart,this.attribs&&((x=(T=this.cbs).onopentag)===null||x===void 0||x.call(T,this.tagname,this.attribs,b),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},y.prototype.onopentagend=function(b){this.endIndex=b,this.endOpenTag(!1),this.startIndex=b+1},y.prototype.onclosetag=function(b,T){var x,w,A,R,_,D;this.endIndex=T;var H=this.getSlice(b,T);if(this.lowerCaseTagNames&&(H=H.toLowerCase()),(h.has(H)||p.has(H))&&this.foreignContext.pop(),this.isVoidElement(H))!this.options.xmlMode&&H==="br"&&((w=(x=this.cbs).onopentagname)===null||w===void 0||w.call(x,"br"),(R=(A=this.cbs).onopentag)===null||R===void 0||R.call(A,"br",{},!0),(D=(_=this.cbs).onclosetag)===null||D===void 0||D.call(_,"br",!1));else{var P=this.stack.lastIndexOf(H);if(P!==-1)if(this.cbs.onclosetag)for(var N=this.stack.length-P;N--;)this.cbs.onclosetag(this.stack.pop(),N!==0);else this.stack.length=P;else!this.options.xmlMode&&H==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=T+1},y.prototype.onselfclosingtag=function(b){this.endIndex=b,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=b+1):this.onopentagend(b)},y.prototype.closeCurrentTag=function(b){var T,x,w=this.tagname;this.endOpenTag(b),this.stack[this.stack.length-1]===w&&((x=(T=this.cbs).onclosetag)===null||x===void 0||x.call(T,w,!b),this.stack.pop())},y.prototype.onattribname=function(b,T){this.startIndex=b;var x=this.getSlice(b,T);this.attribname=this.lowerCaseAttributeNames?x.toLowerCase():x},y.prototype.onattribdata=function(b,T){this.attribvalue+=this.getSlice(b,T)},y.prototype.onattribentity=function(b){this.attribvalue+=(0,r.fromCodePoint)(b)},y.prototype.onattribend=function(b,T){var x,w;this.endIndex=T,(w=(x=this.cbs).onattribute)===null||w===void 0||w.call(x,this.attribname,this.attribvalue,b===i.QuoteType.Double?'"':b===i.QuoteType.Single?"'":b===i.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},y.prototype.getInstructionName=function(b){var T=b.search(g),x=T<0?b:b.substr(0,T);return this.lowerCaseTagNames&&(x=x.toLowerCase()),x},y.prototype.ondeclaration=function(b,T){this.endIndex=T;var x=this.getSlice(b,T);if(this.cbs.onprocessinginstruction){var w=this.getInstructionName(x);this.cbs.onprocessinginstruction("!".concat(w),"!".concat(x))}this.startIndex=T+1},y.prototype.onprocessinginstruction=function(b,T){this.endIndex=T;var x=this.getSlice(b,T);if(this.cbs.onprocessinginstruction){var w=this.getInstructionName(x);this.cbs.onprocessinginstruction("?".concat(w),"?".concat(x))}this.startIndex=T+1},y.prototype.oncomment=function(b,T,x){var w,A,R,_;this.endIndex=T,(A=(w=this.cbs).oncomment)===null||A===void 0||A.call(w,this.getSlice(b,T-x)),(_=(R=this.cbs).oncommentend)===null||_===void 0||_.call(R),this.startIndex=T+1},y.prototype.oncdata=function(b,T,x){var w,A,R,_,D,H,P,N,G,X;this.endIndex=T;var te=this.getSlice(b,T-x);this.options.xmlMode||this.options.recognizeCDATA?((A=(w=this.cbs).oncdatastart)===null||A===void 0||A.call(w),(_=(R=this.cbs).ontext)===null||_===void 0||_.call(R,te),(H=(D=this.cbs).oncdataend)===null||H===void 0||H.call(D)):((N=(P=this.cbs).oncomment)===null||N===void 0||N.call(P,"[CDATA[".concat(te,"]]")),(X=(G=this.cbs).oncommentend)===null||X===void 0||X.call(G)),this.startIndex=T+1},y.prototype.onend=function(){var b,T;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var x=this.stack.length;x>0;this.cbs.onclosetag(this.stack[--x],!0));}(T=(b=this.cbs).onend)===null||T===void 0||T.call(b)},y.prototype.reset=function(){var b,T,x,w;(T=(b=this.cbs).onreset)===null||T===void 0||T.call(b),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(w=(x=this.cbs).onparserinit)===null||w===void 0||w.call(x,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},y.prototype.parseComplete=function(b){this.reset(),this.end(b)},y.prototype.getSlice=function(b,T){for(;b-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var x=this.buffers[0].slice(b-this.bufferOffset,T-this.bufferOffset);T-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),x+=this.buffers[0].slice(0,T-this.bufferOffset);return x},y.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},y.prototype.write=function(b){var T,x;if(this.ended){(x=(T=this.cbs).onerror)===null||x===void 0||x.call(T,new Error(".write() after done!"));return}this.buffers.push(b),this.tokenizer.running&&(this.tokenizer.write(b),this.writeIndex++)},y.prototype.end=function(b){var T,x;if(this.ended){(x=(T=this.cbs).onerror)===null||x===void 0||x.call(T,new Error(".end() after done!"));return}b&&this.write(b),this.ended=!0,this.tokenizer.end()},y.prototype.pause=function(){this.tokenizer.pause()},y.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},y.prototype.parseChunk=function(b){this.write(b)},y.prototype.done=function(b){this.end(b)},y})();return Wi.Parser=v,Wi}var Ta={},pm={},NS;function ac(){return NS||(NS=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Doctype=n.CDATA=n.Tag=n.Style=n.Script=n.Comment=n.Directive=n.Text=n.Root=n.isTag=n.ElementType=void 0;var e;(function(i){i.Root="root",i.Text="text",i.Directive="directive",i.Comment="comment",i.Script="script",i.Style="style",i.Tag="tag",i.CDATA="cdata",i.Doctype="doctype"})(e=n.ElementType||(n.ElementType={}));function t(i){return i.type===e.Tag||i.type===e.Script||i.type===e.Style}n.isTag=t,n.Root=e.Root,n.Text=e.Text,n.Directive=e.Directive,n.Comment=e.Comment,n.Script=e.Script,n.Style=e.Style,n.Tag=e.Tag,n.CDATA=e.CDATA,n.Doctype=e.Doctype})(pm)),pm}var Et={},MS;function FS(){if(MS)return Et;MS=1;var n=Et&&Et.__extends||(function(){var A=function(R,_){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,H){D.__proto__=H}||function(D,H){for(var P in H)Object.prototype.hasOwnProperty.call(H,P)&&(D[P]=H[P])},A(R,_)};return function(R,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");A(R,_);function D(){this.constructor=R}R.prototype=_===null?Object.create(_):(D.prototype=_.prototype,new D)}})(),e=Et&&Et.__assign||function(){return e=Object.assign||function(A){for(var R,_=1,D=arguments.length;_<D;_++){R=arguments[_];for(var H in R)Object.prototype.hasOwnProperty.call(R,H)&&(A[H]=R[H])}return A},e.apply(this,arguments)};Object.defineProperty(Et,"__esModule",{value:!0}),Et.cloneNode=Et.hasChildren=Et.isDocument=Et.isDirective=Et.isComment=Et.isText=Et.isCDATA=Et.isTag=Et.Element=Et.Document=Et.CDATA=Et.NodeWithChildren=Et.ProcessingInstruction=Et.Comment=Et.Text=Et.DataNode=Et.Node=void 0;var t=ac(),i=(function(){function A(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(A.prototype,"parentNode",{get:function(){return this.parent},set:function(R){this.parent=R},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"previousSibling",{get:function(){return this.prev},set:function(R){this.prev=R},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"nextSibling",{get:function(){return this.next},set:function(R){this.next=R},enumerable:!1,configurable:!0}),A.prototype.cloneNode=function(R){return R===void 0&&(R=!1),x(this,R)},A})();Et.Node=i;var r=(function(A){n(R,A);function R(_){var D=A.call(this)||this;return D.data=_,D}return Object.defineProperty(R.prototype,"nodeValue",{get:function(){return this.data},set:function(_){this.data=_},enumerable:!1,configurable:!0}),R})(i);Et.DataNode=r;var s=(function(A){n(R,A);function R(){var _=A!==null&&A.apply(this,arguments)||this;return _.type=t.ElementType.Text,_}return Object.defineProperty(R.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),R})(r);Et.Text=s;var a=(function(A){n(R,A);function R(){var _=A!==null&&A.apply(this,arguments)||this;return _.type=t.ElementType.Comment,_}return Object.defineProperty(R.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),R})(r);Et.Comment=a;var o=(function(A){n(R,A);function R(_,D){var H=A.call(this,D)||this;return H.name=_,H.type=t.ElementType.Directive,H}return Object.defineProperty(R.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),R})(r);Et.ProcessingInstruction=o;var l=(function(A){n(R,A);function R(_){var D=A.call(this)||this;return D.children=_,D}return Object.defineProperty(R.prototype,"firstChild",{get:function(){var _;return(_=this.children[0])!==null&&_!==void 0?_:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"childNodes",{get:function(){return this.children},set:function(_){this.children=_},enumerable:!1,configurable:!0}),R})(i);Et.NodeWithChildren=l;var u=(function(A){n(R,A);function R(){var _=A!==null&&A.apply(this,arguments)||this;return _.type=t.ElementType.CDATA,_}return Object.defineProperty(R.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),R})(l);Et.CDATA=u;var c=(function(A){n(R,A);function R(){var _=A!==null&&A.apply(this,arguments)||this;return _.type=t.ElementType.Root,_}return Object.defineProperty(R.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),R})(l);Et.Document=c;var d=(function(A){n(R,A);function R(_,D,H,P){H===void 0&&(H=[]),P===void 0&&(P=_==="script"?t.ElementType.Script:_==="style"?t.ElementType.Style:t.ElementType.Tag);var N=A.call(this,H)||this;return N.name=_,N.attribs=D,N.type=P,N}return Object.defineProperty(R.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"tagName",{get:function(){return this.name},set:function(_){this.name=_},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"attributes",{get:function(){var _=this;return Object.keys(this.attribs).map(function(D){var H,P;return{name:D,value:_.attribs[D],namespace:(H=_["x-attribsNamespace"])===null||H===void 0?void 0:H[D],prefix:(P=_["x-attribsPrefix"])===null||P===void 0?void 0:P[D]}})},enumerable:!1,configurable:!0}),R})(l);Et.Element=d;function h(A){return(0,t.isTag)(A)}Et.isTag=h;function p(A){return A.type===t.ElementType.CDATA}Et.isCDATA=p;function g(A){return A.type===t.ElementType.Text}Et.isText=g;function v(A){return A.type===t.ElementType.Comment}Et.isComment=v;function y(A){return A.type===t.ElementType.Directive}Et.isDirective=y;function b(A){return A.type===t.ElementType.Root}Et.isDocument=b;function T(A){return Object.prototype.hasOwnProperty.call(A,"children")}Et.hasChildren=T;function x(A,R){R===void 0&&(R=!1);var _;if(g(A))_=new s(A.data);else if(v(A))_=new a(A.data);else if(h(A)){var D=R?w(A.children):[],H=new d(A.name,e({},A.attribs),D);D.forEach(function(X){return X.parent=H}),A.namespace!=null&&(H.namespace=A.namespace),A["x-attribsNamespace"]&&(H["x-attribsNamespace"]=e({},A["x-attribsNamespace"])),A["x-attribsPrefix"]&&(H["x-attribsPrefix"]=e({},A["x-attribsPrefix"])),_=H}else if(p(A)){var D=R?w(A.children):[],P=new u(D);D.forEach(function(te){return te.parent=P}),_=P}else if(b(A)){var D=R?w(A.children):[],N=new c(D);D.forEach(function(te){return te.parent=N}),A["x-mode"]&&(N["x-mode"]=A["x-mode"]),_=N}else if(y(A)){var G=new o(A.name,A.data);A["x-name"]!=null&&(G["x-name"]=A["x-name"],G["x-publicId"]=A["x-publicId"],G["x-systemId"]=A["x-systemId"]),_=G}else throw new Error("Not implemented yet: ".concat(A.type));return _.startIndex=A.startIndex,_.endIndex=A.endIndex,A.sourceCodeLocation!=null&&(_.sourceCodeLocation=A.sourceCodeLocation),_}Et.cloneNode=x;function w(A){for(var R=A.map(function(D){return x(D,!0)}),_=1;_<R.length;_++)R[_].prev=R[_-1],R[_-1].next=R[_];return R}return Et}var BS;function qs(){return BS||(BS=1,(function(n){var e=Ta&&Ta.__createBinding||(Object.create?(function(o,l,u,c){c===void 0&&(c=u);var d=Object.getOwnPropertyDescriptor(l,u);(!d||("get"in d?!l.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return l[u]}}),Object.defineProperty(o,c,d)}):(function(o,l,u,c){c===void 0&&(c=u),o[c]=l[u]})),t=Ta&&Ta.__exportStar||function(o,l){for(var u in o)u!=="default"&&!Object.prototype.hasOwnProperty.call(l,u)&&e(l,o,u)};Object.defineProperty(n,"__esModule",{value:!0}),n.DomHandler=void 0;var i=ac(),r=FS();t(FS(),n);var s={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},a=(function(){function o(l,u,c){this.dom=[],this.root=new r.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof u=="function"&&(c=u,u=s),typeof l=="object"&&(u=l,l=void 0),this.callback=l??null,this.options=u??s,this.elementCB=c??null}return o.prototype.onparserinit=function(l){this.parser=l},o.prototype.onreset=function(){this.dom=[],this.root=new r.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},o.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},o.prototype.onerror=function(l){this.handleCallback(l)},o.prototype.onclosetag=function(){this.lastNode=null;var l=this.tagStack.pop();this.options.withEndIndices&&(l.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(l)},o.prototype.onopentag=function(l,u){var c=this.options.xmlMode?i.ElementType.Tag:void 0,d=new r.Element(l,u,void 0,c);this.addNode(d),this.tagStack.push(d)},o.prototype.ontext=function(l){var u=this.lastNode;if(u&&u.type===i.ElementType.Text)u.data+=l,this.options.withEndIndices&&(u.endIndex=this.parser.endIndex);else{var c=new r.Text(l);this.addNode(c),this.lastNode=c}},o.prototype.oncomment=function(l){if(this.lastNode&&this.lastNode.type===i.ElementType.Comment){this.lastNode.data+=l;return}var u=new r.Comment(l);this.addNode(u),this.lastNode=u},o.prototype.oncommentend=function(){this.lastNode=null},o.prototype.oncdatastart=function(){var l=new r.Text(""),u=new r.CDATA([l]);this.addNode(u),l.parent=u,this.lastNode=l},o.prototype.oncdataend=function(){this.lastNode=null},o.prototype.onprocessinginstruction=function(l,u){var c=new r.ProcessingInstruction(l,u);this.addNode(c)},o.prototype.handleCallback=function(l){if(typeof this.callback=="function")this.callback(l,this.dom);else if(l)throw l},o.prototype.addNode=function(l){var u=this.tagStack[this.tagStack.length-1],c=u.children[u.children.length-1];this.options.withStartIndices&&(l.startIndex=this.parser.startIndex),this.options.withEndIndices&&(l.endIndex=this.parser.endIndex),u.children.push(l),c&&(l.prev=c,c.next=l),l.parent=u,this.lastNode=null},o})();n.DomHandler=a,n.default=a})(Ta)),Ta}var xa={},lr={},ti={},mm={},zr={},kd={},US;function DG(){if(US)return kd;US=1,Object.defineProperty(kd,"__esModule",{value:!0});function n(e){for(var t=1;t<e.length;t++)e[t][0]+=e[t-1][0]+1;return e}return kd.default=new Map(n([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(n([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(n([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(n([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]])),kd}var gm={},HS;function pv(){return HS||(HS=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.escapeText=n.escapeAttribute=n.escapeUTF8=n.escape=n.encodeXML=n.getCodePoint=n.xmlReplacer=void 0,n.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var e=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);n.getCodePoint=String.prototype.codePointAt!=null?function(r,s){return r.codePointAt(s)}:function(r,s){return(r.charCodeAt(s)&64512)===55296?(r.charCodeAt(s)-55296)*1024+r.charCodeAt(s+1)-56320+65536:r.charCodeAt(s)};function t(r){for(var s="",a=0,o;(o=n.xmlReplacer.exec(r))!==null;){var l=o.index,u=r.charCodeAt(l),c=e.get(u);c!==void 0?(s+=r.substring(a,l)+c,a=l+1):(s+="".concat(r.substring(a,l),"&#x").concat((0,n.getCodePoint)(r,l).toString(16),";"),a=n.xmlReplacer.lastIndex+=+((u&64512)===55296))}return s+r.substr(a)}n.encodeXML=t,n.escape=t;function i(r,s){return function(o){for(var l,u=0,c="";l=r.exec(o);)u!==l.index&&(c+=o.substring(u,l.index)),c+=s.get(l[0].charCodeAt(0)),u=l.index+1;return c+o.substring(u)}}n.escapeUTF8=i(/[&<>'"]/g,e),n.escapeAttribute=i(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),n.escapeText=i(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(gm)),gm}var zS;function jS(){if(zS)return zr;zS=1;var n=zr&&zr.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(zr,"__esModule",{value:!0}),zr.encodeNonAsciiHTML=zr.encodeHTML=void 0;var e=n(DG()),t=pv(),i=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function r(o){return a(i,o)}zr.encodeHTML=r;function s(o){return a(t.xmlReplacer,o)}zr.encodeNonAsciiHTML=s;function a(o,l){for(var u="",c=0,d;(d=o.exec(l))!==null;){var h=d.index;u+=l.substring(c,h);var p=l.charCodeAt(h),g=e.default.get(p);if(typeof g=="object"){if(h+1<l.length){var v=l.charCodeAt(h+1),y=typeof g.n=="number"?g.n===v?g.o:void 0:g.n.get(v);if(y!==void 0){u+=y,c=o.lastIndex+=1;continue}}g=g.v}if(g!==void 0)u+=g,c=h+1;else{var b=(0,t.getCodePoint)(l,h);u+="&#x".concat(b.toString(16),";"),c=o.lastIndex+=+(b!==p)}}return u+l.substr(c)}return zr}var VS;function OG(){return VS||(VS=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeXMLStrict=n.decodeHTML5Strict=n.decodeHTML4Strict=n.decodeHTML5=n.decodeHTML4=n.decodeHTMLAttribute=n.decodeHTMLStrict=n.decodeHTML=n.decodeXML=n.DecodingMode=n.EntityDecoder=n.encodeHTML5=n.encodeHTML4=n.encodeNonAsciiHTML=n.encodeHTML=n.escapeText=n.escapeAttribute=n.escapeUTF8=n.escape=n.encodeXML=n.encode=n.decodeStrict=n.decode=n.EncodingMode=n.EntityLevel=void 0;var e=Ff(),t=jS(),i=pv(),r;(function(h){h[h.XML=0]="XML",h[h.HTML=1]="HTML"})(r=n.EntityLevel||(n.EntityLevel={}));var s;(function(h){h[h.UTF8=0]="UTF8",h[h.ASCII=1]="ASCII",h[h.Extensive=2]="Extensive",h[h.Attribute=3]="Attribute",h[h.Text=4]="Text"})(s=n.EncodingMode||(n.EncodingMode={}));function a(h,p){p===void 0&&(p=r.XML);var g=typeof p=="number"?p:p.level;if(g===r.HTML){var v=typeof p=="object"?p.mode:void 0;return(0,e.decodeHTML)(h,v)}return(0,e.decodeXML)(h)}n.decode=a;function o(h,p){var g;p===void 0&&(p=r.XML);var v=typeof p=="number"?{level:p}:p;return(g=v.mode)!==null&&g!==void 0||(v.mode=e.DecodingMode.Strict),a(h,v)}n.decodeStrict=o;function l(h,p){p===void 0&&(p=r.XML);var g=typeof p=="number"?{level:p}:p;return g.mode===s.UTF8?(0,i.escapeUTF8)(h):g.mode===s.Attribute?(0,i.escapeAttribute)(h):g.mode===s.Text?(0,i.escapeText)(h):g.level===r.HTML?g.mode===s.ASCII?(0,t.encodeNonAsciiHTML)(h):(0,t.encodeHTML)(h):(0,i.encodeXML)(h)}n.encode=l;var u=pv();Object.defineProperty(n,"encodeXML",{enumerable:!0,get:function(){return u.encodeXML}}),Object.defineProperty(n,"escape",{enumerable:!0,get:function(){return u.escape}}),Object.defineProperty(n,"escapeUTF8",{enumerable:!0,get:function(){return u.escapeUTF8}}),Object.defineProperty(n,"escapeAttribute",{enumerable:!0,get:function(){return u.escapeAttribute}}),Object.defineProperty(n,"escapeText",{enumerable:!0,get:function(){return u.escapeText}});var c=jS();Object.defineProperty(n,"encodeHTML",{enumerable:!0,get:function(){return c.encodeHTML}}),Object.defineProperty(n,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return c.encodeNonAsciiHTML}}),Object.defineProperty(n,"encodeHTML4",{enumerable:!0,get:function(){return c.encodeHTML}}),Object.defineProperty(n,"encodeHTML5",{enumerable:!0,get:function(){return c.encodeHTML}});var d=Ff();Object.defineProperty(n,"EntityDecoder",{enumerable:!0,get:function(){return d.EntityDecoder}}),Object.defineProperty(n,"DecodingMode",{enumerable:!0,get:function(){return d.DecodingMode}}),Object.defineProperty(n,"decodeXML",{enumerable:!0,get:function(){return d.decodeXML}}),Object.defineProperty(n,"decodeHTML",{enumerable:!0,get:function(){return d.decodeHTML}}),Object.defineProperty(n,"decodeHTMLStrict",{enumerable:!0,get:function(){return d.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTMLAttribute",{enumerable:!0,get:function(){return d.decodeHTMLAttribute}}),Object.defineProperty(n,"decodeHTML4",{enumerable:!0,get:function(){return d.decodeHTML}}),Object.defineProperty(n,"decodeHTML5",{enumerable:!0,get:function(){return d.decodeHTML}}),Object.defineProperty(n,"decodeHTML4Strict",{enumerable:!0,get:function(){return d.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTML5Strict",{enumerable:!0,get:function(){return d.decodeHTMLStrict}}),Object.defineProperty(n,"decodeXMLStrict",{enumerable:!0,get:function(){return d.decodeXML}})})(mm)),mm}var Sa={},GS;function NG(){return GS||(GS=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.attributeNames=Sa.elementNames=void 0,Sa.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(n){return[n.toLowerCase(),n]})),Sa.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(n){return[n.toLowerCase(),n]}))),Sa}var WS;function MG(){if(WS)return ti;WS=1;var n=ti&&ti.__assign||function(){return n=Object.assign||function(w){for(var A,R=1,_=arguments.length;R<_;R++){A=arguments[R];for(var D in A)Object.prototype.hasOwnProperty.call(A,D)&&(w[D]=A[D])}return w},n.apply(this,arguments)},e=ti&&ti.__createBinding||(Object.create?(function(w,A,R,_){_===void 0&&(_=R);var D=Object.getOwnPropertyDescriptor(A,R);(!D||("get"in D?!A.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return A[R]}}),Object.defineProperty(w,_,D)}):(function(w,A,R,_){_===void 0&&(_=R),w[_]=A[R]})),t=ti&&ti.__setModuleDefault||(Object.create?(function(w,A){Object.defineProperty(w,"default",{enumerable:!0,value:A})}):function(w,A){w.default=A}),i=ti&&ti.__importStar||function(w){if(w&&w.__esModule)return w;var A={};if(w!=null)for(var R in w)R!=="default"&&Object.prototype.hasOwnProperty.call(w,R)&&e(A,w,R);return t(A,w),A};Object.defineProperty(ti,"__esModule",{value:!0}),ti.render=void 0;var r=i(ac()),s=OG(),a=NG(),o=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function l(w){return w.replace(/"/g,"&quot;")}function u(w,A){var R;if(w){var _=((R=A.encodeEntities)!==null&&R!==void 0?R:A.decodeEntities)===!1?l:A.xmlMode||A.encodeEntities!=="utf8"?s.encodeXML:s.escapeAttribute;return Object.keys(w).map(function(D){var H,P,N=(H=w[D])!==null&&H!==void 0?H:"";return A.xmlMode==="foreign"&&(D=(P=a.attributeNames.get(D))!==null&&P!==void 0?P:D),!A.emptyAttrs&&!A.xmlMode&&N===""?D:"".concat(D,'="').concat(_(N),'"')}).join(" ")}}var c=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function d(w,A){A===void 0&&(A={});for(var R=("length"in w)?w:[w],_="",D=0;D<R.length;D++)_+=h(R[D],A);return _}ti.render=d,ti.default=d;function h(w,A){switch(w.type){case r.Root:return d(w.children,A);case r.Doctype:case r.Directive:return y(w);case r.Comment:return x(w);case r.CDATA:return T(w);case r.Script:case r.Style:case r.Tag:return v(w,A);case r.Text:return b(w,A)}}var p=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),g=new Set(["svg","math"]);function v(w,A){var R;A.xmlMode==="foreign"&&(w.name=(R=a.elementNames.get(w.name))!==null&&R!==void 0?R:w.name,w.parent&&p.has(w.parent.name)&&(A=n(n({},A),{xmlMode:!1}))),!A.xmlMode&&g.has(w.name)&&(A=n(n({},A),{xmlMode:"foreign"}));var _="<".concat(w.name),D=u(w.attribs,A);return D&&(_+=" ".concat(D)),w.children.length===0&&(A.xmlMode?A.selfClosingTags!==!1:A.selfClosingTags&&c.has(w.name))?(A.xmlMode||(_+=" "),_+="/>"):(_+=">",w.children.length>0&&(_+=d(w.children,A)),(A.xmlMode||!c.has(w.name))&&(_+="</".concat(w.name,">"))),_}function y(w){return"<".concat(w.data,">")}function b(w,A){var R,_=w.data||"";return((R=A.encodeEntities)!==null&&R!==void 0?R:A.decodeEntities)!==!1&&!(!A.xmlMode&&w.parent&&o.has(w.parent.name))&&(_=A.xmlMode||A.encodeEntities!=="utf8"?(0,s.encodeXML)(_):(0,s.escapeText)(_)),_}function T(w){return"<![CDATA[".concat(w.children[0].data,"]]>")}function x(w){return"<!--".concat(w.data,"-->")}return ti}var qS;function E_(){if(qS)return lr;qS=1;var n=lr&&lr.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(lr,"__esModule",{value:!0}),lr.getOuterHTML=r,lr.getInnerHTML=s,lr.getText=a,lr.textContent=o,lr.innerText=l;var e=qs(),t=n(MG()),i=ac();function r(u,c){return(0,t.default)(u,c)}function s(u,c){return(0,e.hasChildren)(u)?u.children.map(function(d){return r(d,c)}).join(""):""}function a(u){return Array.isArray(u)?u.map(a).join(""):(0,e.isTag)(u)?u.name==="br"?`
`:a(u.children):(0,e.isCDATA)(u)?a(u.children):(0,e.isText)(u)?u.data:""}function o(u){return Array.isArray(u)?u.map(o).join(""):(0,e.hasChildren)(u)&&!(0,e.isComment)(u)?o(u.children):(0,e.isText)(u)?u.data:""}function l(u){return Array.isArray(u)?u.map(l).join(""):(0,e.hasChildren)(u)&&(u.type===i.ElementType.Tag||(0,e.isCDATA)(u))?l(u.children):(0,e.isText)(u)?u.data:""}return lr}var $i={},$S;function FG(){if($S)return $i;$S=1,Object.defineProperty($i,"__esModule",{value:!0}),$i.getChildren=e,$i.getParent=t,$i.getSiblings=i,$i.getAttributeValue=r,$i.hasAttrib=s,$i.getName=a,$i.nextElementSibling=o,$i.prevElementSibling=l;var n=qs();function e(u){return(0,n.hasChildren)(u)?u.children:[]}function t(u){return u.parent||null}function i(u){var c,d,h=t(u);if(h!=null)return e(h);for(var p=[u],g=u.prev,v=u.next;g!=null;)p.unshift(g),c=g,g=c.prev;for(;v!=null;)p.push(v),d=v,v=d.next;return p}function r(u,c){var d;return(d=u.attribs)===null||d===void 0?void 0:d[c]}function s(u,c){return u.attribs!=null&&Object.prototype.hasOwnProperty.call(u.attribs,c)&&u.attribs[c]!=null}function a(u){return u.name}function o(u){for(var c,d=u.next;d!==null&&!(0,n.isTag)(d);)c=d,d=c.next;return d}function l(u){for(var c,d=u.prev;d!==null&&!(0,n.isTag)(d);)c=d,d=c.prev;return d}return $i}var jr={},KS;function BG(){if(KS)return jr;KS=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.removeElement=n,jr.replaceElement=e,jr.appendChild=t,jr.append=i,jr.prependChild=r,jr.prepend=s;function n(a){if(a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),a.parent){var o=a.parent.children,l=o.lastIndexOf(a);l>=0&&o.splice(l,1)}a.next=null,a.prev=null,a.parent=null}function e(a,o){var l=o.prev=a.prev;l&&(l.next=o);var u=o.next=a.next;u&&(u.prev=o);var c=o.parent=a.parent;if(c){var d=c.children;d[d.lastIndexOf(a)]=o,a.parent=null}}function t(a,o){if(n(o),o.next=null,o.parent=a,a.children.push(o)>1){var l=a.children[a.children.length-2];l.next=o,o.prev=l}else o.prev=null}function i(a,o){n(o);var l=a.parent,u=a.next;if(o.next=u,o.prev=a,a.next=o,o.parent=l,u){if(u.prev=o,l){var c=l.children;c.splice(c.lastIndexOf(u),0,o)}}else l&&l.children.push(o)}function r(a,o){if(n(o),o.parent=a,o.prev=null,a.children.unshift(o)!==1){var l=a.children[1];l.prev=o,o.next=l}else o.next=null}function s(a,o){n(o);var l=a.parent;if(l){var u=l.children;u.splice(u.indexOf(a),0,o)}a.prev&&(a.prev.next=o),o.parent=l,o.prev=a.prev,o.next=a,a.prev=o}return jr}var Vr={},YS;function b_(){if(YS)return Vr;YS=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.filter=e,Vr.find=t,Vr.findOneChild=i,Vr.findOne=r,Vr.existsOne=s,Vr.findAll=a;var n=qs();function e(o,l,u,c){return u===void 0&&(u=!0),c===void 0&&(c=1/0),t(o,Array.isArray(l)?l:[l],u,c)}function t(o,l,u,c){for(var d=[],h=[Array.isArray(l)?l:[l]],p=[0];;){if(p[0]>=h[0].length){if(p.length===1)return d;h.shift(),p.shift();continue}var g=h[0][p[0]++];if(o(g)&&(d.push(g),--c<=0))return d;u&&(0,n.hasChildren)(g)&&g.children.length>0&&(p.unshift(0),h.unshift(g.children))}}function i(o,l){return l.find(o)}function r(o,l,u){u===void 0&&(u=!0);for(var c=Array.isArray(l)?l:[l],d=0;d<c.length;d++){var h=c[d];if((0,n.isTag)(h)&&o(h))return h;if(u&&(0,n.hasChildren)(h)&&h.children.length>0){var p=r(o,h.children,!0);if(p)return p}}return null}function s(o,l){return(Array.isArray(l)?l:[l]).some(function(u){return(0,n.isTag)(u)&&o(u)||(0,n.hasChildren)(u)&&s(o,u.children)})}function a(o,l){for(var u=[],c=[Array.isArray(l)?l:[l]],d=[0];;){if(d[0]>=c[0].length){if(c.length===1)return u;c.shift(),d.shift();continue}var h=c[0][d[0]++];(0,n.isTag)(h)&&o(h)&&u.push(h),(0,n.hasChildren)(h)&&h.children.length>0&&(d.unshift(0),c.unshift(h.children))}}return Vr}var Gr={},XS;function T_(){if(XS)return Gr;XS=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.testElement=a,Gr.getElements=o,Gr.getElementById=l,Gr.getElementsByTagName=u,Gr.getElementsByClassName=c,Gr.getElementsByTagType=d;var n=qs(),e=b_(),t={tag_name:function(h){return typeof h=="function"?function(p){return(0,n.isTag)(p)&&h(p.name)}:h==="*"?n.isTag:function(p){return(0,n.isTag)(p)&&p.name===h}},tag_type:function(h){return typeof h=="function"?function(p){return h(p.type)}:function(p){return p.type===h}},tag_contains:function(h){return typeof h=="function"?function(p){return(0,n.isText)(p)&&h(p.data)}:function(p){return(0,n.isText)(p)&&p.data===h}}};function i(h,p){return typeof p=="function"?function(g){return(0,n.isTag)(g)&&p(g.attribs[h])}:function(g){return(0,n.isTag)(g)&&g.attribs[h]===p}}function r(h,p){return function(g){return h(g)||p(g)}}function s(h){var p=Object.keys(h).map(function(g){var v=h[g];return Object.prototype.hasOwnProperty.call(t,g)?t[g](v):i(g,v)});return p.length===0?null:p.reduce(r)}function a(h,p){var g=s(h);return g?g(p):!0}function o(h,p,g,v){v===void 0&&(v=1/0);var y=s(h);return y?(0,e.filter)(y,p,g,v):[]}function l(h,p,g){return g===void 0&&(g=!0),Array.isArray(p)||(p=[p]),(0,e.findOne)(i("id",h),p,g)}function u(h,p,g,v){return g===void 0&&(g=!0),v===void 0&&(v=1/0),(0,e.filter)(t.tag_name(h),p,g,v)}function c(h,p,g,v){return g===void 0&&(g=!0),v===void 0&&(v=1/0),(0,e.filter)(i("class",h),p,g,v)}function d(h,p,g,v){return g===void 0&&(g=!0),v===void 0&&(v=1/0),(0,e.filter)(t.tag_type(h),p,g,v)}return Gr}var Ps={},QS;function UG(){if(QS)return Ps;QS=1,Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.DocumentPosition=void 0,Ps.removeSubsets=e,Ps.compareDocumentPosition=i,Ps.uniqueSort=r;var n=qs();function e(s){for(var a=s.length;--a>=0;){var o=s[a];if(a>0&&s.lastIndexOf(o,a-1)>=0){s.splice(a,1);continue}for(var l=o.parent;l;l=l.parent)if(s.includes(l)){s.splice(a,1);break}}return s}var t;(function(s){s[s.DISCONNECTED=1]="DISCONNECTED",s[s.PRECEDING=2]="PRECEDING",s[s.FOLLOWING=4]="FOLLOWING",s[s.CONTAINS=8]="CONTAINS",s[s.CONTAINED_BY=16]="CONTAINED_BY"})(t||(Ps.DocumentPosition=t={}));function i(s,a){var o=[],l=[];if(s===a)return 0;for(var u=(0,n.hasChildren)(s)?s:s.parent;u;)o.unshift(u),u=u.parent;for(u=(0,n.hasChildren)(a)?a:a.parent;u;)l.unshift(u),u=u.parent;for(var c=Math.min(o.length,l.length),d=0;d<c&&o[d]===l[d];)d++;if(d===0)return t.DISCONNECTED;var h=o[d-1],p=h.children,g=o[d],v=l[d];return p.indexOf(g)>p.indexOf(v)?h===a?t.FOLLOWING|t.CONTAINED_BY:t.FOLLOWING:h===s?t.PRECEDING|t.CONTAINS:t.PRECEDING}function r(s){return s=s.filter(function(a,o,l){return!l.includes(a,o+1)}),s.sort(function(a,o){var l=i(a,o);return l&t.PRECEDING?-1:l&t.FOLLOWING?1:0}),s}return Ps}var Dd={},ZS;function HG(){if(ZS)return Dd;ZS=1,Object.defineProperty(Dd,"__esModule",{value:!0}),Dd.getFeed=t;var n=E_(),e=T_();function t(h){var p=l(d,h);return p?p.name==="feed"?i(p):r(p):null}function i(h){var p,g=h.children,v={type:"atom",items:(0,e.getElementsByTagName)("entry",g).map(function(T){var x,w=T.children,A={media:o(w)};c(A,"id","id",w),c(A,"title","title",w);var R=(x=l("link",w))===null||x===void 0?void 0:x.attribs.href;R&&(A.link=R);var _=u("summary",w)||u("content",w);_&&(A.description=_);var D=u("updated",w);return D&&(A.pubDate=new Date(D)),A})};c(v,"id","id",g),c(v,"title","title",g);var y=(p=l("link",g))===null||p===void 0?void 0:p.attribs.href;y&&(v.link=y),c(v,"description","subtitle",g);var b=u("updated",g);return b&&(v.updated=new Date(b)),c(v,"author","email",g,!0),v}function r(h){var p,g,v=(g=(p=l("channel",h.children))===null||p===void 0?void 0:p.children)!==null&&g!==void 0?g:[],y={type:h.name.substr(0,3),id:"",items:(0,e.getElementsByTagName)("item",h.children).map(function(T){var x=T.children,w={media:o(x)};c(w,"id","guid",x),c(w,"title","title",x),c(w,"link","link",x),c(w,"description","description",x);var A=u("pubDate",x)||u("dc:date",x);return A&&(w.pubDate=new Date(A)),w})};c(y,"title","title",v),c(y,"link","link",v),c(y,"description","description",v);var b=u("lastBuildDate",v);return b&&(y.updated=new Date(b)),c(y,"author","managingEditor",v,!0),y}var s=["url","type","lang"],a=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function o(h){return(0,e.getElementsByTagName)("media:content",h).map(function(p){for(var g=p.attribs,v={medium:g.medium,isDefault:!!g.isDefault},y=0,b=s;y<b.length;y++){var T=b[y];g[T]&&(v[T]=g[T])}for(var x=0,w=a;x<w.length;x++){var T=w[x];g[T]&&(v[T]=parseInt(g[T],10))}return g.expression&&(v.expression=g.expression),v})}function l(h,p){return(0,e.getElementsByTagName)(h,p,!0,1)[0]}function u(h,p,g){return g===void 0&&(g=!1),(0,n.textContent)((0,e.getElementsByTagName)(h,p,g,1)).trim()}function c(h,p,g,v,y){y===void 0&&(y=!1);var b=u(g,v,y);b&&(h[p]=b)}function d(h){return h==="rss"||h==="feed"||h==="rdf:RDF"}return Dd}var JS;function vm(){return JS||(JS=1,(function(n){var e=xa&&xa.__createBinding||(Object.create?(function(r,s,a,o){o===void 0&&(o=a);var l=Object.getOwnPropertyDescriptor(s,a);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(r,o,l)}):(function(r,s,a,o){o===void 0&&(o=a),r[o]=s[a]})),t=xa&&xa.__exportStar||function(r,s){for(var a in r)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&e(s,r,a)};Object.defineProperty(n,"__esModule",{value:!0}),n.hasChildren=n.isDocument=n.isComment=n.isText=n.isCDATA=n.isTag=void 0,t(E_(),n),t(FG(),n),t(BG(),n),t(b_(),n),t(T_(),n),t(UG(),n),t(HG(),n);var i=qs();Object.defineProperty(n,"isTag",{enumerable:!0,get:function(){return i.isTag}}),Object.defineProperty(n,"isCDATA",{enumerable:!0,get:function(){return i.isCDATA}}),Object.defineProperty(n,"isText",{enumerable:!0,get:function(){return i.isText}}),Object.defineProperty(n,"isComment",{enumerable:!0,get:function(){return i.isComment}}),Object.defineProperty(n,"isDocument",{enumerable:!0,get:function(){return i.isDocument}}),Object.defineProperty(n,"hasChildren",{enumerable:!0,get:function(){return i.hasChildren}})})(xa)),xa}var ew;function zG(){return ew||(ew=1,(function(n){var e=Gi&&Gi.__createBinding||(Object.create?(function(b,T,x,w){w===void 0&&(w=x);var A=Object.getOwnPropertyDescriptor(T,x);(!A||("get"in A?!T.__esModule:A.writable||A.configurable))&&(A={enumerable:!0,get:function(){return T[x]}}),Object.defineProperty(b,w,A)}):(function(b,T,x,w){w===void 0&&(w=x),b[w]=T[x]})),t=Gi&&Gi.__setModuleDefault||(Object.create?(function(b,T){Object.defineProperty(b,"default",{enumerable:!0,value:T})}):function(b,T){b.default=T}),i=Gi&&Gi.__importStar||function(b){if(b&&b.__esModule)return b;var T={};if(b!=null)for(var x in b)x!=="default"&&Object.prototype.hasOwnProperty.call(b,x)&&e(T,b,x);return t(T,b),T},r=Gi&&Gi.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(n,"__esModule",{value:!0}),n.DomUtils=n.parseFeed=n.getFeed=n.ElementType=n.Tokenizer=n.createDomStream=n.parseDOM=n.parseDocument=n.DefaultHandler=n.DomHandler=n.Parser=void 0;var s=OS(),a=OS();Object.defineProperty(n,"Parser",{enumerable:!0,get:function(){return a.Parser}});var o=qs(),l=qs();Object.defineProperty(n,"DomHandler",{enumerable:!0,get:function(){return l.DomHandler}}),Object.defineProperty(n,"DefaultHandler",{enumerable:!0,get:function(){return l.DomHandler}});function u(b,T){var x=new o.DomHandler(void 0,T);return new s.Parser(x,T).end(b),x.root}n.parseDocument=u;function c(b,T){return u(b,T).children}n.parseDOM=c;function d(b,T,x){var w=new o.DomHandler(b,T,x);return new s.Parser(w,T)}n.createDomStream=d;var h=y_();Object.defineProperty(n,"Tokenizer",{enumerable:!0,get:function(){return r(h).default}}),n.ElementType=i(ac());var p=vm(),g=vm();Object.defineProperty(n,"getFeed",{enumerable:!0,get:function(){return g.getFeed}});var v={xmlMode:!0};function y(b,T){return T===void 0&&(T=v),(0,p.getFeed)(c(b,T))}n.parseFeed=y,n.DomUtils=i(vm())})(Gi)),Gi}var ym,tw;function jG(){return tw||(tw=1,ym=n=>{if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}),ym}var Od={},nw;function VG(){if(nw)return Od;nw=1,Object.defineProperty(Od,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function n(t){return Object.prototype.toString.call(t)==="[object Object]"}function e(t){var i,r;return n(t)===!1?!1:(i=t.constructor,i===void 0?!0:(r=i.prototype,!(n(r)===!1||r.hasOwnProperty("isPrototypeOf")===!1)))}return Od.isPlainObject=e,Od}var Em,iw;function GG(){if(iw)return Em;iw=1;var n=function(T){return e(T)&&!t(T)};function e(b){return!!b&&typeof b=="object"}function t(b){var T=Object.prototype.toString.call(b);return T==="[object RegExp]"||T==="[object Date]"||s(b)}var i=typeof Symbol=="function"&&Symbol.for,r=i?Symbol.for("react.element"):60103;function s(b){return b.$$typeof===r}function a(b){return Array.isArray(b)?[]:{}}function o(b,T){return T.clone!==!1&&T.isMergeableObject(b)?v(a(b),b,T):b}function l(b,T,x){return b.concat(T).map(function(w){return o(w,x)})}function u(b,T){if(!T.customMerge)return v;var x=T.customMerge(b);return typeof x=="function"?x:v}function c(b){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(b).filter(function(T){return Object.propertyIsEnumerable.call(b,T)}):[]}function d(b){return Object.keys(b).concat(c(b))}function h(b,T){try{return T in b}catch{return!1}}function p(b,T){return h(b,T)&&!(Object.hasOwnProperty.call(b,T)&&Object.propertyIsEnumerable.call(b,T))}function g(b,T,x){var w={};return x.isMergeableObject(b)&&d(b).forEach(function(A){w[A]=o(b[A],x)}),d(T).forEach(function(A){p(b,A)||(h(b,A)&&x.isMergeableObject(T[A])?w[A]=u(A,x)(b[A],T[A],x):w[A]=o(T[A],x))}),w}function v(b,T,x){x=x||{},x.arrayMerge=x.arrayMerge||l,x.isMergeableObject=x.isMergeableObject||n,x.cloneUnlessOtherwiseSpecified=o;var w=Array.isArray(T),A=Array.isArray(b),R=w===A;return R?w?x.arrayMerge(b,T,x):g(b,T,x):o(T,x)}v.all=function(T,x){if(!Array.isArray(T))throw new Error("first argument should be an array");return T.reduce(function(w,A){return v(w,A,x)},{})};var y=v;return Em=y,Em}var ff={exports:{}},WG=ff.exports,rw;function qG(){return rw||(rw=1,(function(n){(function(e,t){n.exports?n.exports=t():e.parseSrcset=t()})(WG,function(){return function(e){function t(w){return w===" "||w==="	"||w===`
`||w==="\f"||w==="\r"}function i(w){var A,R=w.exec(e.substring(y));if(R)return A=R[0],y+=A.length,A}for(var r=e.length,s=/^[ \t\n\r\u000c]+/,a=/^[, \t\n\r\u000c]+/,o=/^[^ \t\n\r\u000c]+/,l=/[,]+$/,u=/^\d+$/,c=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,d,h,p,g,v,y=0,b=[];;){if(i(a),y>=r)return b;d=i(o),h=[],d.slice(-1)===","?(d=d.replace(l,""),x()):T()}function T(){for(i(s),p="",g="in descriptor";;){if(v=e.charAt(y),g==="in descriptor")if(t(v))p&&(h.push(p),p="",g="after descriptor");else if(v===","){y+=1,p&&h.push(p),x();return}else if(v==="(")p=p+v,g="in parens";else if(v===""){p&&h.push(p),x();return}else p=p+v;else if(g==="in parens")if(v===")")p=p+v,g="in descriptor";else if(v===""){h.push(p),x();return}else p=p+v;else if(g==="after descriptor"&&!t(v))if(v===""){x();return}else g="in descriptor",y-=1;y+=1}}function x(){var w=!1,A,R,_,D,H={},P,N,G,X,te;for(D=0;D<h.length;D++)P=h[D],N=P[P.length-1],G=P.substring(0,P.length-1),X=parseInt(G,10),te=parseFloat(G),u.test(G)&&N==="w"?((A||R)&&(w=!0),X===0?w=!0:A=X):c.test(G)&&N==="x"?((A||R||_)&&(w=!0),te<0?w=!0:R=te):u.test(G)&&N==="h"?((_||R)&&(w=!0),X===0?w=!0:_=X):w=!0;w?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+P+"'."):(H.url=d,A&&(H.w=A),R&&(H.d=R),_&&(H.h=_),b.push(H))}}})})(ff)),ff.exports}var Nd={exports:{}},sw;function $G(){if(sw)return Nd.exports;sw=1;var n=String,e=function(){return{isColorSupported:!1,reset:n,bold:n,dim:n,italic:n,underline:n,inverse:n,hidden:n,strikethrough:n,black:n,red:n,green:n,yellow:n,blue:n,magenta:n,cyan:n,white:n,gray:n,bgBlack:n,bgRed:n,bgGreen:n,bgYellow:n,bgBlue:n,bgMagenta:n,bgCyan:n,bgWhite:n,blackBright:n,redBright:n,greenBright:n,yellowBright:n,blueBright:n,magentaBright:n,cyanBright:n,whiteBright:n,bgBlackBright:n,bgRedBright:n,bgGreenBright:n,bgYellowBright:n,bgBlueBright:n,bgMagentaBright:n,bgCyanBright:n,bgWhiteBright:n}};return Nd.exports=e(),Nd.exports.createColors=e,Nd.exports}const KG={},YG=Object.freeze(Object.defineProperty({__proto__:null,default:KG},Symbol.toStringTag,{value:"Module"})),Zi=ON(YG);var bm,aw;function Gy(){if(aw)return bm;aw=1;let n=$G(),e=Zi;class t extends Error{constructor(r,s,a,o,l,u){super(r),this.name="CssSyntaxError",this.reason=r,l&&(this.file=l),o&&(this.source=o),u&&(this.plugin=u),typeof s<"u"&&typeof a<"u"&&(typeof s=="number"?(this.line=s,this.column=a):(this.line=s.line,this.column=s.column,this.endLine=a.line,this.endColumn=a.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,t)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(r){if(!this.source)return"";let s=this.source;r==null&&(r=n.isColorSupported);let a=p=>p,o=p=>p,l=p=>p;if(r){let{bold:p,gray:g,red:v}=n.createColors(!0);o=y=>p(v(y)),a=y=>g(y),e&&(l=y=>e(y))}let u=s.split(/\r?\n/),c=Math.max(this.line-3,0),d=Math.min(this.line+2,u.length),h=String(d).length;return u.slice(c,d).map((p,g)=>{let v=c+1+g,y=" "+(" "+v).slice(-h)+" | ";if(v===this.line){if(p.length>160){let T=20,x=Math.max(0,this.column-T),w=Math.max(this.column+T,this.endColumn+T),A=p.slice(x,w),R=a(y.replace(/\d/g," "))+p.slice(0,Math.min(this.column-1,T-1)).replace(/[^\t]/g," ");return o(">")+a(y)+l(A)+`
 `+R+o("^")}let b=a(y.replace(/\d/g," "))+p.slice(0,this.column-1).replace(/[^\t]/g," ");return o(">")+a(y)+l(p)+`
 `+b+o("^")}return" "+a(y)+l(p)}).join(`
`)}toString(){let r=this.showSourceCode();return r&&(r=`

`+r+`
`),this.name+": "+this.message+r}}return bm=t,t.default=t,bm}var Tm,ow;function x_(){if(ow)return Tm;ow=1;const n={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function e(i){return i[0].toUpperCase()+i.slice(1)}class t{constructor(r){this.builder=r}atrule(r,s){let a="@"+r.name,o=r.params?this.rawValue(r,"params"):"";if(typeof r.raws.afterName<"u"?a+=r.raws.afterName:o&&(a+=" "),r.nodes)this.block(r,a+o);else{let l=(r.raws.between||"")+(s?";":"");this.builder(a+o+l,r)}}beforeAfter(r,s){let a;r.type==="decl"?a=this.raw(r,null,"beforeDecl"):r.type==="comment"?a=this.raw(r,null,"beforeComment"):s==="before"?a=this.raw(r,null,"beforeRule"):a=this.raw(r,null,"beforeClose");let o=r.parent,l=0;for(;o&&o.type!=="root";)l+=1,o=o.parent;if(a.includes(`
`)){let u=this.raw(r,null,"indent");if(u.length)for(let c=0;c<l;c++)a+=u}return a}block(r,s){let a=this.raw(r,"between","beforeOpen");this.builder(s+a+"{",r,"start");let o;r.nodes&&r.nodes.length?(this.body(r),o=this.raw(r,"after")):o=this.raw(r,"after","emptyBody"),o&&this.builder(o),this.builder("}",r,"end")}body(r){let s=r.nodes.length-1;for(;s>0&&r.nodes[s].type==="comment";)s-=1;let a=this.raw(r,"semicolon");for(let o=0;o<r.nodes.length;o++){let l=r.nodes[o],u=this.raw(l,"before");u&&this.builder(u),this.stringify(l,s!==o||a)}}comment(r){let s=this.raw(r,"left","commentLeft"),a=this.raw(r,"right","commentRight");this.builder("/*"+s+r.text+a+"*/",r)}decl(r,s){let a=this.raw(r,"between","colon"),o=r.prop+a+this.rawValue(r,"value");r.important&&(o+=r.raws.important||" !important"),s&&(o+=";"),this.builder(o,r)}document(r){this.body(r)}raw(r,s,a){let o;if(a||(a=s),s&&(o=r.raws[s],typeof o<"u"))return o;let l=r.parent;if(a==="before"&&(!l||l.type==="root"&&l.first===r||l&&l.type==="document"))return"";if(!l)return n[a];let u=r.root();if(u.rawCache||(u.rawCache={}),typeof u.rawCache[a]<"u")return u.rawCache[a];if(a==="before"||a==="after")return this.beforeAfter(r,a);{let c="raw"+e(a);this[c]?o=this[c](u,r):u.walk(d=>{if(o=d.raws[s],typeof o<"u")return!1})}return typeof o>"u"&&(o=n[a]),u.rawCache[a]=o,o}rawBeforeClose(r){let s;return r.walk(a=>{if(a.nodes&&a.nodes.length>0&&typeof a.raws.after<"u")return s=a.raws.after,s.includes(`
`)&&(s=s.replace(/[^\n]+$/,"")),!1}),s&&(s=s.replace(/\S/g,"")),s}rawBeforeComment(r,s){let a;return r.walkComments(o=>{if(typeof o.raws.before<"u")return a=o.raws.before,a.includes(`
`)&&(a=a.replace(/[^\n]+$/,"")),!1}),typeof a>"u"?a=this.raw(s,null,"beforeDecl"):a&&(a=a.replace(/\S/g,"")),a}rawBeforeDecl(r,s){let a;return r.walkDecls(o=>{if(typeof o.raws.before<"u")return a=o.raws.before,a.includes(`
`)&&(a=a.replace(/[^\n]+$/,"")),!1}),typeof a>"u"?a=this.raw(s,null,"beforeRule"):a&&(a=a.replace(/\S/g,"")),a}rawBeforeOpen(r){let s;return r.walk(a=>{if(a.type!=="decl"&&(s=a.raws.between,typeof s<"u"))return!1}),s}rawBeforeRule(r){let s;return r.walk(a=>{if(a.nodes&&(a.parent!==r||r.first!==a)&&typeof a.raws.before<"u")return s=a.raws.before,s.includes(`
`)&&(s=s.replace(/[^\n]+$/,"")),!1}),s&&(s=s.replace(/\S/g,"")),s}rawColon(r){let s;return r.walkDecls(a=>{if(typeof a.raws.between<"u")return s=a.raws.between.replace(/[^\s:]/g,""),!1}),s}rawEmptyBody(r){let s;return r.walk(a=>{if(a.nodes&&a.nodes.length===0&&(s=a.raws.after,typeof s<"u"))return!1}),s}rawIndent(r){if(r.raws.indent)return r.raws.indent;let s;return r.walk(a=>{let o=a.parent;if(o&&o!==r&&o.parent&&o.parent===r&&typeof a.raws.before<"u"){let l=a.raws.before.split(`
`);return s=l[l.length-1],s=s.replace(/\S/g,""),!1}}),s}rawSemicolon(r){let s;return r.walk(a=>{if(a.nodes&&a.nodes.length&&a.last.type==="decl"&&(s=a.raws.semicolon,typeof s<"u"))return!1}),s}rawValue(r,s){let a=r[s],o=r.raws[s];return o&&o.value===a?o.raw:a}root(r){this.body(r),r.raws.after&&this.builder(r.raws.after)}rule(r){this.block(r,this.rawValue(r,"selector")),r.raws.ownSemicolon&&this.builder(r.raws.ownSemicolon,r,"end")}stringify(r,s){if(!this[r.type])throw new Error("Unknown AST node type "+r.type+". Maybe you need to change PostCSS stringifier.");this[r.type](r,s)}}return Tm=t,t.default=t,Tm}var xm,uw;function bh(){if(uw)return xm;uw=1;let n=x_();function e(t,i){new n(i).stringify(t)}return xm=e,e.default=e,xm}var Md={},lw;function Wy(){return lw||(lw=1,Md.isClean=Symbol("isClean"),Md.my=Symbol("my")),Md}var Sm,cw;function Th(){if(cw)return Sm;cw=1;let n=Gy(),e=x_(),t=bh(),{isClean:i,my:r}=Wy();function s(l,u){let c=new l.constructor;for(let d in l){if(!Object.prototype.hasOwnProperty.call(l,d)||d==="proxyCache")continue;let h=l[d],p=typeof h;d==="parent"&&p==="object"?u&&(c[d]=u):d==="source"?c[d]=h:Array.isArray(h)?c[d]=h.map(g=>s(g,c)):(p==="object"&&h!==null&&(h=s(h)),c[d]=h)}return c}function a(l,u){if(u&&typeof u.offset<"u")return u.offset;let c=1,d=1,h=0;for(let p=0;p<l.length;p++){if(d===u.line&&c===u.column){h=p;break}l[p]===`
`?(c=1,d+=1):c+=1}return h}class o{get proxyOf(){return this}constructor(u={}){this.raws={},this[i]=!1,this[r]=!0;for(let c in u)if(c==="nodes"){this.nodes=[];for(let d of u[c])typeof d.clone=="function"?this.append(d.clone()):this.append(d)}else this[c]=u[c]}addToError(u){if(u.postcssNode=this,u.stack&&this.source&&/\n\s{4}at /.test(u.stack)){let c=this.source;u.stack=u.stack.replace(/\n\s{4}at /,`$&${c.input.from}:${c.start.line}:${c.start.column}$&`)}return u}after(u){return this.parent.insertAfter(this,u),this}assign(u={}){for(let c in u)this[c]=u[c];return this}before(u){return this.parent.insertBefore(this,u),this}cleanRaws(u){delete this.raws.before,delete this.raws.after,u||delete this.raws.between}clone(u={}){let c=s(this);for(let d in u)c[d]=u[d];return c}cloneAfter(u={}){let c=this.clone(u);return this.parent.insertAfter(this,c),c}cloneBefore(u={}){let c=this.clone(u);return this.parent.insertBefore(this,c),c}error(u,c={}){if(this.source){let{end:d,start:h}=this.rangeBy(c);return this.source.input.error(u,{column:h.column,line:h.line},{column:d.column,line:d.line},c)}return new n(u)}getProxyProcessor(){return{get(u,c){return c==="proxyOf"?u:c==="root"?()=>u.root().toProxy():u[c]},set(u,c,d){return u[c]===d||(u[c]=d,(c==="prop"||c==="value"||c==="name"||c==="params"||c==="important"||c==="text")&&u.markDirty()),!0}}}markClean(){this[i]=!0}markDirty(){if(this[i]){this[i]=!1;let u=this;for(;u=u.parent;)u[i]=!1}}next(){if(!this.parent)return;let u=this.parent.index(this);return this.parent.nodes[u+1]}positionBy(u={}){let c=this.source.start;if(u.index)c=this.positionInside(u.index);else if(u.word){let d="document"in this.source.input?this.source.input.document:this.source.input.css,p=d.slice(a(d,this.source.start),a(d,this.source.end)).indexOf(u.word);p!==-1&&(c=this.positionInside(p))}return c}positionInside(u){let c=this.source.start.column,d=this.source.start.line,h="document"in this.source.input?this.source.input.document:this.source.input.css,p=a(h,this.source.start),g=p+u;for(let v=p;v<g;v++)h[v]===`
`?(c=1,d+=1):c+=1;return{column:c,line:d,offset:g}}prev(){if(!this.parent)return;let u=this.parent.index(this);return this.parent.nodes[u-1]}rangeBy(u={}){let c="document"in this.source.input?this.source.input.document:this.source.input.css,d={column:this.source.start.column,line:this.source.start.line,offset:a(c,this.source.start)},h=this.source.end?{column:this.source.end.column+1,line:this.source.end.line,offset:typeof this.source.end.offset=="number"?this.source.end.offset:a(c,this.source.end)+1}:{column:d.column+1,line:d.line,offset:d.offset+1};if(u.word){let g=c.slice(a(c,this.source.start),a(c,this.source.end)).indexOf(u.word);g!==-1&&(d=this.positionInside(g),h=this.positionInside(g+u.word.length))}else u.start?d={column:u.start.column,line:u.start.line,offset:a(c,u.start)}:u.index&&(d=this.positionInside(u.index)),u.end?h={column:u.end.column,line:u.end.line,offset:a(c,u.end)}:typeof u.endIndex=="number"?h=this.positionInside(u.endIndex):u.index&&(h=this.positionInside(u.index+1));return(h.line<d.line||h.line===d.line&&h.column<=d.column)&&(h={column:d.column+1,line:d.line,offset:d.offset+1}),{end:h,start:d}}raw(u,c){return new e().raw(this,u,c)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...u){if(this.parent){let c=this,d=!1;for(let h of u)h===this?d=!0:d?(this.parent.insertAfter(c,h),c=h):this.parent.insertBefore(c,h);d||this.remove()}return this}root(){let u=this;for(;u.parent&&u.parent.type!=="document";)u=u.parent;return u}toJSON(u,c){let d={},h=c==null;c=c||new Map;let p=0;for(let g in this){if(!Object.prototype.hasOwnProperty.call(this,g)||g==="parent"||g==="proxyCache")continue;let v=this[g];if(Array.isArray(v))d[g]=v.map(y=>typeof y=="object"&&y.toJSON?y.toJSON(null,c):y);else if(typeof v=="object"&&v.toJSON)d[g]=v.toJSON(null,c);else if(g==="source"){if(v==null)continue;let y=c.get(v.input);y==null&&(y=p,c.set(v.input,p),p++),d[g]={end:v.end,inputId:y,start:v.start}}else d[g]=v}return h&&(d.inputs=[...c.keys()].map(g=>g.toJSON())),d}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(u=t){u.stringify&&(u=u.stringify);let c="";return u(this,d=>{c+=d}),c}warn(u,c,d={}){let h={node:this};for(let p in d)h[p]=d[p];return u.warn(c,h)}}return Sm=o,o.default=o,Sm}var wm,dw;function xh(){if(dw)return wm;dw=1;let n=Th();class e extends n{constructor(i){super(i),this.type="comment"}}return wm=e,e.default=e,wm}var Am,fw;function Sh(){if(fw)return Am;fw=1;let n=Th();class e extends n{get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}constructor(i){i&&typeof i.value<"u"&&typeof i.value!="string"&&(i={...i,value:String(i.value)}),super(i),this.type="decl"}}return Am=e,e.default=e,Am}var Cm,hw;function Xa(){if(hw)return Cm;hw=1;let n=xh(),e=Sh(),t=Th(),{isClean:i,my:r}=Wy(),s,a,o,l;function u(h){return h.map(p=>(p.nodes&&(p.nodes=u(p.nodes)),delete p.source,p))}function c(h){if(h[i]=!1,h.proxyOf.nodes)for(let p of h.proxyOf.nodes)c(p)}class d extends t{get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}append(...p){for(let g of p){let v=this.normalize(g,this.last);for(let y of v)this.proxyOf.nodes.push(y)}return this.markDirty(),this}cleanRaws(p){if(super.cleanRaws(p),this.nodes)for(let g of this.nodes)g.cleanRaws(p)}each(p){if(!this.proxyOf.nodes)return;let g=this.getIterator(),v,y;for(;this.indexes[g]<this.proxyOf.nodes.length&&(v=this.indexes[g],y=p(this.proxyOf.nodes[v],v),y!==!1);)this.indexes[g]+=1;return delete this.indexes[g],y}every(p){return this.nodes.every(p)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let p=this.lastEach;return this.indexes[p]=0,p}getProxyProcessor(){return{get(p,g){return g==="proxyOf"?p:p[g]?g==="each"||typeof g=="string"&&g.startsWith("walk")?(...v)=>p[g](...v.map(y=>typeof y=="function"?(b,T)=>y(b.toProxy(),T):y)):g==="every"||g==="some"?v=>p[g]((y,...b)=>v(y.toProxy(),...b)):g==="root"?()=>p.root().toProxy():g==="nodes"?p.nodes.map(v=>v.toProxy()):g==="first"||g==="last"?p[g].toProxy():p[g]:p[g]},set(p,g,v){return p[g]===v||(p[g]=v,(g==="name"||g==="params"||g==="selector")&&p.markDirty()),!0}}}index(p){return typeof p=="number"?p:(p.proxyOf&&(p=p.proxyOf),this.proxyOf.nodes.indexOf(p))}insertAfter(p,g){let v=this.index(p),y=this.normalize(g,this.proxyOf.nodes[v]).reverse();v=this.index(p);for(let T of y)this.proxyOf.nodes.splice(v+1,0,T);let b;for(let T in this.indexes)b=this.indexes[T],v<b&&(this.indexes[T]=b+y.length);return this.markDirty(),this}insertBefore(p,g){let v=this.index(p),y=v===0?"prepend":!1,b=this.normalize(g,this.proxyOf.nodes[v],y).reverse();v=this.index(p);for(let x of b)this.proxyOf.nodes.splice(v,0,x);let T;for(let x in this.indexes)T=this.indexes[x],v<=T&&(this.indexes[x]=T+b.length);return this.markDirty(),this}normalize(p,g){if(typeof p=="string")p=u(a(p).nodes);else if(typeof p>"u")p=[];else if(Array.isArray(p)){p=p.slice(0);for(let y of p)y.parent&&y.parent.removeChild(y,"ignore")}else if(p.type==="root"&&this.type!=="document"){p=p.nodes.slice(0);for(let y of p)y.parent&&y.parent.removeChild(y,"ignore")}else if(p.type)p=[p];else if(p.prop){if(typeof p.value>"u")throw new Error("Value field is missed in node creation");typeof p.value!="string"&&(p.value=String(p.value)),p=[new e(p)]}else if(p.selector||p.selectors)p=[new l(p)];else if(p.name)p=[new s(p)];else if(p.text)p=[new n(p)];else throw new Error("Unknown node type in node creation");return p.map(y=>(y[r]||d.rebuild(y),y=y.proxyOf,y.parent&&y.parent.removeChild(y),y[i]&&c(y),y.raws||(y.raws={}),typeof y.raws.before>"u"&&g&&typeof g.raws.before<"u"&&(y.raws.before=g.raws.before.replace(/\S/g,"")),y.parent=this.proxyOf,y))}prepend(...p){p=p.reverse();for(let g of p){let v=this.normalize(g,this.first,"prepend").reverse();for(let y of v)this.proxyOf.nodes.unshift(y);for(let y in this.indexes)this.indexes[y]=this.indexes[y]+v.length}return this.markDirty(),this}push(p){return p.parent=this,this.proxyOf.nodes.push(p),this}removeAll(){for(let p of this.proxyOf.nodes)p.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(p){p=this.index(p),this.proxyOf.nodes[p].parent=void 0,this.proxyOf.nodes.splice(p,1);let g;for(let v in this.indexes)g=this.indexes[v],g>=p&&(this.indexes[v]=g-1);return this.markDirty(),this}replaceValues(p,g,v){return v||(v=g,g={}),this.walkDecls(y=>{g.props&&!g.props.includes(y.prop)||g.fast&&!y.value.includes(g.fast)||(y.value=y.value.replace(p,v))}),this.markDirty(),this}some(p){return this.nodes.some(p)}walk(p){return this.each((g,v)=>{let y;try{y=p(g,v)}catch(b){throw g.addToError(b)}return y!==!1&&g.walk&&(y=g.walk(p)),y})}walkAtRules(p,g){return g?p instanceof RegExp?this.walk((v,y)=>{if(v.type==="atrule"&&p.test(v.name))return g(v,y)}):this.walk((v,y)=>{if(v.type==="atrule"&&v.name===p)return g(v,y)}):(g=p,this.walk((v,y)=>{if(v.type==="atrule")return g(v,y)}))}walkComments(p){return this.walk((g,v)=>{if(g.type==="comment")return p(g,v)})}walkDecls(p,g){return g?p instanceof RegExp?this.walk((v,y)=>{if(v.type==="decl"&&p.test(v.prop))return g(v,y)}):this.walk((v,y)=>{if(v.type==="decl"&&v.prop===p)return g(v,y)}):(g=p,this.walk((v,y)=>{if(v.type==="decl")return g(v,y)}))}walkRules(p,g){return g?p instanceof RegExp?this.walk((v,y)=>{if(v.type==="rule"&&p.test(v.selector))return g(v,y)}):this.walk((v,y)=>{if(v.type==="rule"&&v.selector===p)return g(v,y)}):(g=p,this.walk((v,y)=>{if(v.type==="rule")return g(v,y)}))}}return d.registerParse=h=>{a=h},d.registerRule=h=>{l=h},d.registerAtRule=h=>{s=h},d.registerRoot=h=>{o=h},Cm=d,d.default=d,d.rebuild=h=>{h.type==="atrule"?Object.setPrototypeOf(h,s.prototype):h.type==="rule"?Object.setPrototypeOf(h,l.prototype):h.type==="decl"?Object.setPrototypeOf(h,e.prototype):h.type==="comment"?Object.setPrototypeOf(h,n.prototype):h.type==="root"&&Object.setPrototypeOf(h,o.prototype),h[r]=!0,h.nodes&&h.nodes.forEach(p=>{d.rebuild(p)})},Cm}var Im,pw;function qy(){if(pw)return Im;pw=1;let n=Xa();class e extends n{constructor(i){super(i),this.type="atrule"}append(...i){return this.proxyOf.nodes||(this.nodes=[]),super.append(...i)}prepend(...i){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...i)}}return Im=e,e.default=e,n.registerAtRule(e),Im}var Rm,mw;function $y(){if(mw)return Rm;mw=1;let n=Xa(),e,t;class i extends n{constructor(s){super({type:"document",...s}),this.nodes||(this.nodes=[])}toResult(s={}){return new e(new t,this,s).stringify()}}return i.registerLazyResult=r=>{e=r},i.registerProcessor=r=>{t=r},Rm=i,i.default=i,Rm}var _m,gw;function XG(){if(gw)return _m;gw=1;let n="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";return _m={nanoid:(i=21)=>{let r="",s=i|0;for(;s--;)r+=n[Math.random()*64|0];return r},customAlphabet:(i,r=21)=>(s=r)=>{let a="",o=s|0;for(;o--;)a+=i[Math.random()*i.length|0];return a}},_m}var Lm,vw;function S_(){if(vw)return Lm;vw=1;let{existsSync:n,readFileSync:e}=Zi,{dirname:t,join:i}=Zi,{SourceMapConsumer:r,SourceMapGenerator:s}=Zi;function a(l){return Buffer?Buffer.from(l,"base64").toString():window.atob(l)}class o{constructor(u,c){if(c.map===!1)return;this.loadAnnotation(u),this.inline=this.startWith(this.annotation,"data:");let d=c.map?c.map.prev:void 0,h=this.loadMap(c.from,d);!this.mapFile&&c.from&&(this.mapFile=c.from),this.mapFile&&(this.root=t(this.mapFile)),h&&(this.text=h)}consumer(){return this.consumerCache||(this.consumerCache=new r(this.text)),this.consumerCache}decodeInline(u){let c=/^data:application\/json;charset=utf-?8;base64,/,d=/^data:application\/json;base64,/,h=/^data:application\/json;charset=utf-?8,/,p=/^data:application\/json,/,g=u.match(h)||u.match(p);if(g)return decodeURIComponent(u.substr(g[0].length));let v=u.match(c)||u.match(d);if(v)return a(u.substr(v[0].length));let y=u.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+y)}getAnnotationURL(u){return u.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(u){return typeof u!="object"?!1:typeof u.mappings=="string"||typeof u._mappings=="string"||Array.isArray(u.sections)}loadAnnotation(u){let c=u.match(/\/\*\s*# sourceMappingURL=/g);if(!c)return;let d=u.lastIndexOf(c.pop()),h=u.indexOf("*/",d);d>-1&&h>-1&&(this.annotation=this.getAnnotationURL(u.substring(d,h)))}loadFile(u){if(this.root=t(u),n(u))return this.mapFile=u,e(u,"utf-8").toString().trim()}loadMap(u,c){if(c===!1)return!1;if(c){if(typeof c=="string")return c;if(typeof c=="function"){let d=c(u);if(d){let h=this.loadFile(d);if(!h)throw new Error("Unable to load previous source map: "+d.toString());return h}}else{if(c instanceof r)return s.fromSourceMap(c).toString();if(c instanceof s)return c.toString();if(this.isMap(c))return JSON.stringify(c);throw new Error("Unsupported previous source map format: "+c.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let d=this.annotation;return u&&(d=i(t(u),d)),this.loadFile(d)}}}startWith(u,c){return u?u.substr(0,c.length)===c:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}}return Lm=o,o.default=o,Lm}var Pm,yw;function wh(){if(yw)return Pm;yw=1;let{nanoid:n}=XG(),{isAbsolute:e,resolve:t}=Zi,{SourceMapConsumer:i,SourceMapGenerator:r}=Zi,{fileURLToPath:s,pathToFileURL:a}=Zi,o=Gy(),l=S_(),u=Zi,c=Symbol("lineToIndexCache"),d=!!(i&&r),h=!!(t&&e);function p(v){if(v[c])return v[c];let y=v.css.split(`
`),b=new Array(y.length),T=0;for(let x=0,w=y.length;x<w;x++)b[x]=T,T+=y[x].length+1;return v[c]=b,b}class g{get from(){return this.file||this.id}constructor(y,b={}){if(y===null||typeof y>"u"||typeof y=="object"&&!y.toString)throw new Error(`PostCSS received ${y} instead of CSS string`);if(this.css=y.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,this.document=this.css,b.document&&(this.document=b.document.toString()),b.from&&(!h||/^\w+:\/\//.test(b.from)||e(b.from)?this.file=b.from:this.file=t(b.from)),h&&d){let T=new l(this.css,b);if(T.text){this.map=T;let x=T.consumer().file;!this.file&&x&&(this.file=this.mapResolve(x))}}this.file||(this.id="<input css "+n(6)+">"),this.map&&(this.map.file=this.from)}error(y,b,T,x={}){let w,A,R,_,D;if(b&&typeof b=="object"){let P=b,N=T;if(typeof P.offset=="number"){_=P.offset;let G=this.fromOffset(_);b=G.line,T=G.col}else b=P.line,T=P.column,_=this.fromLineAndColumn(b,T);if(typeof N.offset=="number"){R=N.offset;let G=this.fromOffset(R);A=G.line,w=G.col}else A=N.line,w=N.column,R=this.fromLineAndColumn(N.line,N.column)}else if(T)_=this.fromLineAndColumn(b,T);else{_=b;let P=this.fromOffset(_);b=P.line,T=P.col}let H=this.origin(b,T,A,w);return H?D=new o(y,H.endLine===void 0?H.line:{column:H.column,line:H.line},H.endLine===void 0?H.column:{column:H.endColumn,line:H.endLine},H.source,H.file,x.plugin):D=new o(y,A===void 0?b:{column:T,line:b},A===void 0?T:{column:w,line:A},this.css,this.file,x.plugin),D.input={column:T,endColumn:w,endLine:A,endOffset:R,line:b,offset:_,source:this.css},this.file&&(a&&(D.input.url=a(this.file).toString()),D.input.file=this.file),D}fromLineAndColumn(y,b){return p(this)[y-1]+b-1}fromOffset(y){let b=p(this),T=b[b.length-1],x=0;if(y>=T)x=b.length-1;else{let w=b.length-2,A;for(;x<w;)if(A=x+(w-x>>1),y<b[A])w=A-1;else if(y>=b[A+1])x=A+1;else{x=A;break}}return{col:y-b[x]+1,line:x+1}}mapResolve(y){return/^\w+:\/\//.test(y)?y:t(this.map.consumer().sourceRoot||this.map.root||".",y)}origin(y,b,T,x){if(!this.map)return!1;let w=this.map.consumer(),A=w.originalPositionFor({column:b,line:y});if(!A.source)return!1;let R;typeof T=="number"&&(R=w.originalPositionFor({column:x,line:T}));let _;e(A.source)?_=a(A.source):_=new URL(A.source,this.map.consumer().sourceRoot||a(this.map.mapFile));let D={column:A.column,endColumn:R&&R.column,endLine:R&&R.line,line:A.line,url:_.toString()};if(_.protocol==="file:")if(s)D.file=s(_);else throw new Error("file: protocol is not available in this PostCSS build");let H=w.sourceContentFor(A.source);return H&&(D.source=H),D}toJSON(){let y={};for(let b of["hasBOM","css","file","id"])this[b]!=null&&(y[b]=this[b]);return this.map&&(y.map={...this.map},y.map.consumerCache&&(y.map.consumerCache=void 0)),y}}return Pm=g,g.default=g,u&&u.registerInput&&u.registerInput(g),Pm}var km,Ew;function oc(){if(Ew)return km;Ew=1;let n=Xa(),e,t;class i extends n{constructor(s){super(s),this.type="root",this.nodes||(this.nodes=[])}normalize(s,a,o){let l=super.normalize(s);if(a){if(o==="prepend")this.nodes.length>1?a.raws.before=this.nodes[1].raws.before:delete a.raws.before;else if(this.first!==a)for(let u of l)u.raws.before=a.raws.before}return l}removeChild(s,a){let o=this.index(s);return!a&&o===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[o].raws.before),super.removeChild(s)}toResult(s={}){return new e(new t,this,s).stringify()}}return i.registerLazyResult=r=>{e=r},i.registerProcessor=r=>{t=r},km=i,i.default=i,n.registerRoot(i),km}var Dm,bw;function w_(){if(bw)return Dm;bw=1;let n={comma(e){return n.split(e,[","],!0)},space(e){let t=[" ",`
`,"	"];return n.split(e,t)},split(e,t,i){let r=[],s="",a=!1,o=0,l=!1,u="",c=!1;for(let d of e)c?c=!1:d==="\\"?c=!0:l?d===u&&(l=!1):d==='"'||d==="'"?(l=!0,u=d):d==="("?o+=1:d===")"?o>0&&(o-=1):o===0&&t.includes(d)&&(a=!0),a?(s!==""&&r.push(s.trim()),s="",a=!1):s+=d;return(i||s!=="")&&r.push(s.trim()),r}};return Dm=n,n.default=n,Dm}var Om,Tw;function Ky(){if(Tw)return Om;Tw=1;let n=Xa(),e=w_();class t extends n{get selectors(){return e.comma(this.selector)}set selectors(r){let s=this.selector?this.selector.match(/,\s*/):null,a=s?s[0]:","+this.raw("between","beforeOpen");this.selector=r.join(a)}constructor(r){super(r),this.type="rule",this.nodes||(this.nodes=[])}}return Om=t,t.default=t,n.registerRule(t),Om}var Nm,xw;function QG(){if(xw)return Nm;xw=1;let n=qy(),e=xh(),t=Sh(),i=wh(),r=S_(),s=oc(),a=Ky();function o(l,u){if(Array.isArray(l))return l.map(h=>o(h));let{inputs:c,...d}=l;if(c){u=[];for(let h of c){let p={...h,__proto__:i.prototype};p.map&&(p.map={...p.map,__proto__:r.prototype}),u.push(p)}}if(d.nodes&&(d.nodes=l.nodes.map(h=>o(h,u))),d.source){let{inputId:h,...p}=d.source;d.source=p,h!=null&&(d.source.input=u[h])}if(d.type==="root")return new s(d);if(d.type==="decl")return new t(d);if(d.type==="rule")return new a(d);if(d.type==="comment")return new e(d);if(d.type==="atrule")return new n(d);throw new Error("Unknown node type: "+l.type)}return Nm=o,o.default=o,Nm}var Mm,Sw;function A_(){if(Sw)return Mm;Sw=1;let{dirname:n,relative:e,resolve:t,sep:i}=Zi,{SourceMapConsumer:r,SourceMapGenerator:s}=Zi,{pathToFileURL:a}=Zi,o=wh(),l=!!(r&&s),u=!!(n&&t&&e&&i);class c{constructor(h,p,g,v){this.stringify=h,this.mapOpts=g.map||{},this.root=p,this.opts=g,this.css=v,this.originalCSS=v,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let h;this.isInline()?h="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?h=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?h=this.mapOpts.annotation(this.opts.to,this.root):h=this.outputFile()+".map";let p=`
`;this.css.includes(`\r
`)&&(p=`\r
`),this.css+=p+"/*# sourceMappingURL="+h+" */"}applyPrevMaps(){for(let h of this.previous()){let p=this.toUrl(this.path(h.file)),g=h.root||n(h.file),v;this.mapOpts.sourcesContent===!1?(v=new r(h.text),v.sourcesContent&&(v.sourcesContent=null)):v=h.consumer(),this.map.applySourceMap(v,p,this.toUrl(this.path(g)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let h;for(let p=this.root.nodes.length-1;p>=0;p--)h=this.root.nodes[p],h.type==="comment"&&h.text.startsWith("# sourceMappingURL=")&&this.root.removeChild(p)}else this.css&&(this.css=this.css.replace(/\n*\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),u&&l&&this.isMap())return this.generateMap();{let h="";return this.stringify(this.root,p=>{h+=p}),[h]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let h=this.previous()[0].consumer();h.file=this.outputFile(),this.map=s.fromSourceMap(h,{ignoreInvalidMapping:!0})}else this.map=new s({file:this.outputFile(),ignoreInvalidMapping:!0}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new s({file:this.outputFile(),ignoreInvalidMapping:!0});let h=1,p=1,g="<no source>",v={generated:{column:0,line:0},original:{column:0,line:0},source:""},y,b;this.stringify(this.root,(T,x,w)=>{if(this.css+=T,x&&w!=="end"&&(v.generated.line=h,v.generated.column=p-1,x.source&&x.source.start?(v.source=this.sourcePath(x),v.original.line=x.source.start.line,v.original.column=x.source.start.column-1,this.map.addMapping(v)):(v.source=g,v.original.line=1,v.original.column=0,this.map.addMapping(v))),b=T.match(/\n/g),b?(h+=b.length,y=T.lastIndexOf(`
`),p=T.length-y):p+=T.length,x&&w!=="start"){let A=x.parent||{raws:{}};(!(x.type==="decl"||x.type==="atrule"&&!x.nodes)||x!==A.last||A.raws.semicolon)&&(x.source&&x.source.end?(v.source=this.sourcePath(x),v.original.line=x.source.end.line,v.original.column=x.source.end.column-1,v.generated.line=h,v.generated.column=p-2,this.map.addMapping(v)):(v.source=g,v.original.line=1,v.original.column=0,v.generated.line=h,v.generated.column=p-1,this.map.addMapping(v)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(h=>h.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let h=this.mapOpts.annotation;return typeof h<"u"&&h!==!0?!1:this.previous().length?this.previous().some(p=>p.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(h=>h.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(h){if(this.mapOpts.absolute||h.charCodeAt(0)===60||/^\w+:\/\//.test(h))return h;let p=this.memoizedPaths.get(h);if(p)return p;let g=this.opts.to?n(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(g=n(t(g,this.mapOpts.annotation)));let v=e(g,h);return this.memoizedPaths.set(h,v),v}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(h=>{if(h.source&&h.source.input.map){let p=h.source.input.map;this.previousMaps.includes(p)||this.previousMaps.push(p)}});else{let h=new o(this.originalCSS,this.opts);h.map&&this.previousMaps.push(h.map)}return this.previousMaps}setSourcesContent(){let h={};if(this.root)this.root.walk(p=>{if(p.source){let g=p.source.input.from;if(g&&!h[g]){h[g]=!0;let v=this.usesFileUrls?this.toFileUrl(g):this.toUrl(this.path(g));this.map.setSourceContent(v,p.source.input.css)}}});else if(this.css){let p=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(p,this.css)}}sourcePath(h){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(h.source.input.from):this.toUrl(this.path(h.source.input.from))}toBase64(h){return Buffer?Buffer.from(h).toString("base64"):window.btoa(unescape(encodeURIComponent(h)))}toFileUrl(h){let p=this.memoizedFileURLs.get(h);if(p)return p;if(a){let g=a(h).toString();return this.memoizedFileURLs.set(h,g),g}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(h){let p=this.memoizedURLs.get(h);if(p)return p;i==="\\"&&(h=h.replace(/\\/g,"/"));let g=encodeURI(h).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(h,g),g}}return Mm=c,Mm}var Fm,ww;function ZG(){if(ww)return Fm;ww=1;const n=39,e=34,t=92,i=47,r=10,s=32,a=12,o=9,l=13,u=91,c=93,d=40,h=41,p=123,g=125,v=59,y=42,b=58,T=64,x=/[\t\n\f\r "#'()/;[\\\]{}]/g,w=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,A=/.[\r\n"'(/\\]/,R=/[\da-f]/i;return Fm=function(D,H={}){let P=D.css.valueOf(),N=H.ignoreErrors,G,X,te,Q,ne,oe,Z,se,j,q,re=P.length,z=0,ve=[],Le=[];function Ce(){return z}function Ae(de){throw D.error("Unclosed "+de,z)}function ke(){return Le.length===0&&z>=re}function je(de){if(Le.length)return Le.pop();if(z>=re)return;let Re=de?de.ignoreUnclosed:!1;switch(G=P.charCodeAt(z),G){case r:case s:case o:case l:case a:{Q=z;do Q+=1,G=P.charCodeAt(Q);while(G===s||G===r||G===o||G===l||G===a);oe=["space",P.slice(z,Q)],z=Q-1;break}case u:case c:case p:case g:case b:case v:case h:{let Ie=String.fromCharCode(G);oe=[Ie,Ie,z];break}case d:{if(q=ve.length?ve.pop()[1]:"",j=P.charCodeAt(z+1),q==="url"&&j!==n&&j!==e&&j!==s&&j!==r&&j!==o&&j!==a&&j!==l){Q=z;do{if(Z=!1,Q=P.indexOf(")",Q+1),Q===-1)if(N||Re){Q=z;break}else Ae("bracket");for(se=Q;P.charCodeAt(se-1)===t;)se-=1,Z=!Z}while(Z);oe=["brackets",P.slice(z,Q+1),z,Q],z=Q}else Q=P.indexOf(")",z+1),X=P.slice(z,Q+1),Q===-1||A.test(X)?oe=["(","(",z]:(oe=["brackets",X,z,Q],z=Q);break}case n:case e:{ne=G===n?"'":'"',Q=z;do{if(Z=!1,Q=P.indexOf(ne,Q+1),Q===-1)if(N||Re){Q=z+1;break}else Ae("string");for(se=Q;P.charCodeAt(se-1)===t;)se-=1,Z=!Z}while(Z);oe=["string",P.slice(z,Q+1),z,Q],z=Q;break}case T:{x.lastIndex=z+1,x.test(P),x.lastIndex===0?Q=P.length-1:Q=x.lastIndex-2,oe=["at-word",P.slice(z,Q+1),z,Q],z=Q;break}case t:{for(Q=z,te=!0;P.charCodeAt(Q+1)===t;)Q+=1,te=!te;if(G=P.charCodeAt(Q+1),te&&G!==i&&G!==s&&G!==r&&G!==o&&G!==l&&G!==a&&(Q+=1,R.test(P.charAt(Q)))){for(;R.test(P.charAt(Q+1));)Q+=1;P.charCodeAt(Q+1)===s&&(Q+=1)}oe=["word",P.slice(z,Q+1),z,Q],z=Q;break}default:{G===i&&P.charCodeAt(z+1)===y?(Q=P.indexOf("*/",z+2)+1,Q===0&&(N||Re?Q=P.length:Ae("comment")),oe=["comment",P.slice(z,Q+1),z,Q],z=Q):(w.lastIndex=z+1,w.test(P),w.lastIndex===0?Q=P.length-1:Q=w.lastIndex-2,oe=["word",P.slice(z,Q+1),z,Q],ve.push(oe),z=Q);break}}return z++,oe}function We(de){Le.push(de)}return{back:We,endOfFile:ke,nextToken:je,position:Ce}},Fm}var Bm,Aw;function JG(){if(Aw)return Bm;Aw=1;let n=qy(),e=xh(),t=Sh(),i=oc(),r=Ky(),s=ZG();const a={empty:!0,space:!0};function o(u){for(let c=u.length-1;c>=0;c--){let d=u[c],h=d[3]||d[2];if(h)return h}}class l{constructor(c){this.input=c,this.root=new i,this.current=this.root,this.spaces="",this.semicolon=!1,this.createTokenizer(),this.root.source={input:c,start:{column:1,line:1,offset:0}}}atrule(c){let d=new n;d.name=c[1].slice(1),d.name===""&&this.unnamedAtrule(d,c),this.init(d,c[2]);let h,p,g,v=!1,y=!1,b=[],T=[];for(;!this.tokenizer.endOfFile();){if(c=this.tokenizer.nextToken(),h=c[0],h==="("||h==="["?T.push(h==="("?")":"]"):h==="{"&&T.length>0?T.push("}"):h===T[T.length-1]&&T.pop(),T.length===0)if(h===";"){d.source.end=this.getPosition(c[2]),d.source.end.offset++,this.semicolon=!0;break}else if(h==="{"){y=!0;break}else if(h==="}"){if(b.length>0){for(g=b.length-1,p=b[g];p&&p[0]==="space";)p=b[--g];p&&(d.source.end=this.getPosition(p[3]||p[2]),d.source.end.offset++)}this.end(c);break}else b.push(c);else b.push(c);if(this.tokenizer.endOfFile()){v=!0;break}}d.raws.between=this.spacesAndCommentsFromEnd(b),b.length?(d.raws.afterName=this.spacesAndCommentsFromStart(b),this.raw(d,"params",b),v&&(c=b[b.length-1],d.source.end=this.getPosition(c[3]||c[2]),d.source.end.offset++,this.spaces=d.raws.between,d.raws.between="")):(d.raws.afterName="",d.params=""),y&&(d.nodes=[],this.current=d)}checkMissedSemicolon(c){let d=this.colon(c);if(d===!1)return;let h=0,p;for(let g=d-1;g>=0&&(p=c[g],!(p[0]!=="space"&&(h+=1,h===2)));g--);throw this.input.error("Missed semicolon",p[0]==="word"?p[3]+1:p[2])}colon(c){let d=0,h,p,g;for(let[v,y]of c.entries()){if(p=y,g=p[0],g==="("&&(d+=1),g===")"&&(d-=1),d===0&&g===":")if(!h)this.doubleColon(p);else{if(h[0]==="word"&&h[1]==="progid")continue;return v}h=p}return!1}comment(c){let d=new e;this.init(d,c[2]),d.source.end=this.getPosition(c[3]||c[2]),d.source.end.offset++;let h=c[1].slice(2,-2);if(/^\s*$/.test(h))d.text="",d.raws.left=h,d.raws.right="";else{let p=h.match(/^(\s*)([^]*\S)(\s*)$/);d.text=p[2],d.raws.left=p[1],d.raws.right=p[3]}}createTokenizer(){this.tokenizer=s(this.input)}decl(c,d){let h=new t;this.init(h,c[0][2]);let p=c[c.length-1];for(p[0]===";"&&(this.semicolon=!0,c.pop()),h.source.end=this.getPosition(p[3]||p[2]||o(c)),h.source.end.offset++;c[0][0]!=="word";)c.length===1&&this.unknownWord(c),h.raws.before+=c.shift()[1];for(h.source.start=this.getPosition(c[0][2]),h.prop="";c.length;){let T=c[0][0];if(T===":"||T==="space"||T==="comment")break;h.prop+=c.shift()[1]}h.raws.between="";let g;for(;c.length;)if(g=c.shift(),g[0]===":"){h.raws.between+=g[1];break}else g[0]==="word"&&/\w/.test(g[1])&&this.unknownWord([g]),h.raws.between+=g[1];(h.prop[0]==="_"||h.prop[0]==="*")&&(h.raws.before+=h.prop[0],h.prop=h.prop.slice(1));let v=[],y;for(;c.length&&(y=c[0][0],!(y!=="space"&&y!=="comment"));)v.push(c.shift());this.precheckMissedSemicolon(c);for(let T=c.length-1;T>=0;T--){if(g=c[T],g[1].toLowerCase()==="!important"){h.important=!0;let x=this.stringFrom(c,T);x=this.spacesFromEnd(c)+x,x!==" !important"&&(h.raws.important=x);break}else if(g[1].toLowerCase()==="important"){let x=c.slice(0),w="";for(let A=T;A>0;A--){let R=x[A][0];if(w.trim().startsWith("!")&&R!=="space")break;w=x.pop()[1]+w}w.trim().startsWith("!")&&(h.important=!0,h.raws.important=w,c=x)}if(g[0]!=="space"&&g[0]!=="comment")break}c.some(T=>T[0]!=="space"&&T[0]!=="comment")&&(h.raws.between+=v.map(T=>T[1]).join(""),v=[]),this.raw(h,"value",v.concat(c),d),h.value.includes(":")&&!d&&this.checkMissedSemicolon(c)}doubleColon(c){throw this.input.error("Double colon",{offset:c[2]},{offset:c[2]+c[1].length})}emptyRule(c){let d=new r;this.init(d,c[2]),d.selector="",d.raws.between="",this.current=d}end(c){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(c[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(c)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(c){if(this.spaces+=c[1],this.current.nodes){let d=this.current.nodes[this.current.nodes.length-1];d&&d.type==="rule"&&!d.raws.ownSemicolon&&(d.raws.ownSemicolon=this.spaces,this.spaces="",d.source.end=this.getPosition(c[2]),d.source.end.offset+=d.raws.ownSemicolon.length)}}getPosition(c){let d=this.input.fromOffset(c);return{column:d.col,line:d.line,offset:c}}init(c,d){this.current.push(c),c.source={input:this.input,start:this.getPosition(d)},c.raws.before=this.spaces,this.spaces="",c.type!=="comment"&&(this.semicolon=!1)}other(c){let d=!1,h=null,p=!1,g=null,v=[],y=c[1].startsWith("--"),b=[],T=c;for(;T;){if(h=T[0],b.push(T),h==="("||h==="[")g||(g=T),v.push(h==="("?")":"]");else if(y&&p&&h==="{")g||(g=T),v.push("}");else if(v.length===0)if(h===";")if(p){this.decl(b,y);return}else break;else if(h==="{"){this.rule(b);return}else if(h==="}"){this.tokenizer.back(b.pop()),d=!0;break}else h===":"&&(p=!0);else h===v[v.length-1]&&(v.pop(),v.length===0&&(g=null));T=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(d=!0),v.length>0&&this.unclosedBracket(g),d&&p){if(!y)for(;b.length&&(T=b[b.length-1][0],!(T!=="space"&&T!=="comment"));)this.tokenizer.back(b.pop());this.decl(b,y)}else this.unknownWord(b)}parse(){let c;for(;!this.tokenizer.endOfFile();)switch(c=this.tokenizer.nextToken(),c[0]){case"space":this.spaces+=c[1];break;case";":this.freeSemicolon(c);break;case"}":this.end(c);break;case"comment":this.comment(c);break;case"at-word":this.atrule(c);break;case"{":this.emptyRule(c);break;default:this.other(c);break}this.endFile()}precheckMissedSemicolon(){}raw(c,d,h,p){let g,v,y=h.length,b="",T=!0,x,w;for(let A=0;A<y;A+=1)g=h[A],v=g[0],v==="space"&&A===y-1&&!p?T=!1:v==="comment"?(w=h[A-1]?h[A-1][0]:"empty",x=h[A+1]?h[A+1][0]:"empty",!a[w]&&!a[x]?b.slice(-1)===","?T=!1:b+=g[1]:T=!1):b+=g[1];if(!T){let A=h.reduce((R,_)=>R+_[1],"");c.raws[d]={raw:A,value:b}}c[d]=b}rule(c){c.pop();let d=new r;this.init(d,c[0][2]),d.raws.between=this.spacesAndCommentsFromEnd(c),this.raw(d,"selector",c),this.current=d}spacesAndCommentsFromEnd(c){let d,h="";for(;c.length&&(d=c[c.length-1][0],!(d!=="space"&&d!=="comment"));)h=c.pop()[1]+h;return h}spacesAndCommentsFromStart(c){let d,h="";for(;c.length&&(d=c[0][0],!(d!=="space"&&d!=="comment"));)h+=c.shift()[1];return h}spacesFromEnd(c){let d,h="";for(;c.length&&(d=c[c.length-1][0],d==="space");)h=c.pop()[1]+h;return h}stringFrom(c,d){let h="";for(let p=d;p<c.length;p++)h+=c[p][1];return c.splice(d,c.length-d),h}unclosedBlock(){let c=this.current.source.start;throw this.input.error("Unclosed block",c.line,c.column)}unclosedBracket(c){throw this.input.error("Unclosed bracket",{offset:c[2]},{offset:c[2]+1})}unexpectedClose(c){throw this.input.error("Unexpected }",{offset:c[2]},{offset:c[2]+1})}unknownWord(c){throw this.input.error("Unknown word "+c[0][1],{offset:c[0][2]},{offset:c[0][2]+c[0][1].length})}unnamedAtrule(c,d){throw this.input.error("At-rule without name",{offset:d[2]},{offset:d[2]+d[1].length})}}return Bm=l,Bm}var Um,Cw;function Yy(){if(Cw)return Um;Cw=1;let n=Xa(),e=wh(),t=JG();function i(r,s){let a=new e(r,s),o=new t(a);try{o.parse()}catch(l){throw l}return o.root}return Um=i,i.default=i,n.registerParse(i),Um}var Hm,Iw;function C_(){if(Iw)return Hm;Iw=1;class n{constructor(t,i={}){if(this.type="warning",this.text=t,i.node&&i.node.source){let r=i.node.rangeBy(i);this.line=r.start.line,this.column=r.start.column,this.endLine=r.end.line,this.endColumn=r.end.column}for(let r in i)this[r]=i[r]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}}return Hm=n,n.default=n,Hm}var zm,Rw;function Xy(){if(Rw)return zm;Rw=1;let n=C_();class e{get content(){return this.css}constructor(i,r,s){this.processor=i,this.messages=[],this.root=r,this.opts=s,this.css="",this.map=void 0}toString(){return this.css}warn(i,r={}){r.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(r.plugin=this.lastPlugin.postcssPlugin);let s=new n(i,r);return this.messages.push(s),s}warnings(){return this.messages.filter(i=>i.type==="warning")}}return zm=e,e.default=e,zm}var jm,_w;function I_(){if(_w)return jm;_w=1;let n=Xa(),e=$y(),t=A_(),i=Yy(),r=Xy(),s=oc(),a=bh(),{isClean:o,my:l}=Wy();const u={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},c={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},d={Once:!0,postcssPlugin:!0,prepare:!0},h=0;function p(x){return typeof x=="object"&&typeof x.then=="function"}function g(x){let w=!1,A=u[x.type];return x.type==="decl"?w=x.prop.toLowerCase():x.type==="atrule"&&(w=x.name.toLowerCase()),w&&x.append?[A,A+"-"+w,h,A+"Exit",A+"Exit-"+w]:w?[A,A+"-"+w,A+"Exit",A+"Exit-"+w]:x.append?[A,h,A+"Exit"]:[A,A+"Exit"]}function v(x){let w;return x.type==="document"?w=["Document",h,"DocumentExit"]:x.type==="root"?w=["Root",h,"RootExit"]:w=g(x),{eventIndex:0,events:w,iterator:0,node:x,visitorIndex:0,visitors:[]}}function y(x){return x[o]=!1,x.nodes&&x.nodes.forEach(w=>y(w)),x}let b={};class T{get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}constructor(w,A,R){this.stringified=!1,this.processed=!1;let _;if(typeof A=="object"&&A!==null&&(A.type==="root"||A.type==="document"))_=y(A);else if(A instanceof T||A instanceof r)_=y(A.root),A.map&&(typeof R.map>"u"&&(R.map={}),R.map.inline||(R.map.inline=!1),R.map.prev=A.map);else{let D=i;R.syntax&&(D=R.syntax.parse),R.parser&&(D=R.parser),D.parse&&(D=D.parse);try{_=D(A,R)}catch(H){this.processed=!0,this.error=H}_&&!_[l]&&n.rebuild(_)}this.result=new r(w,_,R),this.helpers={...b,postcss:b,result:this.result},this.plugins=this.processor.plugins.map(D=>typeof D=="object"&&D.prepare?{...D,...D.prepare(this.result)}:D)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(w){return this.async().catch(w)}finally(w){return this.async().then(w,w)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(w,A){let R=this.result.lastPlugin;try{A&&A.addToError(w),this.error=w,w.name==="CssSyntaxError"&&!w.plugin?(w.plugin=R.postcssPlugin,w.setMessage()):R.postcssVersion}catch(_){console&&console.error&&console.error(_)}return w}prepareVisitors(){this.listeners={};let w=(A,R,_)=>{this.listeners[R]||(this.listeners[R]=[]),this.listeners[R].push([A,_])};for(let A of this.plugins)if(typeof A=="object")for(let R in A){if(!c[R]&&/^[A-Z]/.test(R))throw new Error(`Unknown event ${R} in ${A.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!d[R])if(typeof A[R]=="object")for(let _ in A[R])_==="*"?w(A,R,A[R][_]):w(A,R+"-"+_.toLowerCase(),A[R][_]);else typeof A[R]=="function"&&w(A,R,A[R])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let w=0;w<this.plugins.length;w++){let A=this.plugins[w],R=this.runOnRoot(A);if(p(R))try{await R}catch(_){throw this.handleError(_)}}if(this.prepareVisitors(),this.hasListener){let w=this.result.root;for(;!w[o];){w[o]=!0;let A=[v(w)];for(;A.length>0;){let R=this.visitTick(A);if(p(R))try{await R}catch(_){let D=A[A.length-1].node;throw this.handleError(_,D)}}}if(this.listeners.OnceExit)for(let[A,R]of this.listeners.OnceExit){this.result.lastPlugin=A;try{if(w.type==="document"){let _=w.nodes.map(D=>R(D,this.helpers));await Promise.all(_)}else await R(w,this.helpers)}catch(_){throw this.handleError(_)}}}return this.processed=!0,this.stringify()}runOnRoot(w){this.result.lastPlugin=w;try{if(typeof w=="object"&&w.Once){if(this.result.root.type==="document"){let A=this.result.root.nodes.map(R=>w.Once(R,this.helpers));return p(A[0])?Promise.all(A):A}return w.Once(this.result.root,this.helpers)}else if(typeof w=="function")return w(this.result.root,this.result)}catch(A){throw this.handleError(A)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let w=this.result.opts,A=a;w.syntax&&(A=w.syntax.stringify),w.stringifier&&(A=w.stringifier),A.stringify&&(A=A.stringify);let _=new t(A,this.result.root,this.result.opts).generate();return this.result.css=_[0],this.result.map=_[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let w of this.plugins){let A=this.runOnRoot(w);if(p(A))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let w=this.result.root;for(;!w[o];)w[o]=!0,this.walkSync(w);if(this.listeners.OnceExit)if(w.type==="document")for(let A of w.nodes)this.visitSync(this.listeners.OnceExit,A);else this.visitSync(this.listeners.OnceExit,w)}return this.result}then(w,A){return this.async().then(w,A)}toString(){return this.css}visitSync(w,A){for(let[R,_]of w){this.result.lastPlugin=R;let D;try{D=_(A,this.helpers)}catch(H){throw this.handleError(H,A.proxyOf)}if(A.type!=="root"&&A.type!=="document"&&!A.parent)return!0;if(p(D))throw this.getAsyncError()}}visitTick(w){let A=w[w.length-1],{node:R,visitors:_}=A;if(R.type!=="root"&&R.type!=="document"&&!R.parent){w.pop();return}if(_.length>0&&A.visitorIndex<_.length){let[H,P]=_[A.visitorIndex];A.visitorIndex+=1,A.visitorIndex===_.length&&(A.visitors=[],A.visitorIndex=0),this.result.lastPlugin=H;try{return P(R.toProxy(),this.helpers)}catch(N){throw this.handleError(N,R)}}if(A.iterator!==0){let H=A.iterator,P;for(;P=R.nodes[R.indexes[H]];)if(R.indexes[H]+=1,!P[o]){P[o]=!0,w.push(v(P));return}A.iterator=0,delete R.indexes[H]}let D=A.events;for(;A.eventIndex<D.length;){let H=D[A.eventIndex];if(A.eventIndex+=1,H===h){R.nodes&&R.nodes.length&&(R[o]=!0,A.iterator=R.getIterator());return}else if(this.listeners[H]){A.visitors=this.listeners[H];return}}w.pop()}walkSync(w){w[o]=!0;let A=g(w);for(let R of A)if(R===h)w.nodes&&w.each(_=>{_[o]||this.walkSync(_)});else{let _=this.listeners[R];if(_&&this.visitSync(_,w.toProxy()))return}}warnings(){return this.sync().warnings()}}return T.registerPostcss=x=>{b=x},jm=T,T.default=T,s.registerLazyResult(T),e.registerLazyResult(T),jm}var Vm,Lw;function eW(){if(Lw)return Vm;Lw=1;let n=A_(),e=Yy();const t=Xy();let i=bh();class r{get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let a,o=e;try{a=o(this._css,this._opts)}catch(l){this.error=l}if(this.error)throw this.error;return this._root=a,a}get[Symbol.toStringTag](){return"NoWorkResult"}constructor(a,o,l){o=o.toString(),this.stringified=!1,this._processor=a,this._css=o,this._opts=l,this._map=void 0;let u,c=i;this.result=new t(this._processor,u,this._opts),this.result.css=o;let d=this;Object.defineProperty(this.result,"root",{get(){return d.root}});let h=new n(c,u,this._opts,o);if(h.isMap()){let[p,g]=h.generate();p&&(this.result.css=p),g&&(this.result.map=g)}else h.clearAnnotation(),this.result.css=h.css}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(a){return this.async().catch(a)}finally(a){return this.async().then(a,a)}sync(){if(this.error)throw this.error;return this.result}then(a,o){return this.async().then(a,o)}toString(){return this._css}warnings(){return[]}}return Vm=r,r.default=r,Vm}var Gm,Pw;function tW(){if(Pw)return Gm;Pw=1;let n=$y(),e=I_(),t=eW(),i=oc();class r{constructor(a=[]){this.version="8.5.6",this.plugins=this.normalize(a)}normalize(a){let o=[];for(let l of a)if(l.postcss===!0?l=l():l.postcss&&(l=l.postcss),typeof l=="object"&&Array.isArray(l.plugins))o=o.concat(l.plugins);else if(typeof l=="object"&&l.postcssPlugin)o.push(l);else if(typeof l=="function")o.push(l);else if(!(typeof l=="object"&&(l.parse||l.stringify)))throw new Error(l+" is not a PostCSS plugin");return o}process(a,o={}){return!this.plugins.length&&!o.parser&&!o.stringifier&&!o.syntax?new t(this,a,o):new e(this,a,o)}use(a){return this.plugins=this.plugins.concat(this.normalize([a])),this}}return Gm=r,r.default=r,i.registerProcessor(r),n.registerProcessor(r),Gm}var Wm,kw;function nW(){if(kw)return Wm;kw=1;var n={};let e=qy(),t=xh(),i=Xa(),r=Gy(),s=Sh(),a=$y(),o=QG(),l=wh(),u=I_(),c=w_(),d=Th(),h=Yy(),p=tW(),g=Xy(),v=oc(),y=Ky(),b=bh(),T=C_();function x(...w){return w.length===1&&Array.isArray(w[0])&&(w=w[0]),new p(w)}return x.plugin=function(A,R){let _=!1;function D(...P){console&&console.warn&&!_&&(_=!0,console.warn(A+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),n.LANG&&n.LANG.startsWith("cn")&&console.warn(A+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let N=R(...P);return N.postcssPlugin=A,N.postcssVersion=new p().version,N}let H;return Object.defineProperty(D,"postcss",{get(){return H||(H=D()),H}}),D.process=function(P,N,G){return x([D(G)]).process(P,N)},D},x.stringify=b,x.parse=h,x.fromJSON=o,x.list=c,x.comment=w=>new t(w),x.atRule=w=>new e(w),x.decl=w=>new s(w),x.rule=w=>new y(w),x.root=w=>new v(w),x.document=w=>new a(w),x.CssSyntaxError=r,x.Declaration=s,x.Container=i,x.Processor=p,x.Document=a,x.Comment=t,x.Warning=T,x.AtRule=e,x.Result=g,x.Input=l,x.Rule=y,x.Root=v,x.Node=d,u.registerPostcss(x),Wm=x,x.default=x,Wm}var qm,Dw;function iW(){if(Dw)return qm;Dw=1;const n=zG(),e=jG(),{isPlainObject:t}=VG(),i=GG(),r=qG(),{parse:s}=nW(),a=["img","audio","video","picture","svg","object","map","iframe","embed"],o=["script","style"];function l(y,b){y&&Object.keys(y).forEach(function(T){b(y[T],T)})}function u(y,b){return{}.hasOwnProperty.call(y,b)}function c(y,b){const T=[];return l(y,function(x){b(x)&&T.push(x)}),T}function d(y){for(const b in y)if(u(y,b))return!1;return!0}function h(y){return y.map(function(b){if(!b.url)throw new Error("URL missing");return b.url+(b.w?` ${b.w}w`:"")+(b.h?` ${b.h}h`:"")+(b.d?` ${b.d}x`:"")}).join(", ")}qm=g;const p=/^[^\0\t\n\f\r /<=>]+$/;function g(y,b,T){if(y==null)return"";typeof y=="number"&&(y=y.toString());let x="",w="";function A(de,Re){const Ie=this;this.tag=de,this.attribs=Re||{},this.tagPosition=x.length,this.text="",this.openingTagLength=0,this.mediaChildren=[],this.updateParentNodeText=function(){if(ne.length){const Ye=ne[ne.length-1];Ye.text+=Ie.text}},this.updateParentNodeMediaChildren=function(){ne.length&&a.includes(this.tag)&&ne[ne.length-1].mediaChildren.push(this.tag)}}b=Object.assign({},g.defaults,b),b.parser=Object.assign({},v,b.parser);const R=function(de){return b.allowedTags===!1||(b.allowedTags||[]).indexOf(de)>-1};o.forEach(function(de){R(de)&&!b.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${de}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const _=b.nonTextTags||["script","style","textarea","option"];let D,H;b.allowedAttributes&&(D={},H={},l(b.allowedAttributes,function(de,Re){D[Re]=[];const Ie=[];de.forEach(function(Ye){typeof Ye=="string"&&Ye.indexOf("*")>=0?Ie.push(e(Ye).replace(/\\\*/g,".*")):D[Re].push(Ye)}),Ie.length&&(H[Re]=new RegExp("^("+Ie.join("|")+")$"))}));const P={},N={},G={};l(b.allowedClasses,function(de,Re){if(D&&(u(D,Re)||(D[Re]=[]),D[Re].push("class")),P[Re]=de,Array.isArray(de)){const Ie=[];P[Re]=[],G[Re]=[],de.forEach(function(Ye){typeof Ye=="string"&&Ye.indexOf("*")>=0?Ie.push(e(Ye).replace(/\\\*/g,".*")):Ye instanceof RegExp?G[Re].push(Ye):P[Re].push(Ye)}),Ie.length&&(N[Re]=new RegExp("^("+Ie.join("|")+")$"))}});const X={};let te;l(b.transformTags,function(de,Re){let Ie;typeof de=="function"?Ie=de:typeof de=="string"&&(Ie=g.simpleTransform(de)),Re==="*"?te=Ie:X[Re]=Ie});let Q,ne,oe,Z,se,j,q=!1;z();const re=new n.Parser({onopentag:function(de,Re){if(b.onOpenTag&&b.onOpenTag(de,Re),b.enforceHtmlBoundary&&de==="html"&&z(),se){j++;return}const Ie=new A(de,Re);ne.push(Ie);let Ye=!1;const It=!!Ie.text;let Qe;if(u(X,de)&&(Qe=X[de](de,Re),Ie.attribs=Re=Qe.attribs,Qe.text!==void 0&&(Ie.innerText=Qe.text),de!==Qe.tagName&&(Ie.name=de=Qe.tagName,Z[Q]=Qe.tagName)),te&&(Qe=te(de,Re),Ie.attribs=Re=Qe.attribs,de!==Qe.tagName&&(Ie.name=de=Qe.tagName,Z[Q]=Qe.tagName)),(!R(de)||b.disallowedTagsMode==="recursiveEscape"&&!d(oe)||b.nestingLimit!=null&&Q>=b.nestingLimit)&&(Ye=!0,oe[Q]=!0,(b.disallowedTagsMode==="discard"||b.disallowedTagsMode==="completelyDiscard")&&_.indexOf(de)!==-1&&(se=!0,j=1)),Q++,Ye){if(b.disallowedTagsMode==="discard"||b.disallowedTagsMode==="completelyDiscard"){if(Ie.innerText&&!It){const ue=ve(Ie.innerText);b.textFilter?x+=b.textFilter(ue,de):x+=ue,q=!0}return}w=x,x=""}x+="<"+de,de==="script"&&(b.allowedScriptHostnames||b.allowedScriptDomains)&&(Ie.innerText=""),Ye&&(b.disallowedTagsMode==="escape"||b.disallowedTagsMode==="recursiveEscape")&&b.preserveEscapedAttributes?l(Re,function(ue,Ee){x+=" "+Ee+'="'+ve(ue||"",!0)+'"'}):(!D||u(D,de)||D["*"])&&l(Re,function(ue,Ee){if(!p.test(Ee)){delete Ie.attribs[Ee];return}if(ue===""&&!b.allowedEmptyAttributes.includes(Ee)&&(b.nonBooleanAttributes.includes(Ee)||b.nonBooleanAttributes.includes("*"))){delete Ie.attribs[Ee];return}let _e=!1;if(!D||u(D,de)&&D[de].indexOf(Ee)!==-1||D["*"]&&D["*"].indexOf(Ee)!==-1||u(H,de)&&H[de].test(Ee)||H["*"]&&H["*"].test(Ee))_e=!0;else if(D&&D[de]){for(const Fe of D[de])if(t(Fe)&&Fe.name&&Fe.name===Ee){_e=!0;let Pe="";if(Fe.multiple===!0){const dt=ue.split(" ");for(const mt of dt)Fe.values.indexOf(mt)!==-1&&(Pe===""?Pe=mt:Pe+=" "+mt)}else Fe.values.indexOf(ue)>=0&&(Pe=ue);ue=Pe}}if(_e){if(b.allowedSchemesAppliedToAttributes.indexOf(Ee)!==-1&&Le(de,ue)){delete Ie.attribs[Ee];return}if(de==="script"&&Ee==="src"){let Fe=!0;try{const Pe=Ce(ue);if(b.allowedScriptHostnames||b.allowedScriptDomains){const dt=(b.allowedScriptHostnames||[]).find(function(he){return he===Pe.url.hostname}),mt=(b.allowedScriptDomains||[]).find(function(he){return Pe.url.hostname===he||Pe.url.hostname.endsWith(`.${he}`)});Fe=dt||mt}}catch{Fe=!1}if(!Fe){delete Ie.attribs[Ee];return}}if(de==="iframe"&&Ee==="src"){let Fe=!0;try{const Pe=Ce(ue);if(Pe.isRelativeUrl)Fe=u(b,"allowIframeRelativeUrls")?b.allowIframeRelativeUrls:!b.allowedIframeHostnames&&!b.allowedIframeDomains;else if(b.allowedIframeHostnames||b.allowedIframeDomains){const dt=(b.allowedIframeHostnames||[]).find(function(he){return he===Pe.url.hostname}),mt=(b.allowedIframeDomains||[]).find(function(he){return Pe.url.hostname===he||Pe.url.hostname.endsWith(`.${he}`)});Fe=dt||mt}}catch{Fe=!1}if(!Fe){delete Ie.attribs[Ee];return}}if(Ee==="srcset")try{let Fe=r(ue);if(Fe.forEach(function(Pe){Le("srcset",Pe.url)&&(Pe.evil=!0)}),Fe=c(Fe,function(Pe){return!Pe.evil}),Fe.length)ue=h(c(Fe,function(Pe){return!Pe.evil})),Ie.attribs[Ee]=ue;else{delete Ie.attribs[Ee];return}}catch{delete Ie.attribs[Ee];return}if(Ee==="class"){const Fe=P[de],Pe=P["*"],dt=N[de],mt=G[de],he=G["*"],Se=N["*"],qe=[dt,Se].concat(mt,he).filter(function(F){return F});if(Fe&&Pe?ue=We(ue,i(Fe,Pe),qe):ue=We(ue,Fe||Pe,qe),!ue.length){delete Ie.attribs[Ee];return}}if(Ee==="style"){if(b.parseStyleAttributes)try{const Fe=s(de+" {"+ue+"}",{map:!1}),Pe=Ae(Fe,b.allowedStyles);if(ue=ke(Pe),ue.length===0){delete Ie.attribs[Ee];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+de+" {"+ue+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete Ie.attribs[Ee];return}else if(b.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}x+=" "+Ee,ue&&ue.length?x+='="'+ve(ue,!0)+'"':b.allowedEmptyAttributes.includes(Ee)&&(x+='=""')}else delete Ie.attribs[Ee]}),b.selfClosing.indexOf(de)!==-1?x+=" />":(x+=">",Ie.innerText&&!It&&!b.textFilter&&(x+=ve(Ie.innerText),q=!0)),Ye&&(x=w+ve(x),w=""),Ie.openingTagLength=x.length-Ie.tagPosition},ontext:function(de){if(se)return;const Re=ne[ne.length-1];let Ie;if(Re&&(Ie=Re.tag,de=Re.innerText!==void 0?Re.innerText:de),b.disallowedTagsMode==="completelyDiscard"&&!R(Ie))de="";else if((b.disallowedTagsMode==="discard"||b.disallowedTagsMode==="completelyDiscard")&&(Ie==="script"||Ie==="style"))x+=de;else if(!q){const Ye=ve(de,!1);b.textFilter?x+=b.textFilter(Ye,Ie):x+=Ye}if(ne.length){const Ye=ne[ne.length-1];Ye.text+=de}},onclosetag:function(de,Re){if(b.onCloseTag&&b.onCloseTag(de,Re),se)if(j--,!j)se=!1;else return;const Ie=ne.pop();if(!Ie)return;if(Ie.tag!==de){ne.push(Ie);return}se=b.enforceHtmlBoundary?de==="html":!1,Q--;const Ye=oe[Q];if(Ye){if(delete oe[Q],b.disallowedTagsMode==="discard"||b.disallowedTagsMode==="completelyDiscard"){Ie.updateParentNodeText();return}w=x,x=""}if(Z[Q]&&(de=Z[Q],delete Z[Q]),b.exclusiveFilter){const It=b.exclusiveFilter(Ie);if(It==="excludeTag"){Ye&&(x=w,w=""),x=x.substring(0,Ie.tagPosition)+x.substring(Ie.tagPosition+Ie.openingTagLength);return}else if(It){x=x.substring(0,Ie.tagPosition);return}}if(Ie.updateParentNodeMediaChildren(),Ie.updateParentNodeText(),b.selfClosing.indexOf(de)!==-1||Re&&!R(de)&&["escape","recursiveEscape"].indexOf(b.disallowedTagsMode)>=0){Ye&&(x=w,w="");return}x+="</"+de+">",Ye&&(x=w+ve(x),w=""),q=!1}},b.parser);return re.write(y),re.end(),x;function z(){x="",Q=0,ne=[],oe={},Z={},se=!1,j=0}function ve(de,Re){return typeof de!="string"&&(de=de+""),b.parser.decodeEntities&&(de=de.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Re&&(de=de.replace(/"/g,"&quot;"))),de=de.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Re&&(de=de.replace(/"/g,"&quot;")),de}function Le(de,Re){for(Re=Re.replace(/[\x00-\x20]+/g,"");;){const It=Re.indexOf("<!--");if(It===-1)break;const Qe=Re.indexOf("-->",It+4);if(Qe===-1)break;Re=Re.substring(0,It)+Re.substring(Qe+3)}const Ie=Re.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!Ie)return Re.match(/^[/\\]{2}/)?!b.allowProtocolRelative:!1;const Ye=Ie[1].toLowerCase();return u(b.allowedSchemesByTag,de)?b.allowedSchemesByTag[de].indexOf(Ye)===-1:!b.allowedSchemes||b.allowedSchemes.indexOf(Ye)===-1}function Ce(de){if(de=de.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),de.startsWith("relative:"))throw new Error("relative: exploit attempt");let Re="relative://relative-site";for(let It=0;It<100;It++)Re+=`/${It}`;const Ie=new URL(de,Re);return{isRelativeUrl:Ie&&Ie.hostname==="relative-site"&&Ie.protocol==="relative:",url:Ie}}function Ae(de,Re){if(!Re)return de;const Ie=de.nodes[0];let Ye;return Re[Ie.selector]&&Re["*"]?Ye=i(Re[Ie.selector],Re["*"]):Ye=Re[Ie.selector]||Re["*"],Ye&&(de.nodes[0].nodes=Ie.nodes.reduce(je(Ye),[])),de}function ke(de){return de.nodes[0].nodes.reduce(function(Re,Ie){return Re.push(`${Ie.prop}:${Ie.value}${Ie.important?" !important":""}`),Re},[]).join(";")}function je(de){return function(Re,Ie){return u(de,Ie.prop)&&de[Ie.prop].some(function(It){return It.test(Ie.value)})&&Re.push(Ie),Re}}function We(de,Re,Ie){return Re?(de=de.split(/\s+/),de.filter(function(Ye){return Re.indexOf(Ye)!==-1||Ie.some(function(It){return It.test(Ye)})}).join(" ")):de}}const v={decodeEntities:!0};return g.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","menu","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},allowedEmptyAttributes:["alt"],selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0,preserveEscapedAttributes:!1},g.simpleTransform=function(y,b,T){return T=T===void 0?!0:T,b=b||{},function(x,w){let A;if(T)for(A in b)w[A]=b[A];else w=b;return{tagName:y,attribs:w}}},qm}var rW=iW();const sW=Yl(rW),$e=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},aW=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=oW},oW=Number.MAX_SAFE_INTEGER||9007199254740991;let rt=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),fe=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),O=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var wt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Xe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class _o{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class uW{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _o(e),this.fast_=new _o(t),this.defaultTTFB_=r,this.ttfb_=new _o(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new _o(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new _o(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new _o(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function lW(n,e,t){return(e=dW(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Nt(){return Nt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Nt.apply(null,arguments)}function Ow(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function kt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ow(Object(t),!0).forEach(function(i){lW(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ow(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function cW(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function dW(n){var e=cW(n,"string");return typeof e=="symbol"?e:e+""}class Mi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=Bs,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const Bs=function(){},fW={trace:Bs,debug:Bs,log:Bs,warn:Bs,info:Bs,error:Bs};function mv(){return Nt({},fW)}function hW(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Bs}function Nw(n,e,t){return e[n]?e[n].bind(e):hW(n,t)}const gv=mv();function pW(n,e,t){const i=mv();if(typeof console=="object"&&n===!0||typeof n=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=Nw(s,n,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return mv()}r.forEach(s=>{gv[s]=Nw(s,n)})}else Nt(gv,i);return i}const Dt=gv;function $s(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function mW(n){return typeof self<"u"&&n===self.ManagedMediaSource}function R_(n,e){const t=Object.keys(n),i=Object.keys(e),r=t.length,s=i.length;return!r||!s||r===s&&!t.some(a=>i.indexOf(a)===-1)}function bi(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let i,r,s,a="",o=0;for(;o<t;){if(i=n[o++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=n[o++],a+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=n[o++],s=n[o++],a+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return a}function _n(n){let e="";for(let t=0;t<n.length;t++){let i=n[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function __(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function gW(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $m={exports:{}},Mw;function vW(){return Mw||(Mw=1,(function(n,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var p=o.parseURL(l);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var g=r.exec(p.path);p.netLoc=g[1],p.path=g[2]}p.netLoc&&!p.path&&(p.path="/");var v={scheme:p.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(v.netLoc=p.netLoc,h.path[0]!=="/"))if(!h.path)v.path=p.path,h.params||(v.params=p.params,h.query||(v.query=p.query));else{var y=p.path,b=y.substring(0,y.lastIndexOf("/")+1)+h.path;v.path=o.normalizePath(b)}return v.path===null&&(v.path=c.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(v)},parseURL:function(l){var u=i.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()})($m)),$m.exports}var Qy=vW();class Zy{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ft={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class L_{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,EW(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ft.AUDIO]:null,[Ft.VIDEO]:null,[Ft.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Zy),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Qy.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ft.AUDIO]=null,e[Ft.VIDEO]=null,e[Ft.AUDIOVIDEO]=null}}function an(n){return n.sn!=="initSegment"}class Km extends L_{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if($e(e)&&$e(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const r=this._decryptdata=t[i[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=$e(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!$e(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return an(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const r=t[e];r&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}}class yW extends L_{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function P_(n,e){const t=Object.getPrototypeOf(n);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||P_(t,e)}}function EW(n,e){const t=P_(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Fw=Math.pow(2,32)-1,bW=[].push,k_={video:1,audio:2,id3:3,text:4};function mn(n){return String.fromCharCode.apply(null,n)}function D_(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function pt(n,e){const t=O_(n,e);return t<0?4294967296+t:t}function Bw(n,e){let t=pt(n,e);return t*=Math.pow(2,32),t+=pt(n,e+4),t}function O_(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function TW(n){const e=n.byteLength;for(let t=0;t<e;){const i=pt(n,t);if(i>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Tt(n,e){const t=[];if(!e.length)return t;const i=n.byteLength;for(let r=0;r<i;){const s=pt(n,r),a=mn(n.subarray(r+4,r+8)),o=s>1?r+s:i;if(a===e[0])if(e.length===1)t.push(n.subarray(r+8,o));else{const l=Tt(n.subarray(r+8,o),e.slice(1));l.length&&bW.apply(t,l)}r=o}return t}function xW(n){const e=[],t=n[0];let i=8;const r=pt(n,i);i+=4;let s=0,a=0;t===0?(s=pt(n,i),a=pt(n,i+4),i+=8):(s=Bw(n,i),a=Bw(n,i+8),i+=16),i+=2;let o=n.length+a;const l=D_(n,i);i+=2;for(let u=0;u<l;u++){let c=i;const d=pt(n,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return Dt.warn("SIDX has hierarchical references (not supported)"),null;const g=pt(n,c);c+=4,e.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/r,start:o,end:o+h-1}}),o+=h,c+=4,i=c}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function N_(n){const e=[],t=Tt(n,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],a=Tt(s,["tkhd"])[0];if(a){let o=a[0];const l=pt(a,o===0?12:20),u=Tt(s,["mdia","mdhd"])[0];if(u){o=u[0];const c=pt(u,o===0?12:20),d=Tt(s,["mdia","hdlr"])[0];if(d){const h=mn(d.subarray(8,12)),p={soun:Ft.AUDIO,vide:Ft.VIDEO}[h],g=Tt(s,["mdia","minf","stbl","stsd"])[0],v=SW(g);p?(e[l]={timescale:c,type:p,stsd:v},e[p]=kt({timescale:c,id:l},v)):e[l]={timescale:c,type:h,stsd:v}}}}}return Tt(n,["moov","mvex","trex"]).forEach(r=>{const s=pt(r,4),a=e[s];a&&(a.default={duration:pt(r,12),flags:pt(r,20)})}),e}function SW(n){const e=n.subarray(8),t=e.subarray(86),i=mn(e.subarray(4,8));let r=i,s;const a=i==="enca"||i==="encv";if(a){const u=Tt(e,[i])[0].subarray(i==="enca"?28:78);Tt(u,["sinf"]).forEach(d=>{const h=Tt(d,["schm"])[0];if(h){const p=mn(h.subarray(4,8));if(p==="cbcs"||p==="cenc"){const g=Tt(d,["frma"])[0];g&&(r=mn(g))}}})}const o=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Tt(t,["avcC"])[0];l&&l.length>3&&(r+="."+Bd(l[1])+Bd(l[2])+Bd(l[3]),s=Fd(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=Tt(e,[i])[0],u=Tt(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Ym(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Ym(u,c);const h=u[c++];if(h===64)r+="."+Bd(h);else break;if(c+=12,u[c++]!==5)break;c=Ym(u,c);const p=u[c++];let g=(p&248)>>3;g===31&&(g+=1+((p&7)<<3)+((u[c]&224)>>5)),r+="."+g}break}case"hvc1":case"hev1":{const l=Tt(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,h=pt(l,2),p=(u&32)>>5?"H":"L",g=l[12],v=l.subarray(6,12);r+="."+c+d,r+="."+wW(h).toString(16).toUpperCase(),r+="."+p+g;let y="";for(let b=v.length;b--;){const T=v[b];(T||y)&&(y="."+T.toString(16).toUpperCase()+y)}r+=y}s=Fd(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Fd(r,t)||r;break}case"vp09":{const l=Tt(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;r+="."+hr(u)+"."+hr(c)+"."+hr(d)}break}case"av01":{const l=Tt(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,p=(l[2]&32)>>5,g=u===2&&h?p?12:10:h?10:8,v=(l[2]&16)>>4,y=(l[2]&8)>>3,b=(l[2]&4)>>2,T=l[2]&3;r+="."+u+"."+hr(c)+d+"."+hr(g)+"."+v+"."+y+b+T+"."+hr(1)+"."+hr(1)+"."+hr(1)+"."+0,s=Fd("dav1",t)}break}}return{codec:r,encrypted:a,supplemental:s}}function Fd(n,e){const t=Tt(e,["dvvC"]),i=t.length?t[0]:Tt(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return n+"."+hr(r)+"."+hr(s)}}function wW(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Ym(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Bd(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function hr(n){return(n<10?"0":"")+n}function AW(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&M_(n,(i,r)=>{const s=i.subarray(8,24);s.some(a=>a!==0)||(Dt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${_n(s)} -> ${_n(t)}`),i.set(t,8))})}function CW(n){const e=[];return M_(n,t=>e.push(t.subarray(8,24))),e}function M_(n,e){Tt(n,["moov","trak"]).forEach(i=>{const r=Tt(i,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let a=Tt(s,["enca"]);const o=a.length>0;o||(a=Tt(s,["encv"])),a.forEach(l=>{const u=o?l.subarray(28):l.subarray(78);Tt(u,["sinf"]).forEach(d=>{const h=F_(d);h&&e(h,o)})})})}function F_(n){const e=Tt(n,["schm"])[0];if(e){const t=mn(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=Tt(n,["schi","tenc"])[0];if(i)return i}}}function IW(n,e,t){const i={},r=Tt(n,["moof","traf"]);for(let s=0;s<r.length;s++){const a=r[s],o=Tt(a,["tfhd"])[0],l=pt(o,4),u=e[l];if(!u)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=i[l],d=Tt(a,["tfdt"])[0];if(d){const x=d[0];let w=pt(d,4);x===1&&(w===Fw?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(w*=Fw+1,w+=pt(d,8))),$e(w)&&(!$e(c.start)||w<c.start)&&(c.start=w)}const h=u.default,p=pt(o,0)|(h==null?void 0:h.flags);let g=(h==null?void 0:h.duration)||0;p&8&&(p&2?g=pt(o,12):g=pt(o,8));const v=Tt(a,["trun"]);let y=c.start||0,b=0,T=g;for(let x=0;x<v.length;x++){const w=v[x],A=pt(w,4),R=c.sampleCount;c.sampleCount+=A;const _=w[3]&1,D=w[3]&4,H=w[2]&1,P=w[2]&2,N=w[2]&4,G=w[2]&8;let X=8,te=A;for(_&&(X+=4),D&&A&&(!(w[X+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=R),X+=4,H?(T=pt(w,X),X+=4):T=g,P&&(X+=4),G&&(X+=4),y+=T,b+=T,te--);te--;)H?(T=pt(w,X),X+=4):T=g,P&&(X+=4),N&&(w[X+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(te+1),c.keyFrameStart=y),X+=4),G&&(X+=4),y+=T,b+=T;!b&&g&&(b+=g*A)}c.duration+=b}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,a=0;const o=Tt(n,["sidx"]);for(let l=0;l<o.length;l++){const u=xW(o[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,h)=>d+h.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&$e(a)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=a*i[l].timescale-i[l].start)})}return i}function RW(n){const e={valid:null,remainder:null},t=Tt(n,["moof"]);if(t.length<2)return e.remainder=n,e;const i=t[t.length-1];return e.valid=n.slice(0,i.byteOffset-8),e.remainder=n.slice(i.byteOffset-8),e}function Oi(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Uw(n,e){const t=[],i=e.samples,r=e.timescale,s=e.id;let a=!1;return Tt(i,["moof"]).map(l=>{const u=l.byteOffset-8;Tt(l,["traf"]).map(d=>{const h=Tt(d,["tfdt"]).map(p=>{const g=p[0];let v=pt(p,4);return g===1&&(v*=Math.pow(2,32),v+=pt(p,8)),v/r})[0];return h!==void 0&&(n=h),Tt(d,["tfhd"]).map(p=>{const g=pt(p,4),v=pt(p,0)&16777215,y=(v&1)!==0,b=(v&2)!==0,T=(v&8)!==0;let x=0;const w=(v&16)!==0;let A=0;const R=(v&32)!==0;let _=8;g===s&&(y&&(_+=8),b&&(_+=4),T&&(x=pt(p,_),_+=4),w&&(A=pt(p,_),_+=4),R&&(_+=4),e.type==="video"&&(a=Ah(e.codec)),Tt(d,["trun"]).map(D=>{const H=D[0],P=pt(D,0)&16777215,N=(P&1)!==0;let G=0;const X=(P&4)!==0,te=(P&256)!==0;let Q=0;const ne=(P&512)!==0;let oe=0;const Z=(P&1024)!==0,se=(P&2048)!==0;let j=0;const q=pt(D,4);let re=8;N&&(G=pt(D,re),re+=4),X&&(re+=4);let z=G+u;for(let ve=0;ve<q;ve++){if(te?(Q=pt(D,re),re+=4):Q=x,ne?(oe=pt(D,re),re+=4):oe=A,Z&&(re+=4),se&&(H===0?j=pt(D,re):j=O_(D,re),re+=4),e.type===Ft.VIDEO){let Le=0;for(;Le<oe;){const Ce=pt(i,z);if(z+=4,_W(a,i[z])){const Ae=i.subarray(z,z+Ce);Jy(Ae,a?2:1,n+j/r,t)}z+=Ce,Le+=Ce+4}}n+=Q/r}}))})})}),t}function Ah(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function _W(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Jy(n,e,t,i){const r=B_(n);let s=0;s+=e;let a=0,o=0,l=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);const u=r.length-s;let c=s;if(o<u)s+=o;else if(o>u){Dt.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(r[c++]===181){const h=D_(r,c);if(c+=2,h===49){const p=pt(r,c);if(c+=4,p===1195456820){const g=r[c++];if(g===3){const v=r[c++],y=31&v,b=64&v,T=b?2+y*3:0,x=new Uint8Array(T);if(b){x[0]=v;for(let w=1;w<T;w++)x[w]=r[c++]}i.push({type:g,payloadType:a,pts:t,bytes:x})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const v=r[c++].toString(16);d.push(v.length==1?"0"+v:v),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,p=new Uint8Array(h);for(let g=0;g<h;g++)p[g]=r[c++];i.push({payloadType:a,pts:t,uuid:d.join(""),userData:bi(p),userDataBytes:p})}}}function B_(n){const e=n.byteLength,t=[];let i=1;for(;i<e-2;)n[i]===0&&n[i+1]===0&&n[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return n;const r=e-t.length,s=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===t[0]&&(a++,t.shift()),s[i]=n[a];return s}function LW(n){const e=n[0];let t="",i="",r=0,s=0,a=0,o=0,l=0,u=0;if(e===0){for(;mn(n.subarray(u,u+1))!=="\0";)t+=mn(n.subarray(u,u+1)),u+=1;for(t+=mn(n.subarray(u,u+1)),u+=1;mn(n.subarray(u,u+1))!=="\0";)i+=mn(n.subarray(u,u+1)),u+=1;i+=mn(n.subarray(u,u+1)),u+=1,r=pt(n,12),s=pt(n,16),o=pt(n,20),l=pt(n,24),u=28}else if(e===1){u+=4,r=pt(n,u),u+=4;const d=pt(n,u);u+=4;const h=pt(n,u);for(u+=4,a=2**32*d+h,aW(a)||(a=Number.MAX_SAFE_INTEGER,Dt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=pt(n,u),u+=4,l=pt(n,u),u+=4;mn(n.subarray(u,u+1))!=="\0";)t+=mn(n.subarray(u,u+1)),u+=1;for(t+=mn(n.subarray(u,u+1)),u+=1;mn(n.subarray(u,u+1))!=="\0";)i+=mn(n.subarray(u,u+1)),u+=1;i+=mn(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:c}}function PW(n,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(n,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function kW(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),PW([112,115,115,104],new Uint8Array([i,0,0,0]),n,s,r,a,t)}function DW(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let i=0;for(;i+32<t;){const r=new DataView(n,i),s=OW(r);e.push(s),i+=s.size}}return e}function OW(n){const e=n.getUint32(0),t=n.byteOffset,i=n.byteLength;if(i<e)return{offset:t,size:i};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=n.buffer,o=_n(new Uint8Array(a,t+12,16));let l=null,u=null,c=0;if(s===0)c=28;else{const h=n.getUint32(28);if(!h||i<32+h*16)return{offset:t,size:e};l=[];for(let p=0;p<h;p++)l.push(new Uint8Array(a,t+32+p*16,16));c=32+h*16}if(!c)return{offset:t,size:e};const d=n.getUint32(c);return e-32<d?{offset:t,size:e}:(u=new Uint8Array(a,t+c+4,d),{version:s,systemId:o,kids:l,data:u,offset:t,size:e})}const U_=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ru={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function e1(n,e){const t=ru[e];return!!t&&!!t[n.slice(0,4)]}function Hl(n,e,t=!0){return!n.split(",").some(i=>!t1(i,e,t))}function t1(n,e,t=!0){var i;const r=$s(t);return(i=r==null?void 0:r.isTypeSupported(zl(n,e)))!=null?i:!1}function zl(n,e){return`${e}/mp4;codecs=${n}`}function Hw(n){if(n){const e=n.substring(0,4);return ru.video[e]}return 2}function Bf(n){const e=U_();return n.split(",").reduce((t,i)=>{const s=e&&Ah(i)?9:ru.video[i];return s?(s*2+t)/(t?3:2):(ru.audio[i]+t)/(t?2:1)},0)}const Xm={};function NW(n,e=!0){if(Xm[n])return Xm[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<t.length;r++){var i;if(t1(t[r],"audio",e))return Xm[n]=t[r],t[r];if(t[r]==="mp3"&&(i=$s(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return n}const MW=/flac|opus|mp4a\.40\.34/i;function Uf(n,e=!0){return n.replace(MW,t=>NW(t.toLowerCase(),e))}function FW(n,e){const t=[];if(n){const i=n.split(",");for(let r=0;r<i.length;r++)e1(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function hf(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(zw(n,"audio")||zw(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let i=t.length;i--;)if(t[i].substring(0,4)===n.substring(0,4))return t[i]}return t[0]}}return e||n}function zw(n,e){return e1(n,e)&&t1(n,e)}function BW(n){const e=n.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function UW(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return n}function jw(n){const e=$s(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function vv(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const HW={supported:!0,powerEfficient:!0,smooth:!0},zW={supported:!1,smooth:!1,powerEfficient:!1},H_={supported:!0,configurations:[],decodingInfoResults:[HW]};function z_(n,e){return{supported:!1,configurations:e,decodingInfoResults:[zW],error:n}}function jW(n,e,t,i,r,s){const a=n.videoCodec,o=n.audioCodec?n.audioGroups:null,l=s==null?void 0:s.audioCodec,u=s==null?void 0:s.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((h,p)=>{if(p){const g=e.groups[p];if(!g)throw new Error(`Audio track group ${p} not found`);Object.keys(g.channels).forEach(v=>{h[v]=(h[v]||0)+g.channels[v]})}return h},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(h=>Ah(h))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!d&&$e(c)&&Object.keys(d).some(h=>parseInt(h)>c)}function j_(n,e,t,i={}){const r=n.videoCodec;if(!r&&!n.audioCodec||!t)return Promise.resolve(H_);const s=[],a=VW(n),o=a.length,l=GW(n,e,o>0),u=l.length;for(let c=o||1*u||1;c--;){const d={type:"media-source"};if(o&&(d.video=a[c%o]),u){d.audio=l[c%u];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}s.push(d)}if(r){const c=navigator.userAgent;if(r.split(",").some(d=>Ah(d))&&U_())return Promise.resolve(z_(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),s))}return Promise.all(s.map(c=>{const d=qW(c);return i[d]||(i[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:s,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:s,decodingInfoResults:[],error:c}))}function VW(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),i=V_(n),r=n.width||640,s=n.height||480,a=n.frameRate||30,o=n.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:zl(UW(l),"video"),width:r,height:s,bitrate:i,framerate:a};return o!=="sdr"&&(u.transferFunction=o),u}):[]}function GW(n,e,t){var i;const r=(i=n.audioCodec)==null?void 0:i.split(","),s=V_(n);return r&&n.audioGroups?n.audioGroups.reduce((a,o)=>{var l;const u=o?(l=e.groups[o])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===o){const h=parseFloat(d.channels||"");r.forEach(p=>{const g={contentType:zl(p,"audio"),bitrate:t?WW(p,s):s};h&&(g.channels=""+h),c.push(g)})}return c},a):a},[]):[]}function WW(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function V_(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function qW(n){let e="";const{audio:t,video:i}=n;if(i){const r=vv(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const r=vv(t.contentType);e+=`${i?"_":""}${r}_c${t.channels}`}return e}const yv=["NONE","TYPE-0","TYPE-1",null];function $W(n){return yv.indexOf(n)>-1}const Hf=["SDR","PQ","HLG"];function KW(n){return!!n&&Hf.indexOf(n)>-1}var pf={No:"",Yes:"YES",v2:"v2"};function Vw(n){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=n,r=i<e/2;return e&&r?t?pf.v2:pf.Yes:pf.No}class Gw{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class jl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ww(this._audioGroups,e)}hasSubtitleGroup(e){return Ww(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Ww(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function YW(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function XW(n,e){let t=!1,i=[];if(n&&(t=n!=="SDR",i=[n]),e){i=e.allowedVideoRanges||Hf.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&YW(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const QW=n=>{const e=new WeakSet;return(t,i)=>{if(n&&(i=n(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Bt=(n,e)=>JSON.stringify(n,QW(e));function ZW(n,e,t,i,r){const s=Object.keys(n),a=i==null?void 0:i.channels,o=i==null?void 0:i.audioCodec,l=r==null?void 0:r.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,h=1/0,p=1/0,g=1/0,v=1/0,y=0,b=[];const{preferHDR:T,allowedVideoRanges:x}=XW(e,r);for(let D=s.length;D--;){const H=n[s[D]];c||(c=H.channels[2]>0),h=Math.min(h,H.minHeight),p=Math.min(p,H.minFramerate),g=Math.min(g,H.minBitrate),x.filter(N=>H.videoRanges[N]>0).length>0&&(d=!0)}h=$e(h)?h:0,p=$e(p)?p:0;const w=Math.max(1080,h),A=Math.max(30,p);g=$e(g)?g:t,t=Math.max(g,t),d||(e=void 0);const R=s.length>1;return{codecSet:s.reduce((D,H)=>{const P=n[H];if(H===D)return D;if(b=d?x.filter(N=>P.videoRanges[N]>0):[],R){if(P.minBitrate>t)return cr(H,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),D;if(!P.hasDefaultAudio)return cr(H,"no renditions with default or auto-select sound found"),D;if(o&&H.indexOf(o.substring(0,4))%5!==0)return cr(H,`audio codec preference "${o}" not found`),D;if(a&&!u){if(!P.channels[a])return cr(H,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),D}else if((!o||u)&&c&&P.channels[2]===0)return cr(H,"no renditions with stereo sound found"),D;if(P.minHeight>w)return cr(H,`min resolution of ${P.minHeight} > maximum of ${w}`),D;if(P.minFramerate>A)return cr(H,`min framerate of ${P.minFramerate} > maximum of ${A}`),D;if(!b.some(N=>P.videoRanges[N]>0))return cr(H,`no variants with VIDEO-RANGE of ${Bt(b)} found`),D;if(l&&H.indexOf(l.substring(0,4))%5!==0)return cr(H,`video codec preference "${l}" not found`),D;if(P.maxScore<y)return cr(H,`max score of ${P.maxScore} < selected max of ${y}`),D}return D&&(Bf(H)>=Bf(D)||P.fragmentError>n[D].fragmentError)?D:(v=P.minIndex,y=P.maxScore,H)},void 0),videoRanges:b,preferHDR:T,minFramerate:p,minBitrate:g,minIndex:v}}function cr(n,e){Dt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function G_(n){return n.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function JW(n,e,t,i){return n.slice(t,i+1).reduce((r,s,a)=>{if(!s.codecSet)return r;const o=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),r},{})}function qw(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}}function yr(n,e,t){if("attrs"in n){const i=e.indexOf(n);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(Ba(n,r,t))return i}return-1}function Ba(n,e,t){const{groupId:i,name:r,lang:s,assocLang:a,default:o}=n,l=n.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||eq(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||tq(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function eq(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function tq(n,e=""){const t=n.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function Ca(n,e){const{audioCodec:t,channels:i}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function nq(n,e,t,i,r){const s=e[i],o=e.reduce((h,p,g)=>{const v=p.uri;return(h[v]||(h[v]=[])).push(g),h},{})[s.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=$w(e,i,h=>{if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==c)return!1;const p=h.audioGroups,g=t.filter(v=>!p||p.indexOf(v.groupId)!==-1);return yr(n,g,r)>-1});return d>-1?d:$w(e,i,h=>{const p=h.audioGroups,g=t.filter(v=>!p||p.indexOf(v.groupId)!==-1);return yr(n,g,r)>-1})}function $w(n,e,t){for(let i=e;i>-1;i--)if(t(n[i]))return i;for(let i=e+1;i<n.length;i++)if(t(n[i]))return i;return-1}function zf(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class iq extends Mi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:r,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!r||!l)return;const u=performance.now(),c=s?s.stats:r.stats,d=s?s.duration:r.duration,h=u-c.loading.start,p=a.minAutoLevel,g=r.level,v=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const y=v>-1&&v!==g,b=!!t||y;if(!b&&(l.paused||!l.playbackRate||!l.readyState))return;const T=a.mainForwardBufferInfo;if(!b&&T===null)return;const x=this.bwEstimator.getEstimateTTFB(),w=Math.abs(l.playbackRate);if(h<=Math.max(x,1e3*(d/(w*2))))return;const A=T?T.len/w:0,R=c.loading.first?c.loading.first-c.loading.start:-1,_=c.loaded&&R>-1,D=this.getBwEstimate(),H=a.levels,P=H[g],N=Math.max(c.loaded,Math.round(d*(r.bitrate||P.averageBitrate)/8));let G=_?h-R:h;G<1&&_&&(G=Math.min(h,c.loaded*8/D));const X=_?c.loaded*1e3/G:0,te=x/1e3,Q=X?(N-c.loaded)/X:N*8/D+te;if(Q<=A)return;const ne=X?X*8:D,oe=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,Z=this.hls.config.abrBandWidthUpFactor;let se=Number.POSITIVE_INFINITY,j;for(j=g-1;j>p;j--){const ve=H[j].maxBitrate,Le=!H[j].details||oe;if(se=this.getTimeToLoadFrag(te,ne,d*ve,Le),se<Math.min(A,d+te))break}if(se>=Q||se>d*10)return;_?this.bwEstimator.sample(h-Math.min(x,R),c.loaded):this.bwEstimator.sampleTTFB(h);const q=H[j].maxBitrate;this.getBwEstimate()*Z>q&&this.resetEstimator(q);const re=this.findBestLevel(q,p,j,0,A,1,1);re>-1&&(j=re),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${A.toFixed(3)} s
      Estimated load time for current fragment: ${Q.toFixed(3)} s
      Estimated load time for down switch fragment: ${se.toFixed(3)} s
      TTFB estimate: ${R|0} ms
      Current BW estimate: ${$e(D)?D|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${j} @ ${q|0} bps`),a.nextLoadLevel=a.nextAutoLevel=j,this.clearTimer();const z=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===j&&j>0){const ve=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${j>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${ve.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,j>p){let Le=this.findBestLevel(this.hls.levels[p].bitrate,p,j,0,ve,1,1);Le===-1&&(Le=p),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Le,this.resetEstimator(this.hls.levels[Le].bitrate)}}};y||Q>se*2?z():this.timer=self.setInterval(z,se*1e3),a.trigger(O.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new uW(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(O.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case fe.BUFFER_ADD_CODEC_ERROR:case fe.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case fe.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const a=performance.now(),o=s?s.stats:i.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,r){const s=e+i/t,a=r?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;$e(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===Xe.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+r.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(O.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Xe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:a}=i,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const y=this.findBestLevel(l,a,r,u,0,c,d);if(y>=0)return this.rebufferNotice=-1,y}let h=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const y=this.bitrateTestDelay;y&&(h=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-y,this.info(`bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1)}const p=this.findBestLevel(l,a,r,u,h,c,d);if(this.rebufferNotice!==p&&(this.rebufferNotice=p,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${p}`)),p>-1)return p;const g=i.levels[a],v=i.loadLevelObj;return v&&(g==null?void 0:g.bitrate)<v.bitrate?a:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,a,o){var l;const u=r+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:p}=this,{levels:g,allAudioTracks:v,loadLevel:y,config:b}=this.hls;if(g.length===1)return 0;const T=g[d],x=!!((l=this.hls.latestLevelDetails)!=null&&l.live),w=y===-1||c===-1;let A,R="SDR",_=(T==null?void 0:T.frameRate)||0;const{audioPreference:D,videoPreference:H}=b,P=this.audioTracksByGroup||(this.audioTracksByGroup=G_(v));let N=-1;if(w){if(this.firstSelection!==-1)return this.firstSelection;const ne=this.codecTiers||(this.codecTiers=JW(g,P,t,i)),oe=ZW(ne,R,e,D,H),{codecSet:Z,videoRanges:se,minFramerate:j,minBitrate:q,minIndex:re,preferHDR:z}=oe;N=re,A=Z,R=z?se[se.length-1]:se[0],_=j,e=Math.max(e,q),this.log(`picked start tier ${Bt(oe)}`)}else A=T==null?void 0:T.codecSet,R=T==null?void 0:T.videoRange;const G=p?p.duration:h?h.duration:0,X=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let ne=i;ne>=t;ne--){var Q;const oe=g[ne],Z=ne>d;if(!oe)continue;if(b.useMediaCapabilities&&!oe.supportedResult&&!oe.supportedPromise){const Le=navigator.mediaCapabilities;typeof(Le==null?void 0:Le.decodingInfo)=="function"&&jW(oe,P,R,_,e,D)?(oe.supportedPromise=j_(oe,P,Le,this.supportedCache),oe.supportedPromise.then(Ce=>{if(!this.hls)return;oe.supportedResult=Ce;const Ae=this.hls.levels,ke=Ae.indexOf(oe);Ce.error?this.warn(`MediaCapabilities decodingInfo error: "${Ce.error}" for level ${ke} ${Bt(Ce)}`):Ce.supported?Ce.decodingInfoResults.some(je=>je.smooth===!1||je.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ke} not smooth or powerEfficient: ${Bt(Ce)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ke} ${Bt(Ce)}`),ke>-1&&Ae.length>1&&(this.log(`Removing unsupported level ${ke}`),this.hls.removeLevel(ke),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Ce=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Ce}`)})):oe.supportedResult=H_}if((A&&oe.codecSet!==A||R&&oe.videoRange!==R||Z&&_>oe.frameRate||!Z&&_>0&&_<oe.frameRate||(Q=oe.supportedResult)!=null&&(Q=Q.decodingInfoResults)!=null&&Q.some(Le=>Le.smooth===!1))&&(!w||ne!==N)){te.push(ne);continue}const se=oe.details,j=(p?se==null?void 0:se.partTarget:se==null?void 0:se.averagetargetduration)||G;let q;Z?q=o*e:q=a*e;const re=G&&r>=G*2&&s===0?oe.averageBitrate:oe.maxBitrate,z=this.getTimeToLoadFrag(X,q,re*j,se===void 0);if(q>=re&&(ne===c||oe.loadError===0&&oe.fragmentError===0)&&(z<=X||!$e(z)||x&&!this.bitrateTestDelay||z<u)){const Le=this.forcedAutoLevel;return ne!==y&&(Le===-1||Le!==y)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${g[te[0]].codecs}" ${g[te[0]].videoRange}; not compatible with "${A}" ${R}`),this.info(`switch candidate:${d}->${ne} adjustedbw(${Math.round(q)})-bitrate=${Math.round(q-re)} ttfb:${X.toFixed(1)} avgDuration:${j.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${z.toFixed(1)} firstSelection:${w} codecSet:${oe.codecSet} videoRange:${oe.videoRange} hls.loadLevel:${y}`)),w&&(this.firstSelection=ne),ne}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const W_={search:function(n,e){let t=0,i=n.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=n[r];const a=e(s);if(a>0)t=r+1;else if(a<0)i=r-1;else return s}return null}};function rq(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!$e(e))return null;const i=n[0].programDateTime;if(e<(i||0))return null;const r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<n.length;++s){const a=n[s];if(aq(e,t,a))return a}return null}function ja(n,e,t=0,i=0,r=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&Kw(t,i,s)===0||sq(s,n,Math.min(r,i))))return s;const a=W_.search(e,Kw.bind(null,t,i));return a&&(a!==n||!s)?a:s}function sq(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return n.start<=i}return!1}function Kw(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=n?1:t.start-i>n&&t.start?-1:0}function aq(n,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>n}function q_(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let i=n.fragments;const{fragmentHint:r}=n;r&&(i=i.concat(r));let s;return W_.search(i,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function jf(n){switch(n.details){case fe.FRAG_LOAD_TIMEOUT:case fe.KEY_LOAD_TIMEOUT:case fe.LEVEL_LOAD_TIMEOUT:case fe.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function $_(n){return n.details.startsWith("key")}function K_(n){return $_(n)&&!!n.frag&&!n.frag.decryptdata}function Yw(n,e){const t=jf(e);return n.default[`${t?"timeout":"error"}Retry`]}function n1(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Xw(n){return kt(kt({},n),{errorRetry:null,timeoutRetry:null})}function Vf(n,e,t,i){if(!n)return!1;const r=i==null?void 0:i.code,s=e<n.maxNumRetry&&(oq(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,i,s):s}function oq(n){return Ev(n)||!!n&&(n<400||n>499)}function Ev(n){return n===0&&navigator.onLine===!1}var Rn={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},mi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class uq extends Mi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(O.ERROR,this.onError,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(O.ERROR,this.onError,this),e.off(O.ERROR,this.onErrorOut,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Xe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(a=>r.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case fe.FRAG_LOAD_ERROR:case fe.FRAG_LOAD_TIMEOUT:case fe.KEY_LOAD_ERROR:case fe.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case fe.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Ko();return}case fe.FRAG_GAP:case fe.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Rn.SendAlternateToPenaltyBox;return}case fe.LEVEL_EMPTY_ERROR:case fe.LEVEL_PARSING_ERROR:{var a;const l=t.parent===Xe.MAIN?t.level:r.loadLevel;t.details===fe.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case fe.LEVEL_LOAD_ERROR:case fe.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case fe.AUDIO_TRACK_LOAD_ERROR:case fe.AUDIO_TRACK_LOAD_TIMEOUT:case fe.SUBTITLE_LOAD_ERROR:case fe.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&(s.type===wt.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===wt.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Rn.SendAlternateToPenaltyBox,t.errorAction.flags=mi.MoveAllAlternatesMatchingHost;return}}return;case fe.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Rn.SendAlternateToPenaltyBox,flags:mi.MoveAllAlternatesMatchingHDCP};return;case fe.KEY_SYSTEM_SESSION_UPDATE_FAILED:case fe.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case fe.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Rn.SendAlternateToPenaltyBox,flags:mi.MoveAllAlternatesMatchingKey};return;case fe.BUFFER_ADD_CODEC_ERROR:case fe.REMUX_ALLOC_ERROR:case fe.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:r.loadLevel)}return;case fe.INTERNAL_EXCEPTION:case fe.BUFFER_APPENDING_ERROR:case fe.BUFFER_FULL_ERROR:case fe.LEVEL_SWITCH_ERROR:case fe.BUFFER_STALLED_ERROR:case fe.BUFFER_SEEK_OVER_HOLE:case fe.BUFFER_NUDGE_ON_STALL:t.errorAction=Ko();return}t.type===rt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Ko())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=Yw(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(Vf(r,s,jf(e),e.response))return{action:Rn.RetryRequest,flags:mi.None,retryConfig:r,retryCount:s};const o=this.getLevelSwitchAction(e,t);return r&&(o.retryConfig=r,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=Yw($_(e)?a:s,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(r&&(e.details!==fe.FRAG_GAP&&r.fragmentError++,!K_(e)&&Vf(o,l,jf(e),e.response)))return{action:Rn.RetryRequest,flags:mi.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,i);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var s,a;const u=e.details;r.loadError++,u===fe.BUFFER_APPEND_ERROR&&r.fragmentError++;let c=-1;const{levels:d,loadLevel:h,minAutoLevel:p,maxAutoLevel:g}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const v=(s=e.frag)==null?void 0:s.type,b=(v===Xe.AUDIO&&u===fe.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===fe.BUFFER_ADD_CODEC_ERROR||u===fe.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:R})=>r.audioCodec!==R),x=e.sourceBufferName==="video"&&(u===fe.BUFFER_ADD_CODEC_ERROR||u===fe.BUFFER_APPEND_ERROR)&&d.some(({codecSet:R,audioCodec:_})=>r.codecSet!==R&&r.audioCodec===_),{type:w,groupId:A}=(a=e.context)!=null?a:{};for(let R=d.length;R--;){const _=(R+h)%d.length;if(_!==h&&_>=p&&_<=g&&d[_].loadError===0){var o,l;const D=d[_];if(u===fe.FRAG_GAP&&v===Xe.MAIN&&e.frag){const H=d[_].details;if(H){const P=ja(e.frag,H.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(w===wt.AUDIO_TRACK&&D.hasAudioGroup(A)||w===wt.SUBTITLE_TRACK&&D.hasSubtitleGroup(A))continue;if(v===Xe.AUDIO&&(o=r.audioGroups)!=null&&o.some(H=>D.hasAudioGroup(H))||v===Xe.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(H=>D.hasSubtitleGroup(H))||b&&r.audioCodec===D.audioCodec||x&&r.codecSet===D.codecSet||!b&&r.codecSet!==D.codecSet)continue}c=_;break}}if(c>-1&&i.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Rn.SendAlternateToPenaltyBox,flags:mi.None,nextAutoLevel:c}}return{action:Rn.SendAlternateToPenaltyBox,flags:mi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Rn.DoNothing:break;case Rn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==fe.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r}=i,s=i.nextAutoLevel;switch(r){case mi.None:this.switchLevel(e,s);break;case mi.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(i.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=yv[yv.indexOf(c)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case mi.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let h=c;h--;)if(this.variantHasKey(u[h],l)){var a,o;this.log(`Banned key found in level ${h} (${u[h].bitrate}bps) or audio group "${(a=u[h].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${_n(l.keyId||[])}`),u[h].fragmentError++,u[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const d=e.frag;if(this.hls.levels.length<c)i.resolved=!0;else if(d&&d.type!==Xe.MAIN){const h=d.decryptdata;h&&!l.matches(h)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===fe.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=vv(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${s} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(s))}}}function Ko(n){const e={action:Rn.DoNothing,flags:mi.None};return n&&(e.resolved=!0),e}var vn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class lq{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:r}=this,s=Object.keys(r);for(let a=s.length;a--;){const o=r[s[a]];if((o==null?void 0:o.body.type)===t&&(!i||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,i,r,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===i&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,r=Lo(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach(o=>{const l=i.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;s.range[o]=this.getBufferedTimes(i,e.part,c,u)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,i),Ud(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=Qw(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=Lo(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,i,r){const s={time:[],partial:i},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<r.length;c++){const d=r.start(c)-this.bufferPadding,h=r.end(c)+this.bufferPadding;if(u>=d&&l<=h){s.time.push({startPTS:Math.max(a,r.start(c)),endPTS:Math.min(o,r.end(c))});break}else if(a<h&&o>d){const p=Math.max(a,r.start(c)),g=Math.min(o,r.end(c));g>p&&(s.partial=!0,s.time.push({startPTS:p,endPTS:g}))}else if(o<=d)break}return s}getPartialFragment(e){let t=null,i,r,s,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&Ud(c)&&(r=c.body.start-o,s=c.body.end+o,e>=r&&e<=s&&(i=Math.min(e-r,s-e),a<=i&&(t=c.body,a=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ud(t))}getState(e){const t=Lo(e),i=this.fragments[t];return i?i.buffered?Ud(i)?vn.PARTIAL:vn.OK:vn.APPENDING:vn.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let a=0;a<i.length;a++){if(r=i.start(a)-this.bufferPadding,s=i.end(a)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,r=t.part?null:t,s=Lo(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:s,type:a}=t;if(i.sn==="initSegment")return;const o=i.type;if(r){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(r)}this.timeRanges=s;const l=s[a];this.detectEvictedFragments(a,l,o,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Lo(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){const s=t[i[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==i||r&&!l.gap||l.start<t&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=Lo(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=Qw(i,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function Ud(n){var e,t,i;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(i=n.range.audiovideo)!=null&&i.partial)}function Lo(n){return`${n.type}_${n.level}_${n.sn}`}function Qw(n,e){return n.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Ks={cbc:0,ctr:1};class cq{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Ks.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ks.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function dq(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class fq{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],a=i[2],o=i[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],p=new Uint32Array(256);let g=0,v=0,y=0;for(y=0;y<256;y++)y<128?p[y]=y<<1:p[y]=y<<1^283;for(y=0;y<256;y++){let b=v^v<<1^v<<2^v<<3^v<<4;b=b>>>8^b&255^99,e[g]=b,t[b]=g;const T=p[g],x=p[T],w=p[x];let A=p[b]*257^b*16843008;r[g]=A<<24|A>>>8,s[g]=A<<16|A>>>16,a[g]=A<<8|A>>>24,o[g]=A,A=w*16843009^x*65537^T*257^g*16843008,u[b]=A<<24|A>>>8,c[b]=A<<16|A>>>16,d[b]=A<<8|A>>>24,h[b]=A,g?(g=T^p[p[p[w^T]]],v^=p[p[v]]):g=v=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,p=this.invSubMix,g=p[0],v=p[1],y=p[2],b=p[3];let T,x;for(o=0;o<a;o++){if(o<s){T=u[o]=t[o];continue}x=T,o%s===0?(x=x<<8|x>>>24,x=d[x>>>24]<<24|d[x>>>16&255]<<16|d[x>>>8&255]<<8|d[x&255],x^=h[o/s|0]<<24):s>6&&o%s===4&&(x=d[x>>>24]<<24|d[x>>>16&255]<<16|d[x>>>8&255]<<8|d[x&255]),u[o]=T=(u[o-s]^x)>>>0}for(l=0;l<a;l++)o=a-l,l&3?x=u[o]:x=u[o-4],l<4||o<=4?c[l]=x:c[l]=g[d[x>>>24]]^v[d[x>>>16&255]]^y[d[x>>>8&255]]^b[d[x&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(i);let p=h[0],g=h[1],v=h[2],y=h[3];const b=new Int32Array(e),T=new Int32Array(b.length);let x,w,A,R,_,D,H,P,N,G,X,te,Q,ne;const oe=this.networkToHostOrderSwap;for(;t<b.length;){for(N=oe(b[t]),G=oe(b[t+1]),X=oe(b[t+2]),te=oe(b[t+3]),_=N^s[0],D=te^s[1],H=X^s[2],P=G^s[3],Q=4,ne=1;ne<r;ne++)x=l[_>>>24]^u[D>>16&255]^c[H>>8&255]^d[P&255]^s[Q],w=l[D>>>24]^u[H>>16&255]^c[P>>8&255]^d[_&255]^s[Q+1],A=l[H>>>24]^u[P>>16&255]^c[_>>8&255]^d[D&255]^s[Q+2],R=l[P>>>24]^u[_>>16&255]^c[D>>8&255]^d[H&255]^s[Q+3],_=x,D=w,H=A,P=R,Q=Q+4;x=a[_>>>24]<<24^a[D>>16&255]<<16^a[H>>8&255]<<8^a[P&255]^s[Q],w=a[D>>>24]<<24^a[H>>16&255]<<16^a[P>>8&255]<<8^a[_&255]^s[Q+1],A=a[H>>>24]<<24^a[P>>16&255]<<16^a[_>>8&255]<<8^a[D&255]^s[Q+2],R=a[P>>>24]<<24^a[_>>16&255]<<16^a[D>>8&255]<<8^a[H&255]^s[Q+3],T[t]=oe(x^p),T[t+1]=oe(R^g),T[t+2]=oe(A^v),T[t+3]=oe(w^y),p=N,g=G,v=X,y=te,t=t+4}return T.buffer}}class hq{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=pq(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function pq(n){switch(n){case Ks.cbc:return"AES-CBC";case Ks.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const mq=16;class i1{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?dq(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,i,r);const l=this.flush();l?s(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){const{currentIV:s,currentResult:a,remainderData:o}=this;if(r!==Ks.cbc||t.byteLength!==16)return Dt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=Oi(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(i=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new fq),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new hq(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new cq(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Dt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%mq;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Dt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Zw=Math.pow(2,17);class gq{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Kr({type:rt.NETWORK_ERROR,details:fe.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(e2(e));return}else e.gap=!1;const u=this.loader=s?new s(r):new a(r),c=Jw(e);e.loader=u;const d=Xw(r.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Zw};e.stats=u.stats;const p={onSuccess:(g,v,y,b)=>{this.resetLoader(e,u);let T=g.data;y.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),o({frag:e,part:null,payload:T,networkDetails:b})},onError:(g,v,y,b)=>{this.resetLoader(e,u),l(new Kr({type:rt.NETWORK_ERROR,details:fe.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:kt({url:i,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:y,stats:b}))},onAbort:(g,v,y)=>{this.resetLoader(e,u),l(new Kr({type:rt.NETWORK_ERROR,details:fe.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:y,stats:g}))},onTimeout:(g,v,y)=>{this.resetLoader(e,u),l(new Kr({type:rt.NETWORK_ERROR,details:fe.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:y,stats:g}))}};t&&(p.onProgress=(g,v,y,b)=>t({frag:e,part:null,payload:y,networkDetails:b})),u.load(c,h,p)})}loadPart(e,t,i){this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(e2(e,t));return}const u=this.loader=s?new s(r):new a(r),c=Jw(e,t);e.loader=u;const d=Xw(r.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Zw};t.stats=u.stats,u.load(c,h,{onSuccess:(p,g,v,y)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const b={frag:e,part:t,payload:p.data,networkDetails:y};i(b),o(b)},onError:(p,g,v,y)=>{this.resetLoader(e,u),l(new Kr({type:rt.NETWORK_ERROR,details:fe.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:kt({url:c.url,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:v,stats:y}))},onAbort:(p,g,v)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Kr({type:rt.NETWORK_ERROR,details:fe.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:v,stats:p}))},onTimeout:(p,g,v)=>{this.resetLoader(e,u),l(new Kr({type:rt.NETWORK_ERROR,details:fe.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:v,stats:p}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(i.loaded/s),l),d=(l-u)*Math.round(i.loaded/u);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);const a=i.loading,o=r.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Jw(n,e=null){const t=e||n,i={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if($e(r)&&$e(s)){var a;let o=r,l=s;if(n.sn==="initSegment"&&vq((a=n.decryptdata)==null?void 0:a.method)){const u=s-r;u%16&&(l=s+(16-u%16)),r!==0&&(i.resetIV=!0,o=r-16)}i.rangeStart=o,i.rangeEnd=l}return i}function e2(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:rt.MEDIA_ERROR,details:fe.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(i.part=e),(e||n).stats.aborted=!0,new Kr(i)}function vq(n){return n==="AES-128"||n==="AES-256"}class Kr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Y_ extends Mi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class r1{constructor(e,t,i,r=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Hd(),this.buffering={audio:Hd(),video:Hd(),audiovideo:Hd()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=a}}function Hd(){return{start:0,executeStart:0,executeEnd:0,end:0}}const t2={length:0,start:()=>0,end:()=>0};class vt{static isBuffered(e,t){if(e){const i=vt.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=vt.getBuffered(e);return vt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const r=vt.bufferedRanges(e);if(r.length)return vt.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let r=-1,s=[];if(i)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(r=c);const d=s.length;if(d){const h=s[d-1].end;e[c].start-h<i?e[c].end>h&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let a=0,o,l=t,u=t;for(let c=0;c<s.length;c++){const d=s[c].start,h=s[c].end;if(r===-1&&t>=d&&t<=h&&(r=c),t+i>=d&&t<h)l=d,u=h,a=u-t;else if(t+i<d){o=d;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||t2}catch(t){return Dt.log("failed to get media.buffered",t),t2}}}const X_=/\{\$([a-zA-Z0-9-_]+)\}/g;function n2(n){return X_.test(n)}function bv(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(X_,i=>{const r=i.substring(2,i.length-1),s=t==null?void 0:t[r];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function i2(n,e,t){let i=n.variableList;i||(n.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(r))s=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,s=e.VALUE;r in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function yq(n,e,t){const i=e.IMPORT;if(t&&i in t){let r=n.variableList;r||(n.variableList=r={}),r[i]=t[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const Eq=/^(\d+)x(\d+)$/,r2=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Zt{constructor(e,t){typeof e=="string"&&(e=Zt.parseAttrList(e,t)),Nt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Eq.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const r={};for(r2.lastIndex=0;(i=r2.exec(e))!==null;){const a=i[1].trim();let o=i[2];const l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=bv(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Dt.warn(`${e}: attribute ${a} is missing quotes`)}r[a]=o}return r}}const bq="com.apple.hls.interstitial";function Tq(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function xq(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Q_{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:i,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){Dt.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Nt(new Zt({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);$e(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Dt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if($e(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===bq}get isValid(){return!!this.id&&!this._badValueForSameId&&$e(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Sq=10;class wq{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?$e(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Sq}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Gf(n,e){return n.length===e.length?!n.some((t,i)=>t!==e[i]):!1}function s2(n,e){return!n&&!e?!0:!n||!e?!1:Gf(n,e)}function Yo(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function s1(n){switch(n){case"AES-128":case"AES-256":return Ks.cbc;case"AES-256-CTR":return Ks.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function a1(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Tv(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function Aq(n){const e=Tv(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Z_(n){const e=function(i,r,s){const a=i[r];i[r]=i[s],i[s]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function J_(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",a=r[1];s?(i.splice(-1,1),t=a1(a)):t=Aq(a)}}return t}const Wf=typeof self<"u"?self:void 0;var Jt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ln={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function mf(n){switch(n){case Ln.FAIRPLAY:return Jt.FAIRPLAY;case Ln.PLAYREADY:return Jt.PLAYREADY;case Ln.WIDEVINE:return Jt.WIDEVINE;case Ln.CLEARKEY:return Jt.CLEARKEY}}function Qm(n){switch(n){case Jt.FAIRPLAY:return Ln.FAIRPLAY;case Jt.PLAYREADY:return Ln.PLAYREADY;case Jt.WIDEVINE:return Ln.WIDEVINE;case Jt.CLEARKEY:return Ln.CLEARKEY}}function ml(n){const{drmSystems:e,widevineLicenseUrl:t}=n,i=e?[Jt.FAIRPLAY,Jt.WIDEVINE,Jt.PLAYREADY,Jt.CLEARKEY].filter(r=>!!e[r]):[];return!i[Jt.WIDEVINE]&&t&&i.push(Jt.WIDEVINE),i}const eL=(function(n){return Wf!=null&&(n=Wf.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Cq(n,e,t,i){let r;switch(n){case Jt.FAIRPLAY:r=["cenc","sinf"];break;case Jt.WIDEVINE:case Jt.PLAYREADY:r=["cenc"];break;case Jt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return Iq(r,e,t,i)}function Iq(n,e,t,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Rq(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function tL(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=a1(o).subarray(0,16);return Z_(l),l}}return null}let Po={};class Vs{static clearKeyUriToKeyIdMap(){Po={}}static setKeyIdForUri(e,t){Po[e]=t}static addKeyIdForUri(e){const t=Object.keys(Po).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),Po[e]=i,i}constructor(e,t,i,r=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Yo(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(__(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Gf(e.keyFormatVersions,this.keyFormatVersions)&&s2(e.iv,this.iv)&&s2(e.keyId,this.keyId)}isSupported(){if(this.method){if(Yo(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ln.FAIRPLAY:case Ln.WIDEVINE:case Ln.PLAYREADY:case Ln.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Yo(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Dt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=Lq(e)),new Vs(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Po[this.uri];if(s&&!Gf(this.keyId,s)&&Vs.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=J_(this.uri);if(i)switch(this.keyFormat){case Ln.WIDEVINE:if(this.pssh=i,!this.keyId){const s=DW(i.buffer);if(s.length){var r;const a=s[0];this.keyId=(r=a.kids)!=null&&r.length?a.kids[0]:null}}this.keyId||(this.keyId=a2(t));break;case Ln.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=kW(s,null,i),this.keyId=tL(i);break}default:{let s=i.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=_q(t),s||(s=a2(t),s||(s=Po[this.uri])),s&&(this.keyId=s,Vs.setKeyIdForUri(this.uri,s))}return this}}function _q(n){const e=n==null?void 0:n[Ln.WIDEVINE];return e?e.keyId:null}function a2(n){const e=n==null?void 0:n[Ln.PLAYREADY];if(e){const t=J_(e.uri);if(t)return tL(t)}return null}function Lq(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const o2=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,u2=/#EXT-X-MEDIA:(.*)/g,Pq=/^#EXT(?:INF|-X-TARGETDURATION):/m,Zm=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),kq=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Er{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return Qy.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Pq.test(e)}static parseMasterPlaylist(e,t){const i=n2(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];if(o2.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let a;for(;(a=o2.exec(e))!=null;)if(a[1]){var o;const u=new Zt(a[1],r),c=bv(r,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Er.resolve(c,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),d2(u.CODECS,d);const p=u["SUPPLEMENTAL-CODECS"];p&&(d.supplemental={},d2(p,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),r.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new Zt(c,r),h=d["DATA-ID"];h&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[h]=d);break}case"SESSION-KEY":{const d=l2(c,t,r);d.encrypted&&d.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(d)):Dt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new Zt(c,r);i2(r,d,t)}break}case"CONTENT-STEERING":{const d=new Zt(c,r);r.contentSteering={uri:Er.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=c2(c);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const s={},a=i.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(u2.lastIndex=0;(r=u2.exec(e))!==null;){const u=new Zt(r[1],i),c=u.TYPE;if(c){const d=o[c],h=s[c]||[];s[c]=h;const p=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],v=u.CHANNELS,y=u.CHARACTERISTICS,b=u["INSTREAM-ID"],T={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||p||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:p,url:u.URI?Er.resolve(u.URI,t):""};if(g&&(T.assocLang=g),v&&(T.channels=v),y&&(T.characteristics=y),b&&(T.instreamId=b),d!=null&&d.length){const x=Er.findGroup(d,T.groupId)||d[0];f2(T,x,"audioCodec"),f2(T,x,"textCodec")}h.push(T)}}return s}static parseLevelPlaylist(e,t,i,r,s,a){var o;const l={url:t},u=new wq(t),c=u.fragments,d=[];let h=null,p=0,g=0,v=0,y=0,b=0,T=null,x=new Km(r,l),w,A,R,_=-1,D=!1,H=null,P;if(Zm.lastIndex=0,u.m3u8=e,u.hasVariableRefs=n2(e),((o=Zm.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(w=Zm.exec(e))!==null;){D&&(D=!1,x=new Km(r,l),x.playlistOffset=v,x.setStart(v),x.sn=p,x.cc=y,b&&(x.bitrate=b),x.level=i,h&&(x.initSegment=h,h.rawProgramDateTime&&(x.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),H&&(x.setByteRange(H),H=null)));const te=w[1];if(te){x.duration=parseFloat(te);const Q=(" "+w[2]).slice(1);x.title=Q||null,x.tagList.push(Q?["INF",te,Q]:["INF",te])}else if(w[3]){if($e(x.duration)){x.playlistOffset=v,x.setStart(v),R&&p2(x,R,u),x.sn=p,x.level=i,x.cc=y,c.push(x);const Q=(" "+w[3]).slice(1);x.relurl=bv(u,Q),xv(x,T,d),T=x,v+=x.duration,p++,g=0,D=!0}}else{if(w=w[0].match(kq),!w){Dt.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<w.length&&w[A]===void 0;A++);const Q=(" "+w[A]).slice(1),ne=(" "+w[A+1]).slice(1),oe=w[A+2]?(" "+w[A+2]).slice(1):null;switch(Q){case"BYTERANGE":T?x.setByteRange(ne,T):x.setByteRange(ne);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=ne,x.tagList.push(["PROGRAM-DATE-TIME",ne]),_===-1&&(_=c.length);break;case"PLAYLIST-TYPE":u.type&&Wr(u,Q,w),u.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Wr(u,Q,w):c.length>0&&m2(u,Q,w),p=u.startSN=parseInt(ne);break;case"SKIP":{u.skippedSegments&&Wr(u,Q,w);const Z=new Zt(ne,u),se=Z.decimalInteger("SKIPPED-SEGMENTS");if($e(se)){u.skippedSegments+=se;for(let q=se;q--;)c.push(null);p+=se}const j=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");j&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(j.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Wr(u,Q,w),u.targetduration=Math.max(parseInt(ne),1);break;case"VERSION":u.version!==null&&Wr(u,Q,w),u.version=parseInt(ne);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Wr(u,Q,w),u.live=!1;break;case"#":(ne||oe)&&x.tagList.push(oe?[ne,oe]:[ne]);break;case"DISCONTINUITY":y++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([Q]);break;case"BITRATE":x.tagList.push([Q,ne]),b=parseInt(ne)*1e3,$e(b)?x.bitrate=b:b=0;break;case"DATERANGE":{const Z=new Zt(ne,u),se=new Q_(Z,u.dateRanges[Z.ID],u.dateRangeTagCount);u.dateRangeTagCount++,se.isValid||u.skippedSegments?u.dateRanges[se.id]=se:Dt.warn(`Ignoring invalid DATERANGE tag: "${ne}"`),x.tagList.push(["EXT-X-DATERANGE",ne]);break}case"DEFINE":{{const Z=new Zt(ne,u);"IMPORT"in Z?yq(u,Z,a):i2(u,Z,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Wr(u,Q,w):c.length>0&&m2(u,Q,w),u.startCC=y=parseInt(ne);break;case"KEY":{const Z=l2(ne,t,u);if(Z.isSupported()){if(Z.method==="NONE"){R=void 0;break}R||(R={});const se=R[Z.keyFormat];se!=null&&se.matches(Z)||(se&&(R=Nt({},R)),R[Z.keyFormat]=Z)}else Dt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${ne}"`);break}case"START":u.startTimeOffset=c2(ne);break;case"MAP":{const Z=new Zt(ne,u);if(x.duration){const se=new Km(r,l);h2(se,Z,i,R),h=se,x.initSegment=h,h.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=h.rawProgramDateTime)}else{const se=x.byteRangeEndOffset;if(se){const j=x.byteRangeStartOffset;H=`${se-j}@${j}`}else H=null;h2(x,Z,i,R),h=x,D=!0}h.cc=y;break}case"SERVER-CONTROL":{P&&Wr(u,Q,w),P=new Zt(ne),u.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),u.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Wr(u,Q,w);const Z=new Zt(ne);u.partTarget=Z.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Z=u.partList;Z||(Z=u.partList=[]);const se=g>0?Z[Z.length-1]:void 0,j=g++,q=new Zt(ne,u),re=new yW(q,x,l,j,se);Z.push(re),x.duration+=re.duration;break}case"PRELOAD-HINT":{const Z=new Zt(ne,u);u.preloadHint=Z;break}case"RENDITION-REPORT":{const Z=new Zt(ne,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(Z);break}default:Dt.warn(`line parsed but not handled: ${w}`);break}}}T&&!T.relurl?(c.pop(),v-=T.duration,u.partList&&(u.fragmentHint=T)):u.partList&&(xv(x,T,d),x.cc=y,u.fragmentHint=x,R&&p2(x,R,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const N=c.length,G=c[0],X=c[N-1];if(v+=u.skippedSegments*u.targetduration,v>0&&N&&X){u.averagetargetduration=v/N;const te=X.sn;u.endSN=te!=="initSegment"?te:0,u.live||(X.endList=!0),_>0&&(Oq(c,_),G&&d.unshift(G))}return u.fragmentHint&&(v+=u.fragmentHint.duration),u.totalduration=v,d.length&&u.dateRangeTagCount&&G&&nL(d,u),u.endCC=y,u}}function nL(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];n.push(o),t++}else return;const i=n[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const l=e.dateRanges[s[o]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let c=t;c--;){var a;if(((a=n[c])==null?void 0:a.sn)<e.startSN)break;const d=Dq(e,u,n,c,r);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function Dq(n,e,t,i,r){const s=t[i];if(s){const o=s.programDateTime;if(e>=o||i===0){var a;const l=(((a=t[i+1])==null?void 0:a.start)||r)-s.start;if(e<=o+l*1e3){const u=t[i].sn-n.startSN;if(u<0)return-1;const c=n.fragments;if(c.length>t.length){const h=(t[i+1]||c[c.length-1]).sn-n.startSN;for(let p=h;p>u;p--){const g=c[p].programDateTime;if(e>=g&&e<g+c[p].duration*1e3)return p}}return u}}}return-1}function l2(n,e,t){var i,r;const s=new Zt(n,t),a=(i=s.METHOD)!=null?i:"",o=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(r=s.KEYFORMAT)!=null?r:"identity";o&&s.IV&&!l&&Dt.error(`Invalid IV: ${s.IV}`);const d=o?Er.resolve(o,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Vs(a,d,c,h,l,s.KEYID)}function c2(n){const t=new Zt(n).decimalFloatingPoint("TIME-OFFSET");return $e(t)?t:null}function d2(n,e){let t=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(s=>e1(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function f2(n,e,t){const i=e[t];i&&(n[t]=i)}function Oq(n,e){let t=n[e];for(let i=e;i--;){const r=n[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function xv(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function h2(n,e,t,i){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function p2(n,e,t){n.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(n)}function Wr(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function m2(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Jm(n,e){const t=e.startPTS;if($e(t)){let i=0,r;e.sn>n.sn?(i=t-n.start,r=n):(i=n.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function iL(n,e,t,i,r,s,a){i-t<=0&&(a.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let l=t,u=i;const c=e.startPTS,d=e.endPTS;if($e(c)){const b=Math.abs(c-t);n&&b>n.totalduration?a.warn(`media timestamps and playlist times differ by ${b}s for level ${e.level} ${n.url}`):$e(e.deltaPTS)?e.deltaPTS=Math.max(b,e.deltaPTS):e.deltaPTS=b,l=Math.max(t,c),t=Math.min(t,c),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,u=Math.min(i,d),i=Math.max(i,d),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=i,e.minEndPTS=u,e.endDTS=s;const p=e.sn;if(!n||p<n.startSN||p>n.endSN)return 0;let g;const v=p-n.startSN,y=n.fragments;for(y[v]=e,g=v;g>0;g--)Jm(y[g],y[g-1]);for(g=v;g<y.length-1;g++)Jm(y[g],y[g+1]);return n.fragmentHint&&Jm(y[y.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,h}function Nq(n,e,t){if(n===e)return;let i=null;const r=n.fragments;for(let c=r.length-1;c>=0;c--){const d=r[c].initSegment;if(d){i=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;Bq(n,e,(c,d,h,p)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const g=c.cc-d.cc;for(let v=h;v<p.length;v++)p[v].cc+=g;e.endCC=p[p.length-1].cc}$e(c.startPTS)&&$e(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(s=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,i=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(i&&o.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=i)==null?void 0:d.relurl))&&(c.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Mq(n.dateRanges,e,t));const c=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&xv(o[d],o[d-1],c);nL(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const c=aL(n,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:a[0].cc}Fq(n.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),s?iL(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):rL(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function Mq(n,e,t){const{dateRanges:i,recentlyRemovedDateranges:r}=e,s=Nt({},n);r&&r.forEach(l=>{delete s[l]});const o=Object.keys(s).length;return o?(Object.keys(i).forEach(l=>{const u=s[l],c=new Q_(i[l].attr,u);c.isValid?(s[l]=c,u||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Bt(i[l].attr)}"`)}),s):i}function Fq(n,e,t){if(n&&e){let i=0;for(let r=0,s=n.length;r<=s;r++){const a=n[r],o=e[r+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):i--}}}function Bq(n,e,t){const i=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(i?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=r;u<=s;u++){const c=l[a+u];let d=o[u];if(i&&!d&&c&&(d=e.fragments[u]=c),c&&d){t(c,d,u,o);const h=c.relurl,p=d.relurl;if(h&&Uq(h,p)){e.playlistParsingError=g2(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=g2(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function g2(n,e,t,i,r){return new Error(`${n} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function rL(n,e,t=!0){const i=e.startSN+e.skippedSegments-n.startSN,r=n.fragments,s=i>=0;let a=0;if(s&&i<r.length)a=r[i].start;else if(s&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(s&&t)a=n.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Sv(e,a)}function Sv(n,e){if(e){const t=n.fragments;for(let i=n.skippedSegments;i<t.length;i++)t[i].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function sL(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const i=n.fragments;if(i.length&&t*4>e){const s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function aL(n,e,t){if(!n)return null;let i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function v2(n,e,t){return n?oL(n.partList,e,t):null}function oL(n,e,t){if(n)for(let i=n.length;i--;){const r=n[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function uL(n){n.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Uq(n,e){return n!==e&&e?y2(n)!==y2(e):!1}function y2(n){return n.replace(/\?[^?]*$/,"")}function Ll(n,e){for(let i=0,r=n.length;i<r;i++){var t;if(((t=n[i])==null?void 0:t.cc)===e)return n[i]}return null}function Hq(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function E2(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function lL(n,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)E2(t[i],n);e.fragmentHint&&E2(e.fragmentHint,n),e.alignedSliding=!0}function zq(n,e){n&&(cL(e,n),e.alignedSliding||qf(e,n),!e.alignedSliding&&!e.skippedSegments&&rL(n,e,!1))}function cL(n,e){if(!Hq(e,n))return;const t=Math.min(e.endCC,n.endCC),i=Ll(e.fragments,t),r=Ll(n.fragments,t);if(!i||!r)return;Dt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=i.start-r.start;lL(s,n)}function qf(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(r=Ll(i,a),s=Ll(t,a)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=Ll(t,r.cc)||t[Math.floor(t.length/2)]);const o=r.programDateTime,l=s.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(s.start-r.start);lL(u,n)}function $n(n,e,t){ri(n,e,t),n.addEventListener(e,t)}function ri(n,e,t){n.removeEventListener(e,t)}const jq={toString:function(n){let e="";const t=n.length;for(let i=0;i<t;i++)e+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return e}},we={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class o1 extends Y_{constructor(e,t,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=we.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,h=vt.bufferInfo(u||l,d,a.maxBufferHole),p=!h.len;if(this.log(`Media seeking to ${$e(d)?d.toFixed(3):d}, state: ${c}, ${p?"out of":"in"} buffer`),this.state===we.ENDED)this.resetLoadingState();else if(o){const g=a.maxFragLookUpTolerance,v=o.start-g,y=o.start+o.duration+g;if(p||y<h.start||v>h.end){const b=d>y;(d<v||b)&&(b&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const v=Math.max(h.end,d),y=this.shouldLoadParts(this.getLevelDetails(),v);y&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${v.toFixed(2)}`),this.loadingParts=y)}}this.hls.hasEnoughToStart||(this.log(`Setting ${p?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,p&&(this.startPosition=d)),p&&this.state===we.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new gq(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new i1(e.config)}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===we.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=we.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=vt.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>r&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return vt.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;$n(i,"seeking",this.onMediaSeeking),$n(i,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===we.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ri(r,"seeking",this.onMediaSeeking),ri(r,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=we.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===we.FRAG_LOADING||!this.fragCurrent&&a===we.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=we.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(O.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===we.STOPPED||this.state===we.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===vn.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===vn.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(O.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:s,payload:a}=i,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Yo(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,s1(o.method)).catch(u=>{throw r.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const c=self.performance.now();return r.trigger(O.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:c}}),i.payload=u,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===we.STOPPED||this.state===we.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==we.STOPPED&&(this.state=we.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,r;const s=e.tracks;if(s&&!t.encrypted&&((i=s.audio)!=null&&i.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(O.ERROR,{type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?jq.toString(vt.getBuffered(i)):"(detached)"})`),an(e)){var r;if(e.type!==Xe.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=we.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=we.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new r1(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=we.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(O.KEY_LOADED,h),this.state===we.KEY_LOADING&&(this.state=we.IDLE),h}),this.hls.trigger(O.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(an(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(i=Math.max(e.start,i||0),this.loadingParts&&an(e)){const h=a.partList;if(h&&r){i>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const p=this.getNextPart(h,e,i);if(p>-1){const g=h[p];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${p}/${h.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=we.FRAG_LOADING;let v;return o?v=o.then(y=>!y||this.fragContextChanged(y.frag)?null:this.doFragPartsLoad(e,g,t,r)).catch(y=>this.handleFragLoadError(y)):v=this.doFragPartsLoad(e,g,t,r).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(O.FRAG_LOADING,{frag:e,part:g,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):v}else if(!e.url||this.loadedEndOfParts(h,i))return Promise.resolve(null)}}if(an(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),$e(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=we.FRAG_LOADING;const c=this.config.progressive&&e.type!==Xe.SUBTITLE;let d;return c&&o?d=o.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,r)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,c?r:void 0),o]).then(([h])=>(!c&&r&&r(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(O.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,i,r){return new Promise((s,a)=>{var o;const l=[],u=(o=i.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,r).then(h=>{l[d.index]=h;const p=h.part;this.hls.trigger(O.FRAG_LOADED,h);const g=v2(i.details,e.sn,d.index+1)||oL(u,e.sn,d.index+1);if(g)c(g);else return s({frag:e,part:p,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===fe.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===rt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(O.ERROR,t)}else this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==we.PARSING){!this.fragCurrent&&this.state!==we.STOPPED&&this.state!==we.ERROR&&(this.state=we.IDLE);return}const{frag:i,part:r,level:s}=t,a=self.performance.now();i.stats.parsing.end=a,r&&(r.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&i.sn>o.endSN||this.shouldLoadParts(o,i.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const s=e.partList[0];if(s.fragment.type===Xe.SUBTITLE)return!1;const a=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=a){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:a}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const o=t[r],l=o.details,u=a>-1?v2(l,s,a):null,c=u?u.fragment:aL(l,s,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,i,r,s){if(this.state!==we.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=Oi(a,o)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:t,part:i,chunkMeta:r,offset:c,parent:t.type,data:l};if(this.hls.trigger(O.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!vt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=vt.bufferInfo(t,i,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,r.end-a),i+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var i;const r=this.getLoadPosition();if(!$e(r))return null;const a=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,i,r){const s=vt.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,r);return vt.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),s=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Xe.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:s}=this,a=i[0].start,o=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=s.initialLiveManifestSize;if(r<d)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,p=this.hls.liveSyncPosition,g=l?(h!==-1&&h>=a?h:p)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${p} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=i[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(i[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===vn.OK||i===vn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&i.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(o!==null&&i.len+o.len>=s){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(b2(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(b2(this.config)&&e.type!==Xe.SUBTITLE){const i=this.hls.interstitialsManager,r=i==null?void 0:i.bufferingItem;if(r){const a=r.event;if(a){if(a.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=i==null?void 0:i.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,r>-1&&i<u.start)break;const c=u.loaded;c?r=-1:(s||(u.independent||a)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${u.start}`),r=o),s=c}return r}loadedEndOfParts(e,t){let i;for(let r=e.length;r--;){if(i=e[r],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=rq(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];i.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=q_(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=i;const{fragmentHint:l}=i,{maxFragLookUpTolerance:u}=r,c=i.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var p;const v=e<this.lastCurrentTime||e>t-u||(p=this.media)!=null&&p.paused||!this.startFragRequested?0:u;h=ja(s,a,e,v)}else h=a[a.length-1];if(h){const g=h.sn-i.startSN,v=this.fragmentTracker.getState(h);if((v===vn.OK||v===vn.PARTIAL&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!d||c[0].fragment.sn>h.sn||!i.live)&&h.level===s.level){const b=a[g+1];h.sn<o&&this.fragmentTracker.getState(b)!==vn.OK?h=b:h=null}}return h}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&$e(s);if(a||!o&&!s){zq(i,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const r=this.timelineOffset;if(i===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&$e(a)?(i=t+a,a<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&an(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==we.FRAG_LOADING_WAITING_RETRY)&&(this.state=we.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const b=this.getCurrentContext(t.chunkMeta);b&&(t.frag=b.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===fe.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction;if(!o){this.state=we.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=o,h=!!d,p=h&&l===Rn.RetryRequest,g=h&&!o.resolved&&u===mi.MoveAllAlternatesMatchingHost,v=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!p&&g&&an(r)&&!r.endList&&v&&!K_(t))this.resetFragmentErrors(e),this.treatAsGap(r),o.resolved=!0;else if((p||g)&&c<d.maxNumRetry){var y;const b=Ev((y=t.response)==null?void 0:y.code),T=n1(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+T,this.state=we.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,b){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${T}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&l!==Rn.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===Rn.SendAlternateToPenaltyBox?this.state=we.WAITING_LEVEL:this.state=we.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!Ev(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=we.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===we.PARSING||this.state===we.PARSED){const t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Xe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==we.STOPPED&&(this.state=we.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=vt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===we.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==we.STOPPED&&(this.state=we.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){const s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const h=r?0:iL(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(O.LEVEL_PTS_UPDATED,{details:s,level:i,drift:h,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((i.fragmentError===0||l&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=we.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(O.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Xe.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function b2(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class dL{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=Vq(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Vq(n,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}var eg={exports:{}},T2;function Gq(){return T2||(T2=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new r(c,d||l,h),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,p=d.length,g=new Array(p);h<p;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,h,p,g){var v=t?t+u:u;if(!this._events[v])return!1;var y=this._events[v],b=arguments.length,T,x;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),b){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,d),!0;case 4:return y.fn.call(y.context,c,d,h),!0;case 5:return y.fn.call(y.context,c,d,h,p),!0;case 6:return y.fn.call(y.context,c,d,h,p,g),!0}for(x=1,T=new Array(b-1);x<b;x++)T[x-1]=arguments[x];y.fn.apply(y.context,T)}else{var w=y.length,A;for(x=0;x<w;x++)switch(y[x].once&&this.removeListener(u,y[x].fn,void 0,!0),b){case 1:y[x].fn.call(y[x].context);break;case 2:y[x].fn.call(y[x].context,c);break;case 3:y[x].fn.call(y[x].context,c,d);break;case 4:y[x].fn.call(y[x].context,c,d,h);break;default:if(!T)for(A=1,T=new Array(b-1);A<b;A++)T[A-1]=arguments[A];y[x].fn.apply(y[x].context,T)}}return!0},o.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,h){var p=t?t+u:u;if(!this._events[p])return this;if(!c)return a(this,p),this;var g=this._events[p];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&a(this,p);else{for(var v=0,y=[],b=g.length;v<b;v++)(g[v].fn!==c||h&&!g[v].once||d&&g[v].context!==d)&&y.push(g[v]);y.length?this._events[p]=y.length===1?y[0]:y:a(this,p)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(eg)),eg.exports}var Wq=Gq(),u1=gW(Wq);const Vl="1.6.15",su={};function qq(){return typeof __HLS_WORKER_BUNDLE__=="function"}function $q(){const n=su[Vl];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return su[Vl]=r,r}function Kq(n){const e=su[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return su[n]=r,r}function Yq(n){const e=su[n||Vl];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete su[n||Vl],r&&self.URL.revokeObjectURL(r),i.terminate()}}function fL(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function l1(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Ch(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Gl(n,e){const t=e;let i=0;for(;l1(n,e);){i+=10;const r=Ch(n,e+6);i+=r,fL(n,e+10)&&(i+=10),e+=i}if(i>0)return n.subarray(t,t+i)}function Xq(n,e,t,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const p=new Error(`invalid ADTS sampling index:${a}`);n.emit(O.ERROR,O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}const o=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+o,c=r[a];let d=a;(o===5||o===29)&&(d-=3);const h=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return Dt.log(`manifest codec:${i}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:i}}function hL(n,e){return n[e]===255&&(n[e+1]&246)===240}function pL(n,e){return n[e+1]&1?7:9}function c1(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function Qq(n,e){return e+5<n.length}function $f(n,e){return e+1<n.length&&hL(n,e)}function Zq(n,e){return Qq(n,e)&&hL(n,e)&&c1(n,e)<=n.length-e}function Jq(n,e){if($f(n,e)){const t=pL(n,e);if(e+t>=n.length)return!1;const i=c1(n,e);if(i<=t)return!1;const r=e+i;return r===n.length||$f(n,r)}return!1}function mL(n,e,t,i,r){if(!n.samplerate){const s=Xq(e,t,i,r);if(!s)return;Nt(n,s)}}function gL(n){return 1024*9e4/n}function e$(n,e){const t=pL(n,e);if(e+t<=n.length){const i=c1(n,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function vL(n,e,t,i,r){const s=gL(n.samplerate),a=i+r*s,o=e$(e,t);let l;if(o){const{frameLength:d,headerLength:h}=o,p=h+d,g=Math.max(0,t+p-e.length);g?(l=new Uint8Array(p-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+p);const v={unit:l,pts:a};return g||n.samples.push(v),{sample:v,length:p,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function t$(n,e){return l1(n,e)&&Ch(n,e+6)+10<=n.length-e}function n$(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function tg(n,e=0,t=1/0){return i$(n,e,t,Uint8Array)}function i$(n,e,t,i){const r=r$(n);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const a=s$(n)?n.byteOffset:0,o=(a+n.byteLength)/s,l=(a+e)/s,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new i(r,u,c-u)}function r$(n){return n instanceof ArrayBuffer?n:n.buffer}function s$(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function a$(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=n.data.subarray(1).indexOf(0);if(i===-1)return;const r=bi(tg(n.data,1,i)),s=n.data[2+i],a=n.data.subarray(3+i).indexOf(0);if(a===-1)return;const o=bi(tg(n.data,3+i,a));let l;return r==="-->"?l=bi(tg(n.data,4+i+a)):l=n$(n.data.subarray(4+i+a)),e.mimeType=r,e.pictureType=s,e.description=o,e.data=l,e}function o$(n){if(n.size<2)return;const e=bi(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function u$(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const i=bi(n.data.subarray(t),!0);t+=i.length+1;const r=bi(n.data.subarray(t));return{key:n.type,info:i,data:r}}const e=bi(n.data.subarray(1));return{key:n.type,info:"",data:e}}function l$(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const i=bi(n.data.subarray(t),!0);t+=i.length+1;const r=bi(n.data.subarray(t));return{key:n.type,info:i,data:r}}const e=bi(n.data);return{key:n.type,info:"",data:e}}function c$(n){return n.type==="PRIV"?o$(n):n.type[0]==="W"?l$(n):n.type==="APIC"?a$(n):u$(n)}function d$(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Ch(n,4),i=10;return{type:e,size:t,data:n.subarray(i,i+t)}}const zd=10,f$=10;function yL(n){let e=0;const t=[];for(;l1(n,e);){const i=Ch(n,e+6);n[e+5]>>6&1&&(e+=zd),e+=zd;const r=e+i;for(;e+f$<r;){const s=d$(n.subarray(e)),a=c$(s);a&&t.push(a),e+=s.size+zd}fL(n,e)&&(e+=zd)}return t}function EL(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function h$(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function d1(n){const e=yL(n);for(let t=0;t<e.length;t++){const i=e[t];if(EL(i))return h$(i)}}let vi=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function mr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class f1{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=Oi(this.cachedData,e),this.cachedData=null);let i=Gl(e,0),r=i?i.length:0,s;const a=this._audioTrack,o=this._id3Track,l=i?d1(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&$e(l))&&(this.basePTS=p$(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:vi.audioId3,duration:Number.POSITIVE_INFINITY});r<u;){if(this.canParse(e,r)){const c=this.appendFrame(a,e,r);c?(this.frameIndex++,this.lastPTS=c.sample.pts,r+=c.length,s=r):r=u}else t$(e,r)?(i=Gl(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:vi.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===u&&s!==u){const c=e.slice(s);this.cachedData?this.cachedData=Oi(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:mr(),id3Track:o,textTrack:mr()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:mr(),id3Track:this._id3Track,textTrack:mr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const p$=(n,e,t)=>{if($e(n))return n*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let jd=null;const m$=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],g$=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],v$=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],y$=[0,1,1,4];function bL(n,e,t,i,r){if(t+24>e.length)return;const s=TL(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=i+r*a,l={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function TL(n,e){const t=n[e+1]>>3&3,i=n[e+1]>>1&3,r=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-i:i===3?3:4,u=m$[l*14+r-1]*1e3,d=g$[(t===3?0:t===2?1:2)*3+s],h=o===3?1:2,p=v$[t][i],g=y$[i],v=p*8*g,y=Math.floor(p*u/d+a)*g;if(jd===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);jd=x?parseInt(x[1]):0}return!!jd&&jd<=87&&i===2&&u>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:h,frameLength:y,samplesPerFrame:v}}}function h1(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function xL(n,e){return e+1<n.length&&h1(n,e)}function E$(n,e){return h1(n,e)&&4<=n.length-e}function SL(n,e){if(e+1<n.length&&h1(n,e)){const i=TL(n,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===n.length||xL(n,s)}return!1}class b$ extends f1{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Gl(e,0);let r=(i==null?void 0:i.length)||0;if(SL(e,r))return!1;for(let s=e.length;r<s;r++)if(Jq(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Zq(e,t)}appendFrame(e,t,i){mL(e,this.observer,t,i,e.manifestCodec);const r=vL(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const wL=(n,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=n[e];const o=Math.min(i,8),l=8-o;s[0]=4278190080>>>24+l<<l,r[0]=(a[0]&s[0])>>l,t=t?t<<o|r[0]:r[0],e+=1,i-=o}return t};class T$ extends f1{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=AL(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Gl(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&d1(t)!==void 0&&wL(e,i)<16}}function AL(n,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const p=(e[t+6]<<8|e[t+7])>>12-h&1,v=[2,1,2,3,3,4,4,5][d]+p,y=e[t+5]>>3,b=e[t+5]&7,T=new Uint8Array([s<<6|y<<1|b>>2,(b&3)<<6|d<<3|p<<2|l>>4,l<<4&224]),x=1536/o*9e4,w=i+r*x,A=e.subarray(t,t+c);return n.config=T,n.channelCount=v,n.samplerate=o,n.samples.push({unit:A,pts:w}),c}class x$ extends f1{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Gl(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&d1(t)!==void 0&&wL(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(SL(e,i))return Dt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return E$(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return bL(e,t,i,this.basePTS,this.frameIndex)}}const S$=/\/emsg[-/]ID3/i;class w${constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const s=this.videoTrack=mr("video",1),a=this.audioTrack=mr("audio",1),o=this.txtTrack=mr("text",1);if(this.id3Track=mr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=N_(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:h}=l.video;s.id=u,s.timescale=o.timescale=c,s.codec=d,s.supplemental=h}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;a.id=u,a.timescale=c,a.codec=d}o.id=k_.text,s.sampleDuration=0,s.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return TW(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Oi(this.remainderData,e));const o=RW(i);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=i;const a=this.extractID3Track(r,t);return s.samples=Uw(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=Uw(e,t),{videoTrack:t,audioTrack:mr(),id3Track:r,textTrack:mr()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=Tt(e.samples,["emsg"]);r&&r.forEach(s=>{const a=LW(s);if(S$.test(a.schemeIdUri)){const o=x2(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;i.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:vi.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=x2(a,t);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:vi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function x2(n,e){return $e(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class A${constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new i1(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ks.cbc)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){const a=B_(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}).catch(r)}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(i>=s.length);i++){const a=s[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,r,a),!this.decrypter.isSync()))return}}}}class CL{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const r=t.byteLength;let s=e.naluState||0;const a=s,o=[];let l=0,u,c,d,h=-1,p=0;for(s===-1&&(h=0,p=this.getNALuType(t,0),s=0,l=1);l<r;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(c=l-s-1,h>=0){const g={data:t.subarray(h,c),type:p};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),c>0&&(g.data=Oi(g.data,t.subarray(0,c)),g.state=0))}l<r?(d=this.getNALuType(t,l),h=l,p=d,s=0):s=-1}else s=0}if(h>=0&&s>=0){const g={data:t.subarray(h,r),type:p,state:s};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Oi(g.data,t))}return e.naluState=s,o}}class Pl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Dt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class C$ extends CL{parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let a=this.VideoSample,o,l=!1;i.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var c,d;switch(u.type){case 1:{let v=!1;o=!0;const y=u.data;if(l&&y.length>4){const b=this.readSliceType(y);(b===2||b===4||b===7||b===9)&&(v=!0)}if(v){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=v;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Jy(u.data,1,i.pts,t.samples);break}case 7:{var p,g;o=!0,l=!0;const v=u.data,y=this.readSPS(v);if(!e.sps||e.width!==y.width||e.height!==y.height||((p=e.pixelRatio)==null?void 0:p[0])!==y.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[v];const b=v.subarray(1,4);let T="avc1.";for(let x=0;x<3;x++){let w=b[x].toString(16);w.length<2&&(w="0"+w),T+=w}e.codec=T}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Pl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,s;for(let a=0;a<e;a++)r!==0&&(s=t.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){const t=new Pl(e);let i=0,r=0,s=0,a=0,o,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),p=t.readBoolean.bind(t),g=t.skipBits.bind(t),v=t.skipEG.bind(t),y=t.skipUEG.bind(t),b=this.skipScalingList.bind(this);c();const T=c();if(d(5),g(3),c(),y(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){const D=h();if(D===3&&g(1),y(),y(),g(1),p())for(l=D!==3?8:12,u=0;u<l;u++)p()&&(u<6?b(16,t):b(64,t))}y();const x=h();if(x===0)h();else if(x===1)for(g(1),v(),v(),o=h(),u=0;u<o;u++)v();y(),g(1);const w=h(),A=h(),R=d(1);R===0&&g(1),g(1),p()&&(i=h(),r=h(),s=h(),a=h());let _=[1,1];if(p()&&p())switch(c()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((w+1)*16-i*2-r*2),height:(2-R)*(A+1)*16-(R?2:4)*(s+a),pixelRatio:_}}}class I$ extends CL{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let a=this.VideoSample,o,l=!1;i.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Jy(u.data,2,i.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Nt(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const p=this.readSPS(u.data);e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.codec=p.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in p.params)e.params[g]=p.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const p=this.readPPS(u.data);for(const g in p)e.params[g]=p[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Pl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const t=new Pl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),p=t.readUByte(),g=t.readUByte(),v=t.readUByte(),y=t.readUByte(),b=t.readUByte(),T=[],x=[];for(let Qe=0;Qe<i;Qe++)T.push(t.readBoolean()),x.push(t.readBoolean());if(i>0)for(let Qe=i;Qe<8;Qe++)t.readBits(2);for(let Qe=0;Qe<i;Qe++)T[Qe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[Qe]&&t.readUByte();t.readUEG();const w=t.readUEG();w==3&&t.skipBits(1);const A=t.readUEG(),R=t.readUEG(),_=t.readBoolean();let D=0,H=0,P=0,N=0;_&&(D+=t.readUEG(),H+=t.readUEG(),P+=t.readUEG(),N+=t.readUEG());const G=t.readUEG(),X=t.readUEG(),te=t.readUEG(),Q=t.readBoolean();for(let Qe=Q?0:i;Qe<=i;Qe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let k=0;k<4;k++)for(let $=0;$<(k===3?2:6);$++)if(!t.readBoolean())t.readUEG();else{const Ee=Math.min(64,1<<4+(k<<1));k>1&&t.readEG();for(let _e=0;_e<Ee;_e++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const Z=t.readUEG();let se=0;for(let Qe=0;Qe<Z;Qe++){let k=!1;if(Qe!==0&&(k=t.readBoolean()),k){Qe===Z&&t.readUEG(),t.readBoolean(),t.readUEG();let $=0;for(let ue=0;ue<=se;ue++){const Ee=t.readBoolean();let _e=!1;Ee||(_e=t.readBoolean()),(Ee||_e)&&$++}se=$}else{const $=t.readUEG(),ue=t.readUEG();se=$+ue;for(let Ee=0;Ee<$;Ee++)t.readUEG(),t.readBoolean();for(let Ee=0;Ee<ue;Ee++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Qe=t.readUEG();for(let k=0;k<Qe;k++){for(let $=0;$<te+4;$++)t.readBits(1);t.readBits(1)}}let q=0,re=1,z=1,ve=!0,Le=1,Ce=0;t.readBoolean(),t.readBoolean();let Ae=!1;if(t.readBoolean()){if(t.readBoolean()){const Fe=t.readUByte(),Pe=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],dt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Fe>0&&Fe<16?(re=Pe[Fe-1],z=dt[Fe-1]):Fe===255&&(re=t.readBits(16),z=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ae=t.readBoolean(),Ae&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Le=t.readBits(32),Ce=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const dt=t.readBoolean(),mt=t.readBoolean();let he=!1;(dt||mt)&&(he=t.readBoolean(),he&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),he&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Se=0;Se<=i;Se++){ve=t.readBoolean();const qe=ve||t.readBoolean();let F=!1;qe?t.readEG():F=t.readBoolean();const M=F?1:t.readUEG()+1;if(dt)for(let W=0;W<M;W++)t.readUEG(),t.readUEG(),he&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(mt)for(let W=0;W<M;W++)t.readUEG(),t.readUEG(),he&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),q=t.readUEG())}let je=A,We=R;if(_){let Qe=1,k=1;w===1?Qe=k=2:w==2&&(Qe=2),je=A-Qe*H-Qe*D,We=R-k*N-k*P}const de=r?["A","B","C"][r]:"",Re=o<<24|l<<16|u<<8|c;let Ie=0;for(let Qe=0;Qe<32;Qe++)Ie=(Ie|(Re>>Qe&1)<<31-Qe)>>>0;let Ye=Ie.toString(16);return a===1&&Ye==="2"&&(Ye="6"),{codecString:`hvc1.${de}${a}.${Ye}.${s?"H":"L"}${b}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:r,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[d,h,p,g,v,y],general_level_idc:b,bit_depth:G+8,bit_depth_luma_minus8:G,bit_depth_chroma_minus8:X,min_spatial_segmentation_idc:q,chroma_format_idc:w,frame_rate:{fixed:ve,fps:Ce/Le}},width:je,height:We,pixelRatio:[re,z]}}readPPS(e){const t=new Pl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let a=1;return s&&r?a=0:s?a=3:r&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const xn=188;class Us{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){const i=Us.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(xn*5,t-xn)+1,r=0;for(;r<i;){let s=!1,a=-1,o=0;for(let l=r;l<t;l+=xn)if(e[l]===71&&(t-l===xn||e[l+xn]===71)){if(o++,a===-1&&(a=l,a!==0&&(i=Math.min(a+xn*99,e.length-xn)+1)),s||(s=wv(e,l)===0),s&&o>1&&(a===0&&o>2||l+xn>i))return a}else{if(o)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:k_[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Us.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Us.createTrack("audio",r),this._id3Track=Us.createTrack("id3"),this._txtTrack=Us.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,h=o.pid,p=l.pid,g=o.pesData,v=l.pesData,y=null,b=this.pmtParsed,T=this._pmtId,x=e.length;if(this.remainderData&&(e=Oi(this.remainderData,e),x=e.length,this.remainderData=null),x<xn&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const w=Math.max(0,Us.syncOffset(e));x-=(x-w)%xn,x<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let A=0;for(let _=w;_<x;_+=xn)if(e[_]===71){const D=!!(e[_+1]&64),H=wv(e,_),P=(e[_+3]&48)>>4;let N;if(P>1){if(N=_+5+e[_+4],N===_+xn)continue}else N=_+4;switch(H){case c:D&&(d&&(s=ko(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(N,_+xn)),d.size+=_+xn-N);break;case h:if(D){if(g&&(s=ko(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(N,_+xn)),g.size+=_+xn-N);break;case p:D&&(v&&(s=ko(v,this.logger))&&this.parseID3PES(l,s),v={data:[],size:0}),v&&(v.data.push(e.subarray(N,_+xn)),v.size+=_+xn-N);break;case 0:D&&(N+=e[N]+1),T=this._pmtId=R$(e,N);break;case T:{D&&(N+=e[N]+1);const G=_$(e,N,this.typeSupported,i,this.observer,this.logger);c=G.videoPid,c>0&&(a.pid=c,a.segmentCodec=G.segmentVideoCodec),h=G.audioPid,h>0&&(o.pid=h,o.segmentCodec=G.segmentAudioCodec),p=G.id3Pid,p>0&&(l.pid=p),y!==null&&!b&&(this.logger.warn(`MPEG-TS PMT found at ${_} after unknown PID '${y}'. Backtracking to sync byte @${w} to parse all TS packets.`),y=null,_=w-188),b=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=H;break}}else A++;A>0&&Av(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=v;const R={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(R),R}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,a=i.pesData,o=t.pesData,l=r.pesData;let u;if(a&&(u=ko(a,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,s,u,!0),i.pesData=null)):i.pesData=a,o&&(u=ko(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=ko(l,this.logger))?(this.parseID3PES(r,u),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new A$(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new C$:e==="hevc"&&(this.videoParser=new I$))}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const d=r.missing,h=r.sample.unit.byteLength;if(d===-1)s=Oi(r.sample.unit,s);else{const p=h-d;r.sample.unit.set(s.subarray(0,d),p),e.samples.push(r.sample),i=r.missing}}let a,o;for(a=i,o=s.length;a<o-1&&!$f(s,a);a++);if(a!==i){let d;const h=a<o-1;if(h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",Av(this.observer,new Error(d),h,this.logger),!h)return}mL(e,this.observer,s,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const d=gL(e.samplerate);l=r.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=vL(e,s,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!$f(s,a);a++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(xL(i,a)){const l=bL(e,i,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=i.length;let a=0,o=0,l;for(;o<s&&(l=AL(e,i,o,r,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Nt({},t,{type:this._videoTrack?vi.emsg:vi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function wv(n,e){return((n[e+1]&31)<<8)+n[e+2]}function R$(n,e){return(n[e+10]&31)<<8|n[e+11]}function _$(n,e,t,i,r,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=wv(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!i){ng("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!i){ng("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!i){ng("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let h=e+5,p=d;for(;p>2;){switch(n[h]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const v=n[h+1]+2;h+=v,p-=v}}break;case 194:case 135:return Av(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return a}function Av(n,e,t,i){i.warn(`parsing error: ${e.message}`),n.emit(O.ERROR,O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function ng(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function ko(n,e){let t=0,i,r,s,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Oi(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>n.size-6)return null;const c=i[7];c&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,c&64?(o=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=i[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const h=new Uint8Array(n.size);for(let p=0,g=l.length;p<g;p++){i=l[p];let v=i.byteLength;if(d)if(d>v){d-=v;continue}else i=i.subarray(d),v-=d,d=0;h.set(i,t),t+=v}return r&&(r-=s+3),{data:h,pts:a,dts:o,len:r}}return null}class L${static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ks=Math.pow(2,32)-1;class ce{static init(){ce.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in ce.types)ce.types.hasOwnProperty(e)&&(ce.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ce.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);ce.STTS=ce.STSC=ce.STCO=s,ce.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ce.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),ce.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),ce.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);ce.FTYP=ce.box(ce.types.ftyp,a,l,a,o),ce.DINF=ce.box(ce.types.dinf,ce.box(ce.types.dref,r))}static box(e,...t){let i=8,r=t.length;const s=r;for(;r--;)i+=t[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),r=0,i=8;r<s;r++)a.set(t[r],i),i+=t[r].byteLength;return a}static hdlr(e){return ce.box(ce.types.hdlr,ce.HDLR_TYPES[e])}static mdat(e){return ce.box(ce.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(ks+1)),r=Math.floor(t%(ks+1));return ce.box(ce.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return ce.box(ce.types.mdia,ce.mdhd(e.timescale||0,e.duration||0),ce.hdlr(e.type),ce.minf(e))}static mfhd(e){return ce.box(ce.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?ce.box(ce.types.minf,ce.box(ce.types.smhd,ce.SMHD),ce.DINF,ce.stbl(e)):ce.box(ce.types.minf,ce.box(ce.types.vmhd,ce.VMHD),ce.DINF,ce.stbl(e))}static moof(e,t,i){return ce.box(ce.types.moof,ce.mfhd(e),ce.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=ce.trak(e[t]);return ce.box.apply(null,[ce.types.moov,ce.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(ce.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=ce.trex(e[t]);return ce.box.apply(null,[ce.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(ks+1)),r=Math.floor(t%(ks+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ce.box(ce.types.mvhd,s)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return ce.box(ce.types.sdtp,i)}static stbl(e){return ce.box(ce.types.stbl,ce.stsd(e),ce.box(ce.types.stts,ce.STTS),ce.box(ce.types.stsc,ce.STSC),ce.box(ce.types.stsz,ce.STSZ),ce.box(ce.types.stco,ce.STCO))}static avc1(e){let t=[],i=[],r,s,a;for(r=0;r<e.sps.length;r++)s=e.sps[r],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],a=s.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(s));const o=ce.box(ce.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return ce.box(ce.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,ce.box(ce.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ce.box(ce.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return ce.box(ce.types.mp4a,ce.audioStsd(e),ce.box(ce.types.esds,ce.esds(e)))}static mp3(e){return ce.box(ce.types[".mp3"],ce.audioStsd(e))}static ac3(e){return ce.box(ce.types["ac-3"],ce.audioStsd(e),ce.box(ce.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return ce.box(ce.types.stsd,ce.STSD,ce.mp4a(e));if(t==="ac3"&&e.config)return ce.box(ce.types.stsd,ce.STSD,ce.ac3(e));if(t==="mp3"&&e.codec==="mp3")return ce.box(ce.types.stsd,ce.STSD,ce.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return ce.box(ce.types.stsd,ce.STSD,ce.avc1(e));if(t==="hevc"&&e.vps)return ce.box(ce.types.stsd,ce.STSD,ce.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,a=Math.floor(i/(ks+1)),o=Math.floor(i%(ks+1));return ce.box(ce.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const i=ce.sdtp(e),r=e.id,s=Math.floor(t/(ks+1)),a=Math.floor(t%(ks+1));return ce.box(ce.types.traf,ce.box(ce.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),ce.box(ce.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),ce.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,ce.box(ce.types.trak,ce.tkhd(e),ce.mdia(e))}static trex(e){const t=e.id;return ce.box(ce.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,s=12+16*r,a=new Uint8Array(s);let o,l,u,c,d,h;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<r;o++)l=i[o],u=l.duration,c=l.size,d=l.flags,h=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return ce.box(ce.types.trun,a)}static initSegment(e){ce.types||ce.init();const t=ce.moov(e);return Oi(ce.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let a=s.length;for(let g=0;g<i.length;g+=1){a+=3;for(let v=0;v<i[g].length;v+=1)a+=2+i[g][v].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const l=i.length-1;for(let g=0;g<i.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,i[g].length]),a),a+=3;for(let v=0;v<i[g].length;v+=1)o.set(new Uint8Array([i[g][v].length>>8,i[g][v].length&255]),a),a+=2,o.set(i[g][v],a),a+=i[g][v].length}const u=ce.box(ce.types.hvcC,o),c=e.width,d=e.height,h=e.pixelRatio[0],p=e.pixelRatio[1];return ce.box(ce.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,ce.box(ce.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ce.box(ce.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,p>>24,p>>16&255,p>>8&255,p&255])))}}ce.types=void 0;ce.HDLR_TYPES=void 0;ce.STTS=void 0;ce.STSC=void 0;ce.STCO=void 0;ce.STSZ=void 0;ce.VMHD=void 0;ce.SMHD=void 0;ce.STSD=void 0;ce.FTYP=void 0;ce.DINF=void 0;const IL=9e4;function p1(n,e,t=1,i=!1){const r=n*e*t;return i?Math.round(r):r}function P$(n,e,t=1,i=!1){return p1(n,e,1/t,i)}function dl(n,e=!1){return p1(n,1e3,1/IL,e)}function k$(n,e=1){return p1(n,IL,1/e)}function S2(n){const{baseTime:e,timescale:t,trackId:i}=n;return`${e/t} (${e}/${t}) trackId: ${i}`}const D$=10*1e3,O$=1024,N$=1152,M$=1536;let Do=null,ig=null;function w2(n,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class gf extends Mi{constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Do===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Do=a?parseInt(a[1]):0}if(ig===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);ig=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&S2(t)} > ${e&&S2(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,r=e.reduce((s,a)=>{let o=a.pts,l=o-s;return l<-4294967296&&(t=!0,o=gi(o,i),l=o-s),l>0?s:o},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,s,a,o,l){let u,c,d,h,p,g,v=s,y=s;const b=e.pid>-1,T=t.pid>-1,x=t.samples.length,w=e.samples.length>0,A=o&&x>0||x>1;if((!b||w)&&(!T||A)||this.ISGenerated||o){if(this.ISGenerated){var _,D,H,P;const te=this.videoTrackConfig;(te&&(t.width!==te.width||t.height!==te.height||((_=t.pixelRatio)==null?void 0:_[0])!==((D=te.pixelRatio)==null?void 0:D[0])||((H=t.pixelRatio)==null?void 0:H[1])!==((P=te.pixelRatio)==null?void 0:P[1]))||!te&&A||this.nextAudioTs===null&&w)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,a));const N=this.isVideoContiguous;let G=-1,X;if(A&&(G=F$(t.samples),!N&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,G>0){this.warn(`Dropped ${G} out of ${x} video samples due to a missing keyframe`);const te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(G),t.dropped+=G,y+=(t.samples[0].pts-te)/t.inputTimeScale,X=y}else G===-1&&(this.warn(`No keyframe found out of ${x} video samples`),g=!1);if(this.ISGenerated){if(w&&A){const te=this.getVideoStartPts(t.samples),ne=(gi(e.samples[0].pts,te)-te)/t.inputTimeScale;v+=Math.max(0,ne),y+=Math.max(0,-ne)}if(w){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),c=this.remuxAudio(e,v,this.isAudioContiguous,a,T||A||l===Xe.AUDIO?y:void 0),A){const te=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),u=this.remuxVideo(t,y,N,te)}}else A&&(u=this.remuxVideo(t,y,N,0));u&&(u.firstKeyFrame=G,u.independent=G!==-1,u.firstKeyFramePTS=X)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(p=RL(i,s,this._initPTS,this._initDTS)),r.samples.length&&(h=_L(r,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:h,id3:p}}computeInitPts(e,t,i,r){const s=Math.round(i*t);let a=gi(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${r}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,i,r){const s=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||r,d="audio/mp4",h,p,g,v=-1;if(c&&(h=p=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):ce.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(v=e.id,g=e.inputTimeScale,!u||g!==u.timescale?h=p=this.computeInitPts(s[0].pts,g,i,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ce.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(v=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const y=this.getVideoStartPts(a),b=gi(a[0].dts,y),T=this.computeInitPts(b,g,i,"video"),x=this.computeInitPts(y,g,i,"video");p=Math.min(p,T),h=Math.min(h,x)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${h/g} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${h/g} (${h}/${g}) trackId: ${v}`),this._initPTS={baseTime:h,timescale:g,trackId:v},this._initDTS={baseTime:p,timescale:g,trackId:v}):h=g=void 0,{tracks:l,initPTS:h,timescale:g,trackId:v}}remuxVideo(e,t,i,r){const s=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS,c=u.baseTime*s/u.timescale;let d=this.nextVideoTs,h=8,p=this.videoSampleDuration,g,v,y=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,T=!1;if(!i||d===null){const q=c+t*s,re=a[0].pts-gi(a[0].dts,a[0].pts);Do&&d!==null&&Math.abs(q-re-(d+c))<15e3?i=!0:d=q-re-c}const x=d+c;for(let q=0;q<l;q++){const re=a[q];re.pts=gi(re.pts,x),re.dts=gi(re.dts,x),re.dts<a[q>0?q-1:q].dts&&(T=!0)}T&&a.sort(function(q,re){const z=q.dts-re.dts,ve=q.pts-re.pts;return z||ve}),g=a[0].dts,v=a[a.length-1].dts;const w=v-g,A=w?Math.round(w/(l-1)):p||e.inputTimeScale/30;if(i){const q=g-x,re=q>A,z=q<-1;if((re||z)&&(re?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${dl(q,!0)} ms (${q}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${dl(-q,!0)} ms (${q}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!z||x>=a[0].pts||Do)){g=x;const ve=a[0].pts-q;if(re)a[0].dts=g,a[0].pts=ve;else{let Le=!0;for(let Ce=0;Ce<a.length&&!(a[Ce].dts>ve&&Le);Ce++){const Ae=a[Ce].pts;if(a[Ce].dts-=q,a[Ce].pts-=q,Ce<a.length-1){const ke=a[Ce+1].pts,je=a[Ce].pts,We=ke<=je,de=ke<=Ae;Le=We==de}}}this.log(`Video: Initial PTS/DTS adjusted: ${dl(ve,!0)}/${dl(g,!0)}, delta: ${dl(q,!0)} ms`)}}g=Math.max(0,g);let R=0,_=0,D=g;for(let q=0;q<l;q++){const re=a[q],z=re.units,ve=z.length;let Le=0;for(let Ce=0;Ce<ve;Ce++)Le+=z[Ce].data.length;_+=Le,R+=ve,re.length=Le,re.dts<D?(re.dts=D,D+=A/4|0||1):D=re.dts,y=Math.min(re.pts,y),b=Math.max(re.pts,b)}v=a[l-1].dts;const H=_+4*R+8;let P;try{P=new Uint8Array(H)}catch(q){this.observer.emit(O.ERROR,O.ERROR,{type:rt.MUX_ERROR,details:fe.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:H,reason:`fail allocating video mdat ${H}`});return}const N=new DataView(P.buffer);N.setUint32(0,H),P.set(ce.types.mdat,4);let G=!1,X=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,ne=Number.NEGATIVE_INFINITY;for(let q=0;q<l;q++){const re=a[q],z=re.units;let ve=0;for(let Ae=0,ke=z.length;Ae<ke;Ae++){const je=z[Ae],We=je.data,de=je.data.byteLength;N.setUint32(h,de),h+=4,P.set(We,h),h+=de,ve+=4+de}let Le;if(q<l-1)p=a[q+1].dts-re.dts,Le=a[q+1].pts-re.pts;else{const Ae=this.config,ke=q>0?re.dts-a[q-1].dts:A;if(Le=q>0?re.pts-a[q-1].pts:A,Ae.stretchShortVideoTrack&&this.nextAudioTs!==null){const je=Math.floor(Ae.maxBufferHole*s),We=(r?y+r*s:this.nextAudioTs+c)-re.pts;We>je?(p=We-ke,p<0?p=ke:G=!0,this.log(`It is approximately ${We/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=ke}else p=ke}const Ce=Math.round(re.pts-re.dts);X=Math.min(X,p),Q=Math.max(Q,p),te=Math.min(te,Le),ne=Math.max(ne,Le),o.push(w2(re.key,p,ve,Ce))}if(o.length){if(Do){if(Do<70){const q=o[0].flags;q.dependsOn=2,q.isNonSync=0}}else if(ig&&ne-te<Q-X&&A/Q<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let q=g;for(let re=0,z=o.length;re<z;re++){const ve=q+o[re].duration,Le=q+o[re].cts;if(re<z-1){const Ce=ve+o[re+1].cts;o[re].duration=Ce-Le}else o[re].duration=re?o[re-1].duration:A;o[re].cts=0,q=ve}}}p=G||!p?A:p;const oe=v+p;this.nextVideoTs=d=oe-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const j={data1:ce.moof(e.sequenceNumber++,g,Nt(e,{samples:o})),data2:P,startPTS:(y-c)/s,endPTS:(b+p-c)/s,startDTS:(g-c)/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,j}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return N$;case"ac3":return M$;default:return O$}}remuxAudio(e,t,i,r,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,p=[],g=s!==void 0;let v=e.samples,y=h?0:8,b=this.nextAudioTs||-1;const T=d.baseTime*a/d.timescale,x=T+t*a;if(this.isAudioContiguous=i=i||v.length&&b>0&&(r&&Math.abs(x-(b+T))<9e3||Math.abs(gi(v[0].pts,x)-(b+T))<20*c),v.forEach(function(ne){ne.pts=gi(ne.pts,x)}),!i||b<0){const ne=v.length;if(v=v.filter(oe=>oe.pts>=0),ne!==v.length&&this.warn(`Removed ${v.length-ne} of ${ne} samples (initPTS ${T} / ${a})`),!v.length)return;s===0?b=0:r&&!g?b=Math.max(0,x-T):b=v[0].pts-T}if(e.segmentCodec==="aac"){const ne=this.config.maxAudioFramesDrift;for(let oe=0,Z=b+T;oe<v.length;oe++){const se=v[oe],j=se.pts,q=j-Z,re=Math.abs(1e3*q/a);if(q<=-ne*c&&g)oe===0&&(this.warn(`Audio frame @ ${(j/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*q/a)} ms.`),this.nextAudioTs=b=j-T,Z=j);else if(q>=ne*c&&re<D$&&g){let z=Math.round(q/c);for(Z=j-z*c;Z<0&&z&&c;)z--,Z+=c;oe===0&&(this.nextAudioTs=b=Z-T),this.warn(`Injecting ${z} audio frames @ ${((Z-T)/a).toFixed(3)}s due to ${Math.round(1e3*q/a)} ms gap.`);for(let ve=0;ve<z;ve++){let Le=L$.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Le||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Le=se.unit.subarray()),v.splice(oe,0,{unit:Le,pts:Z}),Z+=c,oe++}}se.pts=Z,Z+=c}}let w=null,A=null,R,_=0,D=v.length;for(;D--;)_+=v[D].unit.byteLength;for(let ne=0,oe=v.length;ne<oe;ne++){const Z=v[ne],se=Z.unit;let j=Z.pts;if(A!==null){const re=p[ne-1];re.duration=Math.round((j-A)/l)}else if(i&&e.segmentCodec==="aac"&&(j=b+T),w=j,_>0){_+=y;try{R=new Uint8Array(_)}catch(re){this.observer.emit(O.ERROR,O.ERROR,{type:rt.MUX_ERROR,details:fe.REMUX_ALLOC_ERROR,fatal:!1,error:re,bytes:_,reason:`fail allocating audio mdat ${_}`});return}h||(new DataView(R.buffer).setUint32(0,_),R.set(ce.types.mdat,4))}else return;R.set(se,y);const q=se.byteLength;y+=q,p.push(w2(!0,u,q,0)),A=j}const H=p.length;if(!H)return;const P=p[p.length-1];b=A-T,this.nextAudioTs=b+l*P.duration;const N=h?new Uint8Array(0):ce.moof(e.sequenceNumber++,w/l,Nt({},e,{samples:p}));e.samples=[];const G=(w-T)/a,X=this.nextAudioTs/a,Q={data1:N,data2:R,startPTS:G,endPTS:X,startDTS:G,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:H};return this.isAudioContiguous=!0,Q}}function gi(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function F$(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function RL(n,e,t,i){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const l=n.samples[o];l.pts=gi(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=gi(l.dts-i.baseTime*s/i.timescale,e*s)/s}const a=n.samples;return n.samples=[],{samples:a}}function _L(n,e,t){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let a=0;a<i;a++){const o=n.samples[a];o.pts=gi(o.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((a,o)=>a.pts-o.pts);const s=n.samples;return n.samples=[],{samples:s}}class B$ extends Mi{constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=N_(e);if(t)AW(e,t);else{const l=s||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(i=A2(s,Ft.AUDIO,this)),a&&(r=A2(a,Ft.VIDEO,this));const o={};s&&a?o.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?o.audio={container:"audio/mp4",codec:i,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,i,r,s,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};$e(c)||(c=this.lastEndTime=s||0);const h=t.samples;if(!h.length)return d;const p={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);const v=IW(h,g,this),y=g.audio?v[g.audio.id]:null,b=g.video?v[g.video.id]:null,T=Vd(b,1/0),x=Vd(y,1/0),w=Vd(b,0,!0),A=Vd(y,0,!0);let R=s,_=0;const D=y&&(!b||!u&&x<T||u&&u.trackId===g.audio.id),H=D?y:b;if(H){const Z=H.timescale,se=H.start-s*Z,j=D?g.audio.id:g.video.id;R=H.start/Z,_=D?A-x:w-T,(a||!u)&&(U$(u,R,s,_)||Z!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${se/Z} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${R-s} (${se}/${Z}) trackId: ${j}`),u=null,p.initPTS=se,p.timescale=Z,p.trackId=j)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);u?(p.initPTS=u.baseTime,p.timescale=u.timescale,p.trackId=u.trackId):((!p.timescale||p.trackId===void 0||p.initPTS===void 0)&&(this.warn("Could not set initPTS"),p.initPTS=R,p.timescale=1,p.trackId=-1),this.initPTS=u={baseTime:p.initPTS,timescale:p.timescale,trackId:p.trackId});const P=R-u.baseTime/u.timescale,N=P+_;_>0?this.lastEndTime=N:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const G=!!g.audio,X=!!g.video;let te="";G&&(te+="audio"),X&&(te+="video");const Q=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),ne={data1:h,startPTS:P,startDTS:P,endPTS:N,endDTS:N,type:te,hasAudio:G,hasVideo:X,nb:1,dropped:0,encrypted:Q};d.audio=G&&!X?ne:void 0,d.video=X?ne:void 0;const oe=b==null?void 0:b.sampleCount;if(oe){const Z=b.keyFrameIndex,se=Z!==-1;ne.nb=oe,ne.dropped=Z===0||this.isVideoContiguous?0:se?Z:oe,ne.independent=se,ne.firstKeyFrame=Z,se&&b.keyFrameStart&&(ne.firstKeyFramePTS=(b.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=se),this.isVideoContiguous||(this.isVideoContiguous=se),ne.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Z}/${oe} dropped: ${ne.dropped} start: ${ne.firstKeyFramePTS||"NA"}`)}return d.initSegment=p,d.id3=RL(i,s,u,u),r.samples.length&&(d.text=_L(r,s,u)),d}}function Vd(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function U$(n,e,t,i){if(n===null)return!0;const r=Math.max(i,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>r}function A2(n,e,t){const i=n.codec;return i&&i.length>4?i:e===Ft.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Uf(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Yr;try{Yr=self.performance.now.bind(self.performance)}catch{Yr=Date.now}const vf=[{demux:w$,remux:B$},{demux:Us,remux:gf},{demux:b$,remux:gf},{demux:x$,remux:gf}];vf.splice(2,0,{demux:T$,remux:gf});class C2{constructor(e,t,i,r,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const s=i.transmuxing;s.executeStart=Yr();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:p,initSegmentChange:g}=r||o,{audioCodec:v,videoCodec:y,defaultInitPts:b,duration:T,initSegmentData:x}=l,w=H$(a,t);if(w&&Yo(w.method)){const D=this.getDecrypter(),H=s1(w.method);if(D.isSync()){let P=D.softwareDecrypt(a,w.key.buffer,w.iv.buffer,H);if(i.part>-1){const G=D.flush();P=G&&G.buffer}if(!P)return s.executeEnd=Yr(),rg(i);a=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=D.webCryptoDecrypt(a,w.key.buffer,w.iv.buffer,H).then(P=>{const N=this.push(P,null,i);return this.decryptionPromise=null,N}),this.decryptionPromise}const A=this.needsProbing(c,d);if(A){const D=this.configureTransmuxer(a);if(D)return this.logger.warn(`[transmuxer] ${D.message}`),this.observer.emit(O.ERROR,O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message}),s.executeEnd=Yr(),rg(i)}(c||d||g||A)&&this.resetInitSegment(x,v,y,T,t),(c||g||A)&&this.resetInitialTimestamp(b),u||this.resetContiguity();const R=this.transmux(a,w,p,h,i);this.asyncResult=Wl(R);const _=this.currentTransmuxState;return _.contiguous=!0,_.discontinuity=!1,_.trackSwitch=!1,s.executeEnd=Yr(),R}flush(e){const t=e.transmuxing;t.executeStart=Yr();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=r;if(i){const d=i.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Yr();const d=[rg(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(o);return Wl(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Xe.MAIN?"level":"track"} ${i.level}`);const c=this.remuxer.remux(r,s,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=Yr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,i,r),o.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,r,s):a=this.transmuxUnencrypted(e,i,r,s),a}transmuxUnencrypted(e,t,i,r){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r}=this;let s;for(let d=0,h=vf.length;d<h;d++){var a;if((a=vf[d].demux)!=null&&a.probe(e,this.logger)){s=vf[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(i,t,r,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(i,t,r,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new i1(this.config)),e}}function H$(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const rg=n=>({remuxResult:{},chunkMeta:n});function Wl(n){return"then"in n&&n.then instanceof Function}class z${constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class j${constructor(e,t,i,r,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=a}}let I2=0;class LL{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=I2++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===O.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new u1,this.observer.on(O.FRAG_DECRYPTED,a),this.observer.on(O.ERROR,a);const o=jw(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||qq()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Kq(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=$q());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Bt(s)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new C2(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new C2(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=I2++;const t=this.hls.config,i=jw(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Bt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Yq(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,s,a,o,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{instanceNo:p,transmuxer:g}=this,v=a?a.start:s.start,y=s.decryptdata,b=this.frag,T=!(b&&s.cc===b.cc),x=!(b&&u.level===b.level),w=b?u.sn-b.sn:-1,A=this.part?u.part-this.part.index:-1,R=w===0&&u.id>1&&u.id===(b==null?void 0:b.stats.chunkCount),_=!x&&(w===1||w===0&&(A===1||R&&A<=0)),D=self.performance.now();(x||w||s.stats.parsing.start===0)&&(s.stats.parsing.start=D),a&&(A||!_)&&(a.stats.parsing.start=D);const H=!(b&&((d=s.initSegment)==null?void 0:d.url)===((h=b.initSegment)==null?void 0:h.url)),P=new j$(T,_,l,x,v,H);if(!_||T||H){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===Xe.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${T}
        trackSwitch: ${x}
        contiguous: ${_}
        accurateTimeOffset: ${l}
        timeOffset: ${v}
        initSegmentChange: ${H}`);const N=new z$(i,r,t,o,c);this.configureTransmuxer(N)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:p,cmd:"demux",data:e,decryptdata:y,chunkMeta:u,state:P},e instanceof ArrayBuffer?[e]:[]);else if(g){const N=g.push(e,y,u,P);Wl(N)?N.then(G=>{this.handleTransmuxComplete(G)}).catch(G=>{this.transmuxerError(G,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(N)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);Wl(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const R2=100;class V$ extends o1{constructor(e,t,i){super(e,t,i,"audio-stream-controller",Xe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:a}){if(i===Xe.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:s,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${r/s} (${r}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===we.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===we.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const s=(r||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=q_(a,s,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===we.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=we.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(R2),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=we.IDLE):this.state=we.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case we.IDLE:this.doTickIdle();break;case we.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e==null?void 0:e[t],r=i==null?void 0:i.details;if(r&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(r))break;this.state=we.WAITING_INIT_PTS}break}case we.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case we.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:r,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=we.FRAG_LOADING;const o=r.flush().buffer,l={frag:t,part:i,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),s&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=we.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:r,trackId:s}=this,a=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[s]))return;const o=i[s],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=we.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Ft.AUDIO,Xe.AUDIO));const c=this.getFwdBufferInfo(u,Xe.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(O.BUFFER_EOS,{type:"audio"}),this.state=we.ENDED;return}const d=c.len,h=t.maxBufferLength,p=l.fragments,g=p[0].start,v=this.getLoadPosition(),y=this.flushing?v:c.end;if(this.switchingTrack&&r){const x=v;l.PTSKnown&&x<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=g+.05)}if(d>=h&&!this.switchingTrack&&y<p[p.length-1].start)return;let b=this.getNextFragment(y,l);if(b&&this.isLoopLoading(b,y)&&(b=this.getNextFragmentLoopLoading(b,l,c,Xe.MAIN,h)),!b){this.bufferFlushed=!0;return}let T=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&T&&an(b)&&!b.endList&&(!l.live||!this.loadingParts&&y<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(T)===vn.OK&&(this.mainFragLoading=T=null),T&&an(T))){if(b.start>T.end){const w=this.fragmentTracker.getFragAtPos(y,Xe.MAIN);w&&w.end>T.end&&(T=w,this.mainFragLoading={frag:w,targetBufferTime:null})}if(b.start>T.end)return}this.loadFragment(b,o,y)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new jl(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==we.STOPPED&&(this.setInterval(R2),this.state=we.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(O.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:r}=this,{details:s,id:a,groupId:o,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==we.STOPPED&&(this.state=we.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=r[a];let d=0;if(s.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var h;d=this.alignPlaylists(s,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}s.alignedSliding||(cL(s,u),s.alignedSliding||qf(s,u),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(O.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===we.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=we.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new LL(this.hls,Xe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const p=this.initPTS[i.cc],g=(t=i.initSegment)==null?void 0:t.data;if(p!==void 0){const y=r?r.index:-1,b=y!==-1,T=new r1(i.level,i.sn,i.stats.chunkCount,s.byteLength,y,b);h.push(s,g,d,"",i,r,c.totalduration,!1,T,p)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:v}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new dL,complete:!1};v.push(new Uint8Array(s)),this.state!==we.STOPPED&&(this.state=we.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Xe.MAIN&&an(t.frag)&&(this.mainFragLoading=t,this.state===we.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==Xe.AUDIO){!this.audioOnly&&i.type===Xe.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(an(i)){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(O.AUDIO_TRACK_SWITCHED,kt({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=we.ERROR;return}switch(t.details){case fe.FRAG_GAP:case fe.FRAG_PARSING_ERROR:case fe.FRAG_DECRYPT_ERROR:case fe.FRAG_LOAD_ERROR:case fe.FRAG_LOAD_TIMEOUT:case fe.KEY_LOAD_ERROR:case fe.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xe.AUDIO,t);break;case fe.AUDIO_TRACK_LOAD_ERROR:case fe.AUDIO_TRACK_LOAD_TIMEOUT:case fe.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===we.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===wt.AUDIO_TRACK&&(this.state=we.IDLE);break;case fe.BUFFER_ADD_CODEC_ERROR:case fe.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case fe.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case fe.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ft.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ft.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===we.ENDED&&(this.state=we.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,Xe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:h,text:p,id3:g,initSegment:v}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=we.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),v!=null&&v.tracks){const y=l.initSegment||l;if(this.unhandledEncryptionError(v,l))return;this._bufferInitSegment(c,v.tracks,y,a),r.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:i,tracks:v.tracks})}if(h){const{startPTS:y,endPTS:b,startDTS:T,endDTS:x}=h;u&&(u.elementaryStreams[Ft.AUDIO]={startPTS:y,endPTS:b,startDTS:T,endDTS:x}),l.setElementaryStreamInfo(Ft.AUDIO,y,b,T,x),this.bufferFragmentData(h,l,u,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const y=Nt({id:i,frag:l,details:d},g);r.trigger(O.FRAG_PARSING_METADATA,y)}if(p){const y=Nt({id:i,frag:l,details:d},p);r.trigger(O.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,i,r){if(this.state!==we.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Xe.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(O.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:o};this.hls.trigger(O.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===vn.NOT_LOADED||r===vn.PARTIAL){var s;if(!an(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=we.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&qf(t.details,a)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;Ba({name:t,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o},e,Ca)||(zf(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(O.AUDIO_TRACK_SWITCHED,kt({},e))}}class m1 extends Mi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let a=0;a<r.length;a++){const o=r[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){s=a;break}else l===e.substring(0,l.length)&&(s=a)}if(s!==-1){const a=r[s],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=i&&Vw(i);return new Gw(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:r,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;r.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const c=Math.max(l||0,0);r.appliedTimelineOffset=c,r.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(r.live||i!=null&&i.live){const c="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){Nq(i,r,this);const T=r.playlistParsingError;if(T){this.warn(T);const x=this.hls;if(!x.config.ignorePlaylistParsingErrors){var u;const{networkDetails:w}=t;x.trigger(O.ERROR,{type:rt.NETWORK_ERROR,details:fe.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:T,reason:T.message,level:t.level||void 0,parent:(u=r.fragments[0])==null?void 0:u.type,networkDetails:w,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,p=(r.edge-h)*1e3,g=sL(r,p);if(r.requestScheduled+g<a?r.requestScheduled=a:r.requestScheduled+=g,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let v,y,b;if(r.canBlockReload&&r.endSN&&r.advanced){const T=this.hls.config.lowLatencyMode,x=r.lastPartSn,w=r.endSN,A=r.lastPartIndex,R=A!==-1,_=x===w;R?_?(y=w+1,b=T?0:A):(y=x,b=T?A+1:r.maxPartIndex):y=w+1;const D=r.age,H=D+r.ageHeader;let P=Math.min(H-r.partTarget,r.targetduration*1.5);if(P>0){if(H>r.targetduration*3)this.log(`Playlist last advanced ${D.toFixed(2)}s ago. Omitting segment and part directives.`),y=void 0,b=void 0;else if(i!=null&&i.tuneInGoal&&H-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${P} with playlist age: ${r.age}`),P=0;else{const N=Math.floor(P/r.targetduration);if(y+=N,b!==void 0){const G=Math.round(P%r.targetduration/r.partTarget);b+=G}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${D.toFixed(2)}s goal: ${P} skip sn ${N} to part ${b}`)}r.tuneInGoal=P}if(v=this.getDeliveryDirectives(r,t.deliveryDirectives,y,b),T||!_){r.requestScheduled=a,this.loadingPlaylist(c,v);return}}else(r.canBlockReload||r.canSkipUntil)&&(v=this.getDeliveryDirectives(r,t.deliveryDirectives,y,b));v&&y!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(c,v,r)}else this.clearTimer()}scheduleLoading(e,t,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=r.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,i,r){let s=Vw(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=pf.No),new Gw(i,r,s)}checkRetry(e){const t=e.details,i=jf(e),r=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=r||{},l=!!r&&!!o&&(s===Rn.RetryRequest||!r.resolved&&s===Rn.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(i&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=n1(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function PL(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ql(n[t].attrs,e[t].attrs))return!1;return!0}function ql(n,e,t){const i=n["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function Cv(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class G$ extends m1{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!i||i.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,p)=>{h.id=p});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!s&&l){const h=yr(l,o,Ca);if(h>-1)s=o[h];else{const p=yr(l,this.tracks);s=this.tracks[p]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(O.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(o.length&&d===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===wt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&Ba(e,r,Ca))return r;const s=yr(e,this.tracksInGroup,Ca);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(r){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=nq(e,t.levels,i,a,Ca);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=yr(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(O.AUDIO_TRACK_SWITCHING,kt({},r)),s))return;const a=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Ba(e,r,Ca)))return i}if(e){const{name:i,lang:r,assocLang:s,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Ba({name:i,lang:r,assocLang:s,characteristics:a,audioCodec:o,channels:l},c,Ca))return u}for(let u=0;u<t.length;u++){const c=t[u];if(ql(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(ql(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&zf(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(O.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}}class W${constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;const a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],r=i==null?void 0:i.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const _2=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,kL="HlsJsTrackRemovedError";class q$ extends Error{constructor(e){super(e),this.name=kL}}class $$ extends Mi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(O.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=mW($s(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.BUFFER_EOS,this.onBufferEos,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.FRAG_PARSED,this.onFragParsed,this),e.on(O.FRAG_CHANGED,this.onFragChanged,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_EOS,this.onBufferEos,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.FRAG_PARSED,this.onFragParsed,this),e.off(O.FRAG_CHANGED,this.onFragChanged,this),e.off(O.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Nt(i,r.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(i[a]=Nt({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const r=$s(this.appendSource);if(r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),s)this._objectUrl=i.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&a instanceof l,L2(i),K$(i,o),i.load()}catch{i.src=o}else i.src=o}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,r=t.tracks,s=r?Object.keys(r):null,a=s?s.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Bt(i,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Bt(r,(l,u)=>l==="initSegment"?void 0:u)}}`),!R_(r,i)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(O.MEDIA_DETACHING,{}),this.onMediaAttaching(O.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(l=>{const u=l,c=r[u];if(c){const d=c.buffer;if(d){const h=this.fragmentTracker,p=c.id;if(h.hasFragments(p)||h.hasParts(p)){const y=vt.getBuffered(d);h.detectEvictedFragments(u,y,p,null,!0)}const g=sg(u),v=[u,d];this.sourceBuffers[g]=v,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const l=s.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),s.removeSourceBuffer(l[u]);o&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(r.removeAttribute("src"),this.appendSource&&L2(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(O.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[sg(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new W$(this.tracks)}onBufferCodecs(e,t){var i;const r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&s.some(l=>!r[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var u,c;const d=t[l],{id:h,codec:p,levelCodec:g,container:v,metadata:y,supplemental:b}=d;let T=r[l];const x=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],w=x!=null&&x.buffer?x:T,A=(w==null?void 0:w.pendingCodec)||(w==null?void 0:w.codec),R=w==null?void 0:w.levelCodec;T||(T=r[l]={buffer:void 0,listeners:[],codec:p,supplemental:b,container:v,levelCodec:g,metadata:y,id:h});const _=hf(A,R),D=_==null?void 0:_.replace(_2,"$1");let H=hf(p,g);const P=(c=H)==null?void 0:c.replace(_2,"$1");H&&_&&D!==P&&(l.slice(0,5)==="audio"&&(H=Uf(H,this.appendSource)),this.log(`switching codec ${A} to ${H}`),H!==(T.pendingCodec||T.codec)&&(T.pendingCodec=H),T.container=v,this.appendChangeType(l,v,H))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const r=`${t};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),o.changeType(r),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,Xe.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&vt.isBuffered(l.buffer,r)||((o=this.fragmentTracker.getAppendedFrag(r,Xe.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:r,type:s,parent:a,frag:o,part:l,chunkMeta:u,offset:c}=t,d=u.buffering[s],{sn:h,cc:p}=o,g=self.performance.now();d.start=g;const v=o.stats.buffering,y=l?l.stats.buffering:null;v.start===0&&(v.start=g),y&&y.start===0&&(y.start=g);const b=i.audio;let T=!1;s==="audio"&&(b==null?void 0:b.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const x=i.video,w=x==null?void 0:x.buffer;if(w&&h!=="initSegment"){const _=l||o,D=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(x.ending||x.ended)){const P=_.start+_.duration*.05,N=w.buffered,G=this.currentOp("video");!N.length&&!G?this.blockAudio(_):!G&&!vt.isBuffered(w,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(_)}else if(s==="video"){const H=_.end;if(D){const P=D.frag.start;(H>P||H<this.lastVideoAppendEnd||vt.isBuffered(w,P))&&this.unblockAudio()}this.lastVideoAppendEnd=H}}const A=(l||o).start,R={label:`append-${s}`,execute:()=>{var _;d.executeStart=self.performance.now();const D=(_=this.tracks[s])==null?void 0:_.buffer;D&&(T?this.updateTimestampOffset(D,A,.1,s,h,p):c!==void 0&&$e(c)&&this.updateTimestampOffset(D,c,1e-6,s,h,p)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const _=self.performance.now();d.executeEnd=d.end=_,v.first===0&&(v.first=_),y&&y.first===0&&(y.first=_);const D={};this.sourceBuffers.forEach(([H,P])=>{H&&(D[H]=vt.getBuffered(P))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(O.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:D})},onError:_=>{var D;const H={type:rt.MEDIA_ERROR,parent:o.type,details:fe.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:l,chunkMeta:u,error:_,err:_,fatal:!1},P=(D=this.media)==null?void 0:D.error;if(_.code===DOMException.QUOTA_EXCEEDED_ERR||_.name=="QuotaExceededError"||"quota"in _)H.details=fe.BUFFER_FULL_ERROR;else if(_.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)H.errorAction=Ko(!0);else if(_.name===kL&&this.sourceBufferCount===0)H.errorAction=Ko(!0);else{const N=++this.appendErrors[s];this.warn(`Failed ${N}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${P||"no media error"})`),(N>=this.hls.config.appendErrorMaxRetry||P)&&(H.fatal=!0)}this.hls.trigger(O.ERROR,H)}};this.log(`queuing "${s}" append sn: ${h}${l?" p: "+l.index:""} of ${o.type===Xe.MAIN?"level":"track"} ${o.level} cc: ${p}`),this.append(R,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(O.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:i,startOffset:r,endOffset:s}=t;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,r,s),a)})}onFragParsed(e,t){const{frag:i,part:r}=t,s=[],a=r?r.elementaryStreams:i.elementaryStreams;a[Ft.AUDIOVIDEO]?s.push("audiovideo"):(a[Ft.AUDIO]&&s.push("audio"),a[Ft.VIDEO]&&s.push("video"));const o=()=>{const l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const u=r?r.stats:i.stats;this.hls.trigger(O.FRAG_BUFFERED,{frag:i,part:r,stats:u,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(O.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(O.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===fe.BUFFER_APPEND_ERROR&&t.frag){var i;const r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;$e(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const r=e.config,s=i.currentTime,a=t.levelTargetDuration,o=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if($e(o)&&o>=0){const u=Math.max(o,a),c=Math.floor(s/a)*a-u;this.flushBackBuffer(s,a,c)}const l=r.frontBufferFlushThreshold;if($e(l)&&l>0){const u=Math.max(r.maxBufferLength,l),c=Math.max(u,a),d=Math.floor(s/a)*a+c;this.flushFrontBuffer(s,a,d)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=vt.getBuffered(s);if(o.length>0&&i>o.start(0)){var a;this.hls.trigger(O.BACK_BUFFER_REACHED,{bufferEnd:i});const l=this.tracks[r];if((a=this.details)!=null&&a.live)this.hls.trigger(O.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=vt.getBuffered(s),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(i>l||e>=l&&e<=u)return;this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,r);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return $e(s)?{duration:s}:null;const a=this.media.duration,o=$e(i.duration)?i.duration:0;return r>o&&r>a||!$e(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&($e(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Bt(i)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(O.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${Bt(o)}`);try{const c=i.addSourceBuffer(u),d=sg(a),h=[a,c];t[d]=h,o.buffer=c}catch(c){var r;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let r=e.codec;i&&(t==="video"||t==="audiovideo")&&Hl(i,"video")&&(r=FW(r,i));const s=hf(r,e.levelCodec);return s?t.slice(0,5)==="audio"?Uf(s,this.appendSource):s:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(O.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,i,r,s,a){const o=t-e.timestampOffset;Math.abs(o)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:r,mediaSource:s}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!r||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=$e(r.duration)?r.duration:1/0,u=$e(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(i,l,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],r=i==null?void 0:i.buffer;if(!r)throw new q$(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const a=i.bind(this,e);r.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function L2(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function K$(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function sg(n){return n==="audio"?1:0}class g1{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&$e(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,g1.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let s=e.length-1;const a=Math.max(t,i);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&r(l,e[o+1])){s=o;break}}return s}}const Y$={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ni=Y$,X$={HLS:"h"},Q$=X$;class xr{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof xr?i:new xr(i))),this.value=e,this.params=t}}const Z$="Dict";function J$(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function eK(n,e,t,i){return new Error(`failed to ${n} "${J$(e)}" as ${t}`,{cause:i})}function Sr(n,e,t){return eK("serialize",n,e,t)}class DL{constructor(e){this.description=e}}const P2="Bare Item",tK="Boolean";function nK(n){if(typeof n!="boolean")throw Sr(n,tK);return n?"?1":"?0"}function iK(n){return btoa(String.fromCharCode(...n))}const rK="Byte Sequence";function sK(n){if(ArrayBuffer.isView(n)===!1)throw Sr(n,rK);return`:${iK(n)}:`}const aK="Integer";function oK(n){return n<-999999999999999||999999999999999<n}function OL(n){if(oK(n))throw Sr(n,aK);return n.toString()}function uK(n){return`@${OL(n.getTime()/1e3)}`}function NL(n,e){if(n<0)return-NL(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}const lK="Decimal";function cK(n){const e=NL(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Sr(n,lK);const t=e.toString();return t.includes(".")?t:`${t}.0`}const dK="String",fK=/[\x00-\x1f\x7f]+/;function hK(n){if(fK.test(n))throw Sr(n,dK);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function pK(n){return n.description||n.toString().slice(7,-1)}const mK="Token";function k2(n){const e=pK(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Sr(e,mK);return e}function Iv(n){switch(typeof n){case"number":if(!$e(n))throw Sr(n,P2);return Number.isInteger(n)?OL(n):cK(n);case"string":return hK(n);case"symbol":return k2(n);case"boolean":return nK(n);case"object":if(n instanceof Date)return uK(n);if(n instanceof Uint8Array)return sK(n);if(n instanceof DL)return k2(n);default:throw Sr(n,P2)}}const gK="Key";function Rv(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Sr(n,gK);return n}function v1(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Rv(e)}`:`;${Rv(e)}=${Iv(t)}`).join("")}function ML(n){return n instanceof xr?`${Iv(n.value)}${v1(n.params)}`:Iv(n)}function vK(n){return`(${n.value.map(ML).join(" ")})${v1(n.params)}`}function yK(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Sr(n,Z$);const t=n instanceof Map?n.entries():Object.entries(n),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof xr||(s=new xr(s));let a=Rv(r);return s.value===!0?a+=v1(s.params):(a+="=",Array.isArray(s.value)?a+=vK(s):a+=ML(s)),a}).join(`,${i}`)}function FL(n,e){return yK(n,e)}const dr="CMCD-Object",nn="CMCD-Request",wa="CMCD-Session",Ds="CMCD-Status",EK={br:dr,ab:dr,d:dr,ot:dr,tb:dr,tpb:dr,lb:dr,tab:dr,lab:dr,url:dr,pb:nn,bl:nn,tbl:nn,dl:nn,ltc:nn,mtp:nn,nor:nn,nrr:nn,rc:nn,sn:nn,sta:nn,su:nn,ttfb:nn,ttfbb:nn,ttlb:nn,cmsdd:nn,cmsds:nn,smrt:nn,df:nn,cs:nn,ts:nn,cid:wa,pr:wa,sf:wa,sid:wa,st:wa,v:wa,msd:wa,bs:Ds,bsd:Ds,cdn:Ds,rtp:Ds,bg:Ds,pt:Ds,ec:Ds,e:Ds},bK={REQUEST:nn};function TK(n){return Object.keys(n).reduce((e,t)=>{var i;return(i=n[t])===null||i===void 0||i.forEach(r=>e[r]=t),e},{})}function xK(n,e){const t={};if(!n)return t;const i=Object.keys(n),r=e?TK(e):{};return i.reduce((s,a)=>{var o;const l=EK[a]||r[a]||bK.REQUEST,u=(o=s[l])!==null&&o!==void 0?o:s[l]={};return u[a]=n[a],s},t)}function SK(n){return["ot","sf","st","e","sta"].includes(n)}function wK(n){return typeof n=="number"?$e(n):n!=null&&n!==""&&n!==!1}const BL="event";function AK(n,e){const t=new URL(n),i=new URL(e);if(t.origin!==i.origin)return n;const r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const yf=n=>Math.round(n),_v=(n,e)=>Array.isArray(n)?n.map(t=>_v(t,e)):n instanceof xr&&typeof n.value=="string"?new xr(_v(n.value,e),n.params):(e.baseUrl&&(n=AK(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Gd=n=>yf(n/100)*100,CK=(n,e)=>{let t=n;return e.version>=2&&(n instanceof xr&&typeof n.value=="string"?t=new xr([n]):typeof n=="string"&&(t=[n])),_v(t,e)},IK={br:yf,d:yf,bl:Gd,dl:Gd,mtp:Gd,nor:CK,rtp:Gd,tb:yf},UL="request",HL="response",y1=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],RK=["e"],_K=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Ih(n){return _K.test(n)}function LK(n){return y1.includes(n)||RK.includes(n)||Ih(n)}const zL=["d","dl","nor","ot","rtp","su"];function PK(n){return y1.includes(n)||zL.includes(n)||Ih(n)}const kK=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function DK(n){return y1.includes(n)||zL.includes(n)||kK.includes(n)||Ih(n)}const OK=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function NK(n){return OK.includes(n)||Ih(n)}const MK={[HL]:DK,[BL]:LK,[UL]:PK};function jL(n,e={}){const t={};if(n==null||typeof n!="object")return t;const i=e.version||n.v||1,r=e.reportingMode||UL,s=i===1?NK:MK[r];let a=Object.keys(n).filter(s);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=r===HL||r===BL;l&&!a.includes("ts")&&a.push("ts"),i>1&&!a.includes("v")&&a.push("v");const u=Nt({},IK,e.formatters),c={version:i,reportingMode:r,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let h=n[d];const p=u[d];if(typeof p=="function"&&(h=p(h,c)),d==="v"){if(i===1)return;h=i}d=="pr"&&h===1||(l&&d==="ts"&&!$e(h)&&(h=Date.now()),wK(h)&&(SK(d)&&typeof h=="string"&&(h=new DL(h)),t[d]=h))}),t}function FK(n,e={}){const t={};if(!n)return t;const i=jL(n,e),r=xK(i,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((s,[a,o])=>{const l=FL(o,{whitespace:!1});return l&&(s[a]=l),s},t)}function BK(n,e,t){return Nt(n,FK(e,t))}const UK="CMCD";function HK(n,e={}){return n?FL(jL(n,e),{whitespace:!1}):""}function zK(n,e={}){if(!n)return"";const t=HK(n,e);return encodeURIComponent(t)}function jK(n,e={}){if(!n)return"";const t=zK(n,e);return`${UK}=${t}`}const D2=/CMCD=[^&#]+/;function VK(n,e,t){const i=jK(e,t);if(!i)return n;if(D2.test(n))return n.replace(D2,i);const r=n.includes("?")?"&":"?";return`${n}${r}${i}`}class GK{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:ni.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:a}=r,o=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(a||s).duration*1e3,ot:l};(l===ni.VIDEO||l===ni.AUDIO||l==ni.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(u.nor=c.url),this.apply(r,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHED,this.onMediaDetached,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHED,this.onMediaDetached,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:Q$.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Nt(t,this.createData());const i=t.ot===ni.INIT||t.ot===ni.VIDEO||t.ot===ni.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((a,o)=>(r.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),BK(e.headers,t,s)):e.url=VK(e.url,t,s)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t;const{index:i,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=r;for(let o=s.length-1;o>=0;o--){const l=s[o];if(l.index===i&&l.fragment.sn===a)return s[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ni.TIMED_TEXT;if(e.sn==="initSegment")return ni.INIT;if(t==="audio")return ni.AUDIO;if(t==="main")return this.hls.audioTracks.length?ni.VIDEO:ni.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===ni.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,a=s>-1?s+1:r.levels.length;i=r.levels.slice(0,a)}return i.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===ni.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:vt.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const WK=3e5;class qK extends Mi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===Rn.SendAlternateToPenaltyBox&&i.flags===mi.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&r?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==a),t.details===fe.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${r&&r.length} priorities: ${Bt(s)} penalized: ${Bt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>WK&&delete i[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in i)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,uL(t),this.hls.trigger(O.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===wt.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===wt.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const d=new Zt(c.attrs);d["PATHWAY-ID"]=a;const h=d.AUDIO&&`${d.AUDIO}_clone_${a}`,p=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;h&&(i[d.AUDIO]=h,d.AUDIO=h),p&&(r[d.SUBTITLES]=p,d.SUBTITLES=p);const g=VL(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),v=new jl({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let y=1;y<c.audioGroups.length;y++)v.addGroupId("audio",`${c.audioGroups[y]}_clone_${a}`);if(c.subtitleGroups)for(let y=1;y<c.subtitleGroups.length;y++)v.addGroupId("text",`${c.subtitleGroups[y]}_clone_${a}`);return v});t.push(...u),O2(this.audioTracks,i,l,a),O2(this.subtitleTracks,r,l,a)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:r.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,h,p)=>{this.log(`Loaded steering manifest: "${r}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":v,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":b}=g;if(v)try{this.uri=new self.URL(v,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${v}`);return}this.scheduleRefresh(this.uri||h.url),y&&this.clonePathways(y);const T={steeringManifest:g,url:r.toString()};this.hls.trigger(O.STEERING_MANIFEST_LOADED,T),b&&this.updatePathwayPriority(b)},onError:(c,d,h,p)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const v=this.loader;if(typeof(v==null?void 0:v.getResponseHeader)=="function"){const y=v.getResponseHeader("Retry-After");y&&(g=parseFloat(y)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function O2(n,e,t,i){n&&Object.keys(e).forEach(r=>{const s=n.filter(a=>a.groupId===r).map(a=>{const o=Nt({},a);return o.details=void 0,o.attrs=new Zt(o.attrs),o.url=o.attrs.URI=VL(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=i,o});n.push(...s)})}function VL(n,e,t,i){const{HOST:r,PARAMS:s,[t]:a}=i;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return r&&!o&&(l.host=r),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}class Xo extends Mi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Xo.CDMCleanupPromise?[Xo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:r}=t,s=`"${t.type}" event: init data type: "${i}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=ml(this.config));const o=a.map(Qm).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=mf(a);if(i!=="sinf"||o!==Jt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${o}`);return}let l;try{const p=mn(new Uint8Array(r)),g=a1(JSON.parse(p).sinf),v=F_(g);if(!v)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(v.subarray(8,24))}catch(p){this.warn(`${s} Failed to parse sinf: ${p}`);return}const u=_n(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let h=c[u];for(let p=0;p<d.length;p++){const g=d[p],v=g.decryptdata;if(!v.keyId)continue;const y=_n(v.keyId);if(Gf(l,v.keyId)||v.uri.replace(/-/g,"").indexOf(u)!==-1){if(h=c[y],!h)continue;if(v.pssh)break;delete c[y],v.pssh=new Uint8Array(r),v.keyId=l,h=c[u]=h.then(()=>this.generateRequestWithPreferredKeySession(g,i,r,"encrypted-event-key-match")),h.catch(b=>this.handleError(b));break}}h||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(O.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(O.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===Jt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t==null?void 0:t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(a,o,l)=>!!a&&l.indexOf(a)===o,r=t.map(a=>a.audioCodec).filter(i),s=t.map(a=>a.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,r,s).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof pi?o(d):o(new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return eL===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){var r;const s=Cq(e,t,i,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(r=a)==null?void 0:r.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Bt(s)}`),o=this.requestMediaKeySystemAccess(e,s);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(p=>p?this.setMediaKeysServerCertificate(h,e,p):h)));return d.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${_n(e.keyId||[])} keyUri: ${e.uri}`);const r=i.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=Wd(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${_n(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Qm(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=Qm(r);s?t(s):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ml(this.config),i=e.map(mf).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const r=$K(e,t[i]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,i=Wd(t),r=this.bannedKeyIds[i];if(r||this.getKeyStatus(t)==="internal-error"){const o=N2(r||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const s=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[i];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[i]=o,o}return a.catch(o=>{if(o instanceof pi){const l=kt({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new pi(l,o.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof pi){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${_n(i.keyId||[])})`:""}`),this.hls.trigger(O.ERROR,e.data)}else this.error(e.message),this.hls.trigger(O.ERROR,{type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Wd(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=mf(e.keyFormat),s=r?[r]:ml(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=ml(this.config)),e.length===0)throw new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Bt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const g=a.call(this.hls,t,i,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,i=g.initData?g.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const o=Wd(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${i.byteLength})`);const u=new u1,c=e._onmessage=g=>{const v=e.mediaKeysSession;if(!v){u.emit("error",new Error("invalid state"));return}const{messageType:y,message:b}=g;this.log(`"${y}" message event for session "${v.sessionId}" message size: ${b.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,b).catch(T=>{u.eventNames().length?u.emit("error",T):this.handleError(T)}):y==="license-release"?e.keySystem===Jt.FAIRPLAY&&this.updateKeySession(e,Tv("acknowledged")).then(()=>this.removeSession(e)).catch(T=>this.handleError(T)):this.warn(`unhandled media key message type "${y}"`)},d=(g,v)=>{v.keyStatus=g;let y;g.startsWith("usable")?u.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?y=N2(g,v.decryptdata):g==="expired"?y=new Error(`key expired (keyId: ${o})`):g==="released"?y=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${o})`),y&&(u.eventNames().length?u.emit("error",y):this.handleError(y))},h=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const y=this.getKeyStatuses(e);if(!Object.keys(y).some(w=>y[w]!=="status-pending"))return;if(y[o]==="expired"){this.log(`Expired key ${Bt(y)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let T=y[o];if(T)d(T,e);else{var x;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(x=e.keyStatusTimeouts)[o]||(x[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const A=this.getKeyStatus(e.decryptdata);if(A&&A!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${A} from other session.`),d(A,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),T="internal-error",d(T,e)},1e3)),this.log(`No status for keyId ${o} (${Bt(y)}).`)}};$n(e.mediaKeysSession,"message",c),$n(e.mediaKeysSession,"keystatuseschange",h);const p=new Promise((g,v)=>{u.on("error",v),u.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(g=>{throw new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>p).catch(g=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,r)=>{if(typeof r=="string"&&typeof i=="object"){const o=r;r=i,i=o}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===Jt.PLAYREADY&&s.length===16){const o=_n(s);t[o]=i,Z_(s)}const a=_n(s);i==="internal-error"&&(this.bannedKeyIds[a]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,p,g,v)=>{a(h.data)},onError:(h,p,g,v)=>{o(new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:kt({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${s}). Status: ${h.code} (${h.text})`))},onTimeout:(h,p,g)=>{o(new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(h,p,g)=>{o(new Error("aborted"))}};r.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,s)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),r(e)}).catch(a=>{s(new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,h=s.length;d<h;d++){var a,o;c=s[d];const p=(a=c.querySelector("name"))==null?void 0:a.textContent,g=(o=c.querySelector("value"))==null?void 0:o.textContent;p&&g&&e.setRequestHeader(p,g)}}const l=r.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Tv(atob(u))}setupLicenseXHR(e,t,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,i,r)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,i,r)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}r(l)}else{const l=i.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)s(new pi({type:rt.KEY_SYSTEM_ERROR,details:fe.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==Jt.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,$n(i,"encrypted",this.onMediaEncrypted),$n(i,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(ri(e,"encrypted",this.onMediaEncrypted),ri(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Vs.clearKeyUriToKeyIdMap();const s=r.length;Xo.CDMCleanupPromise=Promise.all(r.map(a=>this.removeSession(a)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${_n((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:o}=this.config;return(Rq(o)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Xo.CDMCleanupPromise=void 0;function Wd(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return _n(n.keyId)}function $K(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class pi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function N2(n,e){const t=n==="output-restricted",i=t?fe.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:fe.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new pi({type:rt.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class KK{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,a=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/s,u=this.hls;if(u.trigger(O.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:i}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(O.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function GL(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function WL(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Dt.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){Dt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function Go(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let i=n.cues.length;i--;)e&&n.cues[i].removeEventListener("enter",e),n.removeCue(n.cues[i]);t==="disabled"&&(n.mode=t)}function Lv(n,e,t,i){const r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=XK(n.cues,e,t);for(let a=0;a<s.length;a++)(!i||i(s[a]))&&n.removeCue(s[a])}r==="disabled"&&(n.mode=r)}function YK(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let i=0,r=t,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<n[s].startTime)r=s-1;else if(e>n[s].startTime&&i<t)i=s+1;else return s;return n[i].startTime-e<e-n[r].startTime?i:r}function XK(n,e,t){const i=[],r=YK(n,e);if(r>-1)for(let s=r,a=n.length;s<a;s++){const o=n[s];if(o.startTime>=e&&o.endTime<=t)i.push(o);else if(o.startTime>t)return i}return i}function Ef(n){const e=[];for(let t=0;t<n.length;t++){const i=n[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(n[t])}return e}class QK extends m1{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Ef(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Ef(i.textTracks).forEach(a=>{Go(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!i||i.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const c=yr(o,a);if(c>-1)s=a[c];else{const d=yr(o,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(O.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||Ba(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(ql(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(ql(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(Cv(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===wt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&Ba(e,i))return i;const r=yr(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{const s=yr(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(O.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Ef(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(s=>Cv(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!$e(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=r;this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const d=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(d)}}function ZK(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function kl(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Qo=.025;let Kf=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function JK(n,e,t){return`${n.identifier}-${t+1}-${kl(e)}`}class eY{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return ag(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=ag(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=$e(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return ag(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Qo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Kf.Range:Kf.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return tY(this)}}function ag(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Qo)?e.start:e.start+e.duration}function qL(n,e,t){const i=new self.URL(n,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function og(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function tY(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function zo(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class nY{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(O.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=i,this.assetItem=r;const a=()=>{this.hasDetails=!0};s.once(O.LEVEL_LOADED,a),s.once(O.AUDIO_TRACK_LOADED,a),s.once(O.SUBTITLE_TRACK_LOADED,a),s.on(O.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(O.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,s.trigger(O.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=qL(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=vt.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=vt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,i){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,i){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${zo(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const M2=.033;class iY extends Mi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){const s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){const i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){const a=i[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:r}=i,s=this.events,a=this.parseDateRanges(r,{url:i.url},t),o=Object.keys(r),l=s?s.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,h=u.cue.post,p=c.cue.pre,g=c.cue.post;if(d&&!p)return-1;if(p&&!d||h&&!g)return 1;if(g&&!h)return-1;if(!d&&!p&&!h&&!g){const v=u.startTime,y=c.startTime;if(v!==y)return v-y}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],i=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(r,e);(i||t.length||(s==null?void 0:s.length)!==a.length||a.some((l,u)=>Math.abs(l.playout.start-s[u].playout.start)>.005||Math.abs(l.playout.end-s[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){const r=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new eY(l,t),this.eventMap[o]=u,i===!1&&(u.appendInPlace=i)),r.push(u)}}return r}parseSchedule(e,t){const i=[],r=t.main.details,s=r.live?1/0:r.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const h=c.cue.pre,p=c.cue.post,g=e[d-1]||null,v=c.appendInPlace,y=p?s:c.startOffset,b=c.duration,T=c.timelineOccupancy===Kf.Range?b:0,x=c.resumptionOffset,w=(g==null?void 0:g.startTime)===y,A=y+c.cumulativeDuration;let R=v?A+b:y+x;if(h||!p&&y<=0){const D=u;u+=T,c.timelineStart=A;const H=a;a+=b,i.push({event:c,start:A,end:R,playout:{start:H,end:a},integrated:{start:D,end:u}})}else if(y<=s){if(!w){const P=y-l;if(P>M2){const N=l,G=u;u+=P;const X=a;a+=P;const te={previousEvent:e[d-1]||null,nextEvent:c,start:N,end:N+P,playout:{start:X,end:a},integrated:{start:G,end:u}};i.push(te)}else P>0&&g&&(g.cumulativeDuration+=P,i[i.length-1].end=y)}p&&(R=A),c.timelineStart=A;const D=u;u+=T;const H=a;a+=b,i.push({event:c,start:A,end:R,playout:{start:H,end:a},integrated:{start:D,end:u}})}else return;const _=c.resumeTime;p||_>s?l=s:l=_}),l<s){var o;const c=l,d=u,h=s-l;u+=h;const p=a;a+=h,i.push({previousEvent:((o=i[i.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+h,playout:{start:p,end:a},integrated:{start:d,end:u}})}this.setDurations(s,a,u)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,r=i.live?1/0:i.edge;let s=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,d=u?0:c?r:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=s:(s=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=ja(null,i.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<M2&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const p=$e(o.resumeOffset)?o.resumeOffset:o.duration;s+=p})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>Qo?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(i>=l)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${l}`),!1;const u=ja(null,o.fragments,i);if(!u)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-i)<Qo+c||Math.abs(u.end-i)<Qo+c?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,r=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+i;o.startOffset=i,o.timelineStart=l,r||(r=o.duration===null),s||(s=!!o.error);const u=o.error?0:o.duration||0;i+=u}r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ki(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class rY{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let r;try{r=qL(i,this.hls.sessionId,e.baseUrl)}catch(h){const p=this.assignAssetListError(e,fe.ASSET_LIST_LOAD_ERROR,h,i);this.hls.trigger(O.ERROR,p);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),l={responseType:"json",url:r.href},u=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,p,g,v)=>{const y=h.data,b=y==null?void 0:y.ASSETS;if(!Array.isArray(b)){const T=this.assignAssetListError(e,fe.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,p,v);this.hls.trigger(O.ERROR,T);return}e.assetListResponse=y,this.hls.trigger(O.ASSET_LIST_LOADED,{event:e,assetListResponse:y,networkDetails:v})},onError:(h,p,g,v)=>{const y=this.assignAssetListError(e,fe.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${p.url})`),p.url,v,g);this.hls.trigger(O.ERROR,y)},onTimeout:(h,p,g)=>{const v=this.assignAssetListError(e,fe.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${p.url})`),p.url,h,g);this.hls.trigger(O.ERROR,v)}};return o.load(l,c,d),this.hls.trigger(O.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,i,r,s,a){return e.error=i,{type:rt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:a,stats:s}}}function F2(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function qd(n,e){return`[${n}] Advancing timeline position to ${e}`}class sY extends Mi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const a=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),a&&i<o.start||i>=o.end){var l;const p=this.findItemIndex(o);let g=this.schedule.findItemIndexAtTime(i);if(g===-1&&(g=p+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${i} (resolving from ${p} to ${g})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&g>p){const v=this.schedule.findJumpRestrictedIndex(p+1,g);if(v>p){this.setSchedulePosition(v);return}}this.setSchedulePosition(g);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const p=o.event.assetList[0];p&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,p))}return}const c=u.timelineStart,d=u.duration||0;if(a&&i<c||i>=c+d){var h;(h=o.event)!=null&&h.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,u)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const o=this.findItemIndex(r);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,o=s.events||[],l=s.items||[],u=s.durations,c=i.map(v=>v.identifier),d=!!(o.length||c.length);(d||r)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(v=>Ki(v))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let h=null,p=null;a&&(h=this.updateItem(a,this.timelinePos),this.itemsMatch(a,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(p=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,p)?this.bufferingItem=p:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),i.forEach(v=>{v.assetList.forEach(y=>{this.clearAssetPlayer(y.identifier,null)})}),this.playerQueue.forEach(v=>{if(v.interstitial.appendInPlace){const y=v.assetItem.timelineStart,b=v.timelineOffset-y;if(b)try{v.timelineOffset=y}catch(T){Math.abs(b)>Qo&&this.warn(`${T} ("${v.assetId}" ${v.timelineOffset}->${y})`)}}}),d||r){if(this.hls.trigger(O.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(h,a),g&&p!==h&&this.trimInPlace(p,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new rY(e),this.schedule=new iY(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(O.MEDIA_ENDED,this.onMediaEnded,this),e.on(O.ERROR,this.onError,this),e.on(O.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(O.MEDIA_ENDED,this.onMediaEnded,this),e.off(O.ERROR,this.onError,this),e.off(O.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ri(e,"play",this.onPlay),ri(e,"pause",this.onPause),ri(e,"seeking",this.onSeeking),ri(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;$n(i,"seeking",this.onSeeking),$n(i,"timeupdate",this.onTimeupdate),$n(i,"play",this.onPlay),$n(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=d=>d&&e.getAssetPlayer(d.identifier),r=(d,h,p,g,v)=>{if(d){let y=d[h].start;const b=d.event;if(b){if(h==="playout"||b.timelineOccupancy!==Kf.Point){const T=i(p);(T==null?void 0:T.interstitial)===b&&(y+=T.assetItem.startOffset+T[v])}}else{const T=g==="bufferedPos"?a():e[g];y+=T-d.start}return y}return 0},s=(d,h)=>{var p;if(d!==0&&h!=="primary"&&(p=e.schedule)!=null&&p.length){var g;const v=e.schedule.findItemIndexAtTime(d),y=(g=e.schedule.items)==null?void 0:g[v];if(y){const b=y[h].start-y.start;return d+b}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var h,p;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((p=e.schedule)==null?void 0:p.durations[d])||0},l=(d,h)=>{var p,g;const v=e.effectivePlayingItem;if(v!=null&&(p=v.event)!=null&&p.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const y=e.effectivePlayingItem,b=e.schedule.findItemIndexAtTime(d,h),T=(g=e.schedule.items)==null?void 0:g[b],x=e.getBufferingPlayer(),w=x==null?void 0:x.interstitial,A=w==null?void 0:w.appendInPlace,R=y&&e.itemsMatch(y,T);if(y&&(A||R)){const _=i(e.playingAsset),D=(_==null?void 0:_.media)||e.primaryMedia;if(D){const H=h==="primary"?D.currentTime:r(y,h,e.playingAsset,"timelinePos","currentTime"),P=d-H,N=(A?H:D.currentTime)+P;if(N>=0&&(!_||A||N<=_.duration)){D.currentTime=N;return}}}if(T){let _=d;if(h!=="primary"){const H=T[h].start,P=d-H;_=T.start+P}const D=!e.isInterstitial(T);if((!e.isInterstitial(y)||y.event.appendInPlace)&&(D||T.event.appendInPlace)){const H=e.media||(A?x==null?void 0:x.media:null);H&&(H.currentTime=_)}else if(y){const H=e.findItemIndex(y);if(b>H){const N=e.schedule.findJumpRestrictedIndex(H+1,b);if(N>H){e.setSchedulePosition(N);return}}let P=0;if(D)e.timelinePos=_,e.checkBuffer();else{const N=T.event.assetList,G=d-(T[h]||T).start;for(let X=N.length;X--;){const te=N[X];if(te.duration&&G>=te.startOffset&&G<te.startOffset+te.duration){P=X;break}}}e.setSchedulePosition(b,P)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},c={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var p;return r(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((p=e.bufferingAsset)==null?void 0:p.startOffset)||0}return 0},get currentTime(){const d=u(),h=e.effectivePlayingItem;return h&&h===d?r(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=u(),p=e.effectivePlayingItem;p&&p===h&&l(d+p.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=u())==null?void 0:d.event.assetList;return h?h.map(p=>e.getAssetPlayer(p.identifier)):[]},get playingIndex(){var d;const h=(d=u())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const p=e.findItemIndex(d);if(h.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(h,p,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!$e(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Bt(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(i=this.detachedData)==null?void 0:i.mediaSource;let c;if(a.media)l&&(s=a.transferMedia(),this.detachedData=s),c="Primary";else if(u){const g=this.getBufferingPlayer();g?(s=g.transferMedia(),c=`${g}`):c="detached MediaSource"}else c="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${Bt(s)}`);else if(!this.detachedData||a.media===t){const g=this.playerQueue;g.length>1&&g.forEach(v=>{if(o&&v.interstitial.appendInPlace!==l){const y=v.interstitial;this.clearInterstitial(v.interstitial,null),y.appendInPlace=!1,y.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${y}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",h=d&&s?s:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const p=this.schedule;if(h===s&&p){const g=o&&e.assetId===p.assetIdAtEnd;h.overrides={duration:p.duration,endOfStream:!o||g,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const s=this.hls.startPosition;if(this.log(qd("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const i=e.event,r=i.findAssetIndex(t),s=og(i,r);if(!i.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,i){const r=og(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(qd("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const r=t.parentIdentifier,s=i.getEvent(r);if(s){const a=i.findEventIndex(r),o=i.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){var i;const r=(i=this.schedule)==null?void 0:i.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&Ki(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,h=d==null?void 0:d.identifier,p=h?this.getAssetPlayer(h):null;if(p&&h&&(!this.eventItemsMatch(a,s)||t!==void 0&&h!==c.assetList[t].identifier)){var l;const g=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${c.assetList.length} ${zo(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(O.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:g,event:c,schedule:r.slice(0),scheduleIndex:e,player:p}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(h,s),p.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&p.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Ki(a)}`),c.hasPlayed=!0,this.hls.trigger(O.INTERSTITIAL_ENDED,{event:c,schedule:r.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const g=(u=this.schedule)==null?void 0:u.items;if(s&&g){const v=this.findItemIndex(s);this.advanceSchedule(v,g,t,a,o)}return}}this.advanceSchedule(e,r,t,a,o)}advanceSchedule(e,t,i,r,s){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,h=a.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(i===void 0){i=a.findAssetIndex(c,this.timelinePos);const g=og(c,i-1);if(c.isAssetPastPlayoutLimit(g)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,i);return}i=g}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let h=this.preloadAssets(c,i);if(this.eventItemsMatch(o,d||r)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Ki(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(O.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const p=c.assetList[i];if(!p){this.advanceAfterAssetEnded(c,e,i||0);return}if(h||(h=this.getAssetPlayer(p.identifier)),h===null||h.destroyed){const g=c.assetList.length;this.warn(`asset ${i+1}/${g} player destroyed ${c}`),h=this.createAssetPlayer(c,p,i),h.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(p))return;this.startAssetPlayer(h,i,t,e,l),this.shouldPlay&&F2(h.media)}else o?(this.resumePrimary(o,e,r),this.shouldPlay&&F2(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ki(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(qd("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!i)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ki(e)}`),this.hls.trigger(O.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:vt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(qd("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(O.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(O.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const r=kt(kt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=kt(kt({},this.altSelection),{},{audio:i});return}const s=kt(kt({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=kt(kt({},this.altSelection),{},{subtitles:i});return}const s=kt(kt({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,t){const i=qw(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=qw(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var i;const a=this.schedule.findEventIndex(s.identifier),o=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const r=(i=this.schedule)==null?void 0:i.items;if(e&&r){const s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const i=e.end+.25,r=vt.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${Ki(e)} (was ${Ki(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const r=vt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,t,i){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(s),d=Math.min(c+1,t.length-1),h=t[d];if((l===-1&&s&&e>=s.end||(u=h.event)!=null&&u.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(s)){const p=s.event;if(d-o>1&&p.appendInPlace===!1||p.assetList.length===0&&p.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>o)this.bufferedToItem(h);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&h.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else i&&a&&!this.itemsMatch(a,s)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:r,events:s}=i;if(!r||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ki(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const h=this.getAssetPlayer(c.identifier);h&&(d===u&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(O.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){const a=this.preloadAssets(i,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,a=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const h=c-l;h>0&&(u=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),i)return this.createAsset(e,0,0,l,e.duration,i);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&r){for(let u=t;u<r;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,s,a){const o={parentIdentifier:e.identifier,identifier:JK(e,a,t),duration:s,startOffset:i,timelineStart:r,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,i){const r=this.hls,s=r.userConfig;let a=s.videoPreference;const o=r.loadLevelObj||r.levels[r.currentLevel];(a||o)&&(a=Nt({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=r.audioTracks[r.audioTrack],u=r.subtitleTracks[r.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const w=this.timelinePos-t.timelineStart;if(w>1){const A=t.duration;A&&w<A&&(c=w)}}const d=t.identifier,h=kt(kt({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const p=h.cmcd;p!=null&&p.sessionId&&p.contentId&&(h.cmcd=Nt({},p,{contentId:kl(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new nY(this.HlsPlayerClass,h,e,t);this.playerQueue.push(g),e.assetList[i]=t;let v=!0;const y=w=>{if(w.live){var A;const D=new Error(`Interstitials MUST be VOD assets ${e}`),H={fatal:!0,type:rt.OTHER_ERROR,details:fe.INTERSTITIAL_ASSET_ITEM_ERROR,error:D},P=((A=this.schedule)==null?void 0:A.findEventIndex(e.identifier))||-1;this.handleAssetItemError(H,e,P,i,D.message);return}const R=w.edge-w.fragmentStart,_=t.duration;(v||_===null||R>_)&&(v=!1,this.log(`Interstitial asset "${d}" duration change ${_} > ${R}`),t.duration=R,this.updateSchedule())};g.on(O.LEVEL_UPDATED,(w,{details:A})=>y(A)),g.on(O.LEVEL_PTS_UPDATED,(w,{details:A})=>y(A)),g.on(O.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const b=(w,A)=>{const R=this.getAssetPlayer(d);if(R&&A.tracks){R.off(O.BUFFER_CODECS,b),R.tracks=A.tracks;const _=this.primaryMedia;this.bufferingAsset===R.assetItem&&_&&!R.media&&this.bufferAssetPlayer(R,_)}};g.on(O.BUFFER_CODECS,b);const T=()=>{var w;const A=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${A}`),!A||!this.schedule)return;const R=this.schedule.findEventIndex(e.identifier),_=(w=this.schedule.items)==null?void 0:w[R];this.isInterstitial(_)&&this.advanceAssetBuffering(_,t)};g.on(O.BUFFERED_TO_END,T);const x=w=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const R=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,R,w)};return g.once(O.MEDIA_ENDED,x(i)),g.once(O.PLAYOUT_LIMIT_REACHED,x(1/0)),g.on(O.ERROR,(w,A)=>{if(!this.schedule)return;const R=this.getAssetPlayer(d);if(A.details===fe.BUFFER_STALLED_ERROR){if(R!=null&&R.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${A.error} ${e}`)}),g.on(O.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const A=new Error(`Asset player destroyed unexpectedly ${d}`),R={fatal:!0,type:rt.OTHER_ERROR,details:fe.INTERSTITIAL_ASSET_ITEM_ERROR,error:A};this.handleAssetItemError(R,e,this.schedule.findEventIndex(e.identifier),i,A.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${zo(t)}`),this.hls.trigger(O.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const r=this.playerQueue[i];this.log(`clear ${r} toSegment: ${t&&Ki(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,s){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,i[r]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${zo(o)}`),this.hls.trigger(O.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var i,r;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),l=(i=this.schedule.items)==null?void 0:i[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=s.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!R_(d,e.tracks)){const h=new Error(`Asset ${zo(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),p={fatal:!0,type:rt.OTHER_ERROR,details:fe.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=s.findAssetIndex(a);this.handleAssetItemError(p,s,o,g,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const r=i.currentTime,s=t.findAssetIndex(e,r),a=e.assetList[s];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||r-a.timelineStart,u=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${o} ${e} (media.currentTime: ${r})`),l&&(u/i.playbackRate<.5||o.bufferedInPlaceToEnd(i))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,r,s){if(e.details===fe.BUFFER_STALLED_ERROR)return;const a=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&zo(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,d=Nt({},e,{fatal:!1,errorAction:Ko(!0),asset:a,assetListIndex:r,event:t,schedule:c,scheduleIndex:i,player:u});if(this.hls.trigger(O.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,p=this.bufferingAsset,g=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=g),!t.assetList.some(v=>!v.error))t.error=g;else for(let v=r;v<t.assetList.length;v++)this.resetAssetPlayer(t.assetList[v].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===o?this.advanceAfterAssetEnded(t,i,r):p&&p.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,p)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;let r=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${Ki(i)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const a=this.updateItem(i,r);this.itemsMatch(i,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var i,r;const s=t.event,a=s.identifier,o=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(a)))return;const l=s.timelineStart,u=s.duration;let c=0;o.forEach((v,y)=>{const b=parseFloat(v.DURATION);this.createAsset(s,y,c,l+c,b,v.URI),c+=b}),s.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${s}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const p=(r=this.bufferingItem)==null?void 0:r.event;if(h){var g;const v=this.schedule.findEventIndex(a),y=(g=this.schedule.items)==null?void 0:g[v];if(y){if(!this.playingItem&&this.timelinePos>y.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==v){s.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(y)}this.setSchedulePosition(v)}else if((p==null?void 0:p.identifier)===a){const v=s.assetList[0];if(v){const y=this.getAssetPlayer(v.identifier);if(p.appendInPlace){const b=this.primaryMedia;y&&b&&this.bufferAssetPlayer(y,b)}else y&&y.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case fe.ASSET_LIST_PARSING_ERROR:case fe.ASSET_LIST_LOAD_ERROR:case fe.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case fe.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const B2=500;class aY extends o1{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",Xe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=we.IDLE,this.setInterval(B2),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragContextChanged(i)||(an(i)&&(this.fragPrevious=i),this.state=we.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=i.start;for(let u=0;u<s.length;u++)if(o>=s[u].start&&o<=s[u].end){a=s[u];break}const l=i.start+i.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(i,s,Xe.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===Xe.SUBTITLE&&(t.details===fe.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==we.STOPPED&&(this.state=we.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&PL(this.levels,t)){this.levels=t.map(i=>new jl(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new jl(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Xe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==we.STOPPED&&this.setInterval(B2)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=s[o];if(o>=s.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(i=l.details)!=null&&i.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(qf(a,d),u=a.fragmentStart):h&&(u=h.start,Sv(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&h&&(u=h.start,Sv(a,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=a,this.levelLastLoaded=l,o===r&&(this.hls.trigger(O.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===we.IDLE&&(ja(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&Yo(r.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,s1(r.method)).catch(o=>{throw s.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();s.trigger(O.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=we.IDLE})}}doTick(){if(!this.media){this.state=we.IDLE;return}if(this.state===we.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:r}=this,s=this.getLoadPosition(),a=vt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:o,len:l}=a,u=i.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,h=d.length,p=u.edge;let g=null;const v=this.fragPrevious;if(o<p){const T=r.maxFragLookUpTolerance,x=o>p-T?0:T;g=ja(v,d,Math.max(d[0].start,o),x),!g&&v&&v.start<d[0].start&&(g=d[0])}else g=d[h-1];if(g=this.filterReplacedPrimary(g,i.details),!g)return;const y=g.sn-u.startSN,b=d[y-1];if(b&&b.cc===g.cc&&this.fragmentTracker.getState(b)===vn.NOT_LOADED&&(g=b),this.fragmentTracker.getState(g)===vn.NOT_LOADED){const T=this.mapToInitFragWhenRequired(g);T&&this.loadFragment(T,i,o)}}}loadFragment(e,t,i){an(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new oY(this.tracksBuffered[this.currentTrackId]||[])}}class oY{constructor(e){this.buffered=void 0;const t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const uY={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},$L=n=>String.fromCharCode(uY[n]||n),Yi=15,qr=100,lY={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},cY={17:2,18:4,21:6,22:8,23:10,19:13,20:15},dY={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},fY={25:2,26:4,29:6,30:8,31:10,27:13,28:15},hY=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class pY{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Dt.log(`${this.time} [${e}] ${i}`)}}}const Aa=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class KL{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class mY{constructor(){this.uchar=" ",this.penState=new KL}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class gY{constructor(e){this.chars=[],this.pos=0,this.currPenState=new KL,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<qr;t++)this.chars.push(new mY);this.logger=e}equals(e){for(let t=0;t<qr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<qr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<qr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>qr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=qr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=$L(e);if(this.pos>=qr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<qr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<qr;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class ug{constructor(e){this.rows=[],this.currRow=Yi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Yi;t++)this.rows.push(new gY(e));this.logger=e}reset(){for(let e=0;e<Yi;e++)this.rows[e].clear();this.currRow=Yi-1}equals(e){let t=!0;for(let i=0;i<Yi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Yi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Yi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Bt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Yi;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[s+u])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Bt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let s=0;s<Yi;s++){const a=this.rows[s].getTextString();a&&(r=s+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class U2{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new ug(i),this.nonDisplayedMemory=new ug(i),this.lastOutputScreen=new ug(i),this.currRollUpRow=this.displayedMemory.rows[Yi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Yi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+Bt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class H2{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=yY(),this.logger=void 0;const r=this.logger=new pY;this.channels=[null,new U2(e,t,r),new U2(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,s=t[i+1]&127;let a=!1,o=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+Aa([t[i],t[i+1]])+"] -> ("+Aa([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(vY(r,s,l)){$d(null,null,l),this.logger.log(3,()=>"Repeated command ("+Aa([r,s])+") is dropped");continue}$d(r,s,this.cmdHistory),a=this.parseCmd(r,s),a||(a=this.parseMidrow(r,s)),a||(a=this.parsePAC(r,s)),a||(a=this.parseBackgroundAttributes(r,s))}else $d(null,null,l);if(!a&&(o=this.parseChars(r,s),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Aa([r,s])+" orig: "+Aa([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Aa([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?i=a===1?lY[e]:dY[e]:i=a===1?cY[e]:fY[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(i,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+$L(a)+"' in channel "+i),r=[a]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Aa(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=hY[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}$d(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function $d(n,e,t){t.a=n,t.b=e}function vY(n,e,t){return t.a===n&&t.b===e}function yY(){return{a:null,b:null}}var E1=(function(){if(Wf!=null&&Wf.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function i(o){return t(n,o)}function r(o){return t(e,o)}function s(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function a(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",p=!1,g=o,v=l,y=u,b=null,T="",x=!0,w="auto",A="start",R=50,_="middle",D=50,H="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return h},set:function(P){h=""+P}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return p},set:function(P){p=!!P}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return g},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");g=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return v},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");v=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return y},set:function(P){y=""+P,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return b},set:function(P){b=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return T},set:function(P){const N=i(P);if(N===!1)throw new SyntaxError("An invalid or illegal string was specified.");T=N,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return x},set:function(P){x=!!P,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return w},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");w=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return A},set:function(P){const N=r(P);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");A=N,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return R},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");R=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return _},set:function(P){const N=r(P);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");_=N,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return D},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");D=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return H},set:function(P){const N=r(P);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");H=N,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class EY{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function YL(n){function e(i,r,s,a){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class bY{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function XL(n,e,t,i){const r=i?n.split(i):[n];for(const s in r){if(typeof r[s]!="string")continue;const a=r[s].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const Pv=new E1(0,0,""),Kd=Pv.align==="middle"?"middle":"center";function TY(n,e,t){const i=n;function r(){const o=YL(n);if(o===null)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){const u=new bY;XL(o,function(h,p){let g;switch(h){case"region":for(let v=t.length-1;v>=0;v--)if(t[v].id===p){u.set(h,t[v].region);break}break;case"vertical":u.alt(h,p,["rl","lr"]);break;case"line":g=p.split(","),u.integer(h,g[0]),u.percent(h,g[0])&&u.set("snapToLines",!1),u.alt(h,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",Kd,"end"]);break;case"position":g=p.split(","),u.percent(h,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",Kd,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,p);break;case"align":u.alt(h,p,["start",Kd,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&Pv.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Kd);let d=u.get("position","auto");d==="auto"&&Pv.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);n=n.slice(3),a(),e.endTime=r(),a(),s(n,e)}function QL(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class xY{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new EY,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,a=0;for(s=QL(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function r(s){XL(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new E1(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{TY(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const SY=/\r\n|\n\r|\n|\r/g,lg=function(e,t,i=0){return e.slice(i,i+t.length)===t},wY=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!$e(t)||!$e(i)||!$e(r)||!$e(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=3600*1e3*s,t};function b1(n,e,t){return kl(n.toString())+kl(e.toString())+kl(t)}const AY=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function CY(n,e,t,i,r,s,a){const o=new xY,l=bi(new Uint8Array(n)).trim().replace(SY,`
`).split(`
`),u=[],c=e?k$(e.baseTime,e.timescale):0;let d="00:00.000",h=0,p=0,g,v=!0;o.oncue=function(y){const b=t[i];let T=t.ccOffset;const x=(h-c)/9e4;if(b!=null&&b.new&&(p!==void 0?T=t.ccOffset=b.start:AY(t,i,x)),x){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}T=x-t.presentationOffset}const w=y.endTime-y.startTime,A=gi((y.startTime+T-p)*9e4,r*9e4)/9e4;y.startTime=Math.max(A,0),y.endTime=Math.max(A+w,0);const R=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(R)),y.id||(y.id=b1(y.startTime,y.endTime,R)),y.endTime>0&&u.push(y)},o.onparsingerror=function(y){g=y},o.onflush=function(){if(g){a(g);return}s(u)},l.forEach(y=>{if(v)if(lg(y,"X-TIMESTAMP-MAP=")){v=!1,y.slice(16).split(",").forEach(b=>{lg(b,"LOCAL:")?d=b.slice(6):lg(b,"MPEGTS:")&&(h=parseInt(b.slice(7)))});try{p=wY(d)/1e3}catch(b){g=b}return}else y===""&&(v=!1);o.parse(y+`
`)}),o.flush()}const cg="stpp.ttml.im1t",ZL=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,JL=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,IY={left:"start",center:"center",right:"end",start:"start",end:"end"};function z2(n,e,t,i){const r=Tt(new Uint8Array(n),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(o=>bi(o)),a=P$(e.baseTime,1,e.timescale);try{s.forEach(o=>t(RY(o,a)))}catch(o){i(o)}}function RY(n,e){const r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,h)=>(d[h]=r.getAttribute(`ttp:${h}`)||s[h],d),{}),o=r.getAttribute("xml:space")!=="preserve",l=j2(dg(r,"styling","style")),u=j2(dg(r,"layout","region")),c=dg(r,"body","[begin]");return[].map.call(c,d=>{const h=eP(d,o);if(!h||!d.hasAttribute("begin"))return null;const p=hg(d.getAttribute("begin"),a),g=hg(d.getAttribute("dur"),a);let v=hg(d.getAttribute("end"),a);if(p===null)throw V2(d);if(v===null){if(g===null)throw V2(d);v=p+g}const y=new E1(p-e,v-e,h);y.id=b1(y.startTime,y.endTime,y.text);const b=u[d.getAttribute("region")],T=l[d.getAttribute("style")],x=_Y(b,T,l),{textAlign:w}=x;if(w){const A=IY[w];A&&(y.lineAlign=A),y.align=w}return Nt(y,x),y}).filter(d=>d!==null)}function dg(n,e,t){const i=n.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function j2(n){return n.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function eP(n,e){return[].slice.call(n.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?eP(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function _Y(n,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(r=t[a]),s.reduce((o,l)=>{const u=fg(e,i,l)||fg(n,i,l)||fg(r,i,l);return u&&(o[l]=u),o},{})}function fg(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function V2(n){return new Error(`Could not parse ttml timestamp ${n}`)}function hg(n,e){if(!n)return null;let t=YL(n);return t===null&&(ZL.test(n)?t=LY(n,e):JL.test(n)&&(t=PY(n,e))),t}function LY(n,e){const t=ZL.exec(n),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function PY(n,e){const t=JL.exec(n),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Yd{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class kY{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=W2(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Yd(this,"textTrack1"),t=new Yd(this,"textTrack2"),i=new Yd(this,"textTrack3"),r=new Yd(this,"textTrack4");this.cea608Parser1=new H2(1,e,t),this.cea608Parser2=new H2(3,i,r)}addCues(e,t,i,r,s){let a=!1;for(let o=s.length;o--;){const l=s[o],u=DY(l[0],l[1],t,i);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),a=!0,u/(i-t)>.5))return}if(a||s.push([t,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,i,r)}else{const o=this.Cues.newCue(null,t,i,r);this.hls.trigger(O.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:a}){const{unparsedVttFrags:o}=this;i===Xe.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(O.FRAG_LOADED,l):this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(G2(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)i[e]=o,Go(i[e]),GL(i[e],r);else{const l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{Go(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=W2(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Go(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===cg);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(PL(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,o=a?Ef(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let d=null;for(let h=0;h<o.length;h++)if(o[h]&&G2(o[h],l)){d=o[h],o[h]=null;break}d&&(c=d)}if(c)Go(c);else{const d=tP(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,a=this.captionsProperties[s];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Xe.MAIN){var i,r;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===Xe.SUBTITLE)if(r.byteLength){const s=i.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===cg?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;z2(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[i.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=i.initSegment)!=null&&t.data?Oi(i.initSegment.data,new Uint8Array(r)).buffer:r;CY(u,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,c=>{this._appendCues(c,i.level),l.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(i,r),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>i.cc)&&l.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||z2(t,this.initPTS[e.cc],()=>{i.textCodec=cg,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>WL(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;i.trigger(O.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===Xe.SUBTITLE&&this.onFragLoaded(O.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=t;if(!(i.type===Xe.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){const a=r[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(r[s].pts,o[0]),this.cea608Parser2.addData(r[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Lv(o[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Lv(o[l],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let s=0;s<i;s++){const a=e[r++],o=127&e[r++],l=127&e[r++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function tP(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function G2(n,e){return!!n&&n.kind===tP(e)&&Cv(e,n)}function DY(n,e,t,i){return Math.min(e,i)-Math.max(n,t)}function W2(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const OY=/\s/,NY={newCue(n,e,t,i){const r=[];let s,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(s=i.rows[h],o=!0,l=0,u="",!s.isEmpty()){var d;for(let v=0;v<s.chars.length;v++)OY.test(s.chars[v].uchar)&&o?l++:(u+=s.chars[v].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const p=QL(u.trim()),g=b1(e,t,p);n!=null&&(d=n.cues)!=null&&d.getCueById(g)||(a=new c(e,t,p),a.id=g,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(a))}return n&&r.length&&(r.sort((h,p)=>h.line==="auto"||p.line==="auto"?0:h.line>8&&p.line>8?p.line-h.line:h.line-p.line),r.forEach(h=>WL(n,h))),r}};function MY(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const FY=/(\d+)-(\d+)\/(\d+)/;class q2{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||zY,this.controller=new self.AbortController,this.stats=new Zy}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=BY(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&$e(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Wl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const p=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},u-(p-r.loading.start)),!d.ok){const{status:v,statusText:y}=d;throw new jY(y||"fetch, bad network response",v,d)}r.loading.first=p,r.total=HY(d.headers)||r.total;const g=(h=this.callbacks)==null?void 0:h.onProgress;return g&&$e(t.highWaterMark)?this.loadProgressively(d,r,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,p;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const v=d[o];v&&(r.loaded=r.total=v);const y={url:g.url,data:d,code:g.status},b=(h=this.callbacks)==null?void 0:h.onProgress;b&&!$e(t.highWaterMark)&&b(r,e,d,g),(p=this.callbacks)==null||p.onSuccess(y,r,e,g)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const p=d&&d.code||0,g=d?d.message:null;(h=this.callbacks)==null||h.onError({code:p,text:g},e,d?d.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){const a=new dL,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&s(t,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<r||a.dataLength?(a.push(c),a.dataLength>=r&&s(t,i,a.flush().buffer,e)):s(t,i,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function BY(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Nt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function UY(n){const e=FY.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function HY(n){const e=n.get("Content-Range");if(e){const i=UY(e);if($e(i))return i}const t=n.get("Content-Length");if(t)return parseInt(t)}function zY(n,e){return new self.Request(n.url,e)}class jY extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const VY=/^age:\s*[\d.]+\s*$/im;class nP{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Zy,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:i.status,text:a.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=i.loadPolicy;if(r)for(const o in r)e.setRequestHeader(o,r[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&$e(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var a,o;i.loading.end=Math.max(self.performance.now(),i.loading.first);const v=t.responseType==="arraybuffer"?g.byteLength:g.length;i.loaded=i.total=v,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const y=(a=this.callbacks)==null?void 0:a.onProgress;y&&y(i,e,g,t);const b={url:t.responseURL,data:g,code:u};(o=this.callbacks)==null||o.onSuccess(b,i,e,t);return}}const d=s.loadPolicy.errorRetry,h=i.retry,p={url:e.url,data:void 0,code:u};if(Vf(d,h,!1,p))this.retry(d);else{var l;Dt.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Vf(e,t,!0))this.retry(e);else{var i;Dt.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=n1(e,i.retry),i.retry++,Dt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&VY.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const GY={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},WY=kt(kt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:nP,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:iq,bufferController:$$,capLevelController:g1,errorController:uq,fpsController:KK,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:eL,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:GY},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},qY()),{},{subtitleStreamController:aY,subtitleTrackController:QK,timelineController:kY,audioStreamController:V$,audioTrackController:G$,emeController:Xo,cmcdController:GK,contentSteeringController:qK,interstitialsController:sY});function qY(){return{cueHandler:NY,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function $Y(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=kv(n),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];s.forEach(c=>{const d=`${a}Loading${c}`,h=e[d];if(h!==void 0&&l){u.push(d);const p=i[o].default;switch(e[o]={default:p},c){case"TimeOut":p.maxLoadTimeMs=h,p.maxTimeToFirstByteMs=h;break;case"MaxRetry":p.errorRetry.maxNumRetry=h,p.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":p.errorRetry.retryDelayMs=h,p.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=h,p.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${Bt(e[o])}`)}),kt(kt({},i),e)}function kv(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(kv):Object.keys(n).reduce((e,t)=>(e[t]=kv(n[t]),e),{}):n}function KY(n,e){const t=n.loader;t!==q2&&t!==nP?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):MY()&&(n.loader=q2,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const bf=2,YY=.1,XY=.05,QY=100;class ZY extends Y_{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(QY),this.mediaSource=t.mediaSource;const i=this.media=t.media;$n(i,"playing",this.onMediaPlaying),$n(i,"waiting",this.onMediaWaiting),$n(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(ri(i,"playing",this.onMediaPlaying),ri(i,"waiting",this.onMediaWaiting),ri(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;const s=(i=this.hls)==null?void 0:i.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1}));return}if(!vt.getBuffered(a).length){this.nudgeRetry=0;return}const d=vt.bufferInfo(a,e,0),h=d.nextStart||0,p=this.fragmentTracker;if(o&&p&&this.hls){const R=$2(this.hls.inFlightFragments,e),_=d.len>bf,D=!h||R||h-e>bf&&!p.getPartialFragment(e);if(_||D)return;this.moved=!1}const g=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){if(!(d.len>0)&&!h)return;const _=Math.max(h,d.start||0)-e,H=!!(g!=null&&g.live)?g.targetduration*2:bf,P=Xd(e,p);if(_>0&&(_<=H||P)){a.paused||this._trySkipBufferHole(P);return}}const v=s.detectStallWithCurrentTimeMs,y=self.performance.now(),b=this.waiting;let T=this.stalled;if(T===null)if(b>0&&y-b<v)T=this.stalled=b;else{this.stalled=y;return}const x=y-T;if(!o&&(x>=v||b)&&this.hls){var w;if(((w=this.mediaSource)==null?void 0:w.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const A=vt.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(A,x,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(O.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const s=vt.bufferedInfo(vt.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=vt.timeRangesToArray(r),o=vt.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=vt.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=Xd(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const p=vt.bufferInfo(this.media,e,0);this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:p.len,bufferInfo:p})}}}}}_tryFixBufferStall(e,t,i){var r,s;const{fragmentTracker:a,media:o}=this,l=(r=this.hls)==null?void 0:r.config;if(!o||!a||!l)return;const u=(s=this.hls)==null?void 0:s.latestLevelDetails,c=Xd(i,a);if((c||u!=null&&u.live&&i<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,i);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-i<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,r=e.nextStart;if(i&&r){const s=i.getFragAtPos(t,Xe.MAIN),a=i.getFragAtPos(r,Xe.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Bt(e)})`);this.warn(a.message),t.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!i||!s)return 0;const a=r.currentTime,o=vt.bufferInfo(r,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=s.maxBufferHole,d=o.len>0&&o.len<1&&r.readyState<3,h=l-a;if(h>0&&(c||d)){if(h>s.maxBufferHole){let g=!1;if(a===0){const v=i.getAppendedFrag(0,Xe.MAIN);v&&l<v.end&&(g=!0)}if(!g&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||$2(this.hls.inFlightFragments,l))return 0;let y=!1,b=e.end;for(;b<l;){const T=Xd(b,i);if(T)b+=T.duration;else{y=!0;break}}if(y)return 0}}const p=Math.max(l+XY,a+YY);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${p}`),this.moved=!0,r.currentTime=p,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${p}`),v={type:rt.MEDIA_ERROR,details:fe.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?v.part=e:v.frag=e),this.hls.trigger(O.ERROR,v)}return p}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!i||!s)return 0;const a=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const o=a+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),i.currentTime=o,t.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function $2(n,e){const t=K2(n.main);if(t&&t.start<=e)return t;const i=K2(n.audio);return i&&i.start<=e?i:null}function K2(n){if(!n)return null;switch(n.state){case we.IDLE:case we.STOPPED:case we.ENDED:case we.ERROR:return null}return n.frag}function Xd(n,e){return e.getAppendedFrag(n,Xe.MAIN)||e.getPartialFragment(n)}const JY=.25;function Dv(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function pg(n,e,t,i,r){let s=new n(e,t,"");try{s.value=i,r&&(s.type=r)}catch{s=new n(e,t,Bt(r?kt({type:r},i):i))}return s}const Qd=(()=>{const n=Dv();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class eX{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(O.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Go(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return GL(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Dv();if(a)for(let o=0;o<s.length;o++){const l=s[o].type;if(l===vi.emsg&&!i||!r)continue;const u=yL(s[o].data),c=s[o].pts;let d=c+s[o].duration;d>Qd&&(d=Qd),d-c<=0&&(d=c+JY);for(let p=0;p<u.length;p++){const g=u[p];if(!EL(g)){this.updateId3CueEnds(c,l);const v=pg(a,c,d,g,l);v&&this.id3Track.addCue(v)}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){const a=r[s];a.type===t&&a.startTime<e&&a.endTime===Qd&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let u;r==="audio"?u=c=>c.type===vi.audioId3&&l:r==="video"?u=c=>c.type===vi.emsg&&o:u=c=>c.type===vi.audioId3&&l||c.type===vi.emsg&&o,Lv(s,t,i,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=Dv();if(i&&r&&!a){const{fragmentStart:v,fragmentEnd:y}=e;let b=this.assetCue;b?(b.startTime=v,b.endTime=y):o&&(b=this.assetCue=pg(o,v,y,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),b&&(b.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(b),b.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const v=Object.keys(d).filter(y=>!c.includes(y));for(let y=v.length;y--;){var p;const b=v[y],T=(p=d[b])==null?void 0:p.cues;delete d[b],T&&Object.keys(T).forEach(x=>{const w=T[x];if(w){w.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(w)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(c.length===0||!$e(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let v=0;v<c.length;v++){const y=c[v],b=u[y],T=b.startTime,x=d[y],w=(x==null?void 0:x.cues)||{};let A=(x==null?void 0:x.durationKnown)||!1,R=Qd;const{duration:_,endDate:D}=b;if(D&&_!==null)R=T+_,A=!0;else if(b.endOnNext&&!A){const P=c.reduce((N,G)=>{if(G!==b.id){const X=u[G];if(X.class===b.class&&X.startDate>b.startDate&&(!N||b.startDate<N.startDate))return X}return N},null);P&&(R=P.startTime,A=!0)}const H=Object.keys(b.attr);for(let P=0;P<H.length;P++){const N=H[P];if(!Tq(N))continue;const G=w[N];if(G)A&&!(x!=null&&x.durationKnown)?G.endTime=R:Math.abs(G.startTime-T)>.01&&(G.startTime=T,G.endTime=R);else if(o){let X=b.attr[N];xq(N)&&(X=__(X));const Q=pg(o,T,R,{key:N,data:X},vi.dateRange);Q&&(Q.id=y,this.id3Track.addCue(Q),w[N]=Q,a&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&Q.addEventListener("enter",this.onEventCueEnter))}}d[y]={cues:w,dateRange:b,durationKnown:A}}}}}class tX{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!i.live)return;const o=this.targetLatency;if(o===null)return;const l=r-o,u=Math.min(this.maxLatency,o+i.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,p=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,p)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&i||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:a*r);const c=r;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,s=e-t-this.edgeStalled,a=r-i.totalduration,o=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===fe.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class nX extends m1{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],s={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:h,videoCodec:p}=c;h&&(c.audioCodec=h=Uf(h,i)||void 0),p&&(p=c.videoCodec=BW(p));const{width:g,height:v,unknownCodecs:y}=c,b=(y==null?void 0:y.length)||0;if(o||(o=!!(g&&v)),l||(l=!!p),u||(u=!!h),b||h&&!this.isAudioSupported(h)||p&&!this.isVideoSupported(p)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:T,"FRAME-RATE":x,"HDCP-LEVEL":w,"PATHWAY-ID":A,RESOLUTION:R,"VIDEO-RANGE":_}=d,H=`${`${A||"."}-`}${c.bitrate}-${R}-${x}-${T}-${_}-${w}`;if(s[H])if(s[H].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const P=a[H]+=1;c.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const N=this.createLevel(c);s[H]=N,r.push(N)}else s[H].addGroupId("audio",d.AUDIO),s[H].addGroupId("text",d.SUBTITLES);else{const P=this.createLevel(c);s[H]=P,a[H]=1,r.push(P)}}),this.filterAndSortMediaOptions(r,t,o,l,u)}createLevel(e){const t=new jl(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=z_(r,[])}return t}isAudioSupported(e){return Hl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Hl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,s){var a;let o=[],l=[],u=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((i||r)&&s&&(u=u.filter(({videoCodec:T,videoRange:x,width:w,height:A})=>(!!T||!!(w&&A))&&KW(x))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let T="no level with compatible codecs found in manifest",x=T;t.levels.length&&(x=`one or more CODECS in variant not supported: ${Bt(t.levels.map(A=>A.attrs.CODECS).filter((A,R,_)=>_.indexOf(A)===R))}`,this.warn(x),T+=` (${x})`);const w=new Error(T);this.hls.trigger(O.ERROR,{type:rt.MEDIA_ERROR,details:fe.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:w,reason:x})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(T=>!T.audioCodec||this.isAudioSupported(T.audioCodec)),Y2(o)),t.subtitles&&(l=t.subtitles,Y2(l));const d=u.slice(0);u.sort((T,x)=>{if(T.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"])return(T.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&T.height!==x.height)return T.height-x.height;if(T.frameRate!==x.frameRate)return T.frameRate-x.frameRate;if(T.videoRange!==x.videoRange)return Hf.indexOf(T.videoRange)-Hf.indexOf(x.videoRange);if(T.videoCodec!==x.videoCodec){const w=Hw(T.videoCodec),A=Hw(x.videoCodec);if(w!==A)return A-w}if(T.uri===x.uri&&T.codecSet!==x.codecSet){const w=Bf(T.codecSet),A=Bf(x.codecSet);if(w!==A)return A-w}return T.averageBitrate!==x.averageBitrate?T.averageBitrate-x.averageBitrate:0});let h=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let T=0;T<d.length;T++)if(d[T].pathwayId===u[0].pathwayId){h=d[T];break}}this._levels=u;for(let T=0;T<u.length;T++)if(u[T]===h){var p;this._firstLevel=T;const x=h.bitrate,w=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${x}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const A=Math.min(x,this.hls.config.abrEwmaDefaultEstimateMax);A>w&&w===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=A)}break}const g=s&&!r,v=this.hls.config,y=!!(v.audioStreamController&&v.audioTrackController),b={levels:u,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:y&&!g&&o.some(T=>!!T.url)};c.end=performance.now(),this.hls.trigger(O.MANIFEST_PARSED,b)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&r&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${i}${s?" with Pathway "+s:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(O.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,r==null?void 0:r.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===wt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Xe.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${r}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(O.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));uL(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(O.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(O.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Y2(n){const e={};n.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function iP(){return self.SourceBuffer||self.WebKitSourceBuffer}function rP(){if(!$s())return!1;const e=iP();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function iX(){if(!rP())return!1;const n=$s();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(zl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(zl(e,"audio"))))}function rX(){var n;const e=iP();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const sX=100;class aX extends o1{constructor(e,t,i){super(e,t,i,"stream-controller",Xe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!$e(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(r,s,Xe.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(sX),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=we.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=we.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case we.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e==null?void 0:e[t],r=i==null?void 0:i.details;if(r&&(!r.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(r))break;this.state=we.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=we.IDLE;break}break}case we.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===we.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;const a=i[s],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const v={};this.altAudio===2&&(v.type="video"),this.hls.trigger(O.BUFFER_EOS,v),this.state=we.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=a.details;if(!u||this.state===we.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=we.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let p=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&p&&an(p)&&this.fragmentTracker.getState(p)!==vn.OK){var g;const y=((g=this.backtrackFragment)!=null?g:p).sn-u.startSN,b=u.fragments[y-1];b&&p.cc===b.cc&&(p=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,h)){if(!p.gap){const y=this.audioOnly&&!this.altAudio?Ft.AUDIO:Ft.VIDEO,b=(y===Ft.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,y,Xe.MAIN)}p=this.getNextFragmentLoopLoading(p,u,o,Xe.MAIN,d)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,a,h))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);r===vn.NOT_LOADED||r===vn.PARTIAL?an(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Xe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:i=0}else i=0;const a=this.getBufferedFrag(t.currentTime+i);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case we.KEY_LOADING:case we.FRAG_LOADING:case we.FRAG_LOADING_WAITING_RETRY:case we.PARSING:case we.PARSED:this.state=we.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;$n(i,"playing",this.onMediaPlaying),$n(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(ri(i,"playing",this.onMediaPlaying),ri(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,r=r||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&r&&!rX(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==we.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=we.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r,startFragRequested:s}=this,a=t.level,o=t.details,l=o.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===we.FRAG_LOADING||this.state===we.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(i=u.details)!=null&&i.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(u.details=o,this.levelLastLoaded=u,s||this.setStartPosition(o,d),this.hls.trigger(O.LEVEL_UPDATED,{details:o,level:a}),this.state===we.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=we.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=s>=a-t.maxFragLookUpTolerance&&s<=o;if(r!==null&&i.duration>r&&(s<r||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&i.readyState<4||s<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=vt.bufferInfo(i,r,0);if(!((u=d.buffered)!=null&&u.length)){i.currentTime=r;return}if(d.start<=s){i.currentTime=r;return}const{nextStart:p}=vt.bufferedInfo(d.buffered,s,0);p&&(i.currentTime=p)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=a[i.level];if(!o){this.warn(`Level ${i.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(t=i.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),p=this.transmuxer=this.transmuxer||new LL(this.hls,Xe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=r?r.index:-1,v=g!==-1,y=new r1(i.level,i.sn,i.stats.chunkCount,s.byteLength,g,v),b=this.initPTS[i.cc];p.push(s,d,h,u,i,r,l.totalduration,c,y,b)}onAudioTrackSwitching(e,t){const i=this.hls,r=this.altAudio!==0;if(zf(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(O.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(O.AUDIO_TRACK_SWITCHED,t)}),i.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(O.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=zf(t.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,s,a=!1;for(const o in i){const l=i[o];if(l.id==="main"){if(s=o,r=l,o==="video"){const u=i[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t,s=i.type===Xe.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===we.PARSED&&(this.state=we.IDLE);return}const o=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),an(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const a=this.media;a&&(!this._hasEnoughToStart&&vt.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=we.ERROR;return}switch(t.details){case fe.FRAG_GAP:case fe.FRAG_PARSING_ERROR:case fe.FRAG_DECRYPT_ERROR:case fe.FRAG_LOAD_ERROR:case fe.FRAG_LOAD_TIMEOUT:case fe.KEY_LOAD_ERROR:case fe.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xe.MAIN,t);break;case fe.LEVEL_LOAD_ERROR:case fe.LEVEL_LOAD_TIMEOUT:case fe.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===we.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===wt.LEVEL&&(this.state=we.IDLE);break;case fe.BUFFER_ADD_CODEC_ERROR:case fe.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case fe.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case fe.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=we.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ft.AUDIO||!this.altAudio){const i=(t===Ft.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,Xe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const s=this.getLevelDetails(),a=vt.getBuffered(e),o=a.length?a.start(0):0,l=o-i,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${o}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this,s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=we.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(O.FRAG_LOADED,i),s.bitrateTest=!1}).catch(i=>{this.state===we.STOPPED||this.state===we.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:o,part:l,level:u}=a,{video:c,text:d,id3:h,initSegment:p}=r,{details:g}=u,v=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=we.PARSING,p){const y=p.tracks;if(y){const w=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(u,y,w,s),i.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:t,tracks:y})}const b=p.initPTS,T=p.timescale,x=this.initPTS[o.cc];if($e(b)&&(!x||x.baseTime!==b||x.timescale!==T)){const w=p.trackId;this.initPTS[o.cc]={baseTime:b,timescale:T,trackId:w},i.trigger(O.INIT_PTS_FOUND,{frag:o,id:t,initPTS:b,timescale:T,trackId:w})}}if(c&&g){v&&c.type==="audiovideo"&&this.logMuxedErr(o);const y=g.fragments[o.sn-1-g.startSN],b=o.sn===g.startSN,T=!y||o.cc>y.cc;if(r.independent!==!1){const{startPTS:x,endPTS:w,startDTS:A,endDTS:R}=c;if(l)l.elementaryStreams[c.type]={startPTS:x,endPTS:w,startDTS:A,endDTS:R};else if(c.firstKeyFrame&&c.independent&&s.id===1&&!T&&(this.couldBacktrack=!0),c.dropped&&c.independent){const _=this.getMainFwdBufferInfo(),D=(_?_.end:this.getLoadPosition())+this.config.maxBufferHole,H=c.firstKeyFramePTS?c.firstKeyFramePTS:x;if(!b&&D<H-this.config.maxBufferHole&&!T){this.backtrack(o);return}else T&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,w,o.start,R,!0)}else b&&x-(g.appliedTimelineOffset||0)>bf&&(o.gap=!0);o.setElementaryStreamInfo(c.type,x,w,A,R),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,s,b||T)}else if(b||T)o.gap=!0;else{this.backtrack(o);return}}if(v){const{startPTS:y,endPTS:b,startDTS:T,endDTS:x}=v;l&&(l.elementaryStreams[Ft.AUDIO]={startPTS:y,endPTS:b,startDTS:T,endDTS:x}),o.setElementaryStreamInfo(Ft.AUDIO,y,b,T,x),this.bufferFragmentData(v,o,l,s)}if(g&&h!=null&&h.samples.length){const y={id:t,frag:o,details:g,samples:h.samples};i.trigger(O.FRAG_PARSING_METADATA,y)}if(g&&d){const y={id:t,frag:o,details:g,samples:d.samples};i.trigger(O.FRAG_PARSING_USERDATA,y)}}logMuxedErr(e){this.warn(`${an(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==we.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:s,video:a,audiovideo:o}=t;if(s){const u=e.audioCodec;let c=hf(s.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const h=s.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),s.levelCodec=c,s.id=Xe.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Xe.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(O.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(O.BUFFER_APPENDING,{type:u,data:d,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Xe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=we.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(vt.isBuffered(e,i)?t=this.getAppendedFrag(i):vt.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(O.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(O.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return $e(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if($e(t)){const i=this.getLevelDetails(),r=this.currentFrag||(i?ja(null,i.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const a=s+(t-r.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class oX extends Mi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=fe.KEY_LOAD_ERROR,i,r,s){return new Kr({type:rt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const a=t[r];if(e.cc<=a.cc&&(!an(e)||!an(a)||e.sn<a.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=mf(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=ml(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,fe.KEY_LOAD_ERROR,u))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,fe.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=mg(s);let l=this.keyIdToKeyInfo[o];if((i=l)!=null&&i.decryptdata.key)return s.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return s.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${s.keyId?" keyId: "+_n(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,fe.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const a=CW(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${_n(o)}`),Vs.setKeyIdForUri(e.decryptdata.uri,o)):(o=Vs.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${_n(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!an(t))return Promise.resolve(i);const s=this.emeController.loadKey(i);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,i))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,p,g,v)=>{const{frag:y,keyInfo:b}=g,T=mg(b.decryptdata);if(!y.decryptdata||b!==this.keyIdToKeyInfo[T])return o(this.createKeyLoadError(y,fe.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),v));b.decryptdata.key=y.decryptdata.key=new Uint8Array(h.data),y.keyLoader=null,b.loader=null,a({frag:y,keyInfo:b})},onError:(h,p,g,v)=>{this.resetLoader(p),o(this.createKeyLoadError(t,fe.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,kt({url:l.url,data:void 0},h)))},onTimeout:(h,p,g)=>{this.resetLoader(p),o(this.createKeyLoadError(t,fe.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,p,g)=>{this.resetLoader(p),o(this.createKeyLoadError(t,fe.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};s.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null);const a=mg(i.decryptdata)||r;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function mg(n){if(n.keyFormat!==Ln.FAIRPLAY){const e=n.keyId;if(e)return _n(e)}return n.uri}function X2(n){const{type:e}=n;switch(e){case wt.AUDIO_TRACK:return Xe.AUDIO;case wt.SUBTITLE_TRACK:return Xe.SUBTITLE;default:return Xe.MAIN}}function gg(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class uX{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:wt.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:wt.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:a,track:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:wt.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:a,track:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:wt.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const i=this.loaders[wt.LEVEL];if(i){const r=i.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[wt.LEVEL])}}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const u=this.hls.logger,c=r.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===wt.MANIFEST?s=i.manifestLoadPolicy.default:s=Nt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),$e((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===wt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===wt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===wt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;s=Nt({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const p=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;c.parsing.start=performance.now(),Er.isMediaPlaylist(g)||d.type!==wt.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,h||null,p):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};r.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){const s=this.hls,a=e.data,o=gg(e,i),l=Er.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,l.playlistParsingError,r,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:p,variableList:g}=l;this.variableList=g,c.forEach(T=>{const{unknownCodecs:x}=T;if(x){const{preferManagedMediaSource:w}=this.hls.config;let{audioCodec:A,videoCodec:R}=T;for(let _=x.length;_--;){const D=x[_];Hl(D,"audio",w)?(T.audioCodec=A=A?`${A},${D}`:D,ru.audio[A.substring(0,4)]=2,x.splice(_,1)):Hl(D,"video",w)&&(T.videoCodec=R=R?`${R},${D}`:D,ru.video[R.substring(0,4)]=2,x.splice(_,1))}}});const{AUDIO:v=[],SUBTITLES:y,"CLOSED-CAPTIONS":b}=Er.parseMasterPlaylistMedia(a,o,l);v.length&&!v.some(x=>!x.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Zt({}),bitrate:0,url:""})),s.trigger(O.MANIFEST_LOADED,{levels:c,audioTracks:v,subtitles:y,captions:b,contentSteering:u,url:o,stats:t,networkDetails:r,sessionData:d,sessionKeys:h,startTimeOffset:p,variableList:g})}handleTrackOrLevelPlaylist(e,t,i,r,s){const a=this.hls,{id:o,level:l,type:u}=i,c=gg(e,i),d=$e(l)?l:$e(o)?o:0,h=X2(i),p=Er.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(u===wt.MANIFEST){const g={attrs:new Zt({}),bitrate:0,details:p,name:"",url:c};p.requestScheduled=t.loading.start+sL(p,0),a.trigger(O.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=p,this.handlePlaylistLoaded(p,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(O.ERROR,{type:rt.NETWORK_ERROR,details:fe.MANIFEST_PARSING_ERROR,fatal:t.type===wt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let a=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===wt.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===wt.AUDIO_TRACK||e.type===wt.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=fe.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case wt.MANIFEST:l=i?fe.MANIFEST_LOAD_TIMEOUT:fe.MANIFEST_LOAD_ERROR,u=!0;break;case wt.LEVEL:l=i?fe.LEVEL_LOAD_TIMEOUT:fe.LEVEL_LOAD_ERROR,u=!1;break;case wt.AUDIO_TRACK:l=i?fe.AUDIO_TRACK_LOAD_TIMEOUT:fe.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case wt.SUBTITLE_TRACK:l=i?fe.SUBTITLE_TRACK_LOAD_TIMEOUT:fe.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:rt.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:s};if(r){const h=(t==null?void 0:t.url)||e.url;d.response=kt({url:h,data:void 0},r)}this.hls.trigger(O.ERROR,d)}handlePlaylistLoaded(e,t,i,r,s,a){const o=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:h,deliveryDirectives:p}=r,g=gg(t,r),v=X2(r);let y=typeof r.level=="number"&&v===Xe.MAIN?u:void 0;const b=e.playlistParsingError;if(b){if(this.hls.logger.warn(`${b} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(O.ERROR,{type:rt.NETWORK_ERROR,details:fe.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:b,reason:b.message,response:t,context:r,level:y,parent:v,networkDetails:s,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const T=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(O.ERROR,{type:rt.NETWORK_ERROR,details:fe.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:T,reason:T.message,response:t,context:r,level:y,parent:v,networkDetails:s,stats:i});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case wt.MANIFEST:case wt.LEVEL:if(y){if(!c)y=0;else if(c!==o.levels[y]){const T=o.levels.indexOf(c);T>-1&&(y=T)}}o.trigger(O.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:y||0,id:d||0,stats:i,networkDetails:s,deliveryDirectives:p,withoutMultiVariant:l===wt.MANIFEST});break;case wt.AUDIO_TRACK:o.trigger(O.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:i,networkDetails:s,deliveryDirectives:p});break;case wt.SUBTITLE_TRACK:o.trigger(O.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:i,networkDetails:s,deliveryDirectives:p});break}}}class Pn{static get version(){return Vl}static isMSESupported(){return rP()}static isSupported(){return iX()}static getMediaSource(){return $s()}static get Events(){return O}static get MetadataSchema(){return vi}static get ErrorTypes(){return rt}static get ErrorDetails(){return fe}static get DefaultConfig(){return Pn.defaultConfig?Pn.defaultConfig:WY}static set DefaultConfig(e){Pn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new u1,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=pW(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=$Y(Pn.DefaultConfig,e,t);this.userConfig=e,i.progressive&&KY(i,t);const{abrController:r,bufferController:s,capLevelController:a,errorController:o,fpsController:l}=i,u=new o(this),c=this.abrController=new r(this),d=new lq(this),h=i.interstitialsController,p=h?this.interstitialsController=new h(this,Pn):null,g=this.bufferController=new s(this,d),v=this.capLevelController=new a(this),y=new l(this),b=new uX(this),T=i.contentSteeringController,x=T?new T(this):null,w=this.levelController=new nX(this,x),A=new eX(this),R=new oX(this.config,this.logger),_=this.streamController=new aX(this,d,R),D=this.gapController=new ZY(this,d);v.setStreamController(_),y.setStreamController(_);const H=[b,w,_];p&&H.splice(1,0,p),x&&H.splice(1,0,x),this.networkControllers=H;const P=[c,g,D,v,y,A,d];this.audioTrackController=this.createController(i.audioTrackController,H);const N=i.audioStreamController;N&&H.push(this.audioStreamController=new N(this,d,R)),this.subtitleTrackController=this.createController(i.subtitleTrackController,H);const G=i.subtitleStreamController;G&&H.push(this.subtititleStreamController=new G(this,d,R)),this.createController(i.timelineController,P),R.emeController=this.emeController=this.createController(i.emeController,P),this.cmcdController=this.createController(i.cmcdController,P),this.latencyController=this.createController(tX,P),this.coreComponents=P,H.push(u);const X=u.onErrorOut;typeof X=="function"&&this.on(O.ERROR,X,u),this.on(O.MANIFEST_LOADED,b.onManifestLoaded,b)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===O.ERROR;this.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(O.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(O.ERROR,{type:rt.OTHER_ERROR,details:fe.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(O.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(O.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(O.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,r=this._url=Qy.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(O.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Xe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Xe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Xe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=ZK()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){$W(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let s=r;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=i)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=G_(t);return j_(e,i,navigator.mediaCapabilities)}}Pn.defaultConfig=void 0;function Jr(){return Jr=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Jr.apply(null,arguments)}function Dl(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function lX(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function sP(...n){return e=>n.forEach(t=>lX(t,e))}function aP(...n){return U.useCallback(sP(...n),n)}function cX(n,e=[]){let t=[];function i(s,a){const o=U.createContext(a),l=t.length;t=[...t,a];function u(d){const{scope:h,children:p,...g}=d,v=(h==null?void 0:h[n][l])||o,y=U.useMemo(()=>g,Object.values(g));return U.createElement(v.Provider,{value:y},p)}function c(d,h){const p=(h==null?void 0:h[n][l])||o,g=U.useContext(p);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,c]}const r=()=>{const s=t.map(a=>U.createContext(a));return function(o){const l=(o==null?void 0:o[n])||s;return U.useMemo(()=>({[`__scope${n}`]:{...o,[n]:l}}),[o,l])}};return r.scopeName=n,[i,dX(r,...e)]}function dX(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const i=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const a=i.reduce((o,{useScope:l,scopeName:u})=>{const d=l(s)[`__scope${u}`];return{...o,...d}},{});return U.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}const fX=globalThis!=null&&globalThis.document?U.useLayoutEffect:()=>{},hX=ay.useId||(()=>{});let pX=0;function mX(n){const[e,t]=U.useState(hX());return fX(()=>{t(i=>i??String(pX++))},[n]),e?`radix-${e}`:""}const oP=U.forwardRef((n,e)=>{const{children:t,...i}=n,r=U.Children.toArray(t),s=r.find(vX);if(s){const a=s.props.children,o=r.map(l=>l===s?U.Children.count(a)>1?U.Children.only(null):U.isValidElement(a)?a.props.children:null:l);return U.createElement(Ov,Jr({},i,{ref:e}),U.isValidElement(a)?U.cloneElement(a,void 0,o):null)}return U.createElement(Ov,Jr({},i,{ref:e}),t)});oP.displayName="Slot";const Ov=U.forwardRef((n,e)=>{const{children:t,...i}=n;return U.isValidElement(t)?U.cloneElement(t,{...yX(i,t.props),ref:e?sP(e,t.ref):t.ref}):U.Children.count(t)>1?U.Children.only(null):null});Ov.displayName="SlotClone";const gX=({children:n})=>U.createElement(U.Fragment,null,n);function vX(n){return U.isValidElement(n)&&n.type===gX}function yX(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...o)=>{s(...o),r(...o)}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}const EX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Rh=EX.reduce((n,e)=>{const t=U.forwardRef((i,r)=>{const{asChild:s,...a}=i,o=s?oP:e;return U.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),U.createElement(o,Jr({},a,{ref:r}))});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{}),[T1]=cX("Form"),uP="Form",[bX,lP]=T1(uP),[TX,xX]=T1(uP),SX=U.forwardRef((n,e)=>{const{__scopeForm:t,onClearServerErrors:i=()=>{},...r}=n,s=U.useRef(null),a=aP(e,s),[o,l]=U.useState({}),u=U.useCallback(P=>o[P],[o]),c=U.useCallback((P,N)=>l(G=>{var X;return{...G,[P]:{...(X=G[P])!==null&&X!==void 0?X:{},...N}}}),[]),d=U.useCallback(P=>{l(N=>({...N,[P]:void 0})),T(N=>({...N,[P]:{}}))},[]),[h,p]=U.useState({}),g=U.useCallback(P=>{var N;return(N=h[P])!==null&&N!==void 0?N:[]},[h]),v=U.useCallback((P,N)=>{p(G=>{var X;return{...G,[P]:[...(X=G[P])!==null&&X!==void 0?X:[],N]}})},[]),y=U.useCallback((P,N)=>{p(G=>{var X;return{...G,[P]:((X=G[P])!==null&&X!==void 0?X:[]).filter(te=>te.id!==N)}})},[]),[b,T]=U.useState({}),x=U.useCallback(P=>{var N;return(N=b[P])!==null&&N!==void 0?N:{}},[b]),w=U.useCallback((P,N)=>{T(G=>{var X;return{...G,[P]:{...(X=G[P])!==null&&X!==void 0?X:{},...N}}})},[]),[A,R]=U.useState({}),_=U.useCallback((P,N)=>{R(G=>{const X=new Set(G[P]).add(N);return{...G,[P]:X}})},[]),D=U.useCallback((P,N)=>{R(G=>{const X=new Set(G[P]);return X.delete(N),{...G,[P]:X}})},[]),H=U.useCallback(P=>{var N;return Array.from((N=A[P])!==null&&N!==void 0?N:[]).join(" ")||void 0},[A]);return U.createElement(bX,{scope:t,getFieldValidity:u,onFieldValidityChange:c,getFieldCustomMatcherEntries:g,onFieldCustomMatcherEntryAdd:v,onFieldCustomMatcherEntryRemove:y,getFieldCustomErrors:x,onFieldCustomErrorsChange:w,onFieldValiditionClear:d},U.createElement(TX,{scope:t,onFieldMessageIdAdd:_,onFieldMessageIdRemove:D,getFieldDescription:H},U.createElement(Rh.form,Jr({},r,{ref:a,onInvalid:Dl(n.onInvalid,P=>{const N=dP(P.currentTarget);N===P.target&&N.focus(),P.preventDefault()}),onSubmit:Dl(n.onSubmit,i,{checkForDefaultPrevented:!1}),onReset:Dl(n.onReset,i)}))))}),cP="FormField",[wX,AX]=T1(cP),CX=U.forwardRef((n,e)=>{const{__scopeForm:t,name:i,serverInvalid:r=!1,...s}=n,o=lP(cP,t).getFieldValidity(i),l=mX();return U.createElement(wX,{scope:t,id:l,name:i,serverInvalid:r},U.createElement(Rh.div,Jr({"data-valid":fP(o,r),"data-invalid":hP(o,r)},s,{ref:e})))}),vg="FormControl",IX=U.forwardRef((n,e)=>{const{__scopeForm:t,...i}=n,r=lP(vg,t),s=AX(vg,t),a=xX(vg,t),o=U.useRef(null),l=aP(e,o),u=i.name||s.name,c=i.id||s.id,d=r.getFieldCustomMatcherEntries(u),{onFieldValidityChange:h,onFieldCustomErrorsChange:p,onFieldValiditionClear:g}=r,v=U.useCallback(async T=>{if(NX(T.validity)){const G=yg(T.validity);h(u,G);return}const x=T.form?new FormData(T.form):new FormData,w=[T.value,x],A=[],R=[];d.forEach(G=>{kX(G,w)?R.push(G):DX(G)&&A.push(G)});const _=A.map(({id:G,match:X})=>[G,X(...w)]),D=Object.fromEntries(_),H=Object.values(D).some(Boolean),P=H;T.setCustomValidity(P?Q2:"");const N=yg(T.validity);if(h(u,N),p(u,D),!H&&R.length>0){const G=R.map(({id:Z,match:se})=>se(...w).then(j=>[Z,j])),X=await Promise.all(G),te=Object.fromEntries(X),ne=Object.values(te).some(Boolean);T.setCustomValidity(ne?Q2:"");const oe=yg(T.validity);h(u,oe),p(u,te)}},[d,u,p,h]);U.useEffect(()=>{const T=o.current;if(T){const x=()=>v(T);return T.addEventListener("change",x),()=>T.removeEventListener("change",x)}},[v]);const y=U.useCallback(()=>{const T=o.current;T&&(T.setCustomValidity(""),g(u))},[u,g]);U.useEffect(()=>{var T;const x=(T=o.current)===null||T===void 0?void 0:T.form;if(x)return x.addEventListener("reset",y),()=>x.removeEventListener("reset",y)},[y]),U.useEffect(()=>{const T=o.current,x=T==null?void 0:T.closest("form");if(x&&s.serverInvalid){const w=dP(x);w===T&&w.focus()}},[s.serverInvalid]);const b=r.getFieldValidity(u);return U.createElement(Rh.input,Jr({"data-valid":fP(b,s.serverInvalid),"data-invalid":hP(b,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":a.getFieldDescription(u),title:""},i,{ref:l,id:c,name:u,onInvalid:Dl(n.onInvalid,T=>{const x=T.currentTarget;v(x)}),onChange:Dl(n.onChange,T=>{y()})}))}),Q2="This value is not valid",RX=U.forwardRef((n,e)=>{const{__scopeForm:t,...i}=n;return U.createElement(Rh.button,Jr({type:"submit"},i,{ref:e}))});function yg(n){const e={};for(const t in n)e[t]=n[t];return e}function _X(n){return n instanceof HTMLElement}function LX(n){return"validity"in n}function PX(n){return LX(n)&&(n.validity.valid===!1||n.getAttribute("aria-invalid")==="true")}function dP(n){const e=n.elements,[t]=Array.from(e).filter(_X).filter(PX);return t}function kX(n,e){return n.match.constructor.name==="AsyncFunction"||OX(n.match,e)}function DX(n){return n.match.constructor.name==="Function"}function OX(n,e){return n(...e)instanceof Promise}function NX(n){let e=!1;for(const t in n){const i=t;if(i!=="valid"&&i!=="customError"&&n[i]){e=!0;break}}return e}function fP(n,e){if((n==null?void 0:n.valid)===!0&&!e)return!0}function hP(n,e){if((n==null?void 0:n.valid)===!1||e)return!0}const MX=SX,FX=CX,BX=IX,UX=RX;var HX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],pP=HX.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{});function zX(n,e){n&&Xl.flushSync(()=>n.dispatchEvent(e))}function jX(n,e=globalThis==null?void 0:globalThis.document){const t=Ws(n);U.useEffect(()=>{const i=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[t,e])}var VX="DismissableLayer",Nv="dismissableLayer.update",GX="dismissableLayer.pointerDownOutside",WX="dismissableLayer.focusOutside",Z2,mP=U.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),x1=U.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:a,onDismiss:o,...l}=n,u=U.useContext(mP),[c,d]=U.useState(null),h=(c==null?void 0:c.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=U.useState({}),g=Ht(e,_=>d(_)),v=Array.from(u.layers),[y]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),b=v.indexOf(y),T=c?v.indexOf(c):-1,x=u.layersWithOutsidePointerEventsDisabled.size>0,w=T>=b,A=KX(_=>{const D=_.target,H=[...u.branches].some(P=>P.contains(D));!w||H||(r==null||r(_),a==null||a(_),_.defaultPrevented||o==null||o())},h),R=YX(_=>{const D=_.target;[...u.branches].some(P=>P.contains(D))||(s==null||s(_),a==null||a(_),_.defaultPrevented||o==null||o())},h);return jX(_=>{T===u.layers.size-1&&(i==null||i(_),!_.defaultPrevented&&o&&(_.preventDefault(),o()))},h),U.useEffect(()=>{if(c)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(Z2=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(c)),u.layers.add(c),J2(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Z2)}},[c,h,t,u]),U.useEffect(()=>()=>{c&&(u.layers.delete(c),u.layersWithOutsidePointerEventsDisabled.delete(c),J2())},[c,u]),U.useEffect(()=>{const _=()=>p({});return document.addEventListener(Nv,_),()=>document.removeEventListener(Nv,_)},[]),be.jsx(pP.div,{...l,ref:g,style:{pointerEvents:x?w?"auto":"none":void 0,...n.style},onFocusCapture:xt(n.onFocusCapture,R.onFocusCapture),onBlurCapture:xt(n.onBlurCapture,R.onBlurCapture),onPointerDownCapture:xt(n.onPointerDownCapture,A.onPointerDownCapture)})});x1.displayName=VX;var qX="DismissableLayerBranch",$X=U.forwardRef((n,e)=>{const t=U.useContext(mP),i=U.useRef(null),r=Ht(e,i);return U.useEffect(()=>{const s=i.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),be.jsx(pP.div,{...n,ref:r})});$X.displayName=qX;function KX(n,e=globalThis==null?void 0:globalThis.document){const t=Ws(n),i=U.useRef(!1),r=U.useRef(()=>{});return U.useEffect(()=>{const s=o=>{if(o.target&&!i.current){let l=function(){gP(GX,t,u,{discrete:!0})};const u={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);i.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",s),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>i.current=!0}}function YX(n,e=globalThis==null?void 0:globalThis.document){const t=Ws(n),i=U.useRef(!1);return U.useEffect(()=>{const r=s=>{s.target&&!i.current&&gP(WX,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function J2(){const n=new CustomEvent(Nv);document.dispatchEvent(n)}function gP(n,e,t,{discrete:i}){const r=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(n,e,{once:!0}),i?zX(r,s):r.dispatchEvent(s)}var Eg=0;function vP(){U.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??eA()),document.body.insertAdjacentElement("beforeend",n[1]??eA()),Eg++,()=>{Eg===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Eg--}},[])}function eA(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var XX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],QX=XX.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),bg="focusScope.autoFocusOnMount",Tg="focusScope.autoFocusOnUnmount",tA={bubbles:!1,cancelable:!0},ZX="FocusScope",S1=U.forwardRef((n,e)=>{const{loop:t=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:s,...a}=n,[o,l]=U.useState(null),u=Ws(r),c=Ws(s),d=U.useRef(null),h=Ht(e,v=>l(v)),p=U.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;U.useEffect(()=>{if(i){let v=function(x){if(p.paused||!o)return;const w=x.target;o.contains(w)?d.current=w:Ms(d.current,{select:!0})},y=function(x){if(p.paused||!o)return;const w=x.relatedTarget;w!==null&&(o.contains(w)||Ms(d.current,{select:!0}))},b=function(x){if(document.activeElement===document.body)for(const A of x)A.removedNodes.length>0&&Ms(o)};document.addEventListener("focusin",v),document.addEventListener("focusout",y);const T=new MutationObserver(b);return o&&T.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",y),T.disconnect()}}},[i,o,p.paused]),U.useEffect(()=>{if(o){iA.add(p);const v=document.activeElement;if(!o.contains(v)){const b=new CustomEvent(bg,tA);o.addEventListener(bg,u),o.dispatchEvent(b),b.defaultPrevented||(JX(rQ(yP(o)),{select:!0}),document.activeElement===v&&Ms(o))}return()=>{o.removeEventListener(bg,u),setTimeout(()=>{const b=new CustomEvent(Tg,tA);o.addEventListener(Tg,c),o.dispatchEvent(b),b.defaultPrevented||Ms(v??document.body,{select:!0}),o.removeEventListener(Tg,c),iA.remove(p)},0)}}},[o,u,c,p]);const g=U.useCallback(v=>{if(!t&&!i||p.paused)return;const y=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,b=document.activeElement;if(y&&b){const T=v.currentTarget,[x,w]=eQ(T);x&&w?!v.shiftKey&&b===w?(v.preventDefault(),t&&Ms(x,{select:!0})):v.shiftKey&&b===x&&(v.preventDefault(),t&&Ms(w,{select:!0})):b===T&&v.preventDefault()}},[t,i,p.paused]);return be.jsx(QX.div,{tabIndex:-1,...a,ref:h,onKeyDown:g})});S1.displayName=ZX;function JX(n,{select:e=!1}={}){const t=document.activeElement;for(const i of n)if(Ms(i,{select:e}),document.activeElement!==t)return}function eQ(n){const e=yP(n),t=nA(e,n),i=nA(e.reverse(),n);return[t,i]}function yP(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function nA(n,e){for(const t of n)if(!tQ(t,{upTo:e}))return t}function tQ(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function nQ(n){return n instanceof HTMLInputElement&&"select"in n}function Ms(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&nQ(n)&&e&&n.select()}}var iA=iQ();function iQ(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=rA(n,e),n.unshift(e)},remove(e){var t;n=rA(n,e),(t=n[0])==null||t.resume()}}}function rA(n,e){const t=[...n],i=t.indexOf(e);return i!==-1&&t.splice(i,1),t}function rQ(n){return n.filter(e=>e.tagName!=="A")}const sQ=["top","right","bottom","left"],Ys=Math.min,yi=Math.max,Yf=Math.round,Zd=Math.floor,Tr=n=>({x:n,y:n}),aQ={left:"right",right:"left",bottom:"top",top:"bottom"},oQ={start:"end",end:"start"};function Mv(n,e,t){return yi(n,Ys(e,t))}function es(n,e){return typeof n=="function"?n(e):n}function ts(n){return n.split("-")[0]}function mu(n){return n.split("-")[1]}function w1(n){return n==="x"?"y":"x"}function A1(n){return n==="y"?"height":"width"}const uQ=new Set(["top","bottom"]);function br(n){return uQ.has(ts(n))?"y":"x"}function C1(n){return w1(br(n))}function lQ(n,e,t){t===void 0&&(t=!1);const i=mu(n),r=C1(n),s=A1(r);let a=r==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(a=Xf(a)),[a,Xf(a)]}function cQ(n){const e=Xf(n);return[Fv(n),e,Fv(e)]}function Fv(n){return n.replace(/start|end/g,e=>oQ[e])}const sA=["left","right"],aA=["right","left"],dQ=["top","bottom"],fQ=["bottom","top"];function hQ(n,e,t){switch(n){case"top":case"bottom":return t?e?aA:sA:e?sA:aA;case"left":case"right":return e?dQ:fQ;default:return[]}}function pQ(n,e,t,i){const r=mu(n);let s=hQ(ts(n),t==="start",i);return r&&(s=s.map(a=>a+"-"+r),e&&(s=s.concat(s.map(Fv)))),s}function Xf(n){return n.replace(/left|right|bottom|top/g,e=>aQ[e])}function mQ(n){return{top:0,right:0,bottom:0,left:0,...n}}function EP(n){return typeof n!="number"?mQ(n):{top:n,right:n,bottom:n,left:n}}function Qf(n){const{x:e,y:t,width:i,height:r}=n;return{width:i,height:r,top:t,left:e,right:e+i,bottom:t+r,x:e,y:t}}function oA(n,e,t){let{reference:i,floating:r}=n;const s=br(e),a=C1(e),o=A1(a),l=ts(e),u=s==="y",c=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,h=i[o]/2-r[o]/2;let p;switch(l){case"top":p={x:c,y:i.y-r.height};break;case"bottom":p={x:c,y:i.y+i.height};break;case"right":p={x:i.x+i.width,y:d};break;case"left":p={x:i.x-r.width,y:d};break;default:p={x:i.x,y:i.y}}switch(mu(e)){case"start":p[a]-=h*(t&&u?-1:1);break;case"end":p[a]+=h*(t&&u?-1:1);break}return p}const gQ=async(n,e,t)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:a}=t,o=s.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let u=await a.getElementRects({reference:n,floating:e,strategy:r}),{x:c,y:d}=oA(u,i,l),h=i,p={},g=0;for(let v=0;v<o.length;v++){const{name:y,fn:b}=o[v],{x:T,y:x,data:w,reset:A}=await b({x:c,y:d,initialPlacement:i,placement:h,strategy:r,middlewareData:p,rects:u,platform:a,elements:{reference:n,floating:e}});c=T??c,d=x??d,p={...p,[y]:{...p[y],...w}},A&&g<=50&&(g++,typeof A=="object"&&(A.placement&&(h=A.placement),A.rects&&(u=A.rects===!0?await a.getElementRects({reference:n,floating:e,strategy:r}):A.rects),{x:c,y:d}=oA(u,h,l)),v=-1)}return{x:c,y:d,placement:h,strategy:r,middlewareData:p}};async function $l(n,e){var t;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:a,elements:o,strategy:l}=n,{boundary:u="clippingAncestors",rootBoundary:c="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=es(e,n),g=EP(p),y=o[h?d==="floating"?"reference":"floating":d],b=Qf(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(y)))==null||t?y:y.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(o.floating)),boundary:u,rootBoundary:c,strategy:l})),T=d==="floating"?{x:i,y:r,width:a.floating.width,height:a.floating.height}:a.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(o.floating)),w=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},A=Qf(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:T,offsetParent:x,strategy:l}):T);return{top:(b.top-A.top+g.top)/w.y,bottom:(A.bottom-b.bottom+g.bottom)/w.y,left:(b.left-A.left+g.left)/w.x,right:(A.right-b.right+g.right)/w.x}}const vQ=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:i,placement:r,rects:s,platform:a,elements:o,middlewareData:l}=e,{element:u,padding:c=0}=es(n,e)||{};if(u==null)return{};const d=EP(c),h={x:t,y:i},p=C1(r),g=A1(p),v=await a.getDimensions(u),y=p==="y",b=y?"top":"left",T=y?"bottom":"right",x=y?"clientHeight":"clientWidth",w=s.reference[g]+s.reference[p]-h[p]-s.floating[g],A=h[p]-s.reference[p],R=await(a.getOffsetParent==null?void 0:a.getOffsetParent(u));let _=R?R[x]:0;(!_||!await(a.isElement==null?void 0:a.isElement(R)))&&(_=o.floating[x]||s.floating[g]);const D=w/2-A/2,H=_/2-v[g]/2-1,P=Ys(d[b],H),N=Ys(d[T],H),G=P,X=_-v[g]-N,te=_/2-v[g]/2+D,Q=Mv(G,te,X),ne=!l.arrow&&mu(r)!=null&&te!==Q&&s.reference[g]/2-(te<G?P:N)-v[g]/2<0,oe=ne?te<G?te-G:te-X:0;return{[p]:h[p]+oe,data:{[p]:Q,centerOffset:te-Q-oe,...ne&&{alignmentOffset:oe}},reset:ne}}}),yQ=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,i;const{placement:r,middlewareData:s,rects:a,initialPlacement:o,platform:l,elements:u}=e,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:v=!0,...y}=es(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=ts(r),T=br(o),x=ts(o)===o,w=await(l.isRTL==null?void 0:l.isRTL(u.floating)),A=h||(x||!v?[Xf(o)]:cQ(o)),R=g!=="none";!h&&R&&A.push(...pQ(o,v,g,w));const _=[o,...A],D=await $l(e,y),H=[];let P=((i=s.flip)==null?void 0:i.overflows)||[];if(c&&H.push(D[b]),d){const te=lQ(r,a,w);H.push(D[te[0]],D[te[1]])}if(P=[...P,{placement:r,overflows:H}],!H.every(te=>te<=0)){var N,G;const te=(((N=s.flip)==null?void 0:N.index)||0)+1,Q=_[te];if(Q&&(!(d==="alignment"?T!==br(Q):!1)||P.every(Z=>br(Z.placement)===T?Z.overflows[0]>0:!0)))return{data:{index:te,overflows:P},reset:{placement:Q}};let ne=(G=P.filter(oe=>oe.overflows[0]<=0).sort((oe,Z)=>oe.overflows[1]-Z.overflows[1])[0])==null?void 0:G.placement;if(!ne)switch(p){case"bestFit":{var X;const oe=(X=P.filter(Z=>{if(R){const se=br(Z.placement);return se===T||se==="y"}return!0}).map(Z=>[Z.placement,Z.overflows.filter(se=>se>0).reduce((se,j)=>se+j,0)]).sort((Z,se)=>Z[1]-se[1])[0])==null?void 0:X[0];oe&&(ne=oe);break}case"initialPlacement":ne=o;break}if(r!==ne)return{reset:{placement:ne}}}return{}}}};function uA(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function lA(n){return sQ.some(e=>n[e]>=0)}const EQ=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:i="referenceHidden",...r}=es(n,e);switch(i){case"referenceHidden":{const s=await $l(e,{...r,elementContext:"reference"}),a=uA(s,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:lA(a)}}}case"escaped":{const s=await $l(e,{...r,altBoundary:!0}),a=uA(s,t.floating);return{data:{escapedOffsets:a,escaped:lA(a)}}}default:return{}}}}},bP=new Set(["left","top"]);async function bQ(n,e){const{placement:t,platform:i,elements:r}=n,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),a=ts(t),o=mu(t),l=br(t)==="y",u=bP.has(a)?-1:1,c=s&&l?-1:1,d=es(e,n);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof g=="number"&&(p=o==="end"?g*-1:g),l?{x:p*c,y:h*u}:{x:h*u,y:p*c}}const TQ=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,i;const{x:r,y:s,placement:a,middlewareData:o}=e,l=await bQ(e,n);return a===((t=o.offset)==null?void 0:t.placement)&&(i=o.arrow)!=null&&i.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:a}}}}},xQ=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:a=!1,limiter:o={fn:y=>{let{x:b,y:T}=y;return{x:b,y:T}}},...l}=es(n,e),u={x:t,y:i},c=await $l(e,l),d=br(ts(r)),h=w1(d);let p=u[h],g=u[d];if(s){const y=h==="y"?"top":"left",b=h==="y"?"bottom":"right",T=p+c[y],x=p-c[b];p=Mv(T,p,x)}if(a){const y=d==="y"?"top":"left",b=d==="y"?"bottom":"right",T=g+c[y],x=g-c[b];g=Mv(T,g,x)}const v=o.fn({...e,[h]:p,[d]:g});return{...v,data:{x:v.x-t,y:v.y-i,enabled:{[h]:s,[d]:a}}}}}},SQ=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:i,placement:r,rects:s,middlewareData:a}=e,{offset:o=0,mainAxis:l=!0,crossAxis:u=!0}=es(n,e),c={x:t,y:i},d=br(r),h=w1(d);let p=c[h],g=c[d];const v=es(o,e),y=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(l){const x=h==="y"?"height":"width",w=s.reference[h]-s.floating[x]+y.mainAxis,A=s.reference[h]+s.reference[x]-y.mainAxis;p<w?p=w:p>A&&(p=A)}if(u){var b,T;const x=h==="y"?"width":"height",w=bP.has(ts(r)),A=s.reference[d]-s.floating[x]+(w&&((b=a.offset)==null?void 0:b[d])||0)+(w?0:y.crossAxis),R=s.reference[d]+s.reference[x]+(w?0:((T=a.offset)==null?void 0:T[d])||0)-(w?y.crossAxis:0);g<A?g=A:g>R&&(g=R)}return{[h]:p,[d]:g}}}},wQ=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,i;const{placement:r,rects:s,platform:a,elements:o}=e,{apply:l=()=>{},...u}=es(n,e),c=await $l(e,u),d=ts(r),h=mu(r),p=br(r)==="y",{width:g,height:v}=s.floating;let y,b;d==="top"||d==="bottom"?(y=d,b=h===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(b=d,y=h==="end"?"top":"bottom");const T=v-c.top-c.bottom,x=g-c.left-c.right,w=Ys(v-c[y],T),A=Ys(g-c[b],x),R=!e.middlewareData.shift;let _=w,D=A;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(D=x),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(_=T),R&&!h){const P=yi(c.left,0),N=yi(c.right,0),G=yi(c.top,0),X=yi(c.bottom,0);p?D=g-2*(P!==0||N!==0?P+N:yi(c.left,c.right)):_=v-2*(G!==0||X!==0?G+X:yi(c.top,c.bottom))}await l({...e,availableWidth:D,availableHeight:_});const H=await a.getDimensions(o.floating);return g!==H.width||v!==H.height?{reset:{rects:!0}}:{}}}};function _h(){return typeof window<"u"}function gu(n){return TP(n)?(n.nodeName||"").toLowerCase():"#document"}function Ti(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Rr(n){var e;return(e=(TP(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function TP(n){return _h()?n instanceof Node||n instanceof Ti(n).Node:!1}function er(n){return _h()?n instanceof Element||n instanceof Ti(n).Element:!1}function wr(n){return _h()?n instanceof HTMLElement||n instanceof Ti(n).HTMLElement:!1}function cA(n){return!_h()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ti(n).ShadowRoot}const AQ=new Set(["inline","contents"]);function uc(n){const{overflow:e,overflowX:t,overflowY:i,display:r}=tr(n);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!AQ.has(r)}const CQ=new Set(["table","td","th"]);function IQ(n){return CQ.has(gu(n))}const RQ=[":popover-open",":modal"];function Lh(n){return RQ.some(e=>{try{return n.matches(e)}catch{return!1}})}const _Q=["transform","translate","scale","rotate","perspective"],LQ=["transform","translate","scale","rotate","perspective","filter"],PQ=["paint","layout","strict","content"];function I1(n){const e=R1(),t=er(n)?tr(n):n;return _Q.some(i=>t[i]?t[i]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||LQ.some(i=>(t.willChange||"").includes(i))||PQ.some(i=>(t.contain||"").includes(i))}function kQ(n){let e=Xs(n);for(;wr(e)&&!au(e);){if(I1(e))return e;if(Lh(e))return null;e=Xs(e)}return null}function R1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const DQ=new Set(["html","body","#document"]);function au(n){return DQ.has(gu(n))}function tr(n){return Ti(n).getComputedStyle(n)}function Ph(n){return er(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Xs(n){if(gu(n)==="html")return n;const e=n.assignedSlot||n.parentNode||cA(n)&&n.host||Rr(n);return cA(e)?e.host:e}function xP(n){const e=Xs(n);return au(e)?n.ownerDocument?n.ownerDocument.body:n.body:wr(e)&&uc(e)?e:xP(e)}function Kl(n,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=xP(n),s=r===((i=n.ownerDocument)==null?void 0:i.body),a=Ti(r);if(s){const o=Bv(a);return e.concat(a,a.visualViewport||[],uc(r)?r:[],o&&t?Kl(o):[])}return e.concat(r,Kl(r,[],t))}function Bv(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function SP(n){const e=tr(n);let t=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=wr(n),s=r?n.offsetWidth:t,a=r?n.offsetHeight:i,o=Yf(t)!==s||Yf(i)!==a;return o&&(t=s,i=a),{width:t,height:i,$:o}}function _1(n){return er(n)?n:n.contextElement}function Zo(n){const e=_1(n);if(!wr(e))return Tr(1);const t=e.getBoundingClientRect(),{width:i,height:r,$:s}=SP(e);let a=(s?Yf(t.width):t.width)/i,o=(s?Yf(t.height):t.height)/r;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const OQ=Tr(0);function wP(n){const e=Ti(n);return!R1()||!e.visualViewport?OQ:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function NQ(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ti(n)?!1:e}function Va(n,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);const r=n.getBoundingClientRect(),s=_1(n);let a=Tr(1);e&&(i?er(i)&&(a=Zo(i)):a=Zo(n));const o=NQ(s,t,i)?wP(s):Tr(0);let l=(r.left+o.x)/a.x,u=(r.top+o.y)/a.y,c=r.width/a.x,d=r.height/a.y;if(s){const h=Ti(s),p=i&&er(i)?Ti(i):i;let g=h,v=Bv(g);for(;v&&i&&p!==g;){const y=Zo(v),b=v.getBoundingClientRect(),T=tr(v),x=b.left+(v.clientLeft+parseFloat(T.paddingLeft))*y.x,w=b.top+(v.clientTop+parseFloat(T.paddingTop))*y.y;l*=y.x,u*=y.y,c*=y.x,d*=y.y,l+=x,u+=w,g=Ti(v),v=Bv(g)}}return Qf({width:c,height:d,x:l,y:u})}function kh(n,e){const t=Ph(n).scrollLeft;return e?e.left+t:Va(Rr(n)).left+t}function AP(n,e){const t=n.getBoundingClientRect(),i=t.left+e.scrollLeft-kh(n,t),r=t.top+e.scrollTop;return{x:i,y:r}}function MQ(n){let{elements:e,rect:t,offsetParent:i,strategy:r}=n;const s=r==="fixed",a=Rr(i),o=e?Lh(e.floating):!1;if(i===a||o&&s)return t;let l={scrollLeft:0,scrollTop:0},u=Tr(1);const c=Tr(0),d=wr(i);if((d||!d&&!s)&&((gu(i)!=="body"||uc(a))&&(l=Ph(i)),wr(i))){const p=Va(i);u=Zo(i),c.x=p.x+i.clientLeft,c.y=p.y+i.clientTop}const h=a&&!d&&!s?AP(a,l):Tr(0);return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-l.scrollLeft*u.x+c.x+h.x,y:t.y*u.y-l.scrollTop*u.y+c.y+h.y}}function FQ(n){return Array.from(n.getClientRects())}function BQ(n){const e=Rr(n),t=Ph(n),i=n.ownerDocument.body,r=yi(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=yi(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let a=-t.scrollLeft+kh(n);const o=-t.scrollTop;return tr(i).direction==="rtl"&&(a+=yi(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:a,y:o}}const dA=25;function UQ(n,e){const t=Ti(n),i=Rr(n),r=t.visualViewport;let s=i.clientWidth,a=i.clientHeight,o=0,l=0;if(r){s=r.width,a=r.height;const c=R1();(!c||c&&e==="fixed")&&(o=r.offsetLeft,l=r.offsetTop)}const u=kh(i);if(u<=0){const c=i.ownerDocument,d=c.body,h=getComputedStyle(d),p=c.compatMode==="CSS1Compat"&&parseFloat(h.marginLeft)+parseFloat(h.marginRight)||0,g=Math.abs(i.clientWidth-d.clientWidth-p);g<=dA&&(s-=g)}else u<=dA&&(s+=u);return{width:s,height:a,x:o,y:l}}const HQ=new Set(["absolute","fixed"]);function zQ(n,e){const t=Va(n,!0,e==="fixed"),i=t.top+n.clientTop,r=t.left+n.clientLeft,s=wr(n)?Zo(n):Tr(1),a=n.clientWidth*s.x,o=n.clientHeight*s.y,l=r*s.x,u=i*s.y;return{width:a,height:o,x:l,y:u}}function fA(n,e,t){let i;if(e==="viewport")i=UQ(n,t);else if(e==="document")i=BQ(Rr(n));else if(er(e))i=zQ(e,t);else{const r=wP(n);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Qf(i)}function CP(n,e){const t=Xs(n);return t===e||!er(t)||au(t)?!1:tr(t).position==="fixed"||CP(t,e)}function jQ(n,e){const t=e.get(n);if(t)return t;let i=Kl(n,[],!1).filter(o=>er(o)&&gu(o)!=="body"),r=null;const s=tr(n).position==="fixed";let a=s?Xs(n):n;for(;er(a)&&!au(a);){const o=tr(a),l=I1(a);!l&&o.position==="fixed"&&(r=null),(s?!l&&!r:!l&&o.position==="static"&&!!r&&HQ.has(r.position)||uc(a)&&!l&&CP(n,a))?i=i.filter(c=>c!==a):r=o,a=Xs(a)}return e.set(n,i),i}function VQ(n){let{element:e,boundary:t,rootBoundary:i,strategy:r}=n;const a=[...t==="clippingAncestors"?Lh(e)?[]:jQ(e,this._c):[].concat(t),i],o=a[0],l=a.reduce((u,c)=>{const d=fA(e,c,r);return u.top=yi(d.top,u.top),u.right=Ys(d.right,u.right),u.bottom=Ys(d.bottom,u.bottom),u.left=yi(d.left,u.left),u},fA(e,o,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function GQ(n){const{width:e,height:t}=SP(n);return{width:e,height:t}}function WQ(n,e,t){const i=wr(e),r=Rr(e),s=t==="fixed",a=Va(n,!0,s,e);let o={scrollLeft:0,scrollTop:0};const l=Tr(0);function u(){l.x=kh(r)}if(i||!i&&!s)if((gu(e)!=="body"||uc(r))&&(o=Ph(e)),i){const p=Va(e,!0,s,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else r&&u();s&&!i&&r&&u();const c=r&&!i&&!s?AP(r,o):Tr(0),d=a.left+o.scrollLeft-l.x-c.x,h=a.top+o.scrollTop-l.y-c.y;return{x:d,y:h,width:a.width,height:a.height}}function xg(n){return tr(n).position==="static"}function hA(n,e){if(!wr(n)||tr(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Rr(n)===t&&(t=t.ownerDocument.body),t}function IP(n,e){const t=Ti(n);if(Lh(n))return t;if(!wr(n)){let r=Xs(n);for(;r&&!au(r);){if(er(r)&&!xg(r))return r;r=Xs(r)}return t}let i=hA(n,e);for(;i&&IQ(i)&&xg(i);)i=hA(i,e);return i&&au(i)&&xg(i)&&!I1(i)?t:i||kQ(n)||t}const qQ=async function(n){const e=this.getOffsetParent||IP,t=this.getDimensions,i=await t(n.floating);return{reference:WQ(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function $Q(n){return tr(n).direction==="rtl"}const KQ={convertOffsetParentRelativeRectToViewportRelativeRect:MQ,getDocumentElement:Rr,getClippingRect:VQ,getOffsetParent:IP,getElementRects:qQ,getClientRects:FQ,getDimensions:GQ,getScale:Zo,isElement:er,isRTL:$Q};function RP(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function YQ(n,e){let t=null,i;const r=Rr(n);function s(){var o;clearTimeout(i),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),s();const u=n.getBoundingClientRect(),{left:c,top:d,width:h,height:p}=u;if(o||e(),!h||!p)return;const g=Zd(d),v=Zd(r.clientWidth-(c+h)),y=Zd(r.clientHeight-(d+p)),b=Zd(c),x={rootMargin:-g+"px "+-v+"px "+-y+"px "+-b+"px",threshold:yi(0,Ys(1,l))||1};let w=!0;function A(R){const _=R[0].intersectionRatio;if(_!==l){if(!w)return a();_?a(!1,_):i=setTimeout(()=>{a(!1,1e-7)},1e3)}_===1&&!RP(u,n.getBoundingClientRect())&&a(),w=!1}try{t=new IntersectionObserver(A,{...x,root:r.ownerDocument})}catch{t=new IntersectionObserver(A,x)}t.observe(n)}return a(!0),s}function XQ(n,e,t,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,u=_1(n),c=r||s?[...u?Kl(u):[],...Kl(e)]:[];c.forEach(b=>{r&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const d=u&&o?YQ(u,t):null;let h=-1,p=null;a&&(p=new ResizeObserver(b=>{let[T]=b;T&&T.target===u&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var x;(x=p)==null||x.observe(e)})),t()}),u&&!l&&p.observe(u),p.observe(e));let g,v=l?Va(n):null;l&&y();function y(){const b=Va(n);v&&!RP(v,b)&&t(),v=b,g=requestAnimationFrame(y)}return t(),()=>{var b;c.forEach(T=>{r&&T.removeEventListener("scroll",t),s&&T.removeEventListener("resize",t)}),d==null||d(),(b=p)==null||b.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const QQ=TQ,ZQ=xQ,JQ=yQ,eZ=wQ,tZ=EQ,pA=vQ,nZ=SQ,iZ=(n,e,t)=>{const i=new Map,r={platform:KQ,...t},s={...r.platform,_c:i};return gQ(n,e,{...r,platform:s})};var rZ=typeof document<"u",sZ=function(){},Tf=rZ?U.useLayoutEffect:sZ;function Zf(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,i,r;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(i=t;i--!==0;)if(!Zf(n[i],e[i]))return!1;return!0}if(r=Object.keys(n),t=r.length,t!==Object.keys(e).length)return!1;for(i=t;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=t;i--!==0;){const s=r[i];if(!(s==="_owner"&&n.$$typeof)&&!Zf(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function _P(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function mA(n,e){const t=_P(n);return Math.round(e*t)/t}function Sg(n){const e=U.useRef(n);return Tf(()=>{e.current=n}),e}function aZ(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:i=[],platform:r,elements:{reference:s,floating:a}={},transform:o=!0,whileElementsMounted:l,open:u}=n,[c,d]=U.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=U.useState(i);Zf(h,i)||p(i);const[g,v]=U.useState(null),[y,b]=U.useState(null),T=U.useCallback(Z=>{Z!==R.current&&(R.current=Z,v(Z))},[]),x=U.useCallback(Z=>{Z!==_.current&&(_.current=Z,b(Z))},[]),w=s||g,A=a||y,R=U.useRef(null),_=U.useRef(null),D=U.useRef(c),H=l!=null,P=Sg(l),N=Sg(r),G=Sg(u),X=U.useCallback(()=>{if(!R.current||!_.current)return;const Z={placement:e,strategy:t,middleware:h};N.current&&(Z.platform=N.current),iZ(R.current,_.current,Z).then(se=>{const j={...se,isPositioned:G.current!==!1};te.current&&!Zf(D.current,j)&&(D.current=j,Xl.flushSync(()=>{d(j)}))})},[h,e,t,N,G]);Tf(()=>{u===!1&&D.current.isPositioned&&(D.current.isPositioned=!1,d(Z=>({...Z,isPositioned:!1})))},[u]);const te=U.useRef(!1);Tf(()=>(te.current=!0,()=>{te.current=!1}),[]),Tf(()=>{if(w&&(R.current=w),A&&(_.current=A),w&&A){if(P.current)return P.current(w,A,X);X()}},[w,A,X,P,H]);const Q=U.useMemo(()=>({reference:R,floating:_,setReference:T,setFloating:x}),[T,x]),ne=U.useMemo(()=>({reference:w,floating:A}),[w,A]),oe=U.useMemo(()=>{const Z={position:t,left:0,top:0};if(!ne.floating)return Z;const se=mA(ne.floating,c.x),j=mA(ne.floating,c.y);return o?{...Z,transform:"translate("+se+"px, "+j+"px)",..._P(ne.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:se,top:j}},[t,o,ne.floating,c.x,c.y]);return U.useMemo(()=>({...c,update:X,refs:Q,elements:ne,floatingStyles:oe}),[c,X,Q,ne,oe])}const oZ=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:i,padding:r}=typeof n=="function"?n(t):n;return i&&e(i)?i.current!=null?pA({element:i.current,padding:r}).fn(t):{}:i?pA({element:i,padding:r}).fn(t):{}}}},uZ=(n,e)=>({...QQ(n),options:[n,e]}),lZ=(n,e)=>({...ZQ(n),options:[n,e]}),cZ=(n,e)=>({...nZ(n),options:[n,e]}),dZ=(n,e)=>({...JQ(n),options:[n,e]}),fZ=(n,e)=>({...eZ(n),options:[n,e]}),hZ=(n,e)=>({...tZ(n),options:[n,e]}),pZ=(n,e)=>({...oZ(n),options:[n,e]});var mZ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],gZ=mZ.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),vZ="Arrow",LP=U.forwardRef((n,e)=>{const{children:t,width:i=10,height:r=5,...s}=n;return be.jsx(gZ.svg,{...s,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:be.jsx("polygon",{points:"0,0 30,0 15,10"})})});LP.displayName=vZ;var yZ=LP,EZ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],PP=EZ.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),L1="Popper",[kP,Dh]=Cr(L1),[bZ,DP]=kP(L1),OP=n=>{const{__scopePopper:e,children:t}=n,[i,r]=U.useState(null);return be.jsx(bZ,{scope:e,anchor:i,onAnchorChange:r,children:t})};OP.displayName=L1;var NP="PopperAnchor",MP=U.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:i,...r}=n,s=DP(NP,t),a=U.useRef(null),o=Ht(e,a),l=U.useRef(null);return U.useEffect(()=>{const u=l.current;l.current=(i==null?void 0:i.current)||a.current,u!==l.current&&s.onAnchorChange(l.current)}),i?null:be.jsx(PP.div,{...r,ref:o})});MP.displayName=NP;var P1="PopperContent",[TZ,xZ]=kP(P1),FP=U.forwardRef((n,e)=>{var Ae,ke,je,We,de,Re;const{__scopePopper:t,side:i="bottom",sideOffset:r=0,align:s="center",alignOffset:a=0,arrowPadding:o=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:c=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...v}=n,y=DP(P1,t),[b,T]=U.useState(null),x=Ht(e,Ie=>T(Ie)),[w,A]=U.useState(null),R=zy(w),_=(R==null?void 0:R.width)??0,D=(R==null?void 0:R.height)??0,H=i+(s!=="center"?"-"+s:""),P=typeof c=="number"?c:{top:0,right:0,bottom:0,left:0,...c},N=Array.isArray(u)?u:[u],G=N.length>0,X={padding:P,boundary:N.filter(wZ),altBoundary:G},{refs:te,floatingStyles:Q,placement:ne,isPositioned:oe,middlewareData:Z}=aZ({strategy:"fixed",placement:H,whileElementsMounted:(...Ie)=>XQ(...Ie,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[uZ({mainAxis:r+D,alignmentAxis:a}),l&&lZ({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?cZ():void 0,...X}),l&&dZ({...X}),fZ({...X,apply:({elements:Ie,rects:Ye,availableWidth:It,availableHeight:Qe})=>{const{width:k,height:$}=Ye.reference,ue=Ie.floating.style;ue.setProperty("--radix-popper-available-width",`${It}px`),ue.setProperty("--radix-popper-available-height",`${Qe}px`),ue.setProperty("--radix-popper-anchor-width",`${k}px`),ue.setProperty("--radix-popper-anchor-height",`${$}px`)}}),w&&pZ({element:w,padding:o}),AZ({arrowWidth:_,arrowHeight:D}),h&&hZ({strategy:"referenceHidden",...X})]}),[se,j]=HP(ne),q=Ws(g);kn(()=>{oe&&(q==null||q())},[oe,q]);const re=(Ae=Z.arrow)==null?void 0:Ae.x,z=(ke=Z.arrow)==null?void 0:ke.y,ve=((je=Z.arrow)==null?void 0:je.centerOffset)!==0,[Le,Ce]=U.useState();return kn(()=>{b&&Ce(window.getComputedStyle(b).zIndex)},[b]),be.jsx("div",{ref:te.setFloating,"data-radix-popper-content-wrapper":"",style:{...Q,transform:oe?Q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Le,"--radix-popper-transform-origin":[(We=Z.transformOrigin)==null?void 0:We.x,(de=Z.transformOrigin)==null?void 0:de.y].join(" "),...((Re=Z.hide)==null?void 0:Re.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:be.jsx(TZ,{scope:t,placedSide:se,onArrowChange:A,arrowX:re,arrowY:z,shouldHideArrow:ve,children:be.jsx(PP.div,{"data-side":se,"data-align":j,...v,ref:x,style:{...v.style,animation:oe?void 0:"none"}})})})});FP.displayName=P1;var BP="PopperArrow",SZ={top:"bottom",right:"left",bottom:"top",left:"right"},UP=U.forwardRef(function(e,t){const{__scopePopper:i,...r}=e,s=xZ(BP,i),a=SZ[s.placedSide];return be.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:be.jsx(yZ,{...r,ref:t,style:{...r.style,display:"block"}})})});UP.displayName=BP;function wZ(n){return n!==null}var AZ=n=>({name:"transformOrigin",options:n,fn(e){var y,b,T;const{placement:t,rects:i,middlewareData:r}=e,a=((y=r.arrow)==null?void 0:y.centerOffset)!==0,o=a?0:n.arrowWidth,l=a?0:n.arrowHeight,[u,c]=HP(t),d={start:"0%",center:"50%",end:"100%"}[c],h=(((b=r.arrow)==null?void 0:b.x)??0)+o/2,p=(((T=r.arrow)==null?void 0:T.y)??0)+l/2;let g="",v="";return u==="bottom"?(g=a?d:`${h}px`,v=`${-l}px`):u==="top"?(g=a?d:`${h}px`,v=`${i.floating.height+l}px`):u==="right"?(g=`${-l}px`,v=a?d:`${p}px`):u==="left"&&(g=`${i.floating.width+l}px`,v=a?d:`${p}px`),{data:{x:g,y:v}}}});function HP(n){const[e,t="center"]=n.split("-");return[e,t]}var zP=OP,k1=MP,jP=FP,VP=UP,CZ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],IZ=CZ.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),RZ="Portal",GP=U.forwardRef((n,e)=>{var o;const{container:t,...i}=n,[r,s]=U.useState(!1);kn(()=>s(!0),[]);const a=t||r&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return a?qM.createPortal(be.jsx(IZ.div,{...i,ref:e}),a):null});GP.displayName=RZ;var _Z=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],WP=_Z.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),LZ=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Oo=new WeakMap,Jd=new WeakMap,ef={},wg=0,qP=function(n){return n&&(n.host||qP(n.parentNode))},PZ=function(n,e){return e.map(function(t){if(n.contains(t))return t;var i=qP(t);return i&&n.contains(i)?i:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},kZ=function(n,e,t,i){var r=PZ(e,Array.isArray(n)?n:[n]);ef[t]||(ef[t]=new WeakMap);var s=ef[t],a=[],o=new Set,l=new Set(r),u=function(d){!d||o.has(d)||(o.add(d),u(d.parentNode))};r.forEach(u);var c=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(o.has(h))c(h);else try{var p=h.getAttribute(i),g=p!==null&&p!=="false",v=(Oo.get(h)||0)+1,y=(s.get(h)||0)+1;Oo.set(h,v),s.set(h,y),a.push(h),v===1&&g&&Jd.set(h,!0),y===1&&h.setAttribute(t,"true"),g||h.setAttribute(i,"true")}catch(b){console.error("aria-hidden: cannot operate on ",h,b)}})};return c(e),o.clear(),wg++,function(){a.forEach(function(d){var h=Oo.get(d)-1,p=s.get(d)-1;Oo.set(d,h),s.set(d,p),h||(Jd.has(d)||d.removeAttribute(i),Jd.delete(d)),p||d.removeAttribute(t)}),wg--,wg||(Oo=new WeakMap,Oo=new WeakMap,Jd=new WeakMap,ef={})}},$P=function(n,e,t){t===void 0&&(t="data-aria-hidden");var i=Array.from(Array.isArray(n)?n:[n]),r=LZ(n);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),kZ(i,r,t,"aria-hidden")):function(){return null}},gr=function(){return gr=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},gr.apply(this,arguments)};function KP(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function DZ(n,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return n.concat(s||Array.prototype.slice.call(e))}var xf="right-scroll-bar-position",Sf="width-before-scroll-bar",OZ="with-scroll-bars-hidden",NZ="--removed-body-scroll-bar-size";function Ag(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function MZ(n,e){var t=U.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(i){var r=t.value;r!==i&&(t.value=i,t.callback(i,r))}}}})[0];return t.callback=e,t.facade}var FZ=typeof window<"u"?U.useLayoutEffect:U.useEffect,gA=new WeakMap;function BZ(n,e){var t=MZ(null,function(i){return n.forEach(function(r){return Ag(r,i)})});return FZ(function(){var i=gA.get(t);if(i){var r=new Set(i),s=new Set(n),a=t.current;r.forEach(function(o){s.has(o)||Ag(o,null)}),s.forEach(function(o){r.has(o)||Ag(o,a)})}gA.set(t,n)},[n]),t}function UZ(n){return n}function HZ(n,e){e===void 0&&(e=UZ);var t=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var a=e(s,i);return t.push(a),function(){t=t.filter(function(o){return o!==a})}},assignSyncMedium:function(s){for(i=!0;t.length;){var a=t;t=[],a.forEach(s)}t={push:function(o){return s(o)},filter:function(){return t}}},assignMedium:function(s){i=!0;var a=[];if(t.length){var o=t;t=[],o.forEach(s),a=t}var l=function(){var c=a;a=[],c.forEach(s)},u=function(){return Promise.resolve().then(l)};u(),t={push:function(c){a.push(c),u()},filter:function(c){return a=a.filter(c),t}}}};return r}function zZ(n){n===void 0&&(n={});var e=HZ(null);return e.options=gr({async:!0,ssr:!1},n),e}var YP=function(n){var e=n.sideCar,t=KP(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return U.createElement(i,gr({},t))};YP.isSideCarExport=!0;function jZ(n,e){return n.useMedium(e),YP}var XP=zZ(),Cg=function(){},Oh=U.forwardRef(function(n,e){var t=U.useRef(null),i=U.useState({onScrollCapture:Cg,onWheelCapture:Cg,onTouchMoveCapture:Cg}),r=i[0],s=i[1],a=n.forwardProps,o=n.children,l=n.className,u=n.removeScrollBar,c=n.enabled,d=n.shards,h=n.sideCar,p=n.noRelative,g=n.noIsolation,v=n.inert,y=n.allowPinchZoom,b=n.as,T=b===void 0?"div":b,x=n.gapMode,w=KP(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),A=h,R=BZ([t,e]),_=gr(gr({},w),r);return U.createElement(U.Fragment,null,c&&U.createElement(A,{sideCar:XP,removeScrollBar:u,shards:d,noRelative:p,noIsolation:g,inert:v,setCallbacks:s,allowPinchZoom:!!y,lockRef:t,gapMode:x}),a?U.cloneElement(U.Children.only(o),gr(gr({},_),{ref:R})):U.createElement(T,gr({},_,{className:l,ref:R}),o))});Oh.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Oh.classNames={fullWidth:Sf,zeroRight:xf};var VZ=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function GZ(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=VZ();return e&&n.setAttribute("nonce",e),n}function WZ(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function qZ(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var $Z=function(){var n=0,e=null;return{add:function(t){n==0&&(e=GZ())&&(WZ(e,t),qZ(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},KZ=function(){var n=$Z();return function(e,t){U.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},QP=function(){var n=KZ(),e=function(t){var i=t.styles,r=t.dynamic;return n(i,r),null};return e},YZ={left:0,top:0,right:0,gap:0},Ig=function(n){return parseInt(n||"",10)||0},XZ=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],i=e[n==="padding"?"paddingTop":"marginTop"],r=e[n==="padding"?"paddingRight":"marginRight"];return[Ig(t),Ig(i),Ig(r)]},QZ=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return YZ;var e=XZ(n),t=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-t+e[2]-e[0])}},ZZ=QP(),Jo="data-scroll-locked",JZ=function(n,e,t,i){var r=n.left,s=n.top,a=n.right,o=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(OZ,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(o,"px ").concat(i,`;
  }
  body[`).concat(Jo,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),t==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(i,`;
    `),t==="padding"&&"padding-right: ".concat(o,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(xf,` {
    right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(Sf,` {
    margin-right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(xf," .").concat(xf,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(Sf," .").concat(Sf,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Jo,`] {
    `).concat(NZ,": ").concat(o,`px;
  }
`)},vA=function(){var n=parseInt(document.body.getAttribute(Jo)||"0",10);return isFinite(n)?n:0},eJ=function(){U.useEffect(function(){return document.body.setAttribute(Jo,(vA()+1).toString()),function(){var n=vA()-1;n<=0?document.body.removeAttribute(Jo):document.body.setAttribute(Jo,n.toString())}},[])},tJ=function(n){var e=n.noRelative,t=n.noImportant,i=n.gapMode,r=i===void 0?"margin":i;eJ();var s=U.useMemo(function(){return QZ(r)},[r]);return U.createElement(ZZ,{styles:JZ(s,!e,r,t?"":"!important")})},Uv=!1;if(typeof window<"u")try{var tf=Object.defineProperty({},"passive",{get:function(){return Uv=!0,!0}});window.addEventListener("test",tf,tf),window.removeEventListener("test",tf,tf)}catch{Uv=!1}var No=Uv?{passive:!1}:!1,nJ=function(n){return n.tagName==="TEXTAREA"},ZP=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!nJ(n)&&t[e]==="visible")},iJ=function(n){return ZP(n,"overflowY")},rJ=function(n){return ZP(n,"overflowX")},yA=function(n,e){var t=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=JP(n,i);if(r){var s=ek(n,i),a=s[1],o=s[2];if(a>o)return!0}i=i.parentNode}while(i&&i!==t.body);return!1},sJ=function(n){var e=n.scrollTop,t=n.scrollHeight,i=n.clientHeight;return[e,t,i]},aJ=function(n){var e=n.scrollLeft,t=n.scrollWidth,i=n.clientWidth;return[e,t,i]},JP=function(n,e){return n==="v"?iJ(e):rJ(e)},ek=function(n,e){return n==="v"?sJ(e):aJ(e)},oJ=function(n,e){return n==="h"&&e==="rtl"?-1:1},uJ=function(n,e,t,i,r){var s=oJ(n,window.getComputedStyle(e).direction),a=s*i,o=t.target,l=e.contains(o),u=!1,c=a>0,d=0,h=0;do{if(!o)break;var p=ek(n,o),g=p[0],v=p[1],y=p[2],b=v-y-s*g;(g||b)&&JP(n,o)&&(d+=b,h+=g);var T=o.parentNode;o=T&&T.nodeType===Node.DOCUMENT_FRAGMENT_NODE?T.host:T}while(!l&&o!==document.body||l&&(e.contains(o)||e===o));return(c&&Math.abs(d)<1||!c&&Math.abs(h)<1)&&(u=!0),u},nf=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},EA=function(n){return[n.deltaX,n.deltaY]},bA=function(n){return n&&"current"in n?n.current:n},lJ=function(n,e){return n[0]===e[0]&&n[1]===e[1]},cJ=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},dJ=0,Mo=[];function fJ(n){var e=U.useRef([]),t=U.useRef([0,0]),i=U.useRef(),r=U.useState(dJ++)[0],s=U.useState(QP)[0],a=U.useRef(n);U.useEffect(function(){a.current=n},[n]),U.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(r));var v=DZ([n.lockRef.current],(n.shards||[]).map(bA),!0).filter(Boolean);return v.forEach(function(y){return y.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),v.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(r))})}}},[n.inert,n.lockRef.current,n.shards]);var o=U.useCallback(function(v,y){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!a.current.allowPinchZoom;var b=nf(v),T=t.current,x="deltaX"in v?v.deltaX:T[0]-b[0],w="deltaY"in v?v.deltaY:T[1]-b[1],A,R=v.target,_=Math.abs(x)>Math.abs(w)?"h":"v";if("touches"in v&&_==="h"&&R.type==="range")return!1;var D=window.getSelection(),H=D&&D.anchorNode,P=H?H===R||H.contains(R):!1;if(P)return!1;var N=yA(_,R);if(!N)return!0;if(N?A=_:(A=_==="v"?"h":"v",N=yA(_,R)),!N)return!1;if(!i.current&&"changedTouches"in v&&(x||w)&&(i.current=A),!A)return!0;var G=i.current||A;return uJ(G,y,v,G==="h"?x:w)},[]),l=U.useCallback(function(v){var y=v;if(!(!Mo.length||Mo[Mo.length-1]!==s)){var b="deltaY"in y?EA(y):nf(y),T=e.current.filter(function(A){return A.name===y.type&&(A.target===y.target||y.target===A.shadowParent)&&lJ(A.delta,b)})[0];if(T&&T.should){y.cancelable&&y.preventDefault();return}if(!T){var x=(a.current.shards||[]).map(bA).filter(Boolean).filter(function(A){return A.contains(y.target)}),w=x.length>0?o(y,x[0]):!a.current.noIsolation;w&&y.cancelable&&y.preventDefault()}}},[]),u=U.useCallback(function(v,y,b,T){var x={name:v,delta:y,target:b,should:T,shadowParent:hJ(b)};e.current.push(x),setTimeout(function(){e.current=e.current.filter(function(w){return w!==x})},1)},[]),c=U.useCallback(function(v){t.current=nf(v),i.current=void 0},[]),d=U.useCallback(function(v){u(v.type,EA(v),v.target,o(v,n.lockRef.current))},[]),h=U.useCallback(function(v){u(v.type,nf(v),v.target,o(v,n.lockRef.current))},[]);U.useEffect(function(){return Mo.push(s),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,No),document.addEventListener("touchmove",l,No),document.addEventListener("touchstart",c,No),function(){Mo=Mo.filter(function(v){return v!==s}),document.removeEventListener("wheel",l,No),document.removeEventListener("touchmove",l,No),document.removeEventListener("touchstart",c,No)}},[]);var p=n.removeScrollBar,g=n.inert;return U.createElement(U.Fragment,null,g?U.createElement(s,{styles:cJ(r)}):null,p?U.createElement(tJ,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function hJ(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const pJ=jZ(XP,fJ);var D1=U.forwardRef(function(n,e){return U.createElement(Oh,gr({},n,{ref:e,sideCar:pJ}))});D1.classNames=Oh.classNames;var Nh="Popover",[tk]=Cr(Nh,[Dh]),lc=Dh(),[mJ,Qa]=tk(Nh),nk=n=>{const{__scopePopover:e,children:t,open:i,defaultOpen:r,onOpenChange:s,modal:a=!1}=n,o=lc(e),l=U.useRef(null),[u,c]=U.useState(!1),[d,h]=Gs({prop:i,defaultProp:r??!1,onChange:s,caller:Nh});return be.jsx(zP,{...o,children:be.jsx(mJ,{scope:e,contentId:qa(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:U.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:u,onCustomAnchorAdd:U.useCallback(()=>c(!0),[]),onCustomAnchorRemove:U.useCallback(()=>c(!1),[]),modal:a,children:t})})};nk.displayName=Nh;var ik="PopoverAnchor",gJ=U.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=Qa(ik,t),s=lc(t),{onCustomAnchorAdd:a,onCustomAnchorRemove:o}=r;return U.useEffect(()=>(a(),()=>o()),[a,o]),be.jsx(k1,{...s,...i,ref:e})});gJ.displayName=ik;var rk="PopoverTrigger",sk=U.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=Qa(rk,t),s=lc(t),a=Ht(e,r.triggerRef),o=be.jsx(WP.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":dk(r.open),...i,ref:a,onClick:xt(n.onClick,r.onOpenToggle)});return r.hasCustomAnchor?o:be.jsx(k1,{asChild:!0,...s,children:o})});sk.displayName=rk;var vJ="PopoverPortal",[Nae,yJ]=tk(vJ,{forceMount:void 0}),ou="PopoverContent",ak=U.forwardRef((n,e)=>{const t=yJ(ou,n.__scopePopover),{forceMount:i=t.forceMount,...r}=n,s=Qa(ou,n.__scopePopover);return be.jsx(Ql,{present:i||s.open,children:s.modal?be.jsx(bJ,{...r,ref:e}):be.jsx(TJ,{...r,ref:e})})});ak.displayName=ou;var EJ=Dn("PopoverContent.RemoveScroll"),bJ=U.forwardRef((n,e)=>{const t=Qa(ou,n.__scopePopover),i=U.useRef(null),r=Ht(e,i),s=U.useRef(!1);return U.useEffect(()=>{const a=i.current;if(a)return $P(a)},[]),be.jsx(D1,{as:EJ,allowPinchZoom:!0,children:be.jsx(ok,{...n,ref:r,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:xt(n.onCloseAutoFocus,a=>{var o;a.preventDefault(),s.current||(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:xt(n.onPointerDownOutside,a=>{const o=a.detail.originalEvent,l=o.button===0&&o.ctrlKey===!0,u=o.button===2||l;s.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:xt(n.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),TJ=U.forwardRef((n,e)=>{const t=Qa(ou,n.__scopePopover),i=U.useRef(!1),r=U.useRef(!1);return be.jsx(ok,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var a,o;(a=n.onCloseAutoFocus)==null||a.call(n,s),s.defaultPrevented||(i.current||(o=t.triggerRef.current)==null||o.focus(),s.preventDefault()),i.current=!1,r.current=!1},onInteractOutside:s=>{var l,u;(l=n.onInteractOutside)==null||l.call(n,s),s.defaultPrevented||(i.current=!0,s.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const a=s.target;((u=t.triggerRef.current)==null?void 0:u.contains(a))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&r.current&&s.preventDefault()}})}),ok=U.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:c,...d}=n,h=Qa(ou,t),p=lc(t);return vP(),be.jsx(S1,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:s,children:be.jsx(x1,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:c,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:u,onDismiss:()=>h.onOpenChange(!1),children:be.jsx(jP,{"data-state":dk(h.open),role:"dialog",id:h.contentId,...p,...d,ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),uk="PopoverClose",lk=U.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=Qa(uk,t);return be.jsx(WP.button,{type:"button",...i,ref:e,onClick:xt(n.onClick,()=>r.onOpenChange(!1))})});lk.displayName=uk;var xJ="PopoverArrow",ck=U.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=lc(t);return be.jsx(VP,{...r,...i,ref:e})});ck.displayName=xJ;function dk(n){return n?"open":"closed"}var SJ=nk,wJ=sk,AJ=ak,CJ=lk,IJ=ck;function TA(n,[e,t]){return Math.min(t,Math.max(e,n))}var RJ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Si=RJ.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),_J=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],LJ=_J.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),fk=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),PJ="VisuallyHidden",kJ=U.forwardRef((n,e)=>be.jsx(LJ.span,{...n,ref:e,style:{...fk,...n.style}}));kJ.displayName=PJ;var DJ=[" ","Enter","ArrowUp","ArrowDown"],OJ=[" ","Enter"],Ga="Select",[Mh,Fh,NJ]=zC(Ga),[vu]=Cr(Ga,[NJ,Dh]),Bh=Dh(),[MJ,ta]=vu(Ga),[FJ,BJ]=vu(Ga),hk=n=>{const{__scopeSelect:e,children:t,open:i,defaultOpen:r,onOpenChange:s,value:a,defaultValue:o,onValueChange:l,dir:u,name:c,autoComplete:d,disabled:h,required:p,form:g}=n,v=Bh(e),[y,b]=U.useState(null),[T,x]=U.useState(null),[w,A]=U.useState(!1),R=ih(u),[_,D]=Gs({prop:i,defaultProp:r??!1,onChange:s,caller:Ga}),[H,P]=Gs({prop:a,defaultProp:o,onChange:l,caller:Ga}),N=U.useRef(null),G=y?g||!!y.closest("form"):!0,[X,te]=U.useState(new Set),Q=Array.from(X).map(ne=>ne.props.value).join(";");return be.jsx(zP,{...v,children:be.jsxs(MJ,{required:p,scope:e,trigger:y,onTriggerChange:b,valueNode:T,onValueNodeChange:x,valueNodeHasChildren:w,onValueNodeHasChildrenChange:A,contentId:qa(),value:H,onValueChange:P,open:_,onOpenChange:D,dir:R,triggerPointerDownPosRef:N,disabled:h,children:[be.jsx(Mh.Provider,{scope:e,children:be.jsx(FJ,{scope:n.__scopeSelect,onNativeOptionAdd:U.useCallback(ne=>{te(oe=>new Set(oe).add(ne))},[]),onNativeOptionRemove:U.useCallback(ne=>{te(oe=>{const Z=new Set(oe);return Z.delete(ne),Z})},[]),children:t})}),G?be.jsxs(Fk,{"aria-hidden":!0,required:p,tabIndex:-1,name:c,autoComplete:d,value:H,onChange:ne=>P(ne.target.value),disabled:h,form:g,children:[H===void 0?be.jsx("option",{value:""}):null,Array.from(X)]},Q):null]})})};hk.displayName=Ga;var pk="SelectTrigger",mk=U.forwardRef((n,e)=>{const{__scopeSelect:t,disabled:i=!1,...r}=n,s=Bh(t),a=ta(pk,t),o=a.disabled||i,l=Ht(e,a.onTriggerChange),u=Fh(t),c=U.useRef("touch"),[d,h,p]=Uk(v=>{const y=u().filter(x=>!x.disabled),b=y.find(x=>x.value===a.value),T=Hk(y,v,b);T!==void 0&&a.onValueChange(T.value)}),g=v=>{o||(a.onOpenChange(!0),p()),v&&(a.triggerPointerDownPosRef.current={x:Math.round(v.pageX),y:Math.round(v.pageY)})};return be.jsx(k1,{asChild:!0,...s,children:be.jsx(Si.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":Bk(a.value)?"":void 0,...r,ref:l,onClick:xt(r.onClick,v=>{v.currentTarget.focus(),c.current!=="mouse"&&g(v)}),onPointerDown:xt(r.onPointerDown,v=>{c.current=v.pointerType;const y=v.target;y.hasPointerCapture(v.pointerId)&&y.releasePointerCapture(v.pointerId),v.button===0&&v.ctrlKey===!1&&v.pointerType==="mouse"&&(g(v),v.preventDefault())}),onKeyDown:xt(r.onKeyDown,v=>{const y=d.current!=="";!(v.ctrlKey||v.altKey||v.metaKey)&&v.key.length===1&&h(v.key),!(y&&v.key===" ")&&DJ.includes(v.key)&&(g(),v.preventDefault())})})})});mk.displayName=pk;var gk="SelectValue",vk=U.forwardRef((n,e)=>{const{__scopeSelect:t,className:i,style:r,children:s,placeholder:a="",...o}=n,l=ta(gk,t),{onValueNodeHasChildrenChange:u}=l,c=s!==void 0,d=Ht(e,l.onValueNodeChange);return kn(()=>{u(c)},[u,c]),be.jsx(Si.span,{...o,ref:d,style:{pointerEvents:"none"},children:Bk(l.value)?be.jsx(be.Fragment,{children:a}):s})});vk.displayName=gk;var UJ="SelectIcon",yk=U.forwardRef((n,e)=>{const{__scopeSelect:t,children:i,...r}=n;return be.jsx(Si.span,{"aria-hidden":!0,...r,ref:e,children:i||""})});yk.displayName=UJ;var HJ="SelectPortal",Ek=n=>be.jsx(GP,{asChild:!0,...n});Ek.displayName=HJ;var Wa="SelectContent",bk=U.forwardRef((n,e)=>{const t=ta(Wa,n.__scopeSelect),[i,r]=U.useState();if(kn(()=>{r(new DocumentFragment)},[]),!t.open){const s=i;return s?Xl.createPortal(be.jsx(Tk,{scope:n.__scopeSelect,children:be.jsx(Mh.Slot,{scope:n.__scopeSelect,children:be.jsx("div",{children:n.children})})}),s):null}return be.jsx(xk,{...n,ref:e})});bk.displayName=Wa;var Xi=10,[Tk,na]=vu(Wa),zJ="SelectContentImpl",jJ=Dn("SelectContent.RemoveScroll"),xk=U.forwardRef((n,e)=>{const{__scopeSelect:t,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:s,onPointerDownOutside:a,side:o,sideOffset:l,align:u,alignOffset:c,arrowPadding:d,collisionBoundary:h,collisionPadding:p,sticky:g,hideWhenDetached:v,avoidCollisions:y,...b}=n,T=ta(Wa,t),[x,w]=U.useState(null),[A,R]=U.useState(null),_=Ht(e,Ae=>w(Ae)),[D,H]=U.useState(null),[P,N]=U.useState(null),G=Fh(t),[X,te]=U.useState(!1),Q=U.useRef(!1);U.useEffect(()=>{if(x)return $P(x)},[x]),vP();const ne=U.useCallback(Ae=>{const[ke,...je]=G().map(Re=>Re.ref.current),[We]=je.slice(-1),de=document.activeElement;for(const Re of Ae)if(Re===de||(Re==null||Re.scrollIntoView({block:"nearest"}),Re===ke&&A&&(A.scrollTop=0),Re===We&&A&&(A.scrollTop=A.scrollHeight),Re==null||Re.focus(),document.activeElement!==de))return},[G,A]),oe=U.useCallback(()=>ne([D,x]),[ne,D,x]);U.useEffect(()=>{X&&oe()},[X,oe]);const{onOpenChange:Z,triggerPointerDownPosRef:se}=T;U.useEffect(()=>{if(x){let Ae={x:0,y:0};const ke=We=>{var de,Re;Ae={x:Math.abs(Math.round(We.pageX)-(((de=se.current)==null?void 0:de.x)??0)),y:Math.abs(Math.round(We.pageY)-(((Re=se.current)==null?void 0:Re.y)??0))}},je=We=>{Ae.x<=10&&Ae.y<=10?We.preventDefault():x.contains(We.target)||Z(!1),document.removeEventListener("pointermove",ke),se.current=null};return se.current!==null&&(document.addEventListener("pointermove",ke),document.addEventListener("pointerup",je,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ke),document.removeEventListener("pointerup",je,{capture:!0})}}},[x,Z,se]),U.useEffect(()=>{const Ae=()=>Z(!1);return window.addEventListener("blur",Ae),window.addEventListener("resize",Ae),()=>{window.removeEventListener("blur",Ae),window.removeEventListener("resize",Ae)}},[Z]);const[j,q]=Uk(Ae=>{const ke=G().filter(de=>!de.disabled),je=ke.find(de=>de.ref.current===document.activeElement),We=Hk(ke,Ae,je);We&&setTimeout(()=>We.ref.current.focus())}),re=U.useCallback((Ae,ke,je)=>{const We=!Q.current&&!je;(T.value!==void 0&&T.value===ke||We)&&(H(Ae),We&&(Q.current=!0))},[T.value]),z=U.useCallback(()=>x==null?void 0:x.focus(),[x]),ve=U.useCallback((Ae,ke,je)=>{const We=!Q.current&&!je;(T.value!==void 0&&T.value===ke||We)&&N(Ae)},[T.value]),Le=i==="popper"?Hv:Sk,Ce=Le===Hv?{side:o,sideOffset:l,align:u,alignOffset:c,arrowPadding:d,collisionBoundary:h,collisionPadding:p,sticky:g,hideWhenDetached:v,avoidCollisions:y}:{};return be.jsx(Tk,{scope:t,content:x,viewport:A,onViewportChange:R,itemRefCallback:re,selectedItem:D,onItemLeave:z,itemTextRefCallback:ve,focusSelectedItem:oe,selectedItemText:P,position:i,isPositioned:X,searchRef:j,children:be.jsx(D1,{as:jJ,allowPinchZoom:!0,children:be.jsx(S1,{asChild:!0,trapped:T.open,onMountAutoFocus:Ae=>{Ae.preventDefault()},onUnmountAutoFocus:xt(r,Ae=>{var ke;(ke=T.trigger)==null||ke.focus({preventScroll:!0}),Ae.preventDefault()}),children:be.jsx(x1,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:a,onFocusOutside:Ae=>Ae.preventDefault(),onDismiss:()=>T.onOpenChange(!1),children:be.jsx(Le,{role:"listbox",id:T.contentId,"data-state":T.open?"open":"closed",dir:T.dir,onContextMenu:Ae=>Ae.preventDefault(),...b,...Ce,onPlaced:()=>te(!0),ref:_,style:{display:"flex",flexDirection:"column",outline:"none",...b.style},onKeyDown:xt(b.onKeyDown,Ae=>{const ke=Ae.ctrlKey||Ae.altKey||Ae.metaKey;if(Ae.key==="Tab"&&Ae.preventDefault(),!ke&&Ae.key.length===1&&q(Ae.key),["ArrowUp","ArrowDown","Home","End"].includes(Ae.key)){let We=G().filter(de=>!de.disabled).map(de=>de.ref.current);if(["ArrowUp","End"].includes(Ae.key)&&(We=We.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ae.key)){const de=Ae.target,Re=We.indexOf(de);We=We.slice(Re+1)}setTimeout(()=>ne(We)),Ae.preventDefault()}})})})})})})});xk.displayName=zJ;var VJ="SelectItemAlignedPosition",Sk=U.forwardRef((n,e)=>{const{__scopeSelect:t,onPlaced:i,...r}=n,s=ta(Wa,t),a=na(Wa,t),[o,l]=U.useState(null),[u,c]=U.useState(null),d=Ht(e,_=>c(_)),h=Fh(t),p=U.useRef(!1),g=U.useRef(!0),{viewport:v,selectedItem:y,selectedItemText:b,focusSelectedItem:T}=a,x=U.useCallback(()=>{if(s.trigger&&s.valueNode&&o&&u&&v&&y&&b){const _=s.trigger.getBoundingClientRect(),D=u.getBoundingClientRect(),H=s.valueNode.getBoundingClientRect(),P=b.getBoundingClientRect();if(s.dir!=="rtl"){const de=P.left-D.left,Re=H.left-de,Ie=_.left-Re,Ye=_.width+Ie,It=Math.max(Ye,D.width),Qe=window.innerWidth-Xi,k=TA(Re,[Xi,Math.max(Xi,Qe-It)]);o.style.minWidth=Ye+"px",o.style.left=k+"px"}else{const de=D.right-P.right,Re=window.innerWidth-H.right-de,Ie=window.innerWidth-_.right-Re,Ye=_.width+Ie,It=Math.max(Ye,D.width),Qe=window.innerWidth-Xi,k=TA(Re,[Xi,Math.max(Xi,Qe-It)]);o.style.minWidth=Ye+"px",o.style.right=k+"px"}const N=h(),G=window.innerHeight-Xi*2,X=v.scrollHeight,te=window.getComputedStyle(u),Q=parseInt(te.borderTopWidth,10),ne=parseInt(te.paddingTop,10),oe=parseInt(te.borderBottomWidth,10),Z=parseInt(te.paddingBottom,10),se=Q+ne+X+Z+oe,j=Math.min(y.offsetHeight*5,se),q=window.getComputedStyle(v),re=parseInt(q.paddingTop,10),z=parseInt(q.paddingBottom,10),ve=_.top+_.height/2-Xi,Le=G-ve,Ce=y.offsetHeight/2,Ae=y.offsetTop+Ce,ke=Q+ne+Ae,je=se-ke;if(ke<=ve){const de=N.length>0&&y===N[N.length-1].ref.current;o.style.bottom="0px";const Re=u.clientHeight-v.offsetTop-v.offsetHeight,Ie=Math.max(Le,Ce+(de?z:0)+Re+oe),Ye=ke+Ie;o.style.height=Ye+"px"}else{const de=N.length>0&&y===N[0].ref.current;o.style.top="0px";const Ie=Math.max(ve,Q+v.offsetTop+(de?re:0)+Ce)+je;o.style.height=Ie+"px",v.scrollTop=ke-ve+v.offsetTop}o.style.margin=`${Xi}px 0`,o.style.minHeight=j+"px",o.style.maxHeight=G+"px",i==null||i(),requestAnimationFrame(()=>p.current=!0)}},[h,s.trigger,s.valueNode,o,u,v,y,b,s.dir,i]);kn(()=>x(),[x]);const[w,A]=U.useState();kn(()=>{u&&A(window.getComputedStyle(u).zIndex)},[u]);const R=U.useCallback(_=>{_&&g.current===!0&&(x(),T==null||T(),g.current=!1)},[x,T]);return be.jsx(WJ,{scope:t,contentWrapper:o,shouldExpandOnScrollRef:p,onScrollButtonChange:R,children:be.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:w},children:be.jsx(Si.div,{...r,ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});Sk.displayName=VJ;var GJ="SelectPopperPosition",Hv=U.forwardRef((n,e)=>{const{__scopeSelect:t,align:i="start",collisionPadding:r=Xi,...s}=n,a=Bh(t);return be.jsx(jP,{...a,...s,ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Hv.displayName=GJ;var[WJ,O1]=vu(Wa,{}),zv="SelectViewport",wk=U.forwardRef((n,e)=>{const{__scopeSelect:t,nonce:i,...r}=n,s=na(zv,t),a=O1(zv,t),o=Ht(e,s.onViewportChange),l=U.useRef(0);return be.jsxs(be.Fragment,{children:[be.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),be.jsx(Mh.Slot,{scope:t,children:be.jsx(Si.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:xt(r.onScroll,u=>{const c=u.currentTarget,{contentWrapper:d,shouldExpandOnScrollRef:h}=a;if(h!=null&&h.current&&d){const p=Math.abs(l.current-c.scrollTop);if(p>0){const g=window.innerHeight-Xi*2,v=parseFloat(d.style.minHeight),y=parseFloat(d.style.height),b=Math.max(v,y);if(b<g){const T=b+p,x=Math.min(g,T),w=T-x;d.style.height=x+"px",d.style.bottom==="0px"&&(c.scrollTop=w>0?w:0,d.style.justifyContent="flex-end")}}}l.current=c.scrollTop})})})]})});wk.displayName=zv;var Ak="SelectGroup",[qJ,$J]=vu(Ak),Ck=U.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n,r=qa();return be.jsx(qJ,{scope:t,id:r,children:be.jsx(Si.div,{role:"group","aria-labelledby":r,...i,ref:e})})});Ck.displayName=Ak;var Ik="SelectLabel",Rk=U.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n,r=$J(Ik,t);return be.jsx(Si.div,{id:r.id,...i,ref:e})});Rk.displayName=Ik;var Jf="SelectItem",[KJ,_k]=vu(Jf),Lk=U.forwardRef((n,e)=>{const{__scopeSelect:t,value:i,disabled:r=!1,textValue:s,...a}=n,o=ta(Jf,t),l=na(Jf,t),u=o.value===i,[c,d]=U.useState(s??""),[h,p]=U.useState(!1),g=Ht(e,T=>{var x;return(x=l.itemRefCallback)==null?void 0:x.call(l,T,i,r)}),v=qa(),y=U.useRef("touch"),b=()=>{r||(o.onValueChange(i),o.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return be.jsx(KJ,{scope:t,value:i,disabled:r,textId:v,isSelected:u,onItemTextChange:U.useCallback(T=>{d(x=>x||((T==null?void 0:T.textContent)??"").trim())},[]),children:be.jsx(Mh.ItemSlot,{scope:t,value:i,disabled:r,textValue:c,children:be.jsx(Si.div,{role:"option","aria-labelledby":v,"data-highlighted":h?"":void 0,"aria-selected":u&&h,"data-state":u?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...a,ref:g,onFocus:xt(a.onFocus,()=>p(!0)),onBlur:xt(a.onBlur,()=>p(!1)),onClick:xt(a.onClick,()=>{y.current!=="mouse"&&b()}),onPointerUp:xt(a.onPointerUp,()=>{y.current==="mouse"&&b()}),onPointerDown:xt(a.onPointerDown,T=>{y.current=T.pointerType}),onPointerMove:xt(a.onPointerMove,T=>{var x;y.current=T.pointerType,r?(x=l.onItemLeave)==null||x.call(l):y.current==="mouse"&&T.currentTarget.focus({preventScroll:!0})}),onPointerLeave:xt(a.onPointerLeave,T=>{var x;T.currentTarget===document.activeElement&&((x=l.onItemLeave)==null||x.call(l))}),onKeyDown:xt(a.onKeyDown,T=>{var w;((w=l.searchRef)==null?void 0:w.current)!==""&&T.key===" "||(OJ.includes(T.key)&&b(),T.key===" "&&T.preventDefault())})})})})});Lk.displayName=Jf;var gl="SelectItemText",Pk=U.forwardRef((n,e)=>{const{__scopeSelect:t,className:i,style:r,...s}=n,a=ta(gl,t),o=na(gl,t),l=_k(gl,t),u=BJ(gl,t),[c,d]=U.useState(null),h=Ht(e,b=>d(b),l.onItemTextChange,b=>{var T;return(T=o.itemTextRefCallback)==null?void 0:T.call(o,b,l.value,l.disabled)}),p=c==null?void 0:c.textContent,g=U.useMemo(()=>be.jsx("option",{value:l.value,disabled:l.disabled,children:p},l.value),[l.disabled,l.value,p]),{onNativeOptionAdd:v,onNativeOptionRemove:y}=u;return kn(()=>(v(g),()=>y(g)),[v,y,g]),be.jsxs(be.Fragment,{children:[be.jsx(Si.span,{id:l.textId,...s,ref:h}),l.isSelected&&a.valueNode&&!a.valueNodeHasChildren?Xl.createPortal(s.children,a.valueNode):null]})});Pk.displayName=gl;var kk="SelectItemIndicator",Dk=U.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n;return _k(kk,t).isSelected?be.jsx(Si.span,{"aria-hidden":!0,...i,ref:e}):null});Dk.displayName=kk;var jv="SelectScrollUpButton",Ok=U.forwardRef((n,e)=>{const t=na(jv,n.__scopeSelect),i=O1(jv,n.__scopeSelect),[r,s]=U.useState(!1),a=Ht(e,i.onScrollButtonChange);return kn(()=>{if(t.viewport&&t.isPositioned){let o=function(){const u=l.scrollTop>0;s(u)};const l=t.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[t.viewport,t.isPositioned]),r?be.jsx(Mk,{...n,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=t;o&&l&&(o.scrollTop=o.scrollTop-l.offsetHeight)}}):null});Ok.displayName=jv;var Vv="SelectScrollDownButton",Nk=U.forwardRef((n,e)=>{const t=na(Vv,n.__scopeSelect),i=O1(Vv,n.__scopeSelect),[r,s]=U.useState(!1),a=Ht(e,i.onScrollButtonChange);return kn(()=>{if(t.viewport&&t.isPositioned){let o=function(){const u=l.scrollHeight-l.clientHeight,c=Math.ceil(l.scrollTop)<u;s(c)};const l=t.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[t.viewport,t.isPositioned]),r?be.jsx(Mk,{...n,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=t;o&&l&&(o.scrollTop=o.scrollTop+l.offsetHeight)}}):null});Nk.displayName=Vv;var Mk=U.forwardRef((n,e)=>{const{__scopeSelect:t,onAutoScroll:i,...r}=n,s=na("SelectScrollButton",t),a=U.useRef(null),o=Fh(t),l=U.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return U.useEffect(()=>()=>l(),[l]),kn(()=>{var c;const u=o().find(d=>d.ref.current===document.activeElement);(c=u==null?void 0:u.ref.current)==null||c.scrollIntoView({block:"nearest"})},[o]),be.jsx(Si.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:xt(r.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(i,50))}),onPointerMove:xt(r.onPointerMove,()=>{var u;(u=s.onItemLeave)==null||u.call(s),a.current===null&&(a.current=window.setInterval(i,50))}),onPointerLeave:xt(r.onPointerLeave,()=>{l()})})}),YJ="SelectSeparator",XJ=U.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n;return be.jsx(Si.div,{"aria-hidden":!0,...i,ref:e})});XJ.displayName=YJ;var Gv="SelectArrow",QJ=U.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n,r=Bh(t),s=ta(Gv,t),a=na(Gv,t);return s.open&&a.position==="popper"?be.jsx(VP,{...r,...i,ref:e}):null});QJ.displayName=Gv;var ZJ="SelectBubbleInput",Fk=U.forwardRef(({__scopeSelect:n,value:e,...t},i)=>{const r=U.useRef(null),s=Ht(i,r),a=jy(e);return U.useEffect(()=>{const o=r.current;if(!o)return;const l=window.HTMLSelectElement.prototype,c=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==e&&c){const d=new Event("change",{bubbles:!0});c.call(o,e),o.dispatchEvent(d)}},[a,e]),be.jsx(Si.select,{...t,style:{...fk,...t.style},ref:s,defaultValue:e})});Fk.displayName=ZJ;function Bk(n){return n===""||n===void 0}function Uk(n){const e=Ws(n),t=U.useRef(""),i=U.useRef(0),r=U.useCallback(a=>{const o=t.current+a;e(o),(function l(u){t.current=u,window.clearTimeout(i.current),u!==""&&(i.current=window.setTimeout(()=>l(""),1e3))})(o)},[e]),s=U.useCallback(()=>{t.current="",window.clearTimeout(i.current)},[]);return U.useEffect(()=>()=>window.clearTimeout(i.current),[]),[t,r,s]}function Hk(n,e,t){const r=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let a=JJ(n,Math.max(s,0));r.length===1&&(a=a.filter(u=>u!==t));const l=a.find(u=>u.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==t?l:void 0}function JJ(n,e){return n.map((t,i)=>n[(e+i)%n.length])}var eee=hk,tee=mk,nee=bk,iee=Rk,ree=Lk,wf={exports:{}},see=wf.exports,xA;function aee(){return xA||(xA=1,(function(n){//! openseadragon 4.1.1
//! Built on 2024-04-01
//! Git commit: v4.1.1-0-f90d9814
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function e(t){return new e.Viewer(t)}(function(t){t.version={versionStr:"4.1.1",major:parseInt("4",10),minor:parseInt("1",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,s=Object.prototype.hasOwnProperty;t.isFunction=function(a){return t.type(a)==="function"},t.isArray=Array.isArray||function(a){return t.type(a)==="array"},t.isWindow=function(a){return a&&typeof a=="object"&&"setInterval"in a},t.type=function(a){return a==null?String(a):i[r.call(a)]||"object"},t.isPlainObject=function(a){if(!a||e.type(a)!=="object"||a.nodeType||t.isWindow(a)||a.constructor&&!s.call(a,"constructor")&&!s.call(a.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var l in a)o=l;return o===void 0||s.call(a,o)},t.isEmptyObject=function(a){for(var o in a)return!1;return!0},t.freezeObject=function(a){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(o){return o},t.freezeObject(a)},t.supportsCanvas=(function(){var a=document.createElement("canvas");return!!(t.isFunction(a.getContext)&&a.getContext("2d"))})(),t.isCanvasTainted=function(a){var o=!1;try{a.getContext("2d").getImageData(0,0,1,1)}catch{o=!0}return o},t.supportsAddEventListener=(function(){return!!(document.documentElement.addEventListener&&document.addEventListener)})(),t.supportsRemoveEventListener=(function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)})(),t.supportsEventListenerOptions=(function(){var a=0;if(t.supportsAddEventListener)try{var o={get capture(){return a++,!1},get once(){return a++,!1},get passive(){return a++,!1}};window.addEventListener("test",null,o),window.removeEventListener("test",null,o)}catch{a=0}return a>=3})(),t.getCurrentPixelDensityRatio=function(){if(t.supportsCanvas){var a=document.createElement("canvas").getContext("2d"),o=window.devicePixelRatio||1,l=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return Math.max(o,1)/l}else return 1},t.pixelDensityRatio=t.getCurrentPixelDensityRatio()})(e),(function(t){t.extend=function(){var l,u,c,d,h,p,g=arguments[0]||{},v=arguments.length,y=!1,b=1;for(typeof g=="boolean"&&(y=g,g=arguments[1]||{},b=2),typeof g!="object"&&!e.isFunction(g)&&(g={}),v===b&&(g=this,--b);b<v;b++)if(l=arguments[b],l!==null||l!==void 0)for(u in l){var T=Object.getOwnPropertyDescriptor(l,u);if(T!==void 0){if(T.get||T.set){Object.defineProperty(g,u,T);continue}d=T.value}else{t.console.warn('Could not copy inherited property "'+u+'".');continue}g!==d&&(y&&d&&(e.isPlainObject(d)||(h=e.isArray(d)))?(c=g[u],h?(h=!1,p=c&&e.isArray(c)?c:[]):p=c&&e.isPlainObject(c)?c:{},g[u]=e.extend(y,p,d)):d!==void 0&&(g[u]=d))}return g};var i=function(){if(typeof navigator!="object")return!1;var l=navigator.userAgent;return typeof l!="string"?!1:l.indexOf("iPhone")!==-1||l.indexOf("iPad")!==-1||l.indexOf("iPod")!==-1};t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(l,u){return function(){var c=arguments;return c===void 0&&(c=[]),u.apply(l,c)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(l){return t._viewers.get(this.getElement(l))},getElement:function(l){return typeof l=="string"&&(l=document.getElementById(l)),l},getElementPosition:function(l){var u=new t.Point,c,d;for(l=t.getElement(l),c=t.getElementStyle(l).position==="fixed",d=o(l,c);d;)u.x+=l.offsetLeft,u.y+=l.offsetTop,c&&(u=u.plus(t.getPageScroll())),l=d,c=t.getElementStyle(l).position==="fixed",d=o(l,c);return u},getElementOffset:function(l){l=t.getElement(l);var u=l&&l.ownerDocument,c,d,h={top:0,left:0};return u?(c=u.documentElement,typeof l.getBoundingClientRect<"u"&&(h=l.getBoundingClientRect()),d=u===u.window?u:u.nodeType===9?u.defaultView||u.parentWindow:!1,new t.Point(h.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0),h.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0))):new t.Point},getElementSize:function(l){return l=t.getElement(l),new t.Point(l.clientWidth,l.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(l){return l=t.getElement(l),l.currentStyle}:function(l){return l=t.getElement(l),window.getComputedStyle(l,"")},getCssPropertyWithVendorPrefix:function(l){var u={};return t.getCssPropertyWithVendorPrefix=function(c){if(u[c]!==void 0)return u[c];var d=document.createElement("div").style,h=null;if(d[c]!==void 0)h=c;else for(var p=["Webkit","Moz","MS","O","webkit","moz","ms","o"],g=t.capitalizeFirstLetter(c),v=0;v<p.length;v++){var y=p[v]+g;if(d[y]!==void 0){h=y;break}}return u[c]=h,h},t.getCssPropertyWithVendorPrefix(l)},capitalizeFirstLetter:function(l){return l.charAt(0).toUpperCase()+l.slice(1)},positiveModulo:function(l,u){var c=l%u;return c<0&&(c+=u),c},pointInElement:function(l,u){l=t.getElement(l);var c=t.getElementOffset(l),d=t.getElementSize(l);return u.x>=c.x&&u.x<c.x+d.x&&u.y<c.y+d.y&&u.y>=c.y},getMousePosition:function(l){if(typeof l.pageX=="number")t.getMousePosition=function(u){var c=new t.Point;return c.x=u.pageX,c.y=u.pageY,c};else if(typeof l.clientX=="number")t.getMousePosition=function(u){var c=new t.Point;return c.x=u.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=u.clientY+document.body.scrollTop+document.documentElement.scrollTop,c};else throw new Error("Unknown event mouse position, no known technique.");return t.getMousePosition(l)},getPageScroll:function(){var l=document.documentElement||{},u=document.body||{};if(typeof window.pageXOffset=="number")t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(u.scrollLeft||u.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else if(l.scrollLeft||l.scrollTop)t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new t.Point(0,0);return t.getPageScroll()},setPageScroll:function(l){if(typeof window.scrollTo<"u")t.setPageScroll=function(d){window.scrollTo(d.x,d.y)};else{var u=t.getPageScroll();if(u.x===l.x&&u.y===l.y)return;document.body.scrollLeft=l.x,document.body.scrollTop=l.y;var c=t.getPageScroll();if(c.x!==u.x&&c.y!==u.y){t.setPageScroll=function(d){document.body.scrollLeft=d.x,document.body.scrollTop=d.y};return}if(document.documentElement.scrollLeft=l.x,document.documentElement.scrollTop=l.y,c=t.getPageScroll(),c.x!==u.x&&c.y!==u.y){t.setPageScroll=function(d){document.documentElement.scrollLeft=d.x,document.documentElement.scrollTop=d.y};return}t.setPageScroll=function(d){}}t.setPageScroll(l)},getWindowSize:function(){var l=document.documentElement||{},u=document.body||{};if(typeof window.innerWidth=="number")t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(l.clientWidth||l.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(u.clientWidth||u.clientHeight)t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return t.getWindowSize()},makeCenteredNode:function(l){l=t.getElement(l);var u=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(u[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(u[1].style,{display:"table-row"}),t.extend(u[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),u[0].appendChild(u[1]),u[1].appendChild(u[2]),u[2].appendChild(l),u[0]},makeNeutralElement:function(l){var u=document.createElement(l),c=u.style;return c.background="transparent none",c.border="none",c.margin="0px",c.padding="0px",c.position="static",u},now:function(){return Date.now?t.now=Date.now:t.now=function(){return new Date().getTime()},t.now()},makeTransparentImage:function(l){var u=t.makeNeutralElement("img");return u.src=l,u},setElementOpacity:function(l,u,c){var d,h;l=t.getElement(l),c&&!t.Browser.alpha&&(u=Math.round(u)),t.Browser.opacity?l.style.opacity=u<1?u:"":u<1?(d=Math.round(100*u),h="alpha(opacity="+d+")",l.style.filter=h):l.style.filter=""},setElementTouchActionNone:function(l){l=t.getElement(l),typeof l.style.touchAction<"u"?l.style.touchAction="none":typeof l.style.msTouchAction<"u"&&(l.style.msTouchAction="none")},setElementPointerEvents:function(l,u){l=t.getElement(l),typeof l.style<"u"&&typeof l.style.pointerEvents<"u"&&(l.style.pointerEvents=u)},setElementPointerEventsNone:function(l){t.setElementPointerEvents(l,"none")},addClass:function(l,u){l=t.getElement(l),l.className?(" "+l.className+" ").indexOf(" "+u+" ")===-1&&(l.className+=" "+u):l.className=u},indexOf:function(l,u,c){return Array.prototype.indexOf?this.indexOf=function(d,h,p){return d.indexOf(h,p)}:this.indexOf=function(d,h,p){var g,v=p||0,y;if(!d)throw new TypeError;if(y=d.length,y===0||v>=y)return-1;for(v<0&&(v=y-Math.abs(v)),g=v;g<y;g++)if(d[g]===h)return g;return-1},this.indexOf(l,u,c)},removeClass:function(l,u){var c,d=[],h;for(l=t.getElement(l),c=l.className.split(/\s+/),h=0;h<c.length;h++)c[h]&&c[h]!==u&&d.push(c[h]);l.className=d.join(" ")},normalizeEventListenerOptions:function(l){var u;return typeof l<"u"?typeof l=="boolean"?u=t.supportsEventListenerOptions?{capture:l}:l:u=t.supportsEventListenerOptions?l:typeof l.capture<"u"?l.capture:!1:u=t.supportsEventListenerOptions?{capture:!1}:!1,u},addEvent:(function(){if(t.supportsAddEventListener)return function(l,u,c,d){d=t.normalizeEventListenerOptions(d),l=t.getElement(l),l.addEventListener(u,c,d)};if(document.documentElement.attachEvent&&document.attachEvent)return function(l,u,c){l=t.getElement(l),l.attachEvent("on"+u,c)};throw new Error("No known event model.")})(),removeEvent:(function(){if(t.supportsRemoveEventListener)return function(l,u,c,d){d=t.normalizeEventListenerOptions(d),l=t.getElement(l),l.removeEventListener(u,c,d)};if(document.documentElement.detachEvent&&document.detachEvent)return function(l,u,c){l=t.getElement(l),l.detachEvent("on"+u,c)};throw new Error("No known event model.")})(),cancelEvent:function(l){l.preventDefault()},eventIsCanceled:function(l){return l.defaultPrevented},stopEvent:function(l){l.stopPropagation()},createCallback:function(l,u){var c=[],d;for(d=2;d<arguments.length;d++)c.push(arguments[d]);return function(){var h=c.concat([]),p;for(p=0;p<arguments.length;p++)h.push(arguments[p]);return u.apply(l,h)}},getUrlParameter:function(l){var u=a[l];return u||null},getUrlProtocol:function(l){var u=l.match(/^([a-z]+:)\/\//i);return u===null?window.location.protocol:u[1].toLowerCase()},createAjaxRequest:function(l){var u;try{u=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{u=!1}if(u)window.XMLHttpRequest?t.createAjaxRequest=function(c){return c?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:t.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)t.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return t.createAjaxRequest(l)},makeAjaxRequest:function(l,u,c){var d,h,p,g;t.isPlainObject(l)&&(u=l.success,c=l.error,d=l.withCredentials,h=l.headers,p=l.responseType||null,g=l.postData||null,l=l.url);var v=t.getUrlProtocol(l),y=t.createAjaxRequest(v==="file:");if(!t.isFunction(u))throw new Error("makeAjaxRequest requires a success callback");y.onreadystatechange=function(){y.readyState===4&&(y.onreadystatechange=function(){},y.status>=200&&y.status<300||y.status===0&&v!=="http:"&&v!=="https:"?u(y):t.isFunction(c)?c(y):t.console.error("AJAX request returned %d: %s",y.status,l))};var b=g?"POST":"GET";try{if(y.open(b,l,!0),p&&(y.responseType=p),h)for(var T in h)Object.prototype.hasOwnProperty.call(h,T)&&h[T]&&y.setRequestHeader(T,h[T]);d&&(y.withCredentials=!0),y.send(g)}catch(x){t.console.error("%s while making AJAX request: %s",x.name,x.message),y.onreadystatechange=function(){},t.isFunction(c)&&c(y,x)}return y},jsonp:function(l){var u,c=l.url,d=document.head||document.getElementsByTagName("head")[0]||document.documentElement,h=l.callbackName||"openseadragon"+t.now(),p=window[h],g="$1"+h+"$2",v=l.param||"callback",y=l.callback;c=c.replace(/(=)\?(&|$)|\?\?/i,g),c+=(/\?/.test(c)?"&":"?")+v+"="+h,window[h]=function(b){if(p)window[h]=p;else try{delete window[h]}catch{}y&&t.isFunction(y)&&y(b)},u=document.createElement("script"),(l.async!==void 0||l.async!==!1)&&(u.async="async"),l.scriptCharset&&(u.charset=l.scriptCharset),u.src=c,u.onload=u.onreadystatechange=function(b,T){(T||!u.readyState||/loaded|complete/.test(u.readyState))&&(u.onload=u.onreadystatechange=null,d&&u.parentNode&&d.removeChild(u),u=void 0)},d.insertBefore(u,d.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(l){if(window.DOMParser)t.parseXml=function(u){var c=null,d;return d=new DOMParser,c=d.parseFromString(u,"text/xml"),c};else if(window.ActiveXObject)t.parseXml=function(u){var c=null;return c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(u),c};else throw new Error("Browser doesn't support XML DOM.");return t.parseXml(l)},parseJSON:function(l){return t.parseJSON=window.JSON.parse,t.parseJSON(l)},imageFormatSupported:function(l){return l=l||"",!!s[l.toLowerCase()]},setImageFormatsSupported:function(l){t.extend(s,l)}});var r=function(l){};t.console=window.console||{log:r,debug:r,info:r,warn:r,error:r,assert:r},t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},a={};(function(){var l=navigator.appVersion,u=navigator.userAgent,c;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(u.substring(u.indexOf("MSIE")+5,u.indexOf(";",u.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(u.indexOf("Edge")>=0?(t.Browser.vendor=t.BROWSERS.EDGE,t.Browser.version=parseFloat(u.substring(u.indexOf("Edge")+5))):u.indexOf("Edg")>=0?(t.Browser.vendor=t.BROWSERS.CHROMEEDGE,t.Browser.version=parseFloat(u.substring(u.indexOf("Edg")+4))):u.indexOf("Firefox")>=0?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(u.substring(u.indexOf("Firefox")+8))):u.indexOf("Safari")>=0?(t.Browser.vendor=u.indexOf("Chrome")>=0?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(u.substring(u.substring(0,u.indexOf("Safari")).lastIndexOf("/")+1,u.indexOf("Safari")))):(c=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),c.exec(u)!==null&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(l);break}var d=window.location.search.substring(1),h=d.split("&"),p,g,v;for(v=0;v<h.length;v++)if(p=h[v],g=p.indexOf("="),g>0){var y=p.substring(0,g),b=p.substring(g+1);try{a[y]=decodeURIComponent(b)}catch{t.console.error("Ignoring malformed URL parameter: %s=%s",y,b)}}t.Browser.alpha=!(t.Browser.vendor===t.BROWSERS.CHROME&&t.Browser.version<2),t.Browser.opacity=!0,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<11&&t.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),(function(l){var u=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.webkitRequestAnimationFrame||l.msRequestAnimationFrame,c=l.cancelAnimationFrame||l.mozCancelAnimationFrame||l.webkitCancelAnimationFrame||l.msCancelAnimationFrame;if(u&&c)t.requestAnimationFrame=function(){return u.apply(l,arguments)},t.cancelAnimationFrame=function(){return c.apply(l,arguments)};else{var d=[],h=[],p=0,g;t.requestAnimationFrame=function(v){return d.push([++p,v]),g||(g=setInterval(function(){if(d.length){var y=t.now(),b=h;for(h=d,d=b;h.length;)h.shift()[1](y)}else clearInterval(g),g=void 0},1e3/50)),p},t.cancelAnimationFrame=function(v){var y,b;for(y=0,b=d.length;y<b;y+=1)if(d[y][0]===v){d.splice(y,1);return}for(y=0,b=h.length;y<b;y+=1)if(h[y][0]===v){h.splice(y,1);return}}}})(window);function o(l,u){return u&&l!==document.body?document.body:l.offsetParent}})(e),(function(t,i){n.exports?n.exports=i():t.OpenSeadragon=i()})(see,function(){return e}),(function(t){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(r){return r.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(r){return r.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(r){return r.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},t.extend(t,i)})(e),(function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(i,r,s,a,o){var l=this;a=a||1;var u=0,c=function(d){return u++,u===a&&l.removeHandler(i,c),r(d)};this.addHandler(i,c,s,o)},addHandler:function(i,r,s,a){var o=this.events[i];if(o||(this.events[i]=o=[]),r&&t.isFunction(r)){var l=o.length,u={handler:r,userData:s||null,priority:a||0};for(o[l]=u;l>0&&o[l-1].priority<o[l].priority;)o[l]=o[l-1],o[l-1]=u,l--}},removeHandler:function(i,r){var s=this.events[i],a=[],o;if(s&&t.isArray(s)){for(o=0;o<s.length;o++)s[o].handler!==r&&a.push(s[o]);this.events[i]=a}},numberOfHandlers:function(i){var r=this.events[i];return r?r.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var r in this.events)this.events[r]=[]},getHandler:function(i){var r=this.events[i];return!r||!r.length?null:(r=r.length===1?[r[0]]:Array.apply(null,r),function(s,a){var o,l=r.length;for(o=0;o<l;o++)r[o]&&(a.eventSource=s,a.userData=r[o].userData,r[o].handler(a))})},raiseEvent:function(i,r){var s=this.getHandler(i);if(s)return s(this,r||{})}}})(e),(function(t){var i={};t.MouseTracker=function(F){var M=arguments;t.isPlainObject(F)||(F={element:M[0],clickTimeThreshold:M[1],clickDistThreshold:M[2]}),this.hash=Math.random(),this.element=t.getElement(F.element),this.clickTimeThreshold=F.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=F.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=F.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=F.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=F.userData||null,this.stopDelay=F.stopDelay||50,this.preProcessEventHandler=F.preProcessEventHandler||null,this.contextMenuHandler=F.contextMenuHandler||null,this.enterHandler=F.enterHandler||null,this.leaveHandler=F.leaveHandler||null,this.exitHandler=F.exitHandler||null,this.overHandler=F.overHandler||null,this.outHandler=F.outHandler||null,this.pressHandler=F.pressHandler||null,this.nonPrimaryPressHandler=F.nonPrimaryPressHandler||null,this.releaseHandler=F.releaseHandler||null,this.nonPrimaryReleaseHandler=F.nonPrimaryReleaseHandler||null,this.moveHandler=F.moveHandler||null,this.scrollHandler=F.scrollHandler||null,this.clickHandler=F.clickHandler||null,this.dblClickHandler=F.dblClickHandler||null,this.dragHandler=F.dragHandler||null,this.dragEndHandler=F.dragEndHandler||null,this.pinchHandler=F.pinchHandler||null,this.stopHandler=F.stopHandler||null,this.keyDownHandler=F.keyDownHandler||null,this.keyUpHandler=F.keyUpHandler||null,this.keyHandler=F.keyHandler||null,this.focusHandler=F.focusHandler||null,this.blurHandler=F.blurHandler||null;var W=this;i[this.hash]={click:function(Y){x(W,Y)},dblclick:function(Y){w(W,Y)},keydown:function(Y){A(W,Y)},keyup:function(Y){R(W,Y)},keypress:function(Y){_(W,Y)},focus:function(Y){D(W,Y)},blur:function(Y){H(W,Y)},contextmenu:function(Y){P(W,Y)},wheel:function(Y){N(W,Y)},mousewheel:function(Y){G(W,Y)},DOMMouseScroll:function(Y){G(W,Y)},MozMousePixelScroll:function(Y){G(W,Y)},losecapture:function(Y){te(W,Y)},mouseenter:function(Y){z(W,Y)},mouseleave:function(Y){ve(W,Y)},mouseover:function(Y){Le(W,Y)},mouseout:function(Y){Ce(W,Y)},mousedown:function(Y){Ae(W,Y)},mouseup:function(Y){ke(W,Y)},mousemove:function(Y){de(W,Y)},touchstart:function(Y){Q(W,Y)},touchend:function(Y){ne(W,Y)},touchmove:function(Y){oe(W,Y)},touchcancel:function(Y){Z(W,Y)},gesturestart:function(Y){se(W,Y)},gesturechange:function(Y){j(W,Y)},gotpointercapture:function(Y){q(W,Y)},lostpointercapture:function(Y){re(W,Y)},pointerenter:function(Y){z(W,Y)},pointerleave:function(Y){ve(W,Y)},pointerover:function(Y){Le(W,Y)},pointerout:function(Y){Ce(W,Y)},pointerdown:function(Y){Ae(W,Y)},pointerup:function(Y){ke(W,Y)},pointermove:function(Y){de(W,Y)},pointercancel:function(Y){Ye(W,Y)},pointerupcaptured:function(Y){je(W,Y)},pointermovecaptured:function(Y){Re(W,Y)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,t.MouseTracker.havePointerEvents&&t.setElementPointerEvents(this.element,"auto"),this.exitHandler&&t.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),F.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){l(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(F){return F?o(this):l(this),this},getActivePointersListByType:function(F){var M=i[this.hash],W,Y=M.activePointersLists.length,Te;for(W=0;W<Y;W++)if(M.activePointersLists[W].type===F)return M.activePointersLists[W];return Te=new t.MouseTracker.GesturePointList(F),M.activePointersLists.push(Te),Te},getActivePointerCount:function(){var F=i[this.hash],M,W=F.activePointersLists.length,Y=0;for(M=0;M<W;M++)Y+=F.activePointersLists[M].getLength();return Y},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var r=(function(){try{return window.self!==window.top}catch{return!0}})();function s(F){try{return F.addEventListener&&F.removeEventListener}catch{return!1}}t.MouseTracker.gesturePointVelocityTracker=(function(){var F=[],M=0,W=0,Y=function(ft,nt){return ft.hash.toString()+nt.type+nt.id.toString()},Te=function(){var ft,nt=F.length,Mt,en,ir=t.now(),Pr,kr,yu;for(Pr=ir-W,W=ir,ft=0;ft<nt;ft++)Mt=F[ft],en=Mt.gPoint,en.direction=Math.atan2(en.currentPos.y-Mt.lastPos.y,en.currentPos.x-Mt.lastPos.x),kr=Mt.lastPos.distanceTo(en.currentPos),Mt.lastPos=en.currentPos,yu=1e3*kr/(Pr+1),en.speed=.75*yu+.25*en.speed},Ne=function(ft,nt){var Mt=Y(ft,nt);F.push({guid:Mt,gPoint:nt,lastPos:nt.currentPos}),F.length===1&&(W=t.now(),M=window.setInterval(Te,50))},st=function(ft,nt){var Mt=Y(ft,nt),en,ir=F.length;for(en=0;en<ir;en++)if(F[en].guid===Mt){F.splice(en,1),ir--,ir===0&&window.clearInterval(M);break}};return{addPoint:Ne,removePoint:st}})(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName==="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.havePointerCapture=(function(){var F=document.createElement("div");return t.isFunction(F.setPointerCapture)&&t.isFunction(F.releasePointerCapture)})(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(t.MouseTracker.havePointerEvents=!1,t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.havePointerCapture=(function(){var F=document.createElement("div");return t.isFunction(F.setCapture)&&t.isFunction(F.releaseCapture)})(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),t.MouseTracker.GesturePointList=function(F){this._gPoints=[],this.type=F,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(F){return this._gPoints.push(F)},removeById:function(F){var M,W=this._gPoints.length;for(M=0;M<W;M++)if(this._gPoints[M].id===F){this._gPoints.splice(M,1);break}return this._gPoints.length},getByIndex:function(F){return F<this._gPoints.length?this._gPoints[F]:null},getById:function(F){var M,W=this._gPoints.length;for(M=0;M<W;M++)if(this._gPoints[M].id===F)return this._gPoints[M];return null},getPrimary:function(F){var M,W=this._gPoints.length;for(M=0;M<W;M++)if(this._gPoints[M].isPrimary)return this._gPoints[M];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(t.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function a(F){var M=i[F.hash],W,Y,Te,Ne,st,ft=M.activePointersLists.length;for(W=0;W<ft;W++)if(Te=M.activePointersLists[W],Te.getLength()>0){for(st=[],Ne=Te.asArray(),Y=0;Y<Ne.length;Y++)st.push(Ne[Y]);for(Y=0;Y<st.length;Y++)Qe(F,Te,st[Y])}for(W=0;W<ft;W++)M.activePointersLists.pop();M.sentDragEvent=!1}function o(F){var M=i[F.hash],W,Y;if(!M.tracking){for(Y=0;Y<t.MouseTracker.subscribeEvents.length;Y++)W=t.MouseTracker.subscribeEvents[Y],t.addEvent(F.element,W,M[W],W===t.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);a(F),M.tracking=!0}}function l(F){var M=i[F.hash],W,Y;if(M.tracking){for(Y=0;Y<t.MouseTracker.subscribeEvents.length;Y++)W=t.MouseTracker.subscribeEvents[Y],t.removeEvent(F.element,W,M[W],!1);a(F),M.tracking=!1}}function u(F,M){var W=i[F.hash];if(M==="pointerevent")return{upName:"pointerup",upHandler:W.pointerupcaptured,moveName:"pointermove",moveHandler:W.pointermovecaptured};if(M==="mouse")return{upName:"pointerup",upHandler:W.pointerupcaptured,moveName:"pointermove",moveHandler:W.pointermovecaptured};if(M==="touch")return{upName:"touchend",upHandler:W.touchendcaptured,moveName:"touchmove",moveHandler:W.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function c(F,M){var W;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents)try{F.element.setPointerCapture(M.id)}catch{t.console.warn("setPointerCapture() called on invalid pointer ID");return}else F.element.setCapture(!0);else W=u(F,t.MouseTracker.havePointerEvents?"pointerevent":M.type),r&&s(window.top)&&t.addEvent(window.top,W.upName,W.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,W.upName,W.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,W.moveName,W.moveHandler,!0);ue(F,M,!0)}function d(F,M){var W,Y,Te;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents){if(Y=F.getActivePointersListByType(M.type),Te=Y.getById(M.id),!Te||!Te.captured)return;try{F.element.releasePointerCapture(M.id)}catch{}}else F.element.releaseCapture();else W=u(F,t.MouseTracker.havePointerEvents?"pointerevent":M.type),r&&s(window.top)&&t.removeEvent(window.top,W.upName,W.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,W.moveName,W.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,W.upName,W.upHandler,!0);ue(F,M,!1)}function h(F){return t.MouseTracker.havePointerEvents?F.pointerId:t.MouseTracker.mousePointerId}function p(F){return t.MouseTracker.havePointerEvents?F.pointerType||(t.Browser.vendor===t.BROWSERS.IE?"mouse":""):"mouse"}function g(F){return t.MouseTracker.havePointerEvents?F.isPrimary:!0}function v(F){return t.getMousePosition(F)}function y(F,M){return b(v(F),M)}function b(F,M){var W=t.getElementOffset(M);return F.minus(W)}function T(F,M){return new t.Point((F.x+M.x)/2,(F.y+M.y)/2)}function x(F,M){var W={originalEvent:M,eventType:"click",pointerType:"mouse",isEmulated:!1};$(F,W),W.preventDefault&&!W.defaultPrevented&&t.cancelEvent(M),W.stopPropagation&&t.stopEvent(M)}function w(F,M){var W={originalEvent:M,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};$(F,W),W.preventDefault&&!W.defaultPrevented&&t.cancelEvent(M),W.stopPropagation&&t.stopEvent(M)}function A(F,M){var W=null,Y={originalEvent:M,eventType:"keydown",pointerType:"",isEmulated:!1};$(F,Y),F.keyDownHandler&&!Y.preventGesture&&!Y.defaultPrevented&&(W={eventSource:F,keyCode:M.keyCode?M.keyCode:M.charCode,ctrl:M.ctrlKey,shift:M.shiftKey,alt:M.altKey,meta:M.metaKey,originalEvent:M,preventDefault:Y.preventDefault||Y.defaultPrevented,userData:F.userData},F.keyDownHandler(W)),(W&&W.preventDefault||Y.preventDefault&&!Y.defaultPrevented)&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function R(F,M){var W=null,Y={originalEvent:M,eventType:"keyup",pointerType:"",isEmulated:!1};$(F,Y),F.keyUpHandler&&!Y.preventGesture&&!Y.defaultPrevented&&(W={eventSource:F,keyCode:M.keyCode?M.keyCode:M.charCode,ctrl:M.ctrlKey,shift:M.shiftKey,alt:M.altKey,meta:M.metaKey,originalEvent:M,preventDefault:Y.preventDefault||Y.defaultPrevented,userData:F.userData},F.keyUpHandler(W)),(W&&W.preventDefault||Y.preventDefault&&!Y.defaultPrevented)&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function _(F,M){var W=null,Y={originalEvent:M,eventType:"keypress",pointerType:"",isEmulated:!1};$(F,Y),F.keyHandler&&!Y.preventGesture&&!Y.defaultPrevented&&(W={eventSource:F,keyCode:M.keyCode?M.keyCode:M.charCode,ctrl:M.ctrlKey,shift:M.shiftKey,alt:M.altKey,meta:M.metaKey,originalEvent:M,preventDefault:Y.preventDefault||Y.defaultPrevented,userData:F.userData},F.keyHandler(W)),(W&&W.preventDefault||Y.preventDefault&&!Y.defaultPrevented)&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function D(F,M){var W={originalEvent:M,eventType:"focus",pointerType:"",isEmulated:!1};$(F,W),F.focusHandler&&!W.preventGesture&&F.focusHandler({eventSource:F,originalEvent:M,userData:F.userData})}function H(F,M){var W={originalEvent:M,eventType:"blur",pointerType:"",isEmulated:!1};$(F,W),F.blurHandler&&!W.preventGesture&&F.blurHandler({eventSource:F,originalEvent:M,userData:F.userData})}function P(F,M){var W=null,Y={originalEvent:M,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};$(F,Y),F.contextMenuHandler&&!Y.preventGesture&&!Y.defaultPrevented&&(W={eventSource:F,position:b(v(M),F.element),originalEvent:Y.originalEvent,preventDefault:Y.preventDefault||Y.defaultPrevented,userData:F.userData},F.contextMenuHandler(W)),(W&&W.preventDefault||Y.preventDefault&&!Y.defaultPrevented)&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function N(F,M){X(F,M,M)}function G(F,M){var W={target:M.target||M.srcElement,type:"wheel",shiftKey:M.shiftKey||!1,clientX:M.clientX,clientY:M.clientY,pageX:M.pageX?M.pageX:M.clientX,pageY:M.pageY?M.pageY:M.clientY,deltaMode:M.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName==="mousewheel"?W.deltaY=-M.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:W.deltaY=M.detail,X(F,W,M)}function X(F,M,W){var Y=0,Te,Ne=null;Y=M.deltaY<0?1:-1,Te={originalEvent:M,eventType:"wheel",pointerType:"mouse",isEmulated:M!==W},$(F,Te),F.scrollHandler&&!Te.preventGesture&&!Te.defaultPrevented&&(Ne={eventSource:F,pointerType:"mouse",position:y(M,F.element),scroll:Y,shift:M.shiftKey,isTouchEvent:!1,originalEvent:W,preventDefault:Te.preventDefault||Te.defaultPrevented,userData:F.userData},F.scrollHandler(Ne)),Te.stopPropagation&&t.stopEvent(W),(Ne&&Ne.preventDefault||Te.preventDefault&&!Te.defaultPrevented)&&t.cancelEvent(W)}function te(F,M){var W={id:t.MouseTracker.mousePointerId,type:"mouse"},Y={originalEvent:M,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};$(F,Y),M.target===F.element&&ue(F,W,!1),Y.stopPropagation&&t.stopEvent(M)}function Q(F,M){var W,Y,Te=M.changedTouches.length,Ne,st=F.getActivePointersListByType("touch");W=t.now(),st.getLength()>M.touches.length-Te&&t.console.warn("Tracked touch contact count doesn't match event.touches.length");var ft={originalEvent:M,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for($(F,ft),Y=0;Y<Te;Y++)Ne={id:M.changedTouches[Y].identifier,type:"touch",isPrimary:st.getLength()===0,currentPos:v(M.changedTouches[Y]),currentTime:W},Ee(F,ft,Ne),dt(F,ft,Ne,0),ue(F,Ne,!0);ft.preventDefault&&!ft.defaultPrevented&&t.cancelEvent(M),ft.stopPropagation&&t.stopEvent(M)}function ne(F,M){var W,Y,Te=M.changedTouches.length,Ne;W=t.now();var st={originalEvent:M,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for($(F,st),Y=0;Y<Te;Y++)Ne={id:M.changedTouches[Y].identifier,type:"touch",currentPos:v(M.changedTouches[Y]),currentTime:W},mt(F,st,Ne,0),ue(F,Ne,!1),_e(F,st,Ne);st.preventDefault&&!st.defaultPrevented&&t.cancelEvent(M),st.stopPropagation&&t.stopEvent(M)}function oe(F,M){var W,Y,Te=M.changedTouches.length,Ne;W=t.now();var st={originalEvent:M,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for($(F,st),Y=0;Y<Te;Y++)Ne={id:M.changedTouches[Y].identifier,type:"touch",currentPos:v(M.changedTouches[Y]),currentTime:W},he(F,st,Ne);st.preventDefault&&!st.defaultPrevented&&t.cancelEvent(M),st.stopPropagation&&t.stopEvent(M)}function Z(F,M){var W=M.changedTouches.length,Y,Te,Ne={originalEvent:M,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for($(F,Ne),Y=0;Y<W;Y++)Te={id:M.changedTouches[Y].identifier,type:"touch"},Se(F,Ne,Te);Ne.stopPropagation&&t.stopEvent(M)}function se(F,M){return t.eventIsCanceled(M)||M.preventDefault(),!1}function j(F,M){return t.eventIsCanceled(M)||M.preventDefault(),!1}function q(F,M){var W={originalEvent:M,eventType:"gotpointercapture",pointerType:p(M),isEmulated:!1};$(F,W),M.target===F.element&&ue(F,{id:M.pointerId,type:p(M)},!0),W.stopPropagation&&t.stopEvent(M)}function re(F,M){var W={originalEvent:M,eventType:"lostpointercapture",pointerType:p(M),isEmulated:!1};$(F,W),M.target===F.element&&ue(F,{id:M.pointerId,type:p(M)},!1),W.stopPropagation&&t.stopEvent(M)}function z(F,M){var W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()},Y={originalEvent:M,eventType:"pointerenter",pointerType:W.type,isEmulated:!1};$(F,Y),Ee(F,Y,W)}function ve(F,M){var W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()},Y={originalEvent:M,eventType:"pointerleave",pointerType:W.type,isEmulated:!1};$(F,Y),_e(F,Y,W)}function Le(F,M){var W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()},Y={originalEvent:M,eventType:"pointerover",pointerType:W.type,isEmulated:!1};$(F,Y),Fe(F,Y,W),Y.preventDefault&&!Y.defaultPrevented&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function Ce(F,M){var W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()},Y={originalEvent:M,eventType:"pointerout",pointerType:W.type,isEmulated:!1};$(F,Y),Pe(F,Y,W),Y.preventDefault&&!Y.defaultPrevented&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function Ae(F,M){var W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()},Y=t.MouseTracker.havePointerEvents&&W.type==="touch"&&t.Browser.vendor!==t.BROWSERS.IE,Te={originalEvent:M,eventType:"pointerdown",pointerType:W.type,isEmulated:!1};$(F,Te),dt(F,Te,W,M.button),Te.preventDefault&&!Te.defaultPrevented&&t.cancelEvent(M),Te.stopPropagation&&t.stopEvent(M),Te.shouldCapture&&(Y?ue(F,W,!0):c(F,W))}function ke(F,M){We(F,M)}function je(F,M){var W=F.getActivePointersListByType(p(M));W.getById(M.pointerId)&&We(F,M),t.stopEvent(M)}function We(F,M){var W;W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()};var Y={originalEvent:M,eventType:"pointerup",pointerType:W.type,isEmulated:!1};$(F,Y),mt(F,Y,W,M.button),Y.preventDefault&&!Y.defaultPrevented&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M),Y.shouldReleaseCapture&&(M.target===F.element?d(F,W):ue(F,W,!1))}function de(F,M){Ie(F,M)}function Re(F,M){var W=F.getActivePointersListByType(p(M));W.getById(M.pointerId)&&Ie(F,M),t.stopEvent(M)}function Ie(F,M){var W={id:h(M),type:p(M),isPrimary:g(M),currentPos:v(M),currentTime:t.now()},Y={originalEvent:M,eventType:"pointermove",pointerType:W.type,isEmulated:!1};$(F,Y),he(F,Y,W),Y.preventDefault&&!Y.defaultPrevented&&t.cancelEvent(M),Y.stopPropagation&&t.stopEvent(M)}function Ye(F,M){var W={id:M.pointerId,type:p(M)},Y={originalEvent:M,eventType:"pointercancel",pointerType:W.type,isEmulated:!1};$(F,Y),Se(F,Y,W),Y.stopPropagation&&t.stopEvent(M)}function It(F,M){return M.speed=0,M.direction=0,M.contactPos=M.currentPos,M.contactTime=M.currentTime,M.lastPos=M.currentPos,M.lastTime=M.currentTime,F.add(M)}function Qe(F,M,W){var Y,Te=M.getById(W.id);return Te?(Te.captured&&(t.console.warn("stopTrackingPointer() called on captured pointer"),d(F,Te)),M.removeContact(),Y=M.removeById(W.id)):Y=M.getLength(),Y}function k(F,M){switch(M.eventType){case"pointermove":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!1,M.preventGesture=!F.hasGestureHandlers,M.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!1,M.preventGesture=!1,M.stopPropagation=!1;break;case"pointerdown":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!1,M.preventGesture=!F.hasGestureHandlers,M.stopPropagation=!1;break;case"pointerup":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!1,M.preventGesture=!F.hasGestureHandlers,M.stopPropagation=!1;break;case"wheel":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!1,M.preventGesture=!F.hasScrollHandler,M.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":M.isStoppable=!0,M.isCancelable=!1,M.preventDefault=!1,M.preventGesture=!1,M.stopPropagation=!1;break;case"click":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!!F.clickHandler,M.preventGesture=!1,M.stopPropagation=!1;break;case"dblclick":M.isStoppable=!0,M.isCancelable=!0,M.preventDefault=!!F.dblClickHandler,M.preventGesture=!1,M.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:M.isStoppable=!1,M.isCancelable=!1,M.preventDefault=!1,M.preventGesture=!1,M.stopPropagation=!1;break}}function $(F,M){M.eventSource=F,M.eventPhase=M.originalEvent&&typeof M.originalEvent.eventPhase<"u"?M.originalEvent.eventPhase:0,M.defaultPrevented=t.eventIsCanceled(M.originalEvent),M.shouldCapture=!1,M.shouldReleaseCapture=!1,M.userData=F.userData,k(F,M),F.preProcessEventHandler&&F.preProcessEventHandler(M)}function ue(F,M,W){var Y=F.getActivePointersListByType(M.type),Te=Y.getById(M.id);Te?W&&!Te.captured?(Te.captured=!0,Y.captureCount++):!W&&Te.captured&&(Te.captured=!1,Y.captureCount--,Y.captureCount<0&&(Y.captureCount=0,t.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):t.console.warn("updatePointerCaptured() called on untracked pointer")}function Ee(F,M,W){var Y=F.getActivePointersListByType(W.type),Te;Te=Y.getById(W.id),Te?(Te.insideElement=!0,Te.lastPos=Te.currentPos,Te.lastTime=Te.currentTime,Te.currentPos=W.currentPos,Te.currentTime=W.currentTime,W=Te):(W.captured=!1,W.insideElementPressed=!1,W.insideElement=!0,It(Y,W)),F.enterHandler&&F.enterHandler({eventSource:F,pointerType:W.type,position:b(W.currentPos,F.element),buttons:Y.buttons,pointers:F.getActivePointerCount(),insideElementPressed:W.insideElementPressed,buttonDownAny:Y.buttons!==0,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData})}function _e(F,M,W){var Y=F.getActivePointersListByType(W.type),Te,Ne;Te=Y.getById(W.id),Te?(Te.captured?(Te.insideElement=!1,Te.lastPos=Te.currentPos,Te.lastTime=Te.currentTime,Te.currentPos=W.currentPos,Te.currentTime=W.currentTime):Qe(F,Y,Te),W=Te):(W.captured=!1,W.insideElementPressed=!1),(F.leaveHandler||F.exitHandler)&&(Ne={eventSource:F,pointerType:W.type,position:W.currentPos&&b(W.currentPos,F.element),buttons:Y.buttons,pointers:F.getActivePointerCount(),insideElementPressed:W.insideElementPressed,buttonDownAny:Y.buttons!==0,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData},F.leaveHandler&&F.leaveHandler(Ne),F.exitHandler&&F.exitHandler(Ne))}function Fe(F,M,W){var Y,Te;Y=F.getActivePointersListByType(W.type),Te=Y.getById(W.id),Te?W=Te:(W.captured=!1,W.insideElementPressed=!1),F.overHandler&&F.overHandler({eventSource:F,pointerType:W.type,position:b(W.currentPos,F.element),buttons:Y.buttons,pointers:F.getActivePointerCount(),insideElementPressed:W.insideElementPressed,buttonDownAny:Y.buttons!==0,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData})}function Pe(F,M,W){var Y,Te;Y=F.getActivePointersListByType(W.type),Te=Y.getById(W.id),Te?W=Te:(W.captured=!1,W.insideElementPressed=!1),F.outHandler&&F.outHandler({eventSource:F,pointerType:W.type,position:W.currentPos&&b(W.currentPos,F.element),buttons:Y.buttons,pointers:F.getActivePointerCount(),insideElementPressed:W.insideElementPressed,buttonDownAny:Y.buttons!==0,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData})}function dt(F,M,W,Y){var Te=i[F.hash],Ne=F.getActivePointersListByType(W.type),st;if(typeof M.originalEvent.buttons<"u"?Ne.buttons=M.originalEvent.buttons:Y===0?Ne.buttons|=1:Y===1?Ne.buttons|=4:Y===2?Ne.buttons|=2:Y===3?Ne.buttons|=8:Y===4?Ne.buttons|=16:Y===5&&(Ne.buttons|=32),Y!==0){M.shouldCapture=!1,M.shouldReleaseCapture=!1,F.nonPrimaryPressHandler&&!M.preventGesture&&!M.defaultPrevented&&(M.preventDefault=!0,F.nonPrimaryPressHandler({eventSource:F,pointerType:W.type,position:b(W.currentPos,F.element),button:Y,buttons:Ne.buttons,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData}));return}st=Ne.getById(W.id),st?(st.insideElementPressed=!0,st.insideElement=!0,st.originalTarget=M.originalEvent.target,st.contactPos=W.currentPos,st.contactTime=W.currentTime,st.lastPos=st.currentPos,st.lastTime=st.currentTime,st.currentPos=W.currentPos,st.currentTime=W.currentTime,W=st):(W.captured=!1,W.insideElementPressed=!0,W.insideElement=!0,W.originalTarget=M.originalEvent.target,It(Ne,W)),Ne.addContact(),!M.preventGesture&&!M.defaultPrevented?(M.shouldCapture=!0,M.shouldReleaseCapture=!1,M.preventDefault=!0,(F.dragHandler||F.dragEndHandler||F.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(F,W),Ne.contacts===1?F.pressHandler&&!M.preventGesture&&F.pressHandler({eventSource:F,pointerType:W.type,position:b(W.contactPos,F.element),buttons:Ne.buttons,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData}):Ne.contacts===2&&F.pinchHandler&&W.type==="touch"&&(Te.pinchGPoints=Ne.asArray(),Te.lastPinchDist=Te.currentPinchDist=Te.pinchGPoints[0].currentPos.distanceTo(Te.pinchGPoints[1].currentPos),Te.lastPinchCenter=Te.currentPinchCenter=T(Te.pinchGPoints[0].currentPos,Te.pinchGPoints[1].currentPos))):(M.shouldCapture=!1,M.shouldReleaseCapture=!1)}function mt(F,M,W,Y){var Te=i[F.hash],Ne=F.getActivePointersListByType(W.type),st,ft,nt,Mt=!1,en;if(typeof M.originalEvent.buttons<"u"?Ne.buttons=M.originalEvent.buttons:Y===0?Ne.buttons^=-2:Y===1?Ne.buttons^=-5:Y===2?Ne.buttons^=-3:Y===3?Ne.buttons^=-9:Y===4?Ne.buttons^=-17:Y===5&&(Ne.buttons^=-33),M.shouldCapture=!1,Y!==0){M.shouldReleaseCapture=!1,F.nonPrimaryReleaseHandler&&!M.preventGesture&&!M.defaultPrevented&&(M.preventDefault=!0,F.nonPrimaryReleaseHandler({eventSource:F,pointerType:W.type,position:b(W.currentPos,F.element),button:Y,buttons:Ne.buttons,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData}));return}nt=Ne.getById(W.id),nt?(Ne.removeContact(),nt.captured&&(Mt=!0),nt.lastPos=nt.currentPos,nt.lastTime=nt.currentTime,nt.currentPos=W.currentPos,nt.currentTime=W.currentTime,nt.insideElement||Qe(F,Ne,nt),st=nt.currentPos,ft=nt.currentTime):(W.captured=!1,W.insideElementPressed=!1,W.insideElement=!0,It(Ne,W),nt=W),!M.preventGesture&&!M.defaultPrevented&&(Mt?(M.shouldReleaseCapture=!0,M.preventDefault=!0,(F.dragHandler||F.dragEndHandler||F.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(F,nt),Ne.contacts===0?(F.releaseHandler&&st&&F.releaseHandler({eventSource:F,pointerType:nt.type,position:b(st,F.element),buttons:Ne.buttons,insideElementPressed:nt.insideElementPressed,insideElementReleased:nt.insideElement,isTouchEvent:nt.type==="touch",originalEvent:M.originalEvent,userData:F.userData}),F.dragEndHandler&&Te.sentDragEvent&&F.dragEndHandler({eventSource:F,pointerType:nt.type,position:b(nt.currentPos,F.element),speed:nt.speed,direction:nt.direction,shift:M.originalEvent.shiftKey,isTouchEvent:nt.type==="touch",originalEvent:M.originalEvent,userData:F.userData}),Te.sentDragEvent=!1,(F.clickHandler||F.dblClickHandler)&&nt.insideElement&&(en=ft-nt.contactTime<=F.clickTimeThreshold&&nt.contactPos.distanceTo(st)<=F.clickDistThreshold,F.clickHandler&&F.clickHandler({eventSource:F,pointerType:nt.type,position:b(nt.currentPos,F.element),quick:en,shift:M.originalEvent.shiftKey,isTouchEvent:nt.type==="touch",originalEvent:M.originalEvent,originalTarget:nt.originalTarget,userData:F.userData}),F.dblClickHandler&&en&&(Ne.clicks++,Ne.clicks===1?(Te.lastClickPos=st,Te.dblClickTimeOut=setTimeout(function(){Ne.clicks=0},F.dblClickTimeThreshold)):Ne.clicks===2&&(clearTimeout(Te.dblClickTimeOut),Ne.clicks=0,Te.lastClickPos.distanceTo(st)<=F.dblClickDistThreshold&&F.dblClickHandler({eventSource:F,pointerType:nt.type,position:b(nt.currentPos,F.element),shift:M.originalEvent.shiftKey,isTouchEvent:nt.type==="touch",originalEvent:M.originalEvent,userData:F.userData}),Te.lastClickPos=null)))):Ne.contacts===2&&F.pinchHandler&&nt.type==="touch"&&(Te.pinchGPoints=Ne.asArray(),Te.lastPinchDist=Te.currentPinchDist=Te.pinchGPoints[0].currentPos.distanceTo(Te.pinchGPoints[1].currentPos),Te.lastPinchCenter=Te.currentPinchCenter=T(Te.pinchGPoints[0].currentPos,Te.pinchGPoints[1].currentPos))):(M.shouldReleaseCapture=!1,F.releaseHandler&&st&&(F.releaseHandler({eventSource:F,pointerType:nt.type,position:b(st,F.element),buttons:Ne.buttons,insideElementPressed:nt.insideElementPressed,insideElementReleased:nt.insideElement,isTouchEvent:nt.type==="touch",originalEvent:M.originalEvent,userData:F.userData}),M.preventDefault=!0)))}function he(F,M,W){var Y=i[F.hash],Te=F.getActivePointersListByType(W.type),Ne,st,ft;if(typeof M.originalEvent.buttons<"u"&&(Te.buttons=M.originalEvent.buttons),Ne=Te.getById(W.id),Ne)Ne.lastPos=Ne.currentPos,Ne.lastTime=Ne.currentTime,Ne.currentPos=W.currentPos,Ne.currentTime=W.currentTime;else return;M.shouldCapture=!1,M.shouldReleaseCapture=!1,F.stopHandler&&W.type==="mouse"&&(clearTimeout(F.stopTimeOut),F.stopTimeOut=setTimeout(function(){qe(F,M.originalEvent,W.type)},F.stopDelay)),Te.contacts===0?F.moveHandler&&F.moveHandler({eventSource:F,pointerType:W.type,position:b(W.currentPos,F.element),buttons:Te.buttons,isTouchEvent:W.type==="touch",originalEvent:M.originalEvent,userData:F.userData}):Te.contacts===1?(F.moveHandler&&(Ne=Te.asArray()[0],F.moveHandler({eventSource:F,pointerType:Ne.type,position:b(Ne.currentPos,F.element),buttons:Te.buttons,isTouchEvent:Ne.type==="touch",originalEvent:M.originalEvent,userData:F.userData})),F.dragHandler&&!M.preventGesture&&!M.defaultPrevented&&(Ne=Te.asArray()[0],ft=Ne.currentPos.minus(Ne.lastPos),F.dragHandler({eventSource:F,pointerType:Ne.type,position:b(Ne.currentPos,F.element),buttons:Te.buttons,delta:ft,speed:Ne.speed,direction:Ne.direction,shift:M.originalEvent.shiftKey,isTouchEvent:Ne.type==="touch",originalEvent:M.originalEvent,userData:F.userData}),M.preventDefault=!0,Y.sentDragEvent=!0)):Te.contacts===2&&(F.moveHandler&&(st=Te.asArray(),F.moveHandler({eventSource:F,pointerType:st[0].type,position:b(T(st[0].currentPos,st[1].currentPos),F.element),buttons:Te.buttons,isTouchEvent:st[0].type==="touch",originalEvent:M.originalEvent,userData:F.userData})),F.pinchHandler&&W.type==="touch"&&!M.preventGesture&&!M.defaultPrevented&&(ft=Y.pinchGPoints[0].currentPos.distanceTo(Y.pinchGPoints[1].currentPos),ft!==Y.currentPinchDist&&(Y.lastPinchDist=Y.currentPinchDist,Y.currentPinchDist=ft,Y.lastPinchCenter=Y.currentPinchCenter,Y.currentPinchCenter=T(Y.pinchGPoints[0].currentPos,Y.pinchGPoints[1].currentPos),F.pinchHandler({eventSource:F,pointerType:"touch",gesturePoints:Y.pinchGPoints,lastCenter:b(Y.lastPinchCenter,F.element),center:b(Y.currentPinchCenter,F.element),lastDistance:Y.lastPinchDist,distance:Y.currentPinchDist,shift:M.originalEvent.shiftKey,originalEvent:M.originalEvent,userData:F.userData}),M.preventDefault=!0)))}function Se(F,M,W){var Y=F.getActivePointersListByType(W.type),Te;Te=Y.getById(W.id),Te&&Qe(F,Y,Te)}function qe(F,M,W){F.stopHandler&&F.stopHandler({eventSource:F,pointerType:W,position:y(M,F.element),buttons:F.getActivePointersListByType(W).buttons,isTouchEvent:W==="touch",originalEvent:M,userData:F.userData})}})(e),(function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,r,s){var a=i.parentNode;typeof r=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),r={anchor:r}),r.attachToViewer=typeof r.attachToViewer>"u"?!0:r.attachToViewer,this.autoFade=typeof r.autoFade>"u"?!0:r.autoFade,this.element=i,this.anchor=r.anchor,this.container=s,this.anchor===t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof r.top=="number"?r.top+"px":r.top,this.wrapper.style.left=typeof r.left=="number"?r.left+"px":r.left,this.wrapper.style.height=typeof r.height=="number"?r.height+"px":r.height,this.wrapper.style.width=typeof r.width=="number"?r.width+"px":r.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),r.attachToViewer?this.anchor===t.ControlAnchor.TOP_RIGHT||this.anchor===t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):a.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==t.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[t.SIGNAL]&&t.Browser.vendor===t.BROWSERS.IE?t.setElementOpacity(this.element,i,!0):t.setElementOpacity(this.wrapper,i,!0)}}})(e),(function(t){t.ControlDock=function(r){var s=["topleft","topright","bottomright","bottomleft"],a,o;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},r),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<s.length;o++)a=s[o],this.controls[a]=t.makeNeutralElement("div"),this.controls[a].style.position="absolute",a.match("left")&&(this.controls[a].style.left="0px"),a.match("right")&&(this.controls[a].style.right="0px"),a.match("top")&&(this.controls[a].style.top="0px"),a.match("bottom")&&(this.controls[a].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(r,s){r=t.getElement(r);var a=null;if(!(i(this,r)>=0)){switch(s.anchor){case t.ControlAnchor.TOP_RIGHT:a=this.controls.topright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:a=this.controls.bottomright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:a=this.controls.bottomleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:a=this.controls.topleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:a=this.container,r.style.margin="0px",r.style.padding="0px";break;default:case t.ControlAnchor.NONE:a=this.container,r.style.margin="0px",r.style.padding="0px";break}this.controls.push(new t.Control(r,s,a)),r.style.display="inline-block"}},removeControl:function(r){r=t.getElement(r);var s=i(this,r);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var r;for(r=this.controls.length-1;r>=0;r--)if(this.controls[r].isVisible())return!0;return!1},setControlsEnabled:function(r){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(r);return this}};function i(r,s){var a=r.controls,o;for(o=a.length-1;o>=0;o--)if(a[o].element===s)return o;return-1}})(e),(function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})})(e),(function(t){var i={},r=1;t.Viewer=function(k){var $=arguments,ue=this,Ee;if(t.isPlainObject(k)||(k={id:$[0],xmlPath:$.length>1?$[1]:void 0,prefixUrl:$.length>2?$[2]:void 0,controls:$.length>3?$[3]:void 0,overlays:$.length>4?$[4]:void 0}),k.config&&(t.extend(!0,k,k.config),delete k.config),t.extend(!0,this,{id:k.id,hash:k.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},t.DEFAULT_SETTINGS,k),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&t.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(_e){var Fe=t.getString("Errors.OpenFailed",_e.eventSource,_e.message);ue._showMessage(Fe)}),t.ControlDock.call(this,k),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(function(_e){_e.width="100%",_e.height="100%",_e.overflow="hidden",_e.position="absolute",_e.top="0px",_e.left="0px"})(this.canvas.style),t.setElementTouchActionNone(this.canvas),k.tabIndex!==""&&(this.canvas.tabIndex=k.tabIndex===void 0?0:k.tabIndex),this.container.className="openseadragon-container",(function(_e){_e.width="100%",_e.height="100%",_e.position="relative",_e.overflow="hidden",_e.left="0px",_e.top="0px",_e.textAlign="left"})(this.container.style),t.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:t.delegate(this,y),keyDownHandler:t.delegate(this,b),keyHandler:t.delegate(this,T),clickHandler:t.delegate(this,x),dblClickHandler:t.delegate(this,w),dragHandler:t.delegate(this,A),dragEndHandler:t.delegate(this,R),enterHandler:t.delegate(this,_),leaveHandler:t.delegate(this,D),pressHandler:t.delegate(this,H),releaseHandler:t.delegate(this,P),nonPrimaryPressHandler:t.delegate(this,N),nonPrimaryReleaseHandler:t.delegate(this,G),scrollHandler:t.delegate(this,ne),pinchHandler:t.delegate(this,X),focusHandler:t.delegate(this,te),blurHandler:t.delegate(this,Q)}),this.outerTracker=new t.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,oe),leaveHandler:t.delegate(this,Z)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[ue.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(_e){ue.source=ue.world.getItemAt(0).source,i[ue.hash].forceRedraw=!0,ue._updateRequestId||(ue._updateRequestId=u(ue,se))}),this.world.addHandler("remove-item",function(_e){ue.world.getItemCount()?ue.source=ue.world.getItemAt(0).source:ue.source=null,i[ue.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(_e){ue.viewport&&ue.viewport._setContentBounds(ue.world.getHomeBounds(),ue.world.getContentFactor())}),this.world.addHandler("item-index-change",function(_e){ue.source=ue.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:k.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(Ee=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(Ee,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(Ee=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(Ee,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new t.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),Ee=0;Ee<this.customControls.length;Ee++)this.addControl(this.customControls[Ee].id,{anchor:this.customControls[Ee].anchor});t.requestAnimationFrame(function(){d(ue)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),t._viewers.set(this.element,this)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(k){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(k)},openTileSource:function(k){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(k)},get buttons(){return t.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(k,$){var ue=this;if(this.close(),!k)return this;if(this.sequenceMode&&t.isArray(k))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof $<"u"&&!isNaN($)&&(this.initialPage=$),this.tileSources=k,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(t.isArray(k)||(k=[k]),!k.length)return this;this._opening=!0;for(var Ee=k.length,_e=0,Fe=0,Pe,dt=function(){if(_e+Fe===Ee)if(_e){(ue._firstOpen||!ue.preserveViewport)&&(ue.viewport.goHome(!0),ue.viewport.update()),ue._firstOpen=!1;var Se=k[0];if(Se.tileSource&&(Se=Se.tileSource),ue.overlays&&!ue.preserveOverlays)for(var qe=0;qe<ue.overlays.length;qe++)ue.currentOverlays[qe]=o(ue,ue.overlays[qe]);ue._drawOverlays(),ue._opening=!1,ue.raiseEvent("open",{source:Se})}else ue._opening=!1,ue.raiseEvent("open-failed",Pe)},mt=function(Se){(!t.isPlainObject(Se)||!Se.tileSource)&&(Se={tileSource:Se}),Se.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Se.index),Se.collectionImmediately===void 0&&(Se.collectionImmediately=!0);var qe=Se.success;Se.success=function(M){if(_e++,Se.tileSource.overlays)for(var W=0;W<Se.tileSource.overlays.length;W++)ue.addOverlay(Se.tileSource.overlays[W]);qe&&qe(M),dt()};var F=Se.error;Se.error=function(M){Fe++,Pe||(Pe=M),F&&F(M),dt()},ue.addTiledImage(Se)},he=0;he<k.length;he++)mt(k[he]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,t._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(k){return this.innerTracker.setTracking(k),this.outerTracker.setTracking(k),this.raiseEvent("mouse-enabled",{enabled:k}),this},areControlsEnabled:function(){var k=this.controls.length,$;for($=0;$<this.controls.length;$++)k=k&&this.controls[$].isVisible();return k},setControlsEnabled:function(k){return k?p(this):d(this),this.raiseEvent("controls-enabled",{enabled:k}),this},setDebugMode:function(k){for(var $=0;$<this.world.getItemCount();$++)this.world.getItemAt($).debugMode=k;this.debugMode=k,this.forceRedraw()},setAjaxHeaders:function(k,$){if(k===null&&(k={}),!t.isPlainObject(k)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if($===void 0&&($=!0),this.ajaxHeaders=k,$){for(var ue=0;ue<this.world.getItemCount();ue++)this.world.getItemAt(ue)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var Ee in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[Ee].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(k){this.buttonGroup.addButton(k)},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(k){var $=document.body,ue=$.style,Ee=document.documentElement.style,_e=this,Fe,Pe;if(k===this.isFullPage())return this;var dt={fullPage:k,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",dt),dt.preventDefaultAction)return this;if(k){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=ue.margin,this.docMargin=Ee.margin,ue.margin="0",Ee.margin="0",this.bodyPadding=ue.padding,this.docPadding=Ee.padding,ue.padding="0",Ee.padding="0",this.bodyWidth=ue.width,this.docWidth=Ee.width,ue.width="100%",Ee.width="100%",this.bodyHeight=ue.height,this.docHeight=Ee.height,ue.height="100%",Ee.height="100%",this.bodyDisplay=ue.display,ue.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,Fe=$.childNodes.length,Pe=0;Pe<Fe;Pe++)this.previousBody.push($.childNodes[0]),$.removeChild($.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,$.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),$.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,t.delegate(this,oe)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,ue.margin=this.bodyMargin,Ee.margin=this.docMargin,ue.padding=this.bodyPadding,Ee.padding=this.docPadding,ue.width=this.bodyWidth,Ee.width=this.docWidth,ue.height=this.bodyHeight,Ee.height=this.docHeight,ue.display=this.bodyDisplay,$.removeChild(this.element),Fe=this.previousBody.length,Pe=0;Pe<Fe;Pe++)$.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&($.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var mt=0,he=function(){t.setPageScroll(_e.pageScroll);var Se=t.getPageScroll();mt++,mt<10&&(Se.x!==_e.pageScroll.x||Se.y!==_e.pageScroll.y)&&t.requestAnimationFrame(he)};t.requestAnimationFrame(he),i[this.hash].fullPage=!1,t.delegate(this,Z)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:k}),this},setFullScreen:function(k){var $=this;if(!t.supportsFullScreen)return this.setFullPage(k);if(t.isFullScreen()===k)return this;var ue={fullScreen:k,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",ue),ue.preventDefaultAction)return this;if(k){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var Ee=function(){var _e=t.isFullScreen();_e||(t.removeEvent(document,t.fullScreenEventName,Ee),t.removeEvent(document,t.fullScreenErrorEventName,Ee),$.setFullPage(!1),$.isFullPage()&&($.element.style.width=$.fullPageStyleWidth,$.element.style.height=$.fullPageStyleHeight)),$.navigator&&$.viewport&&setTimeout(function(){$.navigator.update($.viewport)}),$.raiseEvent("full-screen",{fullScreen:_e})};t.addEvent(document,t.fullScreenEventName,Ee),t.addEvent(document,t.fullScreenErrorEventName,Ee),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return t.isFullScreen()&&this.isFullPage()},setVisible:function(k){return this.container.style.visibility=k?"":"hidden",this.raiseEvent("visible",{visible:k}),this},addTiledImage:function(k){t.console.assert(k,"[Viewer.addTiledImage] options is required"),t.console.assert(k.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!k.replace||k.index>-1&&k.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var $=this;k.replace&&(k.replaceItem=$.world.getItemAt(k.index)),this._hideMessage(),k.placeholderFillStyle===void 0&&(k.placeholderFillStyle=this.placeholderFillStyle),k.opacity===void 0&&(k.opacity=this.opacity),k.preload===void 0&&(k.preload=this.preload),k.compositeOperation===void 0&&(k.compositeOperation=this.compositeOperation),k.crossOriginPolicy===void 0&&(k.crossOriginPolicy=k.tileSource.crossOriginPolicy!==void 0?k.tileSource.crossOriginPolicy:this.crossOriginPolicy),k.ajaxWithCredentials===void 0&&(k.ajaxWithCredentials=this.ajaxWithCredentials),k.loadTilesWithAjax===void 0&&(k.loadTilesWithAjax=this.loadTilesWithAjax),t.isPlainObject(k.ajaxHeaders)||(k.ajaxHeaders={});var ue={options:k};function Ee(Pe){for(var dt=0;dt<$._loadQueue.length;dt++)if($._loadQueue[dt]===ue){$._loadQueue.splice(dt,1);break}$._loadQueue.length===0&&_e(ue),$.raiseEvent("add-item-failed",Pe),k.error&&k.error(Pe)}function _e(Pe){$.collectionMode&&($.world.arrange({immediately:Pe.options.collectionImmediately,rows:$.collectionRows,columns:$.collectionColumns,layout:$.collectionLayout,tileSize:$.collectionTileSize,tileMargin:$.collectionTileMargin}),$.world.setAutoRefigureSizes(!0))}if(t.isArray(k.tileSource)){setTimeout(function(){Ee({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:k.tileSource,options:k})});return}this._loadQueue.push(ue);function Fe(){for(var Pe,dt,mt;$._loadQueue.length&&(Pe=$._loadQueue[0],!!Pe.tileSource);){if($._loadQueue.splice(0,1),Pe.options.replace){var he=$.world.getIndexOfItem(Pe.options.replaceItem);he!==-1&&(Pe.options.index=he),$.world.removeItem(Pe.options.replaceItem)}dt=new t.TiledImage({viewer:$,source:Pe.tileSource,viewport:$.viewport,drawer:$.drawer,tileCache:$.tileCache,imageLoader:$.imageLoader,x:Pe.options.x,y:Pe.options.y,width:Pe.options.width,height:Pe.options.height,fitBounds:Pe.options.fitBounds,fitBoundsPlacement:Pe.options.fitBoundsPlacement,clip:Pe.options.clip,placeholderFillStyle:Pe.options.placeholderFillStyle,opacity:Pe.options.opacity,preload:Pe.options.preload,degrees:Pe.options.degrees,flipped:Pe.options.flipped,compositeOperation:Pe.options.compositeOperation,springStiffness:$.springStiffness,animationTime:$.animationTime,minZoomImageRatio:$.minZoomImageRatio,wrapHorizontal:$.wrapHorizontal,wrapVertical:$.wrapVertical,immediateRender:$.immediateRender,blendTime:$.blendTime,alwaysBlend:$.alwaysBlend,minPixelRatio:$.minPixelRatio,smoothTileEdgesMinZoom:$.smoothTileEdgesMinZoom,iOSDevice:$.iOSDevice,crossOriginPolicy:Pe.options.crossOriginPolicy,ajaxWithCredentials:Pe.options.ajaxWithCredentials,loadTilesWithAjax:Pe.options.loadTilesWithAjax,ajaxHeaders:Pe.options.ajaxHeaders,debugMode:$.debugMode,subPixelRoundingForTransparency:$.subPixelRoundingForTransparency}),$.collectionMode&&$.world.setAutoRefigureSizes(!1),$.navigator&&(mt=t.extend({},Pe.options,{replace:!1,originalTiledImage:dt,tileSource:Pe.tileSource}),$.navigator.addTiledImage(mt)),$.world.addItem(dt,{index:Pe.options.index}),$._loadQueue.length===0&&_e(Pe),$.world.getItemCount()===1&&!$.preserveViewport&&$.viewport.goHome(!0),Pe.options.success&&Pe.options.success({item:dt})}}a(this,k.tileSource,k,function(Pe){ue.tileSource=Pe,Fe()},function(Pe){Pe.options=k,Ee(Pe),Fe()})},addSimpleImage:function(k){t.console.assert(k,"[Viewer.addSimpleImage] options is required"),t.console.assert(k.url,"[Viewer.addSimpleImage] options.url is required");var $=t.extend({},k,{tileSource:{type:"image",url:k.url}});delete $.url,this.addTiledImage($)},addLayer:function(k){var $=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var ue=t.extend({},k,{success:function(Ee){$.raiseEvent("add-layer",{options:k,drawer:Ee.item})},error:function(Ee){$.raiseEvent("add-layer-failed",Ee)}});return this.addTiledImage(ue),this},getLayerAtLevel:function(k){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(k)},getLevelOfLayer:function(k){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(k)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(k,$){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(k,$)},removeLayer:function(k){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(k)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var k=t.delegate(this,g),$=t.delegate(this,v),ue=t.delegate(this,this.goToNextPage),Ee=t.delegate(this,this.goToPreviousPage),_e=this.navImages,Fe=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Fe=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:z(this.prefixUrl,_e.previous.REST),srcGroup:z(this.prefixUrl,_e.previous.GROUP),srcHover:z(this.prefixUrl,_e.previous.HOVER),srcDown:z(this.prefixUrl,_e.previous.DOWN),onRelease:Ee,onFocus:k,onBlur:$}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:z(this.prefixUrl,_e.next.REST),srcGroup:z(this.prefixUrl,_e.next.GROUP),srcHover:z(this.prefixUrl,_e.next.HOVER),srcDown:z(this.prefixUrl,_e.next.DOWN),onRelease:ue,onFocus:k,onBlur:$}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Fe&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var k=t.delegate(this,ve),$=t.delegate(this,Ce),ue=t.delegate(this,je),Ee=t.delegate(this,Le),_e=t.delegate(this,We),Fe=t.delegate(this,Re),Pe=t.delegate(this,Ie),dt=t.delegate(this,Ye),mt=t.delegate(this,It),he=t.delegate(this,Qe),Se=t.delegate(this,g),qe=t.delegate(this,v),F=this.navImages,M=[],W=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(W=!1),this.showZoomControl&&(M.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:z(this.prefixUrl,F.zoomIn.REST),srcGroup:z(this.prefixUrl,F.zoomIn.GROUP),srcHover:z(this.prefixUrl,F.zoomIn.HOVER),srcDown:z(this.prefixUrl,F.zoomIn.DOWN),onPress:k,onRelease:$,onClick:ue,onEnter:k,onExit:$,onFocus:Se,onBlur:qe})),M.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:z(this.prefixUrl,F.zoomOut.REST),srcGroup:z(this.prefixUrl,F.zoomOut.GROUP),srcHover:z(this.prefixUrl,F.zoomOut.HOVER),srcDown:z(this.prefixUrl,F.zoomOut.DOWN),onPress:Ee,onRelease:$,onClick:_e,onEnter:Ee,onExit:$,onFocus:Se,onBlur:qe}))),this.showHomeControl&&M.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:z(this.prefixUrl,F.home.REST),srcGroup:z(this.prefixUrl,F.home.GROUP),srcHover:z(this.prefixUrl,F.home.HOVER),srcDown:z(this.prefixUrl,F.home.DOWN),onRelease:Fe,onFocus:Se,onBlur:qe})),this.showFullPageControl&&M.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:z(this.prefixUrl,F.fullpage.REST),srcGroup:z(this.prefixUrl,F.fullpage.GROUP),srcHover:z(this.prefixUrl,F.fullpage.HOVER),srcDown:z(this.prefixUrl,F.fullpage.DOWN),onRelease:Pe,onFocus:Se,onBlur:qe})),this.showRotationControl&&(M.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:z(this.prefixUrl,F.rotateleft.REST),srcGroup:z(this.prefixUrl,F.rotateleft.GROUP),srcHover:z(this.prefixUrl,F.rotateleft.HOVER),srcDown:z(this.prefixUrl,F.rotateleft.DOWN),onRelease:dt,onFocus:Se,onBlur:qe})),M.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:z(this.prefixUrl,F.rotateright.REST),srcGroup:z(this.prefixUrl,F.rotateright.GROUP),srcHover:z(this.prefixUrl,F.rotateright.HOVER),srcDown:z(this.prefixUrl,F.rotateright.DOWN),onRelease:mt,onFocus:Se,onBlur:qe}))),this.showFlipControl&&M.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:z(this.prefixUrl,F.flip.REST),srcGroup:z(this.prefixUrl,F.flip.GROUP),srcHover:z(this.prefixUrl,F.flip.HOVER),srcDown:z(this.prefixUrl,F.flip.DOWN),onRelease:he,onFocus:Se,onBlur:qe})),W?(this.buttonGroup=new t.ButtonGroup({buttons:M,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",t.delegate(this,de)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT})):this.customButtons=M),this},currentPage:function(){return this._sequenceIndex},goToPage:function(k){return this.tileSources&&k>=0&&k<this.tileSources.length&&(this._sequenceIndex=k,this._updateSequenceButtons(k),this.open(this.tileSources[k]),this.referenceStrip&&this.referenceStrip.setFocus(k),this.raiseEvent("page",{page:k})),this},addOverlay:function(k,$,ue,Ee){var _e;if(t.isPlainObject(k)?_e=k:_e={element:k,location:$,placement:ue,onDraw:Ee},k=t.getElement(_e.element),l(this.currentOverlays,k)>=0)return this;var Fe=o(this,_e);return this.currentOverlays.push(Fe),Fe.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:k,location:_e.location,placement:_e.placement}),this},updateOverlay:function(k,$,ue){var Ee;return k=t.getElement(k),Ee=l(this.currentOverlays,k),Ee>=0&&(this.currentOverlays[Ee].update($,ue),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:k,location:$,placement:ue})),this},removeOverlay:function(k){var $;return k=t.getElement(k),$=l(this.currentOverlays,k),$>=0&&(this.currentOverlays[$].destroy(),this.currentOverlays.splice($,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:k})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(k){var $;return k=t.getElement(k),$=l(this.currentOverlays,k),$>=0?this.currentOverlays[$]:null},_updateSequenceButtons:function(k){this.nextButton&&(!this.tileSources||this.tileSources.length-1===k?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(k>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(k){this._hideMessage();var $=t.makeNeutralElement("div");$.appendChild(document.createTextNode(k)),this.messageDiv=t.makeCenteredNode($),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var k=this.messageDiv;k&&(k.parentNode.removeChild(k),delete this.messageDiv)},gestureSettingsByDeviceType:function(k){switch(k){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var k,$=this.currentOverlays.length;for(k=0;k<$;k++)this.currentOverlays[k].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),t.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){t.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var k=t.pixelDensityRatio,$=t.getCurrentPixelDensityRatio();k!==$&&(t.pixelDensityRatio=$,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var k=this._sequenceIndex-1;this.navPrevNextWrap&&k<0&&(k+=this.tileSources.length),this.goToPage(k)},goToNextPage:function(){var k=this._sequenceIndex+1;this.navPrevNextWrap&&k>=this.tileSources.length&&(k=0),this.goToPage(k)},isAnimating:function(){return i[this.hash].animating}});function s(k){return k=t.getElement(k),new t.Point(k.clientWidth===0?1:k.clientWidth,k.clientHeight===0?1:k.clientHeight)}function a(k,$,ue,Ee,_e){var Fe=k;if(t.type($)==="string"){if($.match(/^\s*<.*>\s*$/))$=t.parseXml($);else if($.match(/^\s*[{[].*[}\]]\s*$/))try{var Pe=t.parseJSON($);$=Pe}catch{}}function dt(mt,he){mt.ready?Ee(mt):(mt.addHandler("ready",function(){Ee(mt)}),mt.addHandler("open-failed",function(Se){_e({message:Se.message,source:he})}))}setTimeout(function(){if(t.type($)==="string")$=new t.TileSource({url:$,crossOriginPolicy:ue.crossOriginPolicy!==void 0?ue.crossOriginPolicy:k.crossOriginPolicy,ajaxWithCredentials:k.ajaxWithCredentials,ajaxHeaders:ue.ajaxHeaders?ue.ajaxHeaders:k.ajaxHeaders,splitHashDataForPost:k.splitHashDataForPost,useCanvas:k.useCanvas,success:function(qe){Ee(qe.tileSource)}}),$.addHandler("open-failed",function(qe){_e(qe)});else if(t.isPlainObject($)||$.nodeType)if($.crossOriginPolicy===void 0&&(ue.crossOriginPolicy!==void 0||k.crossOriginPolicy!==void 0)&&($.crossOriginPolicy=ue.crossOriginPolicy!==void 0?ue.crossOriginPolicy:k.crossOriginPolicy),$.ajaxWithCredentials===void 0&&($.ajaxWithCredentials=k.ajaxWithCredentials),$.useCanvas===void 0&&($.useCanvas=k.useCanvas),t.isFunction($.getTileUrl)){var mt=new t.TileSource($);mt.getTileUrl=$.getTileUrl,Ee(mt)}else{var he=t.TileSource.determineType(Fe,$);if(!he){_e({message:"Unable to load TileSource",source:$});return}var Se=he.prototype.configure.apply(Fe,[$]);dt(new he(Se),$)}else dt($,$)})}function o(k,$){if($ instanceof t.Overlay)return $;var ue=null;if($.element)ue=t.getElement($.element);else{var Ee=$.id?$.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);ue=t.getElement($.id),ue||(ue=document.createElement("a"),ue.href="#/overlay/"+Ee),ue.id=Ee,t.addClass(ue,$.className?$.className:"openseadragon-overlay")}var _e=$.location,Fe=$.width,Pe=$.height;if(!_e){var dt=$.x,mt=$.y;if($.px!==void 0){var he=k.viewport.imageToViewportRectangle(new t.Rect($.px,$.py,Fe||0,Pe||0));dt=he.x,mt=he.y,Fe=Fe!==void 0?he.width:void 0,Pe=Pe!==void 0?he.height:void 0}_e=new t.Point(dt,mt)}var Se=$.placement;return Se&&t.type(Se)==="string"&&(Se=t.Placement[$.placement.toUpperCase()]),new t.Overlay({element:ue,location:_e,placement:Se,onDraw:$.onDraw,checkResize:$.checkResize,width:Fe,height:Pe,rotationMode:$.rotationMode})}function l(k,$){var ue;for(ue=k.length-1;ue>=0;ue--)if(k[ue].element===$)return ue;return-1}function u(k,$){return t.requestAnimationFrame(function(){$(k)})}function c(k){t.requestAnimationFrame(function(){h(k)})}function d(k){k.autoHideControls&&(k.controlsShouldFade=!0,k.controlsFadeBeginTime=t.now()+k.controlsFadeDelay,window.setTimeout(function(){c(k)},k.controlsFadeDelay))}function h(k){var $,ue,Ee,_e;if(k.controlsShouldFade){for($=t.now(),ue=$-k.controlsFadeBeginTime,Ee=1-ue/k.controlsFadeLength,Ee=Math.min(1,Ee),Ee=Math.max(0,Ee),_e=k.controls.length-1;_e>=0;_e--)k.controls[_e].autoFade&&k.controls[_e].setOpacity(Ee);Ee>0&&c(k)}}function p(k){var $;for(k.controlsShouldFade=!1,$=k.controls.length-1;$>=0;$--)k.controls[$].setOpacity(1)}function g(){p(this)}function v(){d(this)}function y(k){var $={tracker:k.eventSource,position:k.position,originalEvent:k.originalEvent,preventDefault:k.preventDefault};this.raiseEvent("canvas-contextmenu",$),k.preventDefault=$.preventDefault}function b(k){var $={originalEvent:k.originalEvent,preventDefaultAction:!1,preventVerticalPan:k.preventVerticalPan||!this.panVertical,preventHorizontalPan:k.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",$),!$.preventDefaultAction&&!k.ctrl&&!k.alt&&!k.meta)switch(k.keyCode){case 38:$.preventVerticalPan||(k.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 40:$.preventVerticalPan||(k.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 37:$.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 39:$.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 87:$.preventVerticalPan||(k.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 83:$.preventVerticalPan||(k.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 65:$.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 68:$.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 82:k.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),k.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:k.preventDefault=!1;break}else k.preventDefault=!1}function T(k){var $={originalEvent:k.originalEvent};this.raiseEvent("canvas-key-press",$)}function x(k){var $,ue=document.activeElement===this.canvas;ue||this.canvas.focus(),this.viewport.flipped&&(k.position.x=this.viewport.getContainerSize().x-k.position.x);var Ee={tracker:k.eventSource,position:k.position,quick:k.quick,shift:k.shift,originalEvent:k.originalEvent,originalTarget:k.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",Ee),!Ee.preventDefaultAction&&this.viewport&&k.quick&&($=this.gestureSettingsByDeviceType(k.pointerType),$.clickToZoom===!0&&(this.viewport.zoomBy(k.shift?1/this.zoomPerClick:this.zoomPerClick,$.zoomToRefPoint?this.viewport.pointFromPixel(k.position,!0):null),this.viewport.applyConstraints()),$.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=t.now()))}function w(k){var $,ue={tracker:k.eventSource,position:k.position,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",ue),!ue.preventDefaultAction&&this.viewport&&($=this.gestureSettingsByDeviceType(k.pointerType),$.dblClickToZoom&&(this.viewport.zoomBy(k.shift?1/this.zoomPerClick:this.zoomPerClick,$.zoomToRefPoint?this.viewport.pointFromPixel(k.position,!0):null),this.viewport.applyConstraints()))}function A(k){var $,ue={tracker:k.eventSource,pointerType:k.pointerType,position:k.position,delta:k.delta,speed:k.speed,direction:k.direction,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",ue),$=this.gestureSettingsByDeviceType(k.pointerType),!ue.preventDefaultAction&&this.viewport){if($.dblClickDragToZoom&&i[this.hash].draggingToZoom){var Ee=Math.pow(this.zoomPerDblClickDrag,k.delta.y/50);this.viewport.zoomBy(Ee)}else if($.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(k.delta.x=0),this.panVertical||(k.delta.y=0),this.viewport.flipped&&(k.delta.x=-k.delta.x),this.constrainDuringPan){var _e=this.viewport.deltaPointsFromPixels(k.delta.negate());this.viewport.centerSpringX.target.value+=_e.x,this.viewport.centerSpringY.target.value+=_e.y;var Fe=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=_e.x,this.viewport.centerSpringY.target.value-=_e.y,Fe.xConstrained&&(k.delta.x=0),Fe.yConstrained&&(k.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(k.delta.negate()),$.flickEnabled&&!this.constrainDuringPan)}}}function R(k){var $,ue={tracker:k.eventSource,pointerType:k.pointerType,position:k.position,speed:k.speed,direction:k.direction,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",ue),$=this.gestureSettingsByDeviceType(k.pointerType),!ue.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&$.flickEnabled&&k.speed>=$.flickMinSpeed){var Ee=0;this.panHorizontal&&(Ee=$.flickMomentum*k.speed*Math.cos(k.direction));var _e=0;this.panVertical&&(_e=$.flickMomentum*k.speed*Math.sin(k.direction));var Fe=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Pe=this.viewport.pointFromPixel(new t.Point(Fe.x-Ee,Fe.y-_e));this.viewport.panTo(Pe,!1)}this.viewport.applyConstraints()}$.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function _(k){this.raiseEvent("canvas-enter",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function D(k){this.raiseEvent("canvas-exit",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function H(k){var $;if(this.raiseEvent("canvas-press",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,insideElementPressed:k.insideElementPressed,insideElementReleased:k.insideElementReleased,originalEvent:k.originalEvent}),$=this.gestureSettingsByDeviceType(k.pointerType),$.dblClickDragToZoom){var ue=i[this.hash].lastClickTime,Ee=t.now();if(ue===null)return;Ee-ue<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function P(k){this.raiseEvent("canvas-release",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,insideElementPressed:k.insideElementPressed,insideElementReleased:k.insideElementReleased,originalEvent:k.originalEvent})}function N(k){this.raiseEvent("canvas-nonprimary-press",{tracker:k.eventSource,position:k.position,pointerType:k.pointerType,button:k.button,buttons:k.buttons,originalEvent:k.originalEvent})}function G(k){this.raiseEvent("canvas-nonprimary-release",{tracker:k.eventSource,position:k.position,pointerType:k.pointerType,button:k.button,buttons:k.buttons,originalEvent:k.originalEvent})}function X(k){var $,ue,Ee,_e,Fe={tracker:k.eventSource,pointerType:k.pointerType,gesturePoints:k.gesturePoints,lastCenter:k.lastCenter,center:k.center,lastDistance:k.lastDistance,distance:k.distance,shift:k.shift,originalEvent:k.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",Fe),this.viewport&&($=this.gestureSettingsByDeviceType(k.pointerType),$.pinchToZoom&&(!Fe.preventDefaultPanAction||!Fe.preventDefaultZoomAction)&&(ue=this.viewport.pointFromPixel(k.center,!0),$.zoomToRefPoint&&!Fe.preventDefaultPanAction&&(Ee=this.viewport.pointFromPixel(k.lastCenter,!0),_e=Ee.minus(ue),this.panHorizontal||(_e.x=0),this.panVertical||(_e.y=0),this.viewport.panBy(_e,!0)),Fe.preventDefaultZoomAction||this.viewport.zoomBy(k.distance/k.lastDistance,ue,!0),this.viewport.applyConstraints()),$.pinchRotate&&!Fe.preventDefaultRotateAction)){var Pe=Math.atan2(k.gesturePoints[0].currentPos.y-k.gesturePoints[1].currentPos.y,k.gesturePoints[0].currentPos.x-k.gesturePoints[1].currentPos.x),dt=Math.atan2(k.gesturePoints[0].lastPos.y-k.gesturePoints[1].lastPos.y,k.gesturePoints[0].lastPos.x-k.gesturePoints[1].lastPos.x);ue=this.viewport.pointFromPixel(k.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(Pe-dt)*(180/Math.PI),ue,!0)}}function te(k){this.raiseEvent("canvas-focus",{tracker:k.eventSource,originalEvent:k.originalEvent})}function Q(k){this.raiseEvent("canvas-blur",{tracker:k.eventSource,originalEvent:k.originalEvent})}function ne(k){var $,ue,Ee,_e,Fe;_e=t.now(),Fe=_e-this._lastScrollTime,Fe>this.minScrollDeltaTime?(this._lastScrollTime=_e,$={tracker:k.eventSource,position:k.position,scroll:k.scroll,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",$),!$.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(k.position.x=this.viewport.getContainerSize().x-k.position.x),ue=this.gestureSettingsByDeviceType(k.pointerType),ue.scrollToZoom&&(Ee=Math.pow(this.zoomPerScroll,k.scroll),this.viewport.zoomBy(Ee,ue.zoomToRefPoint?this.viewport.pointFromPixel(k.position,!0):null),this.viewport.applyConstraints())),k.preventDefault=$.preventDefault):k.preventDefault=!0}function oe(k){i[this.hash].mouseInside=!0,p(this),this.raiseEvent("container-enter",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function Z(k){k.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||d(this)),this.raiseEvent("container-exit",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function se(k){q(k),k.isOpen()?k._updateRequestId=u(k,se):k._updateRequestId=!1}function j(k,$){var ue=k.viewport,Ee=ue.getZoom(),_e=ue.getCenter();ue.resize($,k.preserveImageSizeOnResize),ue.panTo(_e,!0);var Fe;if(k.preserveImageSizeOnResize)Fe=i[k.hash].prevContainerSize.x/$.x;else{var Pe=new t.Point(0,0),dt=new t.Point(i[k.hash].prevContainerSize.x,i[k.hash].prevContainerSize.y).distanceTo(Pe),mt=new t.Point($.x,$.y).distanceTo(Pe);Fe=mt/dt*i[k.hash].prevContainerSize.x/$.x}ue.zoomTo(Ee*Fe,null,!0),i[k.hash].prevContainerSize=$,i[k.hash].forceRedraw=!0,i[k.hash].needsResize=!1,i[k.hash].forceResize=!1}function q(k){if(!(k._opening||!i[k.hash])){if(k.autoResize||i[k.hash].forceResize){var $;if(k._autoResizePolling){$=s(k.container);var ue=i[k.hash].prevContainerSize;$.equals(ue)||(i[k.hash].needsResize=!0)}i[k.hash].needsResize&&j(k,$||s(k.container))}var Ee=k.viewport.update(),_e=k.world.update()||Ee;Ee&&k.raiseEvent("viewport-change"),k.referenceStrip&&(_e=k.referenceStrip.update(k.viewport)||_e);var Fe=i[k.hash].animating;!Fe&&_e&&(k.raiseEvent("animation-start"),p(k));var Pe=Fe&&!_e;Pe&&(i[k.hash].animating=!1),(_e||Pe||i[k.hash].forceRedraw||k.world.needsDraw())&&(re(k),k._drawOverlays(),k.navigator&&k.navigator.update(k.viewport),i[k.hash].forceRedraw=!1,_e&&k.raiseEvent("animation")),Pe&&(k.raiseEvent("animation-finish"),i[k.hash].mouseInside||d(k)),i[k.hash].animating=_e}}function re(k){k.imageLoader.clear(),k.drawer.clear(),k.world.draw(),k.raiseEvent("update-viewport",{})}function z(k,$){return k?k+$:$}function ve(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,Ae(this)}function Le(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,Ae(this)}function Ce(){i[this.hash].zooming=!1}function Ae(k){t.requestAnimationFrame(t.delegate(k,ke))}function ke(){var k,$,ue;i[this.hash].zooming&&this.viewport&&(k=t.now(),$=k-i[this.hash].lastZoomTime,ue=Math.pow(i[this.hash].zoomFactor,$/1e3),this.viewport.zoomBy(ue),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=k,Ae(this))}function je(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function We(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function de(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Re(){this.viewport&&this.viewport.goHome()}function Ie(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Ye(){if(this.viewport){var k=this.viewport.getRotation();this.viewport.flipped?k+=this.rotationIncrement:k-=this.rotationIncrement,this.viewport.setRotation(k)}}function It(){if(this.viewport){var k=this.viewport.getRotation();this.viewport.flipped?k-=this.rotationIncrement:k+=this.rotationIncrement,this.viewport.setRotation(k)}}function Qe(){this.viewport.toggleFlip()}})(e),(function(t){t.Navigator=function(u){var c=u.viewer,d=this,h,p;u.element||u.id?(u.element?(u.id&&t.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),u.element.id?u.id=u.element.id:u.id="navigator-"+t.now(),this.element=u.element):this.element=document.getElementById(u.id),u.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(u.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),u.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:u.autoFade},u.position&&(u.position==="BOTTOM_RIGHT"?u.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:u.position==="BOTTOM_LEFT"?u.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:u.position==="TOP_RIGHT"?u.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:u.position==="TOP_LEFT"?u.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:u.position==="ABSOLUTE"&&(u.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,u.controlOptions.top=u.top,u.controlOptions.left=u.left,u.controlOptions.height=u.height,u.controlOptions.width=u.width))),this.element.id=u.id,this.element.className+=" navigator",u=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},u,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:u.animationTime,autoResize:!1,minZoomImageRatio:1,background:u.background,opacity:u.opacity,borderColor:u.borderColor,displayRegionColor:u.displayRegionColor}),u.minPixelRatio=this.minPixelRatio=c.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),u.controlOptions.anchor!==t.ControlAnchor.NONE&&(function(y,b){y.margin="0px",y.border=b+"px solid "+u.borderColor,y.padding="0px",y.background=u.background,y.opacity=u.opacity,y.overflow="hidden"})(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",(function(y,b){y.position="relative",y.top="0px",y.left="0px",y.fontSize="0px",y.overflow="hidden",y.border=b+"px solid "+u.displayRegionColor,y.margin="0px",y.padding="0px",y.background="transparent",y.float="left",y.cssFloat="left",y.styleFloat="left",y.zIndex=999999999,y.cursor="default",y.boxSizing="content-box"})(this.displayRegion.style,this.borderWidth),t.setElementPointerEventsNone(this.displayRegion),t.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",t.setElementPointerEventsNone(this.displayRegionContainer),t.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,u.controlOptions),this._resizeWithViewer=u.controlOptions.anchor!==t.ControlAnchor.ABSOLUTE&&u.controlOptions.anchor!==t.ControlAnchor.NONE,u.width&&u.height?(this.setWidth(u.width),this.setHeight(u.height)):this._resizeWithViewer&&(h=t.getElementSize(c.element),this.element.style.height=Math.round(h.y*u.sizeRatio)+"px",this.element.style.width=Math.round(h.x*u.sizeRatio)+"px",this.oldViewerSize=h,p=t.getElementSize(this.element),this.elementArea=p.x*p.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[u]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function g(y,b){o(d.displayRegionContainer,y),o(d.displayRegion,-y),d.viewport.setRotation(y,b)}if(u.navigatorRotate){var v=u.viewer.viewport?u.viewer.viewport.getRotation():u.viewer.degrees||0;g(v,!0),u.viewer.addHandler("rotate",function(y){g(y.degrees,y.immediately)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:t.delegate(this,r),clickHandler:t.delegate(this,i),releaseHandler:t.delegate(this,s),scrollHandler:t.delegate(this,a),preProcessEventHandler:function(y){y.eventType==="wheel"&&(y.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",t.setElementPointerEventsNone(this.canvas),t.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(y){window.setTimeout(function(){var b=d.world.getItemAt(y.previousIndex);d.world.setItemIndex(b,y.newIndex)},1)}),c.world.addHandler("remove-item",function(y){var b=y.item,T=d._getMatchingItem(b);T&&d.world.removeItem(T)}),this.update(c.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var u=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);u.equals(this.oldContainerSize)||(this.viewport.resize(u,!0),this.viewport.goHome(!0),this.oldContainerSize=u,this.drawer.clear(),this.world.draw())}},setWidth:function(u){this.width=u,this.element.style.width=typeof u=="number"?u+"px":u,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(u){this.height=u,this.element.style.height=typeof u=="number"?u+"px":u,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(u){return this.viewport.setFlip(u),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(u){l(this.displayRegion,u),l(this.canvas,u),l(this.element,u)},update:function(u){var c,d,h,p,g,v;if(c=t.getElementSize(this.viewer.element),this._resizeWithViewer&&c.x&&c.y&&!c.equals(this.oldViewerSize)&&(this.oldViewerSize=c,this.maintainSizeRatio||!this.elementArea?(d=c.x*this.sizeRatio,h=c.y*this.sizeRatio):(d=Math.sqrt(this.elementArea*(c.x/c.y)),h=this.elementArea/d),this.element.style.width=Math.round(d)+"px",this.element.style.height=Math.round(h)+"px",this.elementArea||(this.elementArea=d*h),this.updateSize()),u&&this.viewport){if(p=u.getBoundsNoRotate(!0),g=this.viewport.pixelFromPointNoRotate(p.getTopLeft(),!1),v=this.viewport.pixelFromPointNoRotate(p.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var y=u.getRotation(!0);o(this.displayRegion,-y)}var b=this.displayRegion.style;b.display=this.world.getItemCount()?"block":"none",b.top=g.y.toFixed(2)+"px",b.left=g.x.toFixed(2)+"px";var T=v.x-g.x,x=v.y-g.y;b.width=Math.round(Math.max(T,0))+"px",b.height=Math.round(Math.max(x,0))+"px"}},addTiledImage:function(u){var c=this,d=u.originalTiledImage;delete u.original;var h=t.extend({},u,{success:function(p){var g=p.item;g._originalForNavigator=d,c._matchBounds(g,d,!0),c._matchOpacity(g,d),c._matchCompositeOperation(g,d);function v(){c._matchBounds(g,d)}function y(){c._matchOpacity(g,d)}function b(){c._matchCompositeOperation(g,d)}d.addHandler("bounds-change",v),d.addHandler("clip-change",v),d.addHandler("opacity-change",y),d.addHandler("composite-operation-change",b)}});return t.Viewer.prototype.addTiledImage.apply(this,[h])},destroy:function(){return t.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(u){for(var c=this.world.getItemCount(),d,h=0;h<c;h++)if(d=this.world.getItemAt(h),d._originalForNavigator===u)return d;return null},_matchBounds:function(u,c,d){var h=c.getBoundsNoRotate();u.setPosition(h.getTopLeft(),d),u.setWidth(h.width,d),u.setRotation(c.getRotation(),d),u.setClip(c.getClip()),u.setFlip(c.getFlip())},_matchOpacity:function(u,c){u.setOpacity(c.opacity)},_matchCompositeOperation:function(u,c){u.setCompositeOperation(c.compositeOperation)}});function i(u){var c={tracker:u.eventSource,position:u.position,quick:u.quick,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",c),!c.preventDefaultAction&&u.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x);var d=this.viewport.pointFromPixel(u.position);this.panVertical?this.panHorizontal||(d.x=this.viewer.viewport.getCenter(!0).x):d.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(d),this.viewer.viewport.applyConstraints()}}function r(u){var c={tracker:u.eventSource,position:u.position,delta:u.delta,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",c),!c.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(u.delta.x=0),this.panVertical||(u.delta.y=0),this.viewer.viewport.flipped&&(u.delta.x=-u.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(u.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(u){u.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(u){var c={tracker:u.eventSource,position:u.position,scroll:u.scroll,shift:u.shift,originalEvent:u.originalEvent,preventDefault:u.preventDefault};this.viewer.raiseEvent("navigator-scroll",c),u.preventDefault=c.preventDefault}function o(u,c){l(u,"rotate("+c+"deg)")}function l(u,c){u.style.webkitTransform=c,u.style.mozTransform=c,u.style.msTransform=c,u.style.oTransform=c,u.style.transform=c}})(e),(function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(r){var s=r.split("."),a=null,o=arguments,l=i,u;for(u=0;u<s.length-1;u++)l=l[s[u]]||{};return a=l[s[u]],typeof a!="string"&&(t.console.error("Untranslated source string:",r),a=""),a.replace(/\{\d+\}/g,function(c){var d=parseInt(c.match(/\d+/),10)+1;return d<o.length?o[d]:""})},setString:function(r,s){var a=r.split("."),o=i,l;for(l=0;l<a.length-1;l++)o[a[l]]||(o[a[l]]={}),o=o[a[l]];o[a[l]]=s}})})(e),(function(t){t.Point=function(i,r){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(i){return new t.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new t.Point(this.x-i.x,this.y-i.y)},times:function(i){return new t.Point(this.x*i,this.y*i)},divide:function(i){return new t.Point(this.x/i,this.y/i)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new t.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof t.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,r){r=r||new t.Point(0,0);var s,a;if(i%90===0){var o=t.positiveModulo(i,360);switch(o){case 0:s=1,a=0;break;case 90:s=0,a=1;break;case 180:s=-1,a=0;break;case 270:s=0,a=-1;break}}else{var l=i*Math.PI/180;s=Math.cos(l),a=Math.sin(l)}var u=s*(this.x-r.x)-a*(this.y-r.y)+r.x,c=a*(this.x-r.x)+s*(this.y-r.y)+r.y;return new t.Point(u,c)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}})(e),(function(t){t.TileSource=function(r,s,a,o,l,u){var c=this,d=arguments,h,p;if(t.isPlainObject(r)?h=r:h={width:d[0],height:d[1],tileSize:d[2],tileOverlap:d[3],minLevel:d[4],maxLevel:d[5]},t.EventSource.call(this),t.extend(!0,this,h),!this.success){for(p=0;p<arguments.length;p++)if(t.isFunction(arguments[p])){this.success=arguments[p];break}}this.success&&this.addHandler("ready",function(g){c.success(g)}),t.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=h.width&&h.height?h.width/h.height:1,this.dimensions=new t.Point(h.width,h.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=h.tileOverlap?h.tileOverlap:0,this.minLevel=h.minLevel?h.minLevel:0,this.maxLevel=h.maxLevel!==void 0&&h.maxLevel!==null?h.maxLevel:h.width&&h.height?Math.ceil(Math.log(Math.max(h.width,h.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(r){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(r){return this._tileWidth?this._tileWidth:this.getTileSize(r)},getTileHeight:function(r){return this._tileHeight?this._tileHeight:this.getTileSize(r)},setMaxLevel:function(r){this.maxLevel=r,this._memoizeLevelScale()},getLevelScale:function(r){return this._memoizeLevelScale(),this.getLevelScale(r)},_memoizeLevelScale:function(){var r={},s;for(s=0;s<=this.maxLevel;s++)r[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(a){return r[a]}},getNumTiles:function(r){var s=this.getLevelScale(r),a=Math.ceil(s*this.dimensions.x/this.getTileWidth(r)),o=Math.ceil(s*this.dimensions.y/this.getTileHeight(r));return new t.Point(a,o)},getPixelRatio:function(r){var s=this.dimensions.times(this.getLevelScale(r)),a=1/s.x*t.pixelDensityRatio,o=1/s.y*t.pixelDensityRatio;return new t.Point(a,o)},getClosestLevel:function(){var r,s;for(r=this.minLevel+1;r<=this.maxLevel&&(s=this.getNumTiles(r),!(s.x>1||s.y>1));r++);return r-1},getTileAtPoint:function(r,s){var a=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;t.console.assert(a,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(r),l=s.x*o,u=s.y*o,c=Math.floor(l/this.getTileWidth(r)),d=Math.floor(u/this.getTileHeight(r));s.x>=1&&(c=this.getNumTiles(r).x-1);var h=1e-15;return s.y>=1/this.aspectRatio-h&&(d=this.getNumTiles(r).y-1),new t.Point(c,d)},getTileBounds:function(r,s,a,o){var l=this.dimensions.times(this.getLevelScale(r)),u=this.getTileWidth(r),c=this.getTileHeight(r),d=s===0?0:u*s-this.tileOverlap,h=a===0?0:c*a-this.tileOverlap,p=u+(s===0?1:2)*this.tileOverlap,g=c+(a===0?1:2)*this.tileOverlap,v=1/l.x;return p=Math.min(p,l.x-d),g=Math.min(g,l.y-h),o?new t.Rect(0,0,p,g):new t.Rect(d*v,h*v,p*v,g*v)},getImageInfo:function(r){var s=this,a,o,l,u,c,d,h;r&&(c=r.split("/"),d=c[c.length-1],h=d.lastIndexOf("."),h>-1&&(c[c.length-1]=d.slice(0,h)));var p=null;if(this.splitHashDataForPost){var g=r.indexOf("#");g!==-1&&(p=r.substring(g+1),r=r.substr(0,g))}o=function(v){typeof v=="string"&&(v=t.parseXml(v));var y=t.TileSource.determineType(s,v,r);if(!y){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:r});return}u=y.prototype.configure.apply(s,[v,r,p]),u.ajaxWithCredentials===void 0&&(u.ajaxWithCredentials=s.ajaxWithCredentials),l=new y(u),s.ready=!0,s.raiseEvent("ready",{tileSource:l})},r.match(/\.js$/)?(a=r.split("/").pop().replace(".js",""),t.jsonp({url:r,async:!1,callbackName:a,callback:o})):t.makeAjaxRequest({url:r,postData:p,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(v){var y=i(v);o(y)},error:function(v,y){var b;try{b="HTTP "+v.status+" attempting to load TileSource: "+r}catch{var T;typeof y>"u"||!y.toString?T="Unknown error":T=y.toString(),b=T+" attempting to load TileSource: "+r}t.console.error(b),s.raiseEvent("open-failed",{message:b,source:r,postData:p})}})},supports:function(r,s){return!1},configure:function(r,s,a){throw new Error("Method not implemented.")},getTileUrl:function(r,s,a){throw new Error("Method not implemented.")},getTilePostData:function(r,s,a){return null},getTileAjaxHeaders:function(r,s,a){return{}},getTileHashKey:function(r,s,a,o,l,u){function c(d){return l?d+"+"+JSON.stringify(l):d}return c(typeof o!="string"?r+"/"+s+"_"+a:o)},tileExists:function(r,s,a){var o=this.getNumTiles(r);return r>=this.minLevel&&r<=this.maxLevel&&s>=0&&a>=0&&s<o.x&&a<o.y},hasTransparency:function(r,s,a,o){return!!r||s.match(".png")},downloadTileStart:function(r){var s=r.userData,a=new Image;s.image=a,s.request=null;var o=function(l){if(!a){r.finish(null,s.request,"Image load failed: undefined Image instance.");return}a.onload=a.onerror=a.onabort=null,r.finish(l?null:a,s.request,l)};a.onload=function(){o()},a.onabort=a.onerror=function(){o("Image load aborted.")},r.loadWithAjax?s.request=t.makeAjaxRequest({url:r.src,withCredentials:r.ajaxWithCredentials,headers:r.ajaxHeaders,responseType:"arraybuffer",postData:r.postData,success:function(l){var u;try{u=new window.Blob([l.response])}catch(h){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(h.name==="TypeError"&&c){var d=new c;d.append(l.response),u=d.getBlob()}}u.size===0?o("Empty image response."):a.src=(window.URL||window.webkitURL).createObjectURL(u)},error:function(l){o("Image load aborted - XHR error")}}):(r.crossOriginPolicy!==!1&&(a.crossOrigin=r.crossOriginPolicy),a.src=r.src)},downloadTileAbort:function(r){r.userData.request&&r.userData.request.abort();var s=r.userData.image;r.userData.image&&(s.onload=s.onerror=s.onabort=null)},createTileCache:function(r,s,a){r._data=s},destroyTileCache:function(r){r._data=null,r._renderedContext=null},getTileCacheData:function(r){return r._data},getTileCacheDataAsImage:function(r){return r._data},getTileCacheDataAsContext2D:function(r){if(!r._renderedContext){var s=document.createElement("canvas");s.width=r._data.width,s.height=r._data.height,r._renderedContext=s.getContext("2d"),r._renderedContext.drawImage(r._data,0,0),r._data=null}return r._renderedContext}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function i(r){var s=r.responseText,a=r.status,o,l;if(r){if(r.status!==200&&r.status!==0)throw a=r.status,o=a===404?"Not Found":r.statusText,new Error(t.getString("Errors.Status",a,o))}else throw new Error(t.getString("Errors.Security"));if(s.match(/^\s*<.*/))try{l=r.responseXML&&r.responseXML.documentElement?r.responseXML:t.parseXml(s)}catch{l=r.responseText}else if(s.match(/\s*[{[].*/))try{l=t.parseJSON(s)}catch{l=s}else l=s;return l}t.TileSource.determineType=function(r,s,a){var o;for(o in e)if(o.match(/.+TileSource$/)&&t.isFunction(e[o])&&t.isFunction(e[o].prototype.supports)&&e[o].prototype.supports.call(r,s,a))return e[o];return t.console.error("No TileSource was able to open %s %s",a,s),null}})(e),(function(t){t.DziTileSource=function(s,a,o,l,u,c,d,h,p){var g,v,y,b;if(t.isPlainObject(s)?b=s:b={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=b.tilesUrl,this.fileFormat=b.fileFormat,this.displayRects=b.displayRects,this.displayRects)for(g=this.displayRects.length-1;g>=0;g--)for(v=this.displayRects[g],y=v.minLevel;y<=v.maxLevel;y++)this._levelRects[y]||(this._levelRects[y]=[]),this._levelRects[y].push(v);t.TileSource.apply(this,[b])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(s,a){var o;return s.Image?o=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(o=s.documentElement.namespaceURI),o=(o||"").toLowerCase(),o.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||o.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,a,o){var l;return t.isPlainObject(s)?l=r(this,s):l=i(this,s),a&&!l.tilesUrl&&(l.tilesUrl=a.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),a.search(/\.(dzi|xml|js)\?/)!==-1?l.queryParams=a.match(/\?.*/):l.queryParams=""),l},getTileUrl:function(s,a,o){return[this.tilesUrl,s,"/",a,"_",o,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,a,o){var l=this._levelRects[s],u,c,d,h,p,g,v;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!l||!l.length)return!0;for(v=l.length-1;v>=0;v--)if(u=l[v],!(s<u.minLevel||s>u.maxLevel)&&(c=this.getLevelScale(s),d=u.x*c,h=u.y*c,p=d+u.width*c,g=h+u.height*c,d=Math.floor(d/this._tileWidth),h=Math.floor(h/this._tileWidth),p=Math.ceil(p/this._tileWidth),g=Math.ceil(g/this._tileWidth),d<=a&&a<p&&h<=o&&o<g))return!0;return!1}});function i(s,a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var o=a.documentElement,l=o.localName||o.tagName,u=a.documentElement.namespaceURI,c=null,d=[],h,p,g,v,y;if(l==="Image")try{if(v=o.getElementsByTagName("Size")[0],v===void 0&&(v=o.getElementsByTagNameNS(u,"Size")[0]),c={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(v.getAttribute("Height"),10),Width:parseInt(v.getAttribute("Width"),10)}}},!t.imageFormatSupported(c.Image.Format))throw new Error(t.getString("Errors.ImageFormat",c.Image.Format.toUpperCase()));for(h=o.getElementsByTagName("DisplayRect"),h===void 0&&(h=o.getElementsByTagNameNS(u,"DisplayRect")[0]),y=0;y<h.length;y++)p=h[y],g=p.getElementsByTagName("Rect")[0],g===void 0&&(g=p.getElementsByTagNameNS(u,"Rect")[0]),d.push({Rect:{X:parseInt(g.getAttribute("X"),10),Y:parseInt(g.getAttribute("Y"),10),Width:parseInt(g.getAttribute("Width"),10),Height:parseInt(g.getAttribute("Height"),10),MinLevel:parseInt(p.getAttribute("MinLevel"),10),MaxLevel:parseInt(p.getAttribute("MaxLevel"),10)}});return d.length&&(c.Image.DisplayRect=d),r(s,c)}catch(x){throw x instanceof Error?x:new Error(t.getString("Errors.Dzi"))}else{if(l==="Collection")throw new Error(t.getString("Errors.Dzc"));if(l==="Error"){var b=o.getElementsByTagName("Message")[0],T=b.firstChild.nodeValue;throw new Error(T)}}throw new Error(t.getString("Errors.Dzi"))}function r(s,a){var o=a.Image,l=o.Url,u=o.Format,c=o.Size,d=o.DisplayRect||[],h=parseInt(c.Width,10),p=parseInt(c.Height,10),g=parseInt(o.TileSize,10),v=parseInt(o.Overlap,10),y=[],b,T;for(T=0;T<d.length;T++)b=d[T].Rect,y.push(new t.DisplayRect(parseInt(b.X,10),parseInt(b.Y,10),parseInt(b.Width,10),parseInt(b.Height,10),parseInt(b.MinLevel,10),parseInt(b.MaxLevel,10)));return t.extend(!0,{width:h,height:p,tileSize:g,tileOverlap:v,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:u,displayRects:y},a)}})(e),(function(t){t.IIIFTileSource=function(o){if(t.extend(!0,this,o),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var l=0;l<this.tiles.length;l++)for(var u=0;u<this.tiles[l].scaleFactors.length;u++){var c=this.tiles[l].scaleFactors[u];this.scale_factors.push(c),o.tileSizePerScaleFactor[c]={width:this.tiles[l].width,height:this.tiles[l].height||this.tiles[l].width}}}else if(i(o)){for(var d=Math.min(this.height,this.width),h=[256,512,1024],p=[],g=0;g<h.length;g++)h[g]<=d&&p.push(h[g]);p.length>0?o.tileSize=Math.max.apply(null,p):o.tileSize=d}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=r(this),t.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)o.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var v=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(v)*Math.LOG2E)}if(this.sizes){var y=this.sizes.length;(y===o.maxLevel||y===o.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort(function(b,T){return b.width-T.width}),y===o.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}t.TileSource.apply(this,[o])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(o,l){return o.protocol&&o.protocol==="http://iiif.io/api/image"||o["@context"]&&(o["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||o["@context"]==="http://iiif.io/api/image/1/context.json")||o.profile&&o.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||o.identifier&&o.width&&o.height?!0:!!(o.documentElement&&o.documentElement.tagName==="info"&&o.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(o,l,u){if(t.isPlainObject(o)){if(!o["@context"])o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=l.replace("/info.json",""),o.version=1;else{var d=o["@context"];if(Array.isArray(d)){for(var h=0;h<d.length;h++)if(typeof d[h]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(d[h])||d[h]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){d=d[h];break}}switch(d){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(o.preferredFormats){for(var p=0;p<o.preferredFormats.length;p++)if(e.imageFormatSupported(o.preferredFormats[p])){o.tileFormat=o.preferredFormats[p];break}}return o}else{var c=s(o);return c["@context"]="http://iiif.io/api/image/1.0/context.json",c["@id"]=l.replace("/info.xml",""),c.version=1,c}},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,o);var l=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,o);var l=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var l=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(l=this.levels[o].width/this.levels[this.maxLevel].width),l}return t.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){if(this.emulateLegacyImagePyramid){var l=this.getLevelScale(o);return l?new t.Point(1,1):new t.Point(0,0)}if(this.levelSizes){var u=this.levelSizes[o],c=Math.ceil(u.width/this.getTileWidth(o)),d=Math.ceil(u.height/this.getTileHeight(o));return new t.Point(c,d)}else return t.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,l){if(this.emulateLegacyImagePyramid)return new t.Point(0,0);if(this.levelSizes){var u=l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/this.aspectRatio;t.console.assert(u,"[TileSource.getTileAtPoint] must be called with a valid point.");var c=this.levelSizes[o].width,d=l.x*c,h=l.y*c,p=Math.floor(d/this.getTileWidth(o)),g=Math.floor(h/this.getTileHeight(o));l.x>=1&&(p=this.getNumTiles(o).x-1);var v=1e-15;return l.y>=1/this.aspectRatio-v&&(g=this.getNumTiles(o).y-1),new t.Point(p,g)}return t.TileSource.prototype.getTileAtPoint.call(this,o,l)},getTileUrl:function(o,l,u){if(this.emulateLegacyImagePyramid){var c=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(c=this.levels[o].url),c}var d="0",h=Math.pow(.5,this.maxLevel-o),p,g,v,y,b,T,x,w,A,R,_,D,H,P,N,G;return this.levelSizes?(p=this.levelSizes[o].width,g=this.levelSizes[o].height):(p=Math.ceil(this.width*h),g=Math.ceil(this.height*h)),v=this.getTileWidth(o),y=this.getTileHeight(o),b=Math.round(v/h),T=Math.round(y/h),this.version===1?N="native."+this.tileFormat:N="default."+this.tileFormat,p<v&&g<y?(this.version===2&&p===this.width?D="full":this.version===3&&p===this.width&&g===this.height?D="max":this.version===3?D=p+","+g:D=p+",",x="full"):(w=l*b,A=u*T,R=Math.min(b,this.width-w),_=Math.min(T,this.height-A),l===0&&u===0&&R===this.width&&_===this.height?x="full":x=[w,A,R,_].join(","),H=Math.min(v,p-l*v),P=Math.min(y,g-u*y),this.version===2&&H===this.width?D="full":this.version===3&&H===this.width&&P===this.height?D="max":this.version===3?D=H+","+P:D=H+","),G=[this._id,x,D,d,N].join("/"),G},__testonly__:{canBeTiled:i,constructLevels:r}});function i(o){var l=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],u=Array.isArray(o.profile)?o.profile[0]:o.profile,c=l.indexOf(u)!==-1,d=!1;return o.version===2&&o.profile.length>1&&o.profile[1].supports&&(d=o.profile[1].supports.indexOf("sizeByW")!==-1),o.version===3&&o.extraFeatures&&(d=o.extraFeatures.indexOf("sizeByWh")!==-1),!c||d}function r(o){for(var l=[],u=0;u<o.sizes.length;u++)l.push({url:o._id+"/full/"+o.sizes[u].width+","+(o.version===3?o.sizes[u].height:"")+"/0/default."+o.tileFormat,width:o.sizes[u].width,height:o.sizes[u].height});return l.sort(function(c,d){return c.width-d.width})}function s(o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var l=o.documentElement,u=l.tagName,c=null;if(u==="info")try{return c={},a(l,c),c}catch(d){throw d instanceof Error?d:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function a(o,l,u){var c,d;if(o.nodeType===3&&u)d=o.nodeValue.trim(),d.match(/^\d*$/)&&(d=Number(d)),l[u]?(t.isArray(l[u])||(l[u]=[l[u]]),l[u].push(d)):l[u]=d;else if(o.nodeType===1)for(c=0;c<o.childNodes.length;c++)a(o.childNodes[c],l,o.nodeName)}})(e),(function(t){t.OsmTileSource=function(i,r,s,a,o){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!l.width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,t.TileSource.apply(this,[l])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="openstreetmaps"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){return this.tilesUrl+(i-8)+"/"+r+"/"+s+".png"}})})(e),(function(t){t.TmsTileSource=function(i,r,s,a,o){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var u=Math.ceil(l.width/256)*256,c=Math.ceil(l.height/256)*256,d;u>c?d=u/256:d=c/256,l.maxLevel=Math.ceil(Math.log(d)/Math.log(2))-1,l.tileSize=256,l.width=u,l.height=c,t.TileSource.apply(this,[l])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="tiledmapservice"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){var a=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+r+"/"+(a-s)+".png"}})})(e),(function(t){t.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var r={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(r.x,10)>i.tileSize||parseInt(r.y,10)>i.tileSize;)r.x=Math.floor(r.x/2),r.y=Math.floor(r.y/2),i.imageSizes.push({x:r.x,y:r.y}),i.gridSize.push(this._getGridSize(r.x,r.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,e.TileSource.apply(this,[i])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(i,r,s){return{x:Math.ceil(i/s),y:Math.ceil(r/s)}},_calculateAbsoluteTileNumber:function(i,r,s){for(var a=0,o={},l=0;l<i;l++)o=this.gridSize[l],a+=o.x*o.y;return o=this.gridSize[i],a+=o.x*s+r,a},supports:function(i,r){return i.type&&i.type==="zoomifytileservice"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){var a=0,o=this._calculateAbsoluteTileNumber(i,r,s);return a=Math.floor(o/256),this.tilesUrl+"TileGroup"+a+"/"+i+"-"+r+"-"+s+"."+this.fileFormat}})})(e),(function(t){t.LegacyTileSource=function(a){var o,l,u;t.isArray(a)&&(o={type:"legacy-image-pyramid",levels:a}),o.levels=i(o.levels),o.levels.length>0?(l=o.levels[o.levels.length-1].width,u=o.levels[o.levels.length-1].height):(l=0,u=0,t.console.error("No supported image formats found")),t.extend(!0,o,{width:l,height:u,tileSize:Math.max(u,l),tileOverlap:0,minLevel:0,maxLevel:o.levels.length>0?o.levels.length-1:0}),t.TileSource.apply(this,[o]),this.levels=o.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(a,o){return a.type&&a.type==="legacy-image-pyramid"||a.documentElement&&a.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(a,o,l){var u;return t.isPlainObject(a)?u=s(this,a):u=r(this,a),u},getLevelScale:function(a){var o=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(o=this.levels[a].width/this.levels[this.maxLevel].width),o},getNumTiles:function(a){var o=this.getLevelScale(a);return o?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(a,o,l){var u=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(u=this.levels[a].url),u}});function i(a){var o=[],l,u;for(u=0;u<a.length;u++)l=a[u],l.height&&l.width&&l.url?o.push({url:l.url,width:Number(l.width),height:Number(l.height)}):t.console.error("Unsupported image format: %s",l.url?l.url:"<no URL>");return o.sort(function(c,d){return c.height-d.height})}function r(a,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var l=o.documentElement,u=l.tagName,c=null,d=[],h,p;if(u==="image")try{for(c={type:l.getAttribute("type"),levels:[]},d=l.getElementsByTagName("level"),p=0;p<d.length;p++)h=d[p],c.levels.push({url:h.getAttribute("url"),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10)});return s(a,c)}catch(g){throw g instanceof Error?g:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(u==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(u==="error")throw new Error("Error: "+o)}throw new Error("Unknown element "+u)}function s(a,o){return o.levels}})(e),(function(t){t.ImageTileSource=function(i){i=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),t.TileSource.apply(this,[i])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="image"},configure:function(i,r,s){return i},getImageInfo:function(i){var r=this._image=new Image,s=this;this.crossOriginPolicy&&(r.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(r.useCredentials=this.ajaxWithCredentials),t.addEvent(r,"load",function(){s.width=r.naturalWidth,s.height=r.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new t.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),t.addEvent(r,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),r.src=i},getLevelScale:function(i){var r=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(r=this.levels[i].width/this.levels[this.maxLevel].width),r},getNumTiles:function(i){var r=this.getLevelScale(i);return r?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(i,r,s){var a=null;return i>=this.minLevel&&i<=this.maxLevel&&(a=this.levels[i].url),a},getContext2D:function(i,r,s){var a=null;return i>=this.minLevel&&i<=this.maxLevel&&(a=this.levels[i].context2D),a},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,i;var r=this._image.naturalWidth,s=this._image.naturalHeight,a=document.createElement("canvas"),o=a.getContext("2d");if(a.width=r,a.height=s,o.drawImage(this._image,0,0,r,s),i[0].context2D=o,delete this._image,t.isCanvasTainted(a))return i;for(;r>=2&&s>=2;){r=Math.floor(r/2),s=Math.floor(s/2);var l=document.createElement("canvas"),u=l.getContext("2d");l.width=r,l.height=s,u.drawImage(a,0,0,r,s),i.splice(0,0,{context2D:u,width:r,height:s}),a=l,o=u}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0)}})})(e),(function(t){t.TileSourceCollection=function(i,r,s,a){t.console.error("TileSourceCollection is deprecated; use World instead")}})(e),(function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(u){var c=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},u),this.element=u.element||t.makeNeutralElement("div"),u.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,t.setElementPointerEventsNone(this.imgRest),t.setElementPointerEventsNone(this.imgGroup),t.setElementPointerEventsNone(this.imgHover),t.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor===t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(d){d.insideElementPressed?(o(c,t.ButtonState.DOWN),c.raiseEvent("enter",{originalEvent:d.originalEvent})):d.buttonDownAny||o(c,t.ButtonState.HOVER)},focusHandler:function(d){c.tracker.enterHandler(d),c.raiseEvent("focus",{originalEvent:d.originalEvent})},leaveHandler:function(d){l(c,t.ButtonState.GROUP),d.insideElementPressed&&c.raiseEvent("exit",{originalEvent:d.originalEvent})},blurHandler:function(d){c.tracker.leaveHandler(d),c.raiseEvent("blur",{originalEvent:d.originalEvent})},pressHandler:function(d){o(c,t.ButtonState.DOWN),c.raiseEvent("press",{originalEvent:d.originalEvent})},releaseHandler:function(d){d.insideElementPressed&&d.insideElementReleased?(l(c,t.ButtonState.HOVER),c.raiseEvent("release",{originalEvent:d.originalEvent})):d.insideElementPressed?l(c,t.ButtonState.GROUP):o(c,t.ButtonState.HOVER)},clickHandler:function(d){d.quick&&c.raiseEvent("click",{originalEvent:d.originalEvent})},keyHandler:function(d){d.keyCode===13?(c.raiseEvent("click",{originalEvent:d.originalEvent}),c.raiseEvent("release",{originalEvent:d.originalEvent}),d.preventDefault=!0):d.preventDefault=!1}}),l(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){o(this,t.ButtonState.GROUP)},notifyGroupExit:function(){l(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(u){t.requestAnimationFrame(function(){r(u)})}function r(u){var c,d,h;u.shouldFade&&(c=t.now(),d=c-u.fadeBeginTime,h=1-d/u.fadeLength,h=Math.min(1,h),h=Math.max(0,h),u.imgGroup&&t.setElementOpacity(u.imgGroup,h,!0),h>0&&i(u))}function s(u){u.shouldFade=!0,u.fadeBeginTime=t.now()+u.fadeDelay,window.setTimeout(function(){i(u)},u.fadeDelay)}function a(u){u.shouldFade=!1,u.imgGroup&&t.setElementOpacity(u.imgGroup,1,!0)}function o(u,c){u.element.disabled||(c>=t.ButtonState.GROUP&&u.currentState===t.ButtonState.REST&&(a(u),u.currentState=t.ButtonState.GROUP),c>=t.ButtonState.HOVER&&u.currentState===t.ButtonState.GROUP&&(u.imgHover&&(u.imgHover.style.visibility=""),u.currentState=t.ButtonState.HOVER),c>=t.ButtonState.DOWN&&u.currentState===t.ButtonState.HOVER&&(u.imgDown&&(u.imgDown.style.visibility=""),u.currentState=t.ButtonState.DOWN))}function l(u,c){u.element.disabled||(c<=t.ButtonState.HOVER&&u.currentState===t.ButtonState.DOWN&&(u.imgDown&&(u.imgDown.style.visibility="hidden"),u.currentState=t.ButtonState.HOVER),c<=t.ButtonState.GROUP&&u.currentState===t.ButtonState.HOVER&&(u.imgHover&&(u.imgHover.style.visibility="hidden"),u.currentState=t.ButtonState.GROUP),c<=t.ButtonState.REST&&u.currentState===t.ButtonState.GROUP&&(s(u),u.currentState=t.ButtonState.REST))}})(e),(function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var r=this.buttons.concat([]),s=this,a;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",a=0;a<r.length;a++)this.element.appendChild(r[a].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var l;for(l=0;l<s.buttons.length;l++)s.buttons[l].notifyGroupEnter()},leaveHandler:function(o){var l;if(!o.insideElementPressed)for(l=0;l<s.buttons.length;l++)s.buttons[l].notifyGroupExit()}})},t.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}})(e),(function(t){t.Rect=function(i,r,s,a,o){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0,this.width=typeof s=="number"?s:0,this.height=typeof a=="number"?a:0,this.degrees=typeof o=="number"?o:0,this.degrees=t.positiveModulo(this.degrees,360);var l,u;this.degrees>=270?(l=this.getTopRight(),this.x=l.x,this.y=l.y,u=this.height,this.height=this.width,this.width=u,this.degrees-=270):this.degrees>=180?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):this.degrees>=90&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,u=this.height,this.height=this.width,this.width=u,this.degrees-=90)},t.Rect.fromSummits=function(i,r,s){var a=i.distanceTo(r),o=i.distanceTo(s),l=r.minus(i),u=Math.atan(l.y/l.x);return l.x<0?u+=Math.PI:l.y<0&&(u+=2*Math.PI),new t.Rect(i.x,i.y,a,o,u/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(i){return i instanceof t.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new t.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new t.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var r=this.getBoundingBox(),s=i.getBoundingBox(),a=Math.min(r.x,s.x),o=Math.min(r.y,s.y),l=Math.max(r.x+r.width,s.x+s.width),u=Math.max(r.y+r.height,s.y+s.height);return new t.Rect(a,o,l-a,u-o)},intersection:function(i){var r=1e-10,s=[],a=this.getTopLeft();i.containsPoint(a,r)&&s.push(a);var o=this.getTopRight();i.containsPoint(o,r)&&s.push(o);var l=this.getBottomLeft();i.containsPoint(l,r)&&s.push(l);var u=this.getBottomRight();i.containsPoint(u,r)&&s.push(u);var c=i.getTopLeft();this.containsPoint(c,r)&&s.push(c);var d=i.getTopRight();this.containsPoint(d,r)&&s.push(d);var h=i.getBottomLeft();this.containsPoint(h,r)&&s.push(h);var p=i.getBottomRight();this.containsPoint(p,r)&&s.push(p);for(var g=this._getSegments(),v=i._getSegments(),y=0;y<g.length;y++)for(var b=g[y],T=0;T<v.length;T++){var x=v[T],w=A(b[0],b[1],x[0],x[1]);w&&s.push(w)}function A(G,X,te,Q){var ne=X.minus(G),oe=Q.minus(te),Z=-oe.x*ne.y+ne.x*oe.y;if(Z===0)return null;var se=(ne.x*(G.y-te.y)-ne.y*(G.x-te.x))/Z,j=(oe.x*(G.y-te.y)-oe.y*(G.x-te.x))/Z;return-r<=se&&se<=1-r&&-r<=j&&j<=1-r?new t.Point(G.x+j*ne.x,G.y+j*ne.y):null}if(s.length===0)return null;for(var R=s[0].x,_=s[0].x,D=s[0].y,H=s[0].y,P=1;P<s.length;P++){var N=s[P];N.x<R&&(R=N.x),N.x>_&&(_=N.x),N.y<D&&(D=N.y),N.y>H&&(H=N.y)}return new t.Rect(R,D,_-R,H-D)},_getSegments:function(){var i=this.getTopLeft(),r=this.getTopRight(),s=this.getBottomLeft(),a=this.getBottomRight();return[[i,r],[r,a],[a,s],[s,i]]},rotate:function(i,r){if(i=t.positiveModulo(i,360),i===0)return this.clone();r=r||this.getCenter();var s=this.getTopLeft().rotate(i,r),a=this.getTopRight().rotate(i,r),o=a.minus(s);o=o.apply(function(u){var c=1e-15;return Math.abs(u)<c?0:u});var l=Math.atan(o.y/o.x);return o.x<0?l+=Math.PI:o.y<0&&(l+=2*Math.PI),new t.Rect(s.x,s.y,this.width,this.height,l/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),r=this.getTopRight(),s=this.getBottomLeft(),a=this.getBottomRight(),o=Math.min(i.x,r.x,s.x,a.x),l=Math.max(i.x,r.x,s.x,a.x),u=Math.min(i.y,r.y,s.y,a.y),c=Math.max(i.y,r.y,s.y,a.y);return new t.Rect(o,u,l-o,c-u)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),r=Math.floor(i.x),s=Math.floor(i.y),a=Math.ceil(i.width+i.x-r),o=Math.ceil(i.height+i.y-s);return new t.Rect(r,s,a,o)},containsPoint:function(i,r){r=r||0;var s=this.getTopLeft(),a=this.getTopRight(),o=this.getBottomLeft(),l=a.minus(s),u=o.minus(s);return(i.x-s.x)*l.x+(i.y-s.y)*l.y>=-r&&(i.x-a.x)*l.x+(i.y-a.y)*l.y<=r&&(i.x-s.x)*u.x+(i.y-s.y)*u.y>=-r&&(i.x-o.x)*u.x+(i.y-o.y)*u.y<=r},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}})(e),(function(t){var i={};t.ReferenceStrip=function(h){var p=this,g=h.viewer,v=t.getElementSize(g.element),y,b,T;for(h.id||(h.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=h.id,this.element.className="referencestrip"),h=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},h,{element:this.element}),t.extend(this,h),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,b=this.element.style,b.marginTop="0px",b.marginRight="0px",b.marginBottom="0px",b.marginLeft="0px",b.left="0px",b.bottom="0px",b.border="0px",b.background="#000",b.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=g,this.tracker=new t.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:t.delegate(this,r),dragHandler:t.delegate(this,s),scrollHandler:t.delegate(this,a),enterHandler:t.delegate(this,l),leaveHandler:t.delegate(this,u),keyDownHandler:t.delegate(this,c),keyHandler:t.delegate(this,d),preProcessEventHandler:function(x){x.eventType==="wheel"&&(x.preventDefault=!0)}}),h.width&&h.height?(this.element.style.width=h.width+"px",this.element.style.height=h.height+"px",g.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):h.scroll==="horizontal"?(this.element.style.width=v.x*h.sizeRatio*g.tileSources.length+12*g.tileSources.length+"px",this.element.style.height=v.y*h.sizeRatio+"px",g.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=v.y*h.sizeRatio*g.tileSources.length+12*g.tileSources.length+"px",this.element.style.width=v.x*h.sizeRatio+"px",g.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=v.x*this.sizeRatio+8,this.panelHeight=v.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},T=0;T<g.tileSources.length;T++)y=t.makeNeutralElement("div"),y.id=this.element.id+"-"+T,y.style.width=p.panelWidth+"px",y.style.height=p.panelHeight+"px",y.style.display="inline",y.style.float="left",y.style.cssFloat="left",y.style.styleFloat="left",y.style.padding="2px",t.setElementTouchActionNone(y),t.setElementPointerEventsNone(y),this.element.appendChild(y),y.activePanel=!1,this.panels.push(y);o(this,this.scroll==="vertical"?v.y:v.x,0),this.setFocus(0)},t.ReferenceStrip.prototype={setFocus:function(h){var p=this.element.querySelector("#"+this.element.id+"-"+h),g=t.getElementSize(this.viewer.canvas),v=Number(this.element.style.width.replace("px","")),y=Number(this.element.style.height.replace("px","")),b=-Number(this.element.style.marginLeft.replace("px","")),T=-Number(this.element.style.marginTop.replace("px","")),x;this.currentSelected!==p&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=p,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(x=Number(h)*(this.panelWidth+3),x>b+g.x-this.panelWidth?(x=Math.min(x,v-g.x),this.element.style.marginLeft=-x+"px",o(this,g.x,-x)):x<b&&(x=Math.max(0,x-g.x/2),this.element.style.marginLeft=-x+"px",o(this,g.x,-x))):(x=Number(h)*(this.panelHeight+3),x>T+g.y-this.panelHeight?(x=Math.min(x,y-g.y),this.element.style.marginTop=-x+"px",o(this,g.y,-x)):x<T&&(x=Math.max(0,x-g.y/2),this.element.style.marginTop=-x+"px",o(this,g.y,-x))),this.currentPage=h,l.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var h in this.miniViewers)this.miniViewers[h].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function r(h){if(h.quick){var p;this.scroll==="horizontal"?p=Math.floor(h.position.x/(this.panelWidth+4)):p=Math.floor(h.position.y/this.panelHeight),this.viewer.goToPage(p)}this.element.focus()}function s(h){if(this.dragging=!0,this.element){var p=Number(this.element.style.marginLeft.replace("px","")),g=Number(this.element.style.marginTop.replace("px","")),v=Number(this.element.style.width.replace("px","")),y=Number(this.element.style.height.replace("px","")),b=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-h.delta.x>0?p>-(v-b.x)&&(this.element.style.marginLeft=p+h.delta.x*2+"px",o(this,b.x,p+h.delta.x*2)):-h.delta.x<0&&p<0&&(this.element.style.marginLeft=p+h.delta.x*2+"px",o(this,b.x,p+h.delta.x*2)):-h.delta.y>0?g>-(y-b.y)&&(this.element.style.marginTop=g+h.delta.y*2+"px",o(this,b.y,g+h.delta.y*2)):-h.delta.y<0&&g<0&&(this.element.style.marginTop=g+h.delta.y*2+"px",o(this,b.y,g+h.delta.y*2))}}function a(h){if(this.element){var p=Number(this.element.style.marginLeft.replace("px","")),g=Number(this.element.style.marginTop.replace("px","")),v=Number(this.element.style.width.replace("px","")),y=Number(this.element.style.height.replace("px","")),b=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?h.scroll>0?p>-(v-b.x)&&(this.element.style.marginLeft=p-h.scroll*60+"px",o(this,b.x,p-h.scroll*60)):h.scroll<0&&p<0&&(this.element.style.marginLeft=p-h.scroll*60+"px",o(this,b.x,p-h.scroll*60)):h.scroll<0?g>b.y-y&&(this.element.style.marginTop=g+h.scroll*60+"px",o(this,b.y,g+h.scroll*60)):h.scroll>0&&g<0&&(this.element.style.marginTop=g+h.scroll*60+"px",o(this,b.y,g+h.scroll*60)),h.preventDefault=!0}}function o(h,p,g){var v,y,b,T,x,w;for(h.scroll==="horizontal"?v=h.panelWidth:v=h.panelHeight,y=Math.ceil(p/v)+5,b=Math.ceil((Math.abs(g)+p)/v)+1,y=b-y,y=y<0?0:y,x=y;x<b&&x<h.panels.length;x++)if(w=h.panels[x],!w.activePanel){var A,R=h.viewer.tileSources[x];R.referenceStripThumbnailUrl?A={type:"image",url:R.referenceStripThumbnailUrl}:A=R,T=new t.Viewer({id:w.id,tileSources:[A],element:w,navigatorSizeRatio:h.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:h.viewer.loadTilesWithAjax,ajaxHeaders:h.viewer.ajaxHeaders,useCanvas:h.useCanvas}),t.setElementPointerEventsNone(T.canvas),t.setElementPointerEventsNone(T.container),T.innerTracker.setTracking(!1),T.outerTracker.setTracking(!1),h.miniViewers[w.id]=T,w.activePanel=!0}}function l(h){var p=h.eventSource.element;this.scroll==="horizontal"?p.style.marginBottom="0px":p.style.marginLeft="0px"}function u(h){var p=h.eventSource.element;this.scroll==="horizontal"?p.style.marginBottom="-"+t.getElementSize(p).y/2+"px":p.style.marginLeft="-"+t.getElementSize(p).x/2+"px"}function c(h){if(!h.ctrl&&!h.alt&&!h.meta)switch(h.keyCode){case 38:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),h.preventDefault=!0;break;case 40:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),h.preventDefault=!0;break;case 37:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),h.preventDefault=!0;break;case 39:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),h.preventDefault=!0;break;default:h.preventDefault=!1;break}else h.preventDefault=!1}function d(h){if(!h.ctrl&&!h.alt&&!h.meta)switch(h.keyCode){case 61:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),h.preventDefault=!0;break;case 45:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),h.preventDefault=!0;break;case 48:case 119:case 87:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),h.preventDefault=!0;break;case 115:case 83:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),h.preventDefault=!0;break;case 97:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),h.preventDefault=!0;break;case 100:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),h.preventDefault=!0;break;default:h.preventDefault=!1;break}else h.preventDefault=!1}})(e),(function(t){t.DisplayRect=function(i,r,s,a,o,l){t.Rect.apply(this,[i,r,s,a]),this.minLevel=o,this.maxLevel=l},t.extend(t.DisplayRect.prototype,t.Rect.prototype)})(e),(function(t){t.Spring=function(r){var s=arguments;typeof r!="object"&&(r={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),t.console.assert(typeof r.springStiffness=="number"&&r.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof r.animationTime=="number"&&r.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),r.exponential&&(this._exponential=!0,delete r.exponential),t.extend(!0,this,r),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=r,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=r,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(r){this.start.value+=r,this.target.value+=r,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(r){this._exponential=r,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var r,s;this._exponential?(r=this.start._logValue,s=this.target._logValue):(r=this.start.value,s=this.target.value);var a=this.current.time>=this.target.time?s:r+(s-r)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(a):this.current.value=a,o!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(r,s){return(1-Math.exp(r*-s))/(1-Math.exp(-r))}})(e),(function(t){t.ImageJob=function(r){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},r),this.data=null,this.userData={},this.errorMsg=null},t.ImageJob.prototype={start:function(){this.tries++;var r=this,s=this.abort;this.jobId=window.setTimeout(function(){r.finish(null,null,"Image load exceeded timeout ("+r.timeout+" ms)")},this.timeout),this.abort=function(){r.source.downloadTileAbort(r),typeof s=="function"&&s()},this.source.downloadTileStart(this)},finish:function(r,s,a){this.data=r,this.request=s,this.errorMsg=a,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(r){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},r)},t.ImageLoader.prototype={addJob:function(r){if(!r.source){t.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var s=t.TileSource.prototype;r.source={downloadTileStart:s.downloadTileStart,downloadTileAbort:s.downloadTileAbort}}var a=this,o=function(c){i(a,c,r.callback)},l={src:r.src,tile:r.tile||{},source:r.source,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.loadWithAjax?r.ajaxHeaders:null,crossOriginPolicy:r.crossOriginPolicy,ajaxWithCredentials:r.ajaxWithCredentials,postData:r.postData,callback:o,abort:r.abort,timeout:this.timeout},u=new t.ImageJob(l);!this.jobLimit||this.jobsInProgress<this.jobLimit?(u.start(),this.jobsInProgress++):this.jobQueue.push(u)},clear:function(){for(var r=0;r<this.jobQueue.length;r++){var s=this.jobQueue[r];typeof s.abort=="function"&&s.abort()}this.jobQueue=[]}};function i(r,s,a){s.errorMsg!==""&&(s.data===null||s.data===void 0)&&s.tries<1+r.tileRetryMax&&r.failedTiles.push(s);var o;r.jobsInProgress--,(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.jobQueue.length>0&&(o=r.jobQueue.shift(),o.start(),r.jobsInProgress++),r.tileRetryMax>0&&r.jobQueue.length===0&&(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.failedTiles.length>0&&(o=r.failedTiles.shift(),setTimeout(function(){o.start()},r.tileRetryDelay),r.jobsInProgress++),a(s.data,s.errorMsg,s.request)}})(e),(function(t){t.Tile=function(i,r,s,a,o,l,u,c,d,h,p,g){this.level=i,this.x=r,this.y=s,this.bounds=a,this.sourceBounds=h,this.exists=o,this._url=l,this.postData=p,this.context2D=u,this.loadWithAjax=c,this.ajaxHeaders=d,g===void 0&&(t.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),g=t.TileSource.prototype.getTileHashKey(i,r,s,l,d,p)),this.cacheKey=g,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){var r=this.getImage();if(!r)return;this.element=t.makeNeutralElement("div"),this.imgElement=r.cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"}this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),t.setElementOpacity(this.element,this.opacity)},get image(){return t.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return t.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord.getRenderedContext()},drawCanvas:function(i,r,s,a,o,l){var u=this.position.times(t.pixelDensityRatio),c=this.size.times(t.pixelDensityRatio),d;if(!this.context2D&&!this.cacheImageRecord){t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(d=this.getCanvasContext(),!this.loaded||!d){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof s=="number"&&s!==1&&(u=u.times(s),c=c.times(s)),a instanceof t.Point&&(u=u.plus(a)),i.globalAlpha===1&&this.hasTransparency&&(o&&(u.x=Math.round(u.x),u.y=Math.round(u.y),c.x=Math.round(c.x),c.y=Math.round(c.y)),i.clearRect(u.x,u.y,c.x,c.y)),r({context:i,tile:this,rendered:d});var h,p;this.sourceBounds?(h=Math.min(this.sourceBounds.width,d.canvas.width),p=Math.min(this.sourceBounds.height,d.canvas.height)):(h=d.canvas.width,p=d.canvas.height),i.translate(u.x+c.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(d.canvas,0,0,h,p,-c.x/2,u.y,c.x,c.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,r,s){var a=Math.max(1,Math.ceil((s.x-r.x)/2)),o=Math.max(1,Math.ceil((s.y-r.y)/2));return new t.Point(a,o).minus(this.position.times(t.pixelDensityRatio).times(i||1).apply(function(l){return l%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}})(e),(function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,r,s){var a;t.isPlainObject(i)?a=i:a={element:i,location:r,placement:s},this.element=a.element,this.style=a.element.style,this._init(a)},t.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?t.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,r){var s=t.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=r.x/2:s.isRight&&(i.x-=r.x),s.isVerticallyCentered?i.y-=r.y/2:s.isBottom&&(i.y-=r.y))},destroy:function(){var i=this.element,r=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(r.display="none",document.body.appendChild(i))),this.onDraw=null,r.top="",r.left="",r.position="",this.width!==null&&(r.width=""),this.height!==null&&(r.height="");var s=t.getCssPropertyWithVendorPrefix("transformOrigin"),a=t.getCssPropertyWithVendorPrefix("transform");s&&a&&(r[s]="",r[a]="")},drawHTML:function(i,r){var s=this.element;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=t.getElementSize(s));var a=this._getOverlayPositionAndSize(r),o=a.position,l=this.size=a.size,u=a.rotate;if(this.onDraw)this.onDraw(o,l,this.element);else{var c=this.style;c.left=o.x+"px",c.top=o.y+"px",this.width!==null&&(c.width=l.x+"px"),this.height!==null&&(c.height=l.y+"px");var d=t.getCssPropertyWithVendorPrefix("transformOrigin"),h=t.getCssPropertyWithVendorPrefix("transform");d&&h&&(u?(c[d]=this._getTransformOrigin(),c[h]="rotate("+u+"deg)"):(c[d]="",c[h]="")),c.display="block"}},_getOverlayPositionAndSize:function(i){var r=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(r,s);var a=0;if(i.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var o=new t.Rect(r.x,r.y,s.x,s.y),l=this._getBoundingBox(o,i.getRotation(!0));r=l.getTopLeft(),s=l.getSize()}else a=i.getRotation(!0);return{position:r,size:s,rotate:a}},_getSizeInPixels:function(i){var r=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var a=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(r=a.x),this.height!==null&&(s=a.y)}if(this.checkResize&&(this.width===null||this.height===null)){var o=this.size=t.getElementSize(this.element);this.width===null&&(r=o.x),this.height===null&&(s=o.y)}return new t.Point(r,s)},_getBoundingBox:function(i,r){var s=this._getPlacementPoint(i);return i.rotate(r,s).getBoundingBox()},_getPlacementPoint:function(i){var r=new t.Point(i.x,i.y),s=t.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?r.x+=i.width/2:s.isRight&&(r.x+=i.width),s.isVerticallyCentered?r.y+=i.height/2:s.isBottom&&(r.y+=i.height)),r},_getTransformOrigin:function(){var i="",r=t.Placement.properties[this.placement];return r&&(r.isLeft?i="left":r.isRight&&(i="right"),r.isTop?i+=" top":r.isBottom&&(i+=" bottom")),i},update:function(i,r){var s=t.isPlainObject(i)?i:{location:i,placement:r};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var r=this.width,s=this.height;if(r===null||s===null){var a=i.deltaPointsFromPixelsNoRotate(this.size,!0);r===null&&(r=a.x),s===null&&(s=a.y)}var o=this.location.clone();return this.adjust(o,new t.Point(r,s)),this._adjustBoundsForRotation(i,new t.Rect(o.x,o.y,r,s))},_adjustBoundsForRotation:function(i,r){if(!i||i.getRotation(!0)===0||this.rotationMode===t.OverlayRotationMode.EXACT)return r;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return r;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new t.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return r.rotate(-i.getRotation(!0),this._getPlacementPoint(r))}}})(e),(function(t){t.Drawer=function(i){t.console.assert(i.viewer,"[Drawer] options.viewer is required");var r=arguments;if(t.isPlainObject(i)||(i={source:r[0],viewport:r[1],element:r[2]}),t.console.assert(i.viewport,"[Drawer] options.viewport is required"),t.console.assert(i.element,"[Drawer] options.element is required"),i.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,i.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=t.getElement(i.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var s=this._calculateCanvasSize();this.canvas.width=s.x,this.canvas.height=s.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),t.setElementPointerEventsNone(this.canvas),t.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(i,r,s,a){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,r,s,a),this},updateOverlay:function(i,r,s){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,r,s),this},removeOverlay:function(i){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var r=this.viewport.pixelFromPointNoRotate(i,!0);return new t.Point(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio)},clipWithPolygons:function(i,r){if(this.useCanvas){var s=this._getContext(r);s.beginPath(),i.forEach(function(a){a.forEach(function(o,l){s[l===0?"moveTo":"lineTo"](o.x,o.y)})}),s.clip()}},setOpacity:function(i){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var r=this.viewer.world,s=0;s<r.getItemCount();s++)r.getItemAt(s).setOpacity(i);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,r=0,s=0;s<i.getItemCount();s++){var a=i.getItemAt(s).getOpacity();a>r&&(r=a)}return r},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var r=this._calculateSketchCanvasSize();this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,r){if(this.useCanvas){var s=this._getContext(i);if(r)s.clearRect(r.x,r.y,r.width,r.height);else{var a=s.canvas;s.clearRect(0,0,a.width,a.height)}}},viewportToDrawerRectangle:function(i){var r=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new t.Rect(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio,s.x*t.pixelDensityRatio,s.y*t.pixelDensityRatio)},drawTile:function(i,r,s,a,o,l,u){if(t.console.assert(i,"[Drawer.drawTile] tile is required"),t.console.assert(r,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var c=this._getContext(s);a=a||1,i.drawCanvas(c,r,a,o,l,u)}else i.drawHTML(this.canvas)},_getContext:function(i){var r=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var s=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var a=this;this.viewer.addHandler("rotate",function o(){if(a.viewport.getRotation()!==0){a.viewer.removeHandler("rotate",o);var l=a._calculateSketchCanvasSize();a.sketchCanvas.width=l.x,a.sketchCanvas.height=l.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}r=this.sketchContext}return r},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,r){if(this.useCanvas){var s=this._getContext(r);s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip()}},drawRectangle:function(i,r,s){if(this.useCanvas){var a=this._getContext(s);a.save(),a.fillStyle=r,a.fillRect(i.x,i.y,i.width,i.height),a.restore()}},blendSketch:function(i,r,s,a){var o=i;if(t.isPlainObject(o)||(o={opacity:i,scale:r,translate:s,compositeOperation:a}),!(!this.useCanvas||!this.sketchCanvas)){i=o.opacity,a=o.compositeOperation;var l=o.bounds;if(this.context.save(),this.context.globalAlpha=i,a&&(this.context.globalCompositeOperation=a),l)l.x<0&&(l.width+=l.x,l.x=0),l.x+l.width>this.canvas.width&&(l.width=this.canvas.width-l.x),l.y<0&&(l.height+=l.y,l.y=0),l.y+l.height>this.canvas.height&&(l.height=this.canvas.height-l.y),this.context.drawImage(this.sketchCanvas,l.x,l.y,l.width,l.height,l.x,l.y,l.width,l.height);else{r=o.scale||1,s=o.translate;var u=s instanceof t.Point?s:new t.Point(0,0),c=0,d=0;if(s){var h=this.sketchCanvas.width-this.canvas.width,p=this.sketchCanvas.height-this.canvas.height;c=Math.round(h/2),d=Math.round(p/2)}this.context.drawImage(this.sketchCanvas,u.x-c*r,u.y-d*r,(this.canvas.width+2*c)*r,(this.canvas.height+2*d)*r,-c,-d,this.canvas.width+2*c,this.canvas.height+2*d)}this.context.restore()}},drawDebugInfo:function(i,r,s,a){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(a)%this.debugGridColor.length,l=this.context;l.save(),l.lineWidth=2*t.pixelDensityRatio,l.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",l.strokeStyle=this.debugGridColor[o],l.fillStyle=this.debugGridColor[o],this.viewport.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:this.viewport.getRotation(!0)}),a.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:a.getRotation(!0),point:a.viewport.pixelFromPointNoRotate(a._getRotationPoint(!0),!0)}),a.viewport.getRotation(!0)%360===0&&a.getRotation(!0)%360===0&&a._drawer.viewer.viewport.getFlip()&&a._drawer._flip(),l.strokeRect(i.position.x*t.pixelDensityRatio,i.position.y*t.pixelDensityRatio,i.size.x*t.pixelDensityRatio,i.size.y*t.pixelDensityRatio);var u=(i.position.x+i.size.x/2)*t.pixelDensityRatio,c=(i.position.y+i.size.y/2)*t.pixelDensityRatio;l.translate(u,c),l.rotate(Math.PI/180*-this.viewport.getRotation(!0)),l.translate(-u,-c),i.x===0&&i.y===0&&(l.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*t.pixelDensityRatio,(i.position.y-30)*t.pixelDensityRatio),l.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*t.pixelDensityRatio,(i.position.y-20)*t.pixelDensityRatio)),l.fillText("Level: "+i.level,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+20)*t.pixelDensityRatio),l.fillText("Column: "+i.x,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+30)*t.pixelDensityRatio),l.fillText("Row: "+i.y,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+40)*t.pixelDensityRatio),l.fillText("Order: "+s+" of "+r,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+50)*t.pixelDensityRatio),l.fillText("Size: "+i.size.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+60)*t.pixelDensityRatio),l.fillText("Position: "+i.position.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.viewport.getRotation(!0)%360===0&&a.getRotation(!0)%360===0&&a._drawer.viewer.viewport.getFlip()&&a._drawer._flip(),l.restore()}},debugRect:function(i){if(this.useCanvas){var r=this.context;r.save(),r.lineWidth=2*t.pixelDensityRatio,r.strokeStyle=this.debugGridColor[0],r.fillStyle=this.debugGridColor[0],r.strokeRect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,i.width*t.pixelDensityRatio,i.height*t.pixelDensityRatio),r.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var r=this._getContext(i).canvas;return new t.Point(r.width,r.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var r=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.save(),s.translate(r.x,r.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-i.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*i.degrees),s.translate(-r.x,-r.y)},_flip:function(i){i=i||{};var r=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.translate(r.x,0),s.scale(-1,1),s.translate(-r.x,0)},_restoreRotationChanges:function(i){var r=this._getContext(i);r.restore()},_calculateCanvasSize:function(){var i=t.pixelDensityRatio,r=this.viewport.getContainerSize();return{x:Math.round(r.x*i),y:Math.round(r.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var r=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:r,y:r}}}})(e),(function(t){t.Viewport=function(i){var r=arguments;r.length&&r[0]instanceof t.Point&&(i={containerSize:r[0],contentSize:r[1],config:r[2]}),i.config&&(t.extend(!0,i,i.config),delete i.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:t.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new t.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={get degrees(){return t.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){t.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return t.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(i instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,r){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,r)},_setContentBounds:function(i,r){t.console.assert(i,"[Viewport._setContentBounds] bounds is required"),t.console.assert(i instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(r),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(r),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:r,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),r;return this.homeFillsViewer?r=i>=1?i:1:r=i>=1?1:i,r/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),r=1/this.getHomeZoom(),s=r/this.getAspectRatio();return new t.Rect(i.x-r/2,i.y-s/2,r,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),r=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return r},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(i){t.console.assert(t.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var r=this.getCenter(i),s=1/this.getZoom(i),a=s/this.getAspectRatio();return new t.Rect(r.x-s/2,r.y-a/2,s,a)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var r=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return r.x-=this._margins.left/s,r.y-=this._margins.top/s,r.width+=(this._margins.left+this._margins.right)/s,r.height+=(this._margins.top+this._margins.bottom)/s,r},getCenter:function(i){var r=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),a,o,l,u,c,d,h,p;return i?r:this.zoomPoint?(a=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),l=1/o,u=l/this.getAspectRatio(),c=new t.Rect(r.x-l/2,r.y-u/2,l,u),d=this._pixelFromPoint(this.zoomPoint,c),h=d.minus(a).rotate(-this.getRotation(!0)),p=h.divide(this._containerInnerSize.x*o),s.plus(p)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var r=this.viewportToViewerElementRectangle(i).getBoundingBox(),s=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),a=!1,o=!1;if(!this.wrapHorizontal){var l=r.x+r.width,u=s.x+s.width,c,d,h;r.width>s.width?c=this.visibilityRatio*s.width:c=this.visibilityRatio*r.width,d=s.x-l+c,h=u-r.x-c,c>s.width?(r.x+=(d+h)/2,a=!0):h<0?(r.x+=h,a=!0):d>0&&(r.x+=d,a=!0)}if(!this.wrapVertical){var p=r.y+r.height,g=s.y+s.height,v,y,b;r.height>s.height?v=this.visibilityRatio*s.height:v=this.visibilityRatio*r.height,y=s.y-p+v,b=g-r.y-v,v>s.height?(r.y+=(y+b)/2,o=!0):b<0?(r.y+=b,o=!0):y>0&&(r.y+=y,o=!0)}var T=a||o,x=T?this.viewerElementToViewportRectangle(r):i.clone();return x.xConstrained=a,x.yConstrained=o,x.constraintApplied=T,x},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var r=this.getZoom(),s=this._applyZoomConstraints(r);r!==s&&this.zoomTo(s,this.zoomPoint,i);var a=this.getConstrainedBounds(!1);return a.constraintApplied&&(this.fitBounds(a,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,r){r=r||{};var s=r.immediately||!1,a=r.constraints||!1,o=this.getAspectRatio(),l=i.getCenter(),u=new t.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();u.getAspectRatio()>=o?u.height=u.width/o:u.width=u.height*o,u.x=l.x-u.width/2,u.y=l.y-u.height/2;var c=1/u.width;if(s)return this.panTo(l,!0),this.zoomTo(c,null,!0),a&&this.applyConstraints(!0),this;var d=this.getCenter(!0),h=this.getZoom(!0);this.panTo(d,!0),this.zoomTo(h,null,!0);var p=this.getBounds(),g=this.getZoom();if(g===0||Math.abs(c/g-1)<1e-8)return this.zoomTo(c,null,!0),this.panTo(l,s),a&&this.applyConstraints(!1),this;if(a){this.panTo(l,!1),c=this._applyZoomConstraints(c),this.zoomTo(c,null,!1);var v=this.getConstrainedBounds();this.panTo(d,!0),this.zoomTo(h,null,!0),this.fitBounds(v)}else{var y=u.rotate(-this.getRotation()),b=y.getTopLeft().times(c).minus(p.getTopLeft().times(g)).divide(c-g);this.zoomTo(c,b,s)}return this},fitBounds:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!1})},fitBoundsWithConstraints:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!0})},fitVertically:function(i){var r=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(r,i)},fitHorizontally:function(i){var r=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(r,i)},getConstrainedBounds:function(i){var r,s;return r=this.getBounds(i),s=this._applyBoundaryConstraints(r),s},panBy:function(i,r){var s=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),r)},panTo:function(i,r){return r?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:r}),this},zoomBy:function(i,r,s){return this.zoomTo(this.zoomSpring.target.value*i,r,s)},zoomTo:function(i,r,s){var a=this;return this.zoomPoint=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,s?this._adjustCenterSpringsForZoomPoint(function(){a.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:r,immediately:s}),this},setRotation:function(i,r){return this.rotateTo(i,null,r)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,r,s){return this.rotateTo(i,r,s)},rotateTo:function(i,r,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,s)if(this.rotationPivot){var a=i-this._oldDegrees;if(!a)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var o=t.positiveModulo(this.degreesSpring.current.value,360),l=t.positiveModulo(i,360),u=l-o;u>180?l-=360:u<-180&&(l+=360);var c=o-l;this.degreesSpring.resetTo(i+c),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,r,s){return this.rotateTo(this.degreesSpring.target.value+i,r,s)},resize:function(i,r){var s=this.getBoundsNoRotate(),a=s,o;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),r&&(o=i.x/this.containerSize.x,a.width=s.width*o,a.height=a.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:r});var l=this.fitBounds(a,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:r}),l},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var r=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,r},_rotateAboutPivot:function(i){var r=i===!0,s=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(s.x),this.centerSpringY.shiftBy(s.y),r?this.degreesSpring.update():this.degreesSpring.resetTo(i);var a=this.degreesSpring.current.value-this._oldDegrees,o=s.rotate(a*-1).times(-1);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var r=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),a=s.minus(r),o=this.deltaPointsFromPixels(a,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,r){return i.times(this._containerInnerSize.x*this.getZoom(r))},deltaPixelsFromPoints:function(i,r){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(r)),r)},deltaPointsFromPixelsNoRotate:function(i,r){return i.divide(this._containerInnerSize.x*this.getZoom(r))},deltaPointsFromPixels:function(i,r){return this.deltaPointsFromPixelsNoRotate(i,r).rotate(-this.getRotation(r))},pixelFromPointNoRotate:function(i,r){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(r))},pixelFromPoint:function(i,r){return this._pixelFromPoint(i,this.getBoundsNoRotate(r))},_pixelFromPointNoRotate:function(i,r){return i.minus(r.getTopLeft()).times(this._containerInnerSize.x/r.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,r){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),r)},pointFromPixelNoRotate:function(i,r){var s=this.getBoundsNoRotate(r);return i.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,r){return this.pointFromPixelNoRotate(i,r).rotate(-this.getRotation(r),this.getCenter(r))},_viewportToImageDelta:function(i,r){var s=this._contentBoundsNoRotate.width;return new t.Point(i*this._contentSizeNoRotate.x/s,r*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,r){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var a=this.viewer.world.getItemAt(0);return a.viewportToImageCoordinates(i,r,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,r-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,r){var s=this._contentBoundsNoRotate.width;return new t.Point(i/this._contentSizeNoRotate.x*s,r/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,r){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var a=this.viewer.world.getItemAt(0);return a.imageToViewportCoordinates(i,r,!0)}}var o=this._imageToViewportDelta(i,r);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(i,r,s,a){var o=i;if(o instanceof t.Rect||(o=new t.Rect(i,r,s,a)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(l===1){var u=this.viewer.world.getItemAt(0);return u.imageToViewportRectangle(i,r,s,a,!0)}}var c=this.imageToViewportCoordinates(o.x,o.y),d=this._imageToViewportDelta(o.width,o.height);return new t.Rect(c.x,c.y,d.x,d.y,o.degrees)},viewportToImageRectangle:function(i,r,s,a){var o=i;if(o instanceof t.Rect||(o=new t.Rect(i,r,s,a)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(l===1){var u=this.viewer.world.getItemAt(0);return u.viewportToImageRectangle(i,r,s,a,!0)}}var c=this.viewportToImageCoordinates(o.x,o.y),d=this._viewportToImageDelta(o.width,o.height);return new t.Rect(c.x,c.y,d.x,d.y,o.degrees)},viewerElementToImageCoordinates:function(i){var r=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(i){var r=this.imageToViewportCoordinates(i);return this.pixelFromPoint(r,!0)},windowToImageCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var r=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var r=this.imageToViewerElementCoordinates(i);return r.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return t.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return t.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var r=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(r)},viewportToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var r=this.viewportToViewerElementCoordinates(i);return r.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var a=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,u=o/a*l;return i*u},imageToViewportZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var a=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,u=a/o/l;return i*u},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}})(e),(function(t){t.TiledImage=function(o){var l=this;t.console.assert(o.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(o.drawer,"[TiledImage] options.drawer is required"),t.console.assert(o.viewer,"[TiledImage] options.viewer is required"),t.console.assert(o.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(o.source,"[TiledImage] options.source is required"),t.console.assert(!o.clip||o.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=o.tileCache,delete o.tileCache,this._drawer=o.drawer,delete o.drawer,this._imageLoader=o.imageLoader,delete o.imageLoader,o.clip instanceof t.Rect&&(this._clip=o.clip.clone()),delete o.clip;var u=o.x||0;delete o.x;var c=o.y||0;delete o.y,this.normHeight=o.source.dimensions.y/o.source.dimensions.x,this.contentAspectX=o.source.dimensions.x/o.source.dimensions.y;var d=1;o.width?(d=o.width,delete o.width,o.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete o.height)):o.height&&(d=o.height/this.normHeight,delete o.height);var h=o.fitBounds;delete o.fitBounds;var p=o.fitBoundsPlacement||e.Placement.CENTER;delete o.fitBoundsPlacement;var g=o.degrees||0;delete o.degrees;var v=o.ajaxHeaders;delete o.ajaxHeaders,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:t.DEFAULT_SETTINGS.subPixelRoundingForTransparency},o),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:d,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:g,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),h&&this.fitBounds(h,p,!0),this._drawingHandler=function(y){l.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:l},y))},this._ownAjaxHeaders={},this.setAjaxHeaders(v,!1)},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(o){o!==this._fullyLoaded&&(this._fullyLoaded=o,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var o=this._xSpring.update(),l=this._ySpring.update(),u=this._scaleSpring.update(),c=this._degreesSpring.update();return o||l||u||c?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(o){return this.getBoundsNoRotate(o).rotate(this.getRotation(o),this._getRotationPoint(o))},getBoundsNoRotate:function(o){return o?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(o){var l=this.getBoundsNoRotate(o);if(this._clip){var u=o?this._worldWidthCurrent:this._worldWidthTarget,c=u/this.source.dimensions.x,d=this._clip.times(c);l=new t.Rect(l.x+d.x,l.y+d.y,d.width,d.height)}return l.rotate(this.getRotation(o),this._getRotationPoint(o))},getTileBounds:function(o,l,u){var c=this.source.getNumTiles(o),d=(c.x+l%c.x)%c.x,h=(c.y+u%c.y)%c.y,p=this.source.getTileBounds(o,d,h);return this.getFlip()&&(p.x=1-p.x-p.width),p.x+=(l-d)/c.x,p.y+=this._worldHeightCurrent/this._worldWidthCurrent*((u-h)/c.y),p},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var o=this.imageToWindowCoordinates(new t.Point(0,0)),l=this.imageToWindowCoordinates(this.getContentSize());return new t.Point(l.x-o.x,l.y-o.y)},_viewportToImageDelta:function(o,l,u){var c=u?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(o*(this.source.dimensions.x/c),l*(this.source.dimensions.y*this.contentAspectX/c))},viewportToImageCoordinates:function(o,l,u){var c;return o instanceof t.Point?(u=l,c=o):c=new t.Point(o,l),c=c.rotate(-this.getRotation(u),this._getRotationPoint(u)),u?this._viewportToImageDelta(c.x-this._xSpring.current.value,c.y-this._ySpring.current.value):this._viewportToImageDelta(c.x-this._xSpring.target.value,c.y-this._ySpring.target.value)},_imageToViewportDelta:function(o,l,u){var c=u?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(o/this.source.dimensions.x*c,l/this.source.dimensions.y/this.contentAspectX*c)},imageToViewportCoordinates:function(o,l,u){o instanceof t.Point&&(u=l,l=o.y,o=o.x);var c=this._imageToViewportDelta(o,l);return u?(c.x+=this._xSpring.current.value,c.y+=this._ySpring.current.value):(c.x+=this._xSpring.target.value,c.y+=this._ySpring.target.value),c.rotate(this.getRotation(u),this._getRotationPoint(u))},imageToViewportRectangle:function(o,l,u,c,d){var h=o;h instanceof t.Rect?d=l:h=new t.Rect(o,l,u,c);var p=this.imageToViewportCoordinates(h.getTopLeft(),d),g=this._imageToViewportDelta(h.width,h.height,d);return new t.Rect(p.x,p.y,g.x,g.y,h.degrees+this.getRotation(d))},viewportToImageRectangle:function(o,l,u,c,d){var h=o;o instanceof t.Rect?d=l:h=new t.Rect(o,l,u,c);var p=this.viewportToImageCoordinates(h.getTopLeft(),d),g=this._viewportToImageDelta(h.width,h.height,d);return new t.Rect(p.x,p.y,g.x,g.y,h.degrees-this.getRotation(d))},viewerElementToImageCoordinates:function(o){var l=this.viewport.pointFromPixel(o,!0);return this.viewportToImageCoordinates(l)},imageToViewerElementCoordinates:function(o){var l=this.imageToViewportCoordinates(o);return this.viewport.pixelFromPoint(l,!0)},windowToImageCoordinates:function(o){var l=o.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(l)},imageToWindowCoordinates:function(o){var l=this.imageToViewerElementCoordinates(o);return l.plus(e.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(o){var l=this._scaleSpring.current.value;return o=o.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((o.x-this._xSpring.current.value)/l,(o.y-this._ySpring.current.value)/l,o.width/l,o.height/l,o.degrees)},viewportToImageZoom:function(o){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return l*o},imageToViewportZoom:function(o){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return o/l},setPosition:function(o,l){var u=this._xSpring.target.value===o.x&&this._ySpring.target.value===o.y;if(l){if(u&&this._xSpring.current.value===o.x&&this._ySpring.current.value===o.y)return;this._xSpring.resetTo(o.x),this._ySpring.resetTo(o.y),this._needsDraw=!0}else{if(u)return;this._xSpring.springTo(o.x),this._ySpring.springTo(o.y),this._needsDraw=!0}u||this._raiseBoundsChange()},setWidth:function(o,l){this._setScale(o,l)},setHeight:function(o,l){this._setScale(o/this.normHeight,l)},setCroppingPolygons:function(o){var l=function(c){return c instanceof t.Point||typeof c.x=="number"&&typeof c.y=="number"},u=function(c){return c.map(function(d){try{if(l(d))return{x:d.x,y:d.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(o))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=o.map(function(c){return u(c)})}catch(c){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(c),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(o,l,u){l=l||t.Placement.CENTER;var c=t.Placement.properties[l],d=this.contentAspectX,h=0,p=0,g=1,v=1;if(this._clip&&(d=this._clip.getAspectRatio(),g=this._clip.width/this.source.dimensions.x,v=this._clip.height/this.source.dimensions.y,o.getAspectRatio()>d?(h=this._clip.x/this._clip.height*o.height,p=this._clip.y/this._clip.height*o.height):(h=this._clip.x/this._clip.width*o.width,p=this._clip.y/this._clip.width*o.width)),o.getAspectRatio()>d){var y=o.height/v,b=0;c.isHorizontallyCentered?b=(o.width-o.height*d)/2:c.isRight&&(b=o.width-o.height*d),this.setPosition(new t.Point(o.x-h+b,o.y-p),u),this.setHeight(y,u)}else{var T=o.width/g,x=0;c.isVerticallyCentered?x=(o.height-o.width/d)/2:c.isBottom&&(x=o.height-o.width/d),this.setPosition(new t.Point(o.x-h,o.y-p+x),u),this.setWidth(T,u)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(o){t.console.assert(!o||o instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),o instanceof t.Rect?this._clip=o.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(o){this.flipped=!!o,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(o){o!==this.opacity&&(this.opacity=o,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(o){this._preload=!!o,this._needsDraw=!0},getRotation:function(o){return o?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(o,l){this._degreesSpring.target.value===o&&this._degreesSpring.isAtTargetValue()||(l?this._degreesSpring.resetTo(o):this._degreesSpring.springTo(o),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(o){return this.getBoundsNoRotate(o).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(o){o!==this.compositeOperation&&(this.compositeOperation=o,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},setAjaxHeaders:function(o,l){if(o===null&&(o={}),!t.isPlainObject(o)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=o,this._updateAjaxHeaders(l)},_updateAjaxHeaders:function(o){if(o===void 0&&(o=!0),t.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=t.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,o){var l,u,c,d;for(var h in this.tilesMatrix){l=this.source.getNumTiles(h);for(var p in this.tilesMatrix[h]){u=(l.x+p%l.x)%l.x;for(var g in this.tilesMatrix[h][p])if(c=(l.y+g%l.y)%l.y,d=this.tilesMatrix[h][p][g],d.loadWithAjax=this.loadTilesWithAjax,d.loadWithAjax){var v=this.source.getTileAjaxHeaders(h,u,c);d.ajaxHeaders=t.extend({},this.ajaxHeaders,v)}else d.ajaxHeaders=null}}for(var y=0;y<this._imageLoader.jobQueue.length;y++){var b=this._imageLoader.jobQueue[y];b.loadWithAjax=b.tile.loadWithAjax,b.ajaxHeaders=b.tile.loadWithAjax?b.tile.ajaxHeaders:null}}},_setScale:function(o,l){var u=this._scaleSpring.target.value===o;if(l){if(u&&this._scaleSpring.current.value===o)return;this._scaleSpring.resetTo(o),this._updateForScale(),this._needsDraw=!0}else{if(u)return;this._scaleSpring.springTo(o),this._updateForScale(),this._needsDraw=!0}u||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var o=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),l=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,u=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(l/this.minPixelRatio)/Math.log(2))));return u=Math.max(u,this.source.minLevel||0),o=Math.min(o,u),{lowestLevel:o,highestLevel:u}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var o=this.lastDrawn.pop();o.beingDrawn=!1}var l=this.viewport,u=this._viewportToTiledImageRectangle(l.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var c=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(u=u.intersection(c),u===null)return}for(var d=this._getLevelsInterval(),h=d.lowestLevel,p=d.highestLevel,g=null,v=!1,y=t.now(),b=p;b>=h;b--){var T=!1,x=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(b),!0).x*this._scaleSpring.current.value;if(b===h||!v&&x>=this.minPixelRatio)T=!0,v=!0;else if(!v)continue;var w=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(b),!1).x*this._scaleSpring.current.value,A=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,R=this.immediateRender?1:A,_=Math.min(1,(x-.5)/.5),D=R/Math.abs(R-w);if(g=this._updateLevel(v,T,b,_,D,u,y,g),this._providesCoverage(this.coverage,b))break}this._drawTiles(this.lastDrawn),g&&!g.context2D?(this._loadTile(g,y),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(o,l,u){var c,d;this.wrapHorizontal?(c=t.positiveModulo(l.x,1),d=t.positiveModulo(u.x,1)):(c=Math.max(0,l.x),d=Math.min(1,u.x));var h,p,g=1/this.source.aspectRatio;this.wrapVertical?(h=t.positiveModulo(l.y,g),p=t.positiveModulo(u.y,g)):(h=Math.max(0,l.y),p=Math.min(g,u.y));var v=this.source.getTileAtPoint(o,new t.Point(c,h)),y=this.source.getTileAtPoint(o,new t.Point(d,p)),b=this.source.getNumTiles(o);return this.wrapHorizontal&&(v.x+=b.x*Math.floor(l.x),y.x+=b.x*Math.floor(u.x)),this.wrapVertical&&(v.y+=b.y*Math.floor(l.y/g),y.y+=b.y*Math.floor(u.y/g)),{topLeft:v,bottomRight:y}},_updateLevel:function(o,l,u,c,d,h,p,g){var v=h.getBoundingBox().getTopLeft(),y=h.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:o,level:u,opacity:c,visibility:d,drawArea:h,topleft:v,bottomright:y,currenttime:p,best:g}),this._resetCoverage(this.coverage,u),this._resetCoverage(this.loadingCoverage,u);var b=this._getCornerTiles(u,v,y),T=b.topLeft,x=b.bottomRight,w=this.source.getNumTiles(u),A=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(x.x+=1,this.wrapHorizontal||(x.x=Math.min(x.x,w.x-1)));for(var R=T.x;R<=x.x;R++)for(var _=T.y;_<=x.y;_++){var D;if(this.getFlip()){var H=(w.x+R%w.x)%w.x;D=R+w.x-H-H-1}else D=R;h.intersection(this.getTileBounds(u,D,_))!==null&&(g=this._updateTile(l,o,D,_,u,c,d,A,w,p,g))}return g},_updateTile:function(o,l,u,c,d,h,p,g,v,y,b){var T=this._getTile(u,c,d,y,v,this._worldWidthCurrent,this._worldHeightCurrent),x=l;this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:T}),this._setCoverage(this.coverage,d,u,c,!1);var w=T.loaded||T.loading||this._isCovered(this.loadingCoverage,d,u,c);if(this._setCoverage(this.loadingCoverage,d,u,c,w),!T.exists||(o&&!x&&(this._isCovered(this.coverage,d,u,c)?this._setCoverage(this.coverage,d,u,c,!0):x=!0),!x))return b;if(this._positionTile(T,this.source.tileOverlap,this.viewport,g,p),!T.loaded)if(T.context2D)this._setTileLoaded(T);else{var A=this._tileCache.getImageRecord(T.cacheKey);A&&this._setTileLoaded(T,A.getData())}if(T.loaded){var R=this._blendTile(T,u,c,d,h,y);R&&(this._needsDraw=!0)}else T.loading?this._tilesLoading++:w||(b=this._compareTiles(b,T));return b},_getTile:function(o,l,u,c,d,h,p){var g,v,y,b,T,x,w,A,R,_,D=this.tilesMatrix,H=this.source;return D[u]||(D[u]={}),D[u][o]||(D[u][o]={}),(!D[u][o][l]||!D[u][o][l].flipped!=!this.flipped)&&(g=(d.x+o%d.x)%d.x,v=(d.y+l%d.y)%d.y,y=this.getTileBounds(u,o,l),b=H.getTileBounds(u,g,v,!0),T=H.tileExists(u,g,v),x=H.getTileUrl(u,g,v),w=H.getTilePostData(u,g,v),this.loadTilesWithAjax?(A=H.getTileAjaxHeaders(u,g,v),t.isPlainObject(this.ajaxHeaders)&&(A=t.extend({},this.ajaxHeaders,A))):A=null,R=H.getContext2D?H.getContext2D(u,g,v):void 0,_=new t.Tile(u,o,l,y,T,x,R,this.loadTilesWithAjax,A,b,w,H.getTileHashKey(u,g,v,x,A,w)),this.getFlip()?g===0&&(_.isRightMost=!0):g===d.x-1&&(_.isRightMost=!0),v===d.y-1&&(_.isBottomMost=!0),_.flipped=this.flipped,D[u][o][l]=_),_=D[u][o][l],_.lastTouchTime=c,_},_loadTile:function(o,l){var u=this;o.loading=!0,this._imageLoader.addJob({src:o.getUrl(),tile:o,source:this.source,postData:o.postData,loadWithAjax:o.loadWithAjax,ajaxHeaders:o.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(c,d,h){u._onTileLoad(o,l,c,d,h)},abort:function(){o.loading=!1}})},_onTileLoad:function(o,l,u,c,d){if(u)o.exists=!0;else{t.console.error("Tile %s failed to load: %s - error: %s",o,o.getUrl(),c),this.viewer.raiseEvent("tile-load-failed",{tile:o,tiledImage:this,time:l,message:c,tileRequest:d}),o.loading=!1,o.exists=!1;return}if(l<this.lastResetTime){t.console.warn("Ignoring tile %s loaded before reset: %s",o,o.getUrl()),o.loading=!1;return}var h=this,p=function(){var g=h.source,v=g.getClosestLevel();h._setTileLoaded(o,u,v,d)};this._midDraw?window.setTimeout(p,1):p()},_setTileLoaded:function(o,l,u,c){var d=0,h=!1,p=this;function g(){return h&&t.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),d++,v}function v(){d--,d===0&&(o.loading=!1,o.loaded=!0,o.hasTransparency=p.source.hasTransparency(o.context2D,o.getUrl(),o.ajaxHeaders,o.postData),o.context2D||p._tileCache.cacheTile({data:l,tile:o,cutoff:u,tiledImage:p}),p._needsDraw=!0)}var y=g();this.viewer.raiseEvent("tile-loaded",{tile:o,tiledImage:this,tileRequest:c,get image(){return t.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),l},data:l,getCompletionCallback:g}),h=!0,y()},_positionTile:function(o,l,u,c,d){var h=o.bounds.getTopLeft();h.x*=this._scaleSpring.current.value,h.y*=this._scaleSpring.current.value,h.x+=this._xSpring.current.value,h.y+=this._ySpring.current.value;var p=o.bounds.getSize();p.x*=this._scaleSpring.current.value,p.y*=this._scaleSpring.current.value;var g=u.pixelFromPointNoRotate(h,!0),v=u.pixelFromPointNoRotate(h,!1),y=u.deltaPixelsFromPointsNoRotate(p,!0),b=u.deltaPixelsFromPointsNoRotate(p,!1),T=v.plus(b.divide(2)),x=c.squaredDistanceTo(T);l||(y=y.plus(new t.Point(1,1))),o.isRightMost&&this.wrapHorizontal&&(y.x+=.75),o.isBottomMost&&this.wrapVertical&&(y.y+=.75),o.position=g,o.size=y,o.squaredDistance=x,o.visibility=d},_blendTile:function(o,l,u,c,d,h){var p=1e3*this.blendTime,g,v;if(o.blendStart||(o.blendStart=h),g=h-o.blendStart,v=p?Math.min(1,g/p):1,this.alwaysBlend&&(v*=d),o.opacity=v,this.lastDrawn.push(o),v===1)this._setCoverage(this.coverage,c,l,u,!0),this._hasOpaqueTile=!0;else if(g<p)return!0;return!1},_compareTiles:function(o,l){return!o||l.visibility>o.visibility||l.visibility===o.visibility&&l.squaredDistance<o.squaredDistance?l:o},_drawTiles:function(o){if(!(this.opacity===0||o.length===0&&!this.placeholderFillStyle)){var l=o[0],u;l&&(u=this.opacity<1||this.compositeOperation&&this.compositeOperation!=="source-over"||!this._isBottomItem()&&this.source.hasTransparency(l.context2D,l.getUrl(),l.ajaxHeaders,l.postData));var c,d,h=this.viewport.getZoom(!0),p=this.viewportToImageZoom(h);o.length>1&&p>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360===0&&t.supportsCanvas&&this.viewer.useCanvas&&(u=!0,c=l.getScaleForEdgeSmoothing(),d=l.getTranslationForEdgeSmoothing(c,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var g;u&&(c||(g=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.getRotation(!0)%360!==0||this.getRotation(!0)%360!==0)&&(g.x=this._drawer.viewer.container.clientWidth-(g.x+g.width)),g=g.times(t.pixelDensityRatio)),this._drawer._clear(!0,g)),c||(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:u}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:u}),this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip());var v=!1;if(this._clip){this._drawer.saveContext(u);var y=this.imageToViewportRectangle(this._clip,!0);y=y.rotate(-this.getRotation(!0),this._getRotationPoint(!0));var b=this._drawer.viewportToDrawerRectangle(y);c&&(b=b.times(c)),d&&(b=b.translate(d)),this._drawer.setClip(b,u),v=!0}if(this._croppingPolygons){var T=this;this._drawer.saveContext(u);try{var x=this._croppingPolygons.map(function(P){return P.map(function(N){var G=T.imageToViewportCoordinates(N.x,N.y,!0).rotate(-T.getRotation(!0),T._getRotationPoint(!0)),X=T._drawer.viewportCoordToDrawerCoord(G);return c&&(X=X.times(c)),d&&(X=X.plus(d)),X})});this._drawer.clipWithPolygons(x,u)}catch(P){t.console.error(P)}v=!0}if(this.placeholderFillStyle&&this._hasOpaqueTile===!1){var w=this._drawer.viewportToDrawerRectangle(this.getBounds(!0));c&&(w=w.times(c)),d&&(w=w.translate(d));var A=null;typeof this.placeholderFillStyle=="function"?A=this.placeholderFillStyle(this,this._drawer.context):A=this.placeholderFillStyle,this._drawer.drawRectangle(w,A,u)}var R=a(this.subPixelRoundingForTransparency),_=!1;if(R===t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)_=!0;else if(R===t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var D=this.viewer&&this.viewer.isAnimating();_=!D}for(var H=o.length-1;H>=0;H--)l=o[H],this._drawer.drawTile(l,this._drawingHandler,u,c,d,_,this.source),l.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:l});v&&this._drawer.restoreContext(u),c||(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(u),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(u)),u&&(c&&(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:!1}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:c,translate:d,compositeOperation:this.compositeOperation,bounds:g}),c&&(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1))),c||this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(o)}},_drawDebugInfo:function(o){if(this.debugMode)for(var l=o.length-1;l>=0;l--){var u=o[l];try{this._drawer.drawDebugInfo(u,o.length,l,this)}catch(c){t.console.error(c)}}},_providesCoverage:function(o,l,u,c){var d,h,p,g;if(!o[l])return!1;if(u===void 0||c===void 0){d=o[l];for(p in d)if(Object.prototype.hasOwnProperty.call(d,p)){h=d[p];for(g in h)if(Object.prototype.hasOwnProperty.call(h,g)&&!h[g])return!1}return!0}return o[l][u]===void 0||o[l][u][c]===void 0||o[l][u][c]===!0},_isCovered:function(o,l,u,c){return u===void 0||c===void 0?this._providesCoverage(o,l+1):this._providesCoverage(o,l+1,2*u,2*c)&&this._providesCoverage(o,l+1,2*u,2*c+1)&&this._providesCoverage(o,l+1,2*u+1,2*c)&&this._providesCoverage(o,l+1,2*u+1,2*c+1)},_setCoverage:function(o,l,u,c,d){if(!o[l]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",l);return}o[l][u]||(o[l][u]={}),o[l][u][c]=d},_resetCoverage:function(o,l){o[l]={}}});var i=t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function r(o){return o!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&o!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&o!==t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(o){return r(o)?i:o}function a(o){if(typeof o=="number")return s(o);if(!o||!t.Browser)return i;var l=o[t.Browser.vendor];return r(l)&&(l=o["*"]),s(l)}})(e),(function(t){var i=function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},r=function(s){t.console.assert(s,"[ImageRecord] options is required"),t.console.assert(s.data,"[ImageRecord] options.data is required"),this._tiles=[],s.create.apply(null,[this,s.data,s.ownerTile]),this._destroyImplementation=s.destroy.bind(null,this),this.getImage=s.getImage.bind(null,this),this.getData=s.getData.bind(null,this),this.getRenderedContext=s.getRenderedContext.bind(null,this)};r.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(s){t.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var a=0;a<this._tiles.length;a++)if(this._tiles[a]===s){this._tiles.splice(a,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var a=s.cutoff||0,o=this._tilesLoaded.length,l=this._imagesLoaded[s.tile.cacheKey];if(l||(s.data||(t.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),t.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),l=this._imagesLoaded[s.tile.cacheKey]=new r({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),l.addTile(s.tile),s.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var u=null,c=-1,d=null,h,p,g,v,y,b,T=this._tilesLoaded.length-1;T>=0;T--)if(b=this._tilesLoaded[T],h=b.tile,!(h.level<=a||h.beingDrawn)){if(!u){u=h,c=T,d=b;continue}v=h.lastTouchTime,p=u.lastTouchTime,y=h.level,g=u.level,(v<p||v===p&&y>g)&&(u=h,c=T,d=b)}u&&c>=0&&(this._unloadTile(d),o=c)}this._tilesLoaded[o]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){t.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var a,o=0;o<this._tilesLoaded.length;++o)a=this._tilesLoaded[o],a.tiledImage===s&&(this._unloadTile(a),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(s){return t.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){t.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var a=s.tile,o=s.tiledImage;a.unload(),a.cacheImageRecord=null;var l=this._imagesLoaded[a.cacheKey];l.removeTile(a),l.getTileCount()||(l.destroy(),delete this._imagesLoaded[a.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:a,tiledImage:o})}}})(e),(function(t){t.World=function(i){var r=this;t.console.assert(i.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){r._autoRefigureSizes?r._figureSizes():r._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(i,r){if(t.console.assert(i,"[World.addItem] item is required"),t.console.assert(i instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),r=r||{},r.index!==void 0){var s=Math.max(0,Math.min(this._items.length,r.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return t.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return t.console.assert(i,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,r){t.console.assert(i,"[World.setItemIndex] item is required"),t.console.assert(r!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(r>=this._items.length)throw new Error("Index bigger than number of layers.");r===s||s===-1||(this._items.splice(s,1),this._items.splice(r,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:r}))},removeItem:function(i){t.console.assert(i,"[World.removeItem] item is required");var r=t.indexOf(this._items,i);r!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(r,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,r;for(r=0;r<this._items.length;r++)i=this._items[r],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,r=0;r<s.length;r++)i=s[r],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,r=0;r<this._items.length;r++)i=this._items[r].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var r=i.immediately||!1,s=i.layout||t.DEFAULT_SETTINGS.collectionLayout,a=i.rows||t.DEFAULT_SETTINGS.collectionRows,o=i.columns||t.DEFAULT_SETTINGS.collectionColumns,l=i.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,u=i.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,c=l+u,d;!i.rows&&o?d=o:d=Math.ceil(this._items.length/a);var h=0,p=0,g,v,y,b,T;this.setAutoRefigureSizes(!1);for(var x=0;x<this._items.length;x++)x&&x%d===0&&(s==="horizontal"?(p+=c,h=0):(h+=c,p=0)),g=this._items[x],v=g.getBounds(),v.width>v.height?y=l:y=l*(v.width/v.height),b=y*(v.height/v.width),T=new t.Point(h+(l-y)/2,p+(l-b)/2),g.setPosition(T,r),g.setWidth(y,r),s==="horizontal"?h+=c:p+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,r=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var a=this._items[0],o=a.getBounds();this._contentFactor=a.getContentSize().x/o.width;for(var l=a.getClippedBounds().getBoundingBox(),u=l.x,c=l.y,d=l.x+l.width,h=l.y+l.height,p=1;p<this._items.length;p++)a=this._items[p],o=a.getBounds(),this._contentFactor=Math.max(this._contentFactor,a.getContentSize().x/o.width),l=a.getClippedBounds().getBoundingBox(),u=Math.min(u,l.x),c=Math.min(c,l.y),d=Math.max(d,l.x+l.width),h=Math.max(h,l.y+l.height);this._homeBounds=new t.Rect(u,c,d-u,h-c),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(r))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})})(e)})(wf)),wf.exports}var oee=aee();const vl=Yl(oee);var uee=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],zk=uee.reduce((n,e)=>{const t=Dn(`Primitive.${e}`),i=U.forwardRef((r,s)=>{const{asChild:a,...o}=r,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),be.jsx(l,{...o,ref:s})});return i.displayName=`Primitive.${e}`,{...n,[e]:i}},{}),Uh="Switch",[lee]=Cr(Uh),[cee,dee]=lee(Uh),jk=U.forwardRef((n,e)=>{const{__scopeSwitch:t,name:i,checked:r,defaultChecked:s,required:a,disabled:o,value:l="on",onCheckedChange:u,form:c,...d}=n,[h,p]=U.useState(null),g=Ht(e,x=>p(x)),v=U.useRef(!1),y=h?c||!!h.closest("form"):!0,[b,T]=Gs({prop:r,defaultProp:s??!1,onChange:u,caller:Uh});return be.jsxs(cee,{scope:t,checked:b,disabled:o,children:[be.jsx(zk.button,{type:"button",role:"switch","aria-checked":b,"aria-required":a,"data-state":qk(b),"data-disabled":o?"":void 0,disabled:o,value:l,...d,ref:g,onClick:xt(n.onClick,x=>{T(w=>!w),y&&(v.current=x.isPropagationStopped(),v.current||x.stopPropagation())})}),y&&be.jsx(Wk,{control:h,bubbles:!v.current,name:i,value:l,checked:b,required:a,disabled:o,form:c,style:{transform:"translateX(-100%)"}})]})});jk.displayName=Uh;var Vk="SwitchThumb",Gk=U.forwardRef((n,e)=>{const{__scopeSwitch:t,...i}=n,r=dee(Vk,t);return be.jsx(zk.span,{"data-state":qk(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:e})});Gk.displayName=Vk;var fee="SwitchBubbleInput",Wk=U.forwardRef(({__scopeSwitch:n,control:e,checked:t,bubbles:i=!0,...r},s)=>{const a=U.useRef(null),o=Ht(a,s),l=jy(t),u=zy(e);return U.useEffect(()=>{const c=a.current;if(!c)return;const d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"checked").set;if(l!==t&&p){const g=new Event("click",{bubbles:i});p.call(c,t),c.dispatchEvent(g)}},[l,t,i]),be.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...r,tabIndex:-1,ref:o,style:{...r.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Wk.displayName=fee;function qk(n){return n?"checked":"unchecked"}var hee=jk,pee=Gk;const mee="Close",gee="Next",vee="Previous",yee="Search",Eee="Search...",bee="Share",Tee="View All",xee="Failed",See="Copied",wee="Loading...",Aee="Search",Cee="No Results",Iee="More Results",Ree="Select",_ee="Viewer",Lee="About",Pee="Annotations",kee="Search",Dee="More Information",Oee="View Collection",Nee="Copy Collection URL",Mee="View Manifest",Fee="Copy Manifest URL",Bee={commonClose:mee,commonNext:gee,commonPrevious:vee,commonSearch:yee,commonSearchPlaceholder:Eee,commonShare:bee,commonViewAll:Tee,copyFailure:xee,copySuccess:See,contentSearchLoading:wee,contentSearchPlaceholder:Aee,contentSearchResultsNone:Cee,contentSearchResultsMore:Iee,informationPanelTabs:Ree,informationPanelTabsClose:_ee,informationPanelTabsAbout:Lee,informationPanelTabsAnnotations:Pee,informationPanelTabsSearch:kee,informationPanelToggle:Dee,shareCollectionJson:Oee,shareCollectionCopy:Nee,shareManifestJson:Mee,shareManifestCopy:Fee},Uee={},Hee={en:Bee,pt:Uee},Wv="clover",zee=Object.fromEntries(Object.entries(Hee).map(([n,e])=>[n,{[`${Wv}`]:e}]));Hn.use(iC).use(U6).init({defaultNS:Wv,fallbackLng:"en",ns:[Wv],resources:{...zee}});var fn=function(n){return function(){const e={type:n,getType:()=>n,toString:()=>n};return(t,i)=>({...e,...t!==void 0&&{payload:t},...i!==void 0&&{meta:i}})}},$k="@iiif/IMPORT_ENTITIES",Kk="@iiif/MODIFY_ENTITY_FIELD",Yk="@iiif/REORDER_ENTITY_FIELD",Xk="@iiif/ADD_REFERENCE",qv="@iiif/UPDATE_REFERENCE",Qk="@iiif/REMOVE_REFERENCE",Zk="@iiif/ADD_METADATA",Jk="@iiif/REMOVE_METADATA",$v="@iiif/UPDATE_METADATA",e3="@iiif/REORDER_METADATA",t3=fn($k)(),jee=fn(Kk)(),Vee=fn(Yk)(),Gee=fn(Xk)(),Wee=fn(Qk)(),qee=fn(qv)(),$ee=fn(Zk)(),Kee=fn($v)(),Yee=fn(Jk)(),Xee=fn(e3)(),Qee={importEntities:t3,modifyEntityField:jee,reorderEntityField:Vee,addReference:Gee,removeReference:Wee,updateReference:qee,addMetadata:$ee,removeMetadata:Yee,updateMetadata:Kee,reorderMetadata:Xee},n3="@iiif/ADD_MAPPING",i3="@iiif/ADD_MAPPINGS",Zee=fn(n3)(),Jee=fn(i3)(),Kv="RESOURCE_ERROR",r3="RESOURCE_LOADING",Yv="RESOURCE_READY",s3="@iiif/REQUEST_RESOURCE",a3="@iiif/REQUEST_ERROR",o3="@iiif/REQUEST_MISMATCH",u3="@iiif/REQUEST_COMPLETE",ete="@iiif/REQUEST_OFFLINE_RESOURCE",tte=fn(s3)(),Xv=fn(a3)(),nte=fn(o3)(),ite=fn(u3)(),N1="@iiif/BATCH",rte="@iiif/BATCH_IMPORT",Qv=fn(N1)(),ste=(n,e)=>{const{entities:t,resource:i,mapping:r}=pM(e);if(i.id===void 0)return[Xv({id:n,message:"ID is not defined in resource."})];const s=[t3({entities:t}),Jee({mapping:r})];return i.id!==n&&(s.push(Zee({id:n,type:i.type})),s.push(nte({requestId:n,actualId:i.id}))),s.push(ite({id:n})),s},SA=Number.isNaN||function(n){return typeof n=="number"&&n!==n};function ate(n,e){return!!(n===e||SA(n)&&SA(e))}function wA(n,e){if(!Array.isArray(n)||!Array.isArray(e))return n===e;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ate(n[t],e[t]))return!1;return!0}function Rg(n,e,t){const i=n.iiif.requests[e],r=n.iiif.mapping[e];if(!r||!n.iiif.entities[r][i.resourceUri])return;const s=n.iiif.entities[r][i.resourceUri];if(s&&s[gn]){const a=s[gn].find(o=>o[Qr]===s.id);return uy(s,a)}return s}function ote(n){return n&&typeof n.then=="function"}function AA(n,e,{waitTimeout:t=30}={}){return(i,r,s)=>{const a=n.getStore(),o=a.getState(),l=o.iiif.requests[i];if(l){if(l.loadingState===Yv){const c=Rg(o,i);if(c)return c}switch(l.loadingState){case Kv:break;case r3:return(async()=>{let c,d=!1;try{const h=await Promise.race([new Promise((p,g)=>{d||(c=a.subscribe(()=>{const v=a.getState();if(v.iiif.requests[i].loadingState===Kv){g();return}if(v.iiif.requests[i].loadingState===Yv){const y=Rg(v,i);y?p(y):g()}}))}),new Promise((p,g)=>setTimeout(()=>{d=!0,g()},t*60*1e3))]);if(c&&c(),h)return h}catch{c&&c()}})()}}n.dispatch(tte({id:i}));const u=c=>{if(!c)return;!c.id&&!c["@id"]&&(c["@type"]&&(c["@id"]=i),c.id=i);const d=ste(i,c);return n.dispatch(Qv({actions:d})),Rg(a.getState(),i)};try{const c=e(i,r);return ote(c)?(async()=>{try{let d=await c;return s&&(d=s(d)),u(d)}catch(d){throw n.dispatch(Xv({id:i,message:d.toString()})),d}})():u(s?s(c):c)}catch(c){throw n.dispatch(Xv({id:i,message:c.toString()})),c}}}var l3="@iiif/SET_META_VALUE",c3="@iiif/SET_META_VALUE_DYNAMIC",d3="@iiif/UNSET_META_VALUE",ute=fn(l3)(),lte=fn(c3)(),cte=fn(d3)(),CA={setMetaValue:ute,setMetaValueDynamic:lte,unsetMetaValue:cte};function f3(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const dte={};var IA=n=>{let e;const t=new Set,i=(o,l)=>{const u=typeof o=="function"?o(e):o;if(!Object.is(u,e)){const c=e;e=l??(typeof u!="object"||u===null)?u:Object.assign({},e,u),t.forEach(d=>d(e,c))}},r=()=>e,s={setState:i,getState:r,getInitialState:()=>a,subscribe:o=>(t.add(o),()=>t.delete(o)),destroy:()=>{(dte?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},a=e=n(i,r,s);return s},h3=n=>n?IA(n):IA;const _g={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var fte=(n,e)=>(t,i,r)=>(r.dispatch=s=>(t(a=>n(a,s),!1,s),s),r.dispatchFromDevtools=!0,{dispatch:(...s)=>r.dispatch(...s),...e}),hte=fte,Zv=new Map,rf=n=>{const e=Zv.get(n);return e?Object.fromEntries(Object.entries(e.stores).map(([t,i])=>[t,i.getState()])):{}},pte=(n,e,t)=>{if(n===void 0)return{type:"untracked",connection:e.connect(t)};const i=Zv.get(t.name);if(i)return{type:"tracked",store:n,...i};const r={connection:e.connect(t),stores:{}};return Zv.set(t.name,r),{type:"tracked",store:n,...r}},mte=(n,e={})=>(t,i,r)=>{const{enabled:s,anonymousActionType:a,store:o,...l}=e;let u;try{u=(s??(_g?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!u)return(_g?"production":void 0)!=="production"&&s&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),n(t,i,r);const{connection:c,...d}=pte(o,u,l);let h=!0;r.setState=(v,y,b)=>{const T=t(v,y);if(!h)return T;const x=b===void 0?{type:a||"anonymous"}:typeof b=="string"?{type:b}:b;return o===void 0?(c==null||c.send(x,i()),T):(c==null||c.send({...x,type:`${o}/${x.type}`},{...rf(l.name),[o]:r.getState()}),T)};const p=(...v)=>{const y=h;h=!1,t(...v),h=y},g=n(r.setState,i,r);if(d.type==="untracked"?c==null||c.init(g):(d.stores[d.store]=r,c==null||c.init(Object.fromEntries(Object.entries(d.stores).map(([v,y])=>[v,v===d.store?g:y.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let v=!1;const y=r.dispatch;r.dispatch=(...b)=>{(_g?"production":void 0)!=="production"&&b[0].type==="__setState"&&!v&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),v=!0),y(...b)}}return c.subscribe(v=>{var y;switch(v.type){case"ACTION":if(typeof v.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Lg(v.payload,b=>{if(b.type==="__setState"){if(o===void 0){p(b.state);return}Object.keys(b.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const T=b.state[o];if(T==null)return;JSON.stringify(r.getState())!==JSON.stringify(T)&&p(T);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(b)});case"DISPATCH":switch(v.payload.type){case"RESET":return p(g),o===void 0?c==null?void 0:c.init(r.getState()):c==null?void 0:c.init(rf(l.name));case"COMMIT":if(o===void 0){c==null||c.init(r.getState());return}return c==null?void 0:c.init(rf(l.name));case"ROLLBACK":return Lg(v.state,b=>{if(o===void 0){p(b),c==null||c.init(r.getState());return}p(b[o]),c==null||c.init(rf(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Lg(v.state,b=>{if(o===void 0){p(b);return}JSON.stringify(r.getState())!==JSON.stringify(b[o])&&p(b[o])});case"IMPORT_STATE":{const{nextLiftedState:b}=v.payload,T=(y=b.computedStates.slice(-1)[0])==null?void 0:y.state;if(!T)return;p(o===void 0?T:T[o]),c==null||c.send(null,b);return}case"PAUSE_RECORDING":return h=!h}return}}),g},gte=mte,Lg=(n,e)=>{let t;try{t=JSON.parse(n)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}t!==void 0&&e(t)},vte=n=>(e,t,i)=>{const r=i.subscribe;return i.subscribe=(s,a,o)=>{let l=s;if(a){const u=(o==null?void 0:o.equalityFn)||Object.is;let c=s(i.getState());l=d=>{const h=s(d);if(!u(c,h)){const p=c;a(c=h,p)}},o!=null&&o.fireImmediately&&a(c,c)}return r(l)},n(e,t,i)},yte=vte,Ete=(n={},e)=>{switch(e.type){case n3:return{...n,[e.payload.id]:e.payload.type};case i3:return{...n,...e.payload.mapping};default:return n}};function Pg(n,e,t,i){return!(!n[t]||!n[t][e]||!n[t][e][i]||!Array.isArray(n[t][e][i]))}function bte(n,e){const t={},i=[];for(const[r,s]of Object.entries(n||{})){i.push(r);const a=(e||{})[r];if(!a||a.length===0){t[r]=s;continue}t[r]=a}for(const[r,s]of Object.entries(e||{}))i.indexOf(r)===-1&&(t[r]=s);return t}function ot(n){return n.payload}function kg(n,e){return typeof n>"u"?e:n}var Tte=(n=f3(),e)=>{var t;const i=(r,s)=>({...n,[ot(e).type]:{...n[ot(e).type],[ot(e).id]:{...r,...s}}});switch(e.type){case Kk:{if(!n[ot(e).type]||!n[ot(e).type][ot(e).id])return n;const r=n[ot(e).type][ot(e).id];return typeof r=="string"?n:i(r,{[ot(e).key]:ot(e).value})}case Yk:{if(!Pg(n,ot(e).id,ot(e).type,ot(e).key))return n;const r=n[ot(e).type][ot(e).id];if(typeof r=="string")return n;const s=Array.from(r[ot(e).key]),[a]=s.splice(ot(e).startIndex,1);return s.splice(ot(e).endIndex,0,a),i(r,{[ot(e).key]:s})}case $k:{const r=Object.keys(ot(e).entities),s={...n};for(const a of r){const o=ot(e).entities[a],l={...n[a]||{}};let u=!1;const c=Object.keys(o||{})||[];if(o&&c){for(const d of c)u=!0,l[d]=n[a][d]?bte(n[a][d],o[d]):o[d];u&&(s[a]=l)}}return s}case Xk:{if(!Pg(n,ot(e).id,ot(e).type,ot(e).key))return n;const r=n[ot(e).type][ot(e).id],s=Array.from(r[ot(e).key]);return s.splice(kg(ot(e).index,s.length+1),0,ot(e).reference),i(r,{[ot(e).key]:s})}case qv:case Qk:{if(!Pg(n,ot(e).id,ot(e).type,ot(e).key))return n;const r=n[ot(e).type][ot(e).id],s=Array.from(r[ot(e).key]),a=kg(ot(e).index,s.findIndex(o=>o&&o.id===ot(e).reference.id));return a===-1||((t=s[a])==null?void 0:t.id)!==ot(e).reference.id?n:(e.type===qv?s.splice(a,1,ot(e).reference):s.splice(a,1),i(r,{[ot(e).key]:s}))}case Zk:{const r=n[ot(e).type][ot(e).id];if(!r)return n;const s=Array.from(r.metadata||[]),a=ot(e);return s.splice(kg(e.payload.beforeIndex,s.length+1),0,{label:a.label,value:a.label}),i(r,{metadata:s})}case e3:{const r=n[ot(e).type][ot(e).id];if(typeof r=="string"||!r)return n;const s=Array.from(r.metadata||[]),[a]=s.splice(ot(e).startIndex,1);return s.splice(ot(e).endIndex,0,a),i(r,{metadata:s})}case $v:case Jk:{const r=n[ot(e).type][ot(e).id],s=Array.from(r.metadata||[]),a=ot(e).atIndex;return typeof a>"u"||a===-1||!s[a]?n:(e.type===$v?s.splice(a,1,{label:ot(e).label,value:ot(e).value}):s.splice(a,1),i(r,{metadata:s}))}default:return n}},xte=(n={},e)=>{switch(e.type){case s3:case ete:return{...n,[e.payload.id]:{requestUri:e.payload.id,loadingState:r3,uriMismatch:!1,resourceUri:e.payload.id}};case o3:return{...n,[e.payload.requestId]:{...n[e.payload.requestId]||{},uriMismatch:!0,resourceUri:e.payload.actualId},[e.payload.actualId]:{requestUri:e.payload.requestId,loadingState:n[e.payload.requestId].loadingState,uriMismatch:!0,resourceUri:e.payload.actualId}};case a3:return{...n,[e.payload.id]:{...n[e.payload.id]||{},loadingState:Kv,error:e.payload.message}};case u3:return{...n,[e.payload.id]:{...n[e.payload.id]||{},loadingState:Yv,error:void 0}}}return n},Ste=(n={},e)=>{const{id:t,updateValue:i,value:r,meta:s,key:a}=e&&e.payload||{};switch(e.type){case l3:return{...n,[t]:{...n[t]||{},[s]:{...n[t]?n[t][s]||{}:{},[a]:r}}};case c3:return{...n,[t]:{...n[t]||{},[s]:{...n[t]?n[t][s]||{}:{},[a]:n[t]&&n[t][s]?i(n[t][s][a]):i(void 0)}}};case d3:return n[t]&&n[t][s]&&n[t][s][a]?{...n,[t]:{...n[t]||{},[s]:{...n[t]?n[t][s]||{}:{},[a]:void 0}}}:n;default:return n}};function p3(n={}){const e=Object.keys(n);return function(t={},i){let r=!1;const s={};for(let a=0;a<e.length;a++){const o=e[a];s[o]=n[o](t[o],i),r=r||s[o]!==t[o]}return r?s:t}}function wte(n){return(e,t)=>t&&t.type===N1?t.payload.actions.reduce(n,e):t&&t.type===rte?{...e,iiif:{...e.iiif,...t.payload.state}}:n(e,t)}var Ate=p3({mapping:Ete,entities:Tte,requests:xte,meta:Ste});function Cte(){return{iiif:{entities:f3(),meta:{},mapping:{},requests:{}}}}function Ite(n={}){const{enableDevtools:e=!1,iiifStoreName:t="iiif",defaultState:i=Cte(),customReducers:r={}}=n,s=wte(p3({[t]:Ate,...r})),a=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__?gte:(o,l)=>o;return h3(yte(a(hte(s,i),{enabled:e})))}function m3(n){return{all:n=n||new Map,on:function(e,t){var i=n.get(e);i?i.push(t):n.set(e,[t])},off:function(e,t){var i=n.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var i=n.get(e);i&&i.slice().map(function(r){r(t)}),(i=n.get("*"))&&i.slice().map(function(r){r(e,t)})}}}var Rte=Object.defineProperty,_te=(n,e,t)=>e in n?Rte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Li=(n,e,t)=>(_te(n,typeof e!="symbol"?e+"":e,t),t);function Wn(n,e,t,i=!0){e[eu]=e[eu]||[],e[eu].push(n);const r=new Map;Object.defineProperty(e,n,{enumerable:i,get(){if(typeof e[Ra][n]>"u")return;const s=e[Ra][n];if(!s)return s;const a=t.get(e[Ra][n],{parent:this.id?{id:this.id,type:this.type}:void 0});return r.has(a)||(r.clear(),r.set(a,_a(a,t))),r.get(a)},set(s){e[Ra][n]!==s&&(this[Ia]?t.modifyEntityField({id:this.id,type:this.type},n,g3(s)):this[Ra][n]=s)}})}var Ra=Symbol.for("_refs_"),Ia=Symbol.for("_reactive_"),eu=Symbol.for("_defined_"),RA=Symbol.for("_parent_");function Lte(n,e=!1,t){const i={id:"",type:"unknown",[eu]:[],[Ra]:{},[RA]:null,[Ia]:null,is(r){return typeof r=="string"?this.id===r:r.id?r.id===this.id:!1},reactive(){if(!this[Ia])return this[Ia]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){const r=this.unwrap();for(const s of Object.keys(r||{}))this[eu].includes(s)?this[Ra][s]=r[s]:this[s]=r[s]}},unreactive(){this[Ia]&&(this[Ia](),this[Ia]=null)},unwrap(){if(!this.id)throw new Error("Invalid object");const r=this[RA];return n.get(this.id,{parent:r?{id:r,type:"unknown"}:void 0})},toPresentation3(){return n.toPresentation3(this.unwrap())},toPresentation2(){return n.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){const r=this;return{...r,items:r.items,annotations:r.annotations,structures:r.structures,seeAlso:r.seeAlso,service:r.service,services:r.services,rendering:r.rendering,partOf:r.partOf,start:r.start,supplementary:r.supplementary,homepage:r.homepage,thumbnail:r.thumbnail,placeholderCanvas:r.placeholderCanvas,accompanyingCanvas:r.accompanyingCanvas,provider:r.provider}},subscribe(r,s=!0){return n.subscribe(()=>this.id?n.get(this.id):null,r,s)}};return Wn("items",i,n),Wn("annotations",i,n),Wn("structures",i,n),Wn("seeAlso",i,n),Wn("rendering",i,n),Wn("partOf",i,n),Wn("start",i,n,!1),Wn("supplementary",i,n),Wn("homepage",i,n),Wn("thumbnail",i,n),Wn("placeholderCanvas",i,n,!1),Wn("accompanyingCanvas",i,n,!1),Wn("provider",i,n),Wn("body",i,n),Wn("logo",i,n),i}function Pte(n){return!!n[eu]}function g3(n){return Array.isArray(n)?n.map(e=>g3(e)):!n||!n.type?n:{id:n.id,type:n.type}}function _a(n,e,t=!1,i){if(Array.isArray(n))return n.map(o=>_a(o,e,t));if(!n||!n.type||!n.id)return n;const r=Lte(e,t),s=Object.create(r),a=Object.assign(s,n);return t&&a.reactive(),a}function _A(n){switch(n){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return n}var v3=class{constructor(n,e){Li(this,"options"),Li(this,"store"),Li(this,"emitter"),Li(this,"isBatching",!1),Li(this,"batchQueue",[]),Li(this,"remoteFetcher"),Li(this,"staticFetcher"),Li(this,"defaultFetcher",t=>fetch(t).then(i=>{if(i.status===200)return i.json();{const r=new Error(`${i.status} ${i.statusText}`);throw r.name="HTTPError",r}})),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},n||{}),this.store=e||Ite({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=m3(),this.remoteFetcher=AA(this,this.options.customFetcher),this.staticFetcher=AA(this,(t,i)=>i)}batch(n){this.isBatching=!0;try{n(this),this.isBatching=!1,this.dispatch(Qv({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}async asyncBatch(n){this.isBatching=!0;try{await n(this),this.isBatching=!1,this.dispatch(Qv({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}modifyEntityField(n,e,t){this.dispatch(Qee.modifyEntityField({id:n.id,type:n.type,key:e,value:t}))}dispatch(n){if(this.isBatching)this.batchQueue.push(n);else{if(n.type===N1){for(const i of n.payload.actions)this.emitter.emit(i.type,{action:i,state:this.store.getState()});this.store.dispatch(n);const t=this.getState();for(const i of n.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(n.type,{action:n,state:this.store.getState()}),this.store.dispatch(n);const e=this.store.getState();this.emitter.emit(`after:${n.type}`,{action:n,state:e});return}}on(n,e){return this.emitter.on(n,e),()=>{this.emitter.off(n,e)}}serialize(n,e){return gM(this.getState().iiif,n,e)}toPresentation2(n){return this.serialize(n,TM)}toPresentation3(n){return this.serialize(n,xM)}hydrate(n,e,t={}){return this.get(n,e,{...t,skipSelfReturn:!1})}get(n,e,t={}){typeof e!="string"&&(t=e||{},e=void 0);const{skipSelfReturn:i=!0}=t||{};let r=t.parent?typeof t.parent=="string"?t.parent:t.parent.id:void 0;if(Array.isArray(n))return n.map(c=>this.get(c,t));const s=this.getState();if(zs(n)&&!t.preserveSpecificResources&&(n=n.source),typeof n=="string"){const c=_A(e||s.iiif.mapping[n]);if(!c)return i?null:{id:n,type:"unknown"};n={id:n,type:c}}if(n&&n.partOf&&!r&&!t.skipPartOfCheck){const c=Array.isArray(n.partOf)?n.partOf[0]:n.partOf;c&&(typeof c=="string"&&(r=c),typeof c.id=="string"&&(r=c.id))}const a=_A(e||(n==null?void 0:n.type)),o=n==null?void 0:n.id,l=s.iiif.entities[a];if(!l){const c=s.iiif.requests[o];return c&&c.resourceUri!==o?this.get(c.resourceUri,t):i?null:n}const u=l[n.id];if(u&&u[gn]){const c=u[gn].find(d=>r?d[Qr]===r:d[Qr]===u.id);return uy(u,c)}return l[n.id]||(i?null:n)}select(n){return n(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(n,e){if(typeof n>"u")return this.get(e,{skipSelfReturn:!1});if(typeof n=="function")try{const i=n(this.get(e,{skipSelfReturn:!1})),r=s=>this.deep(s,i);return r.size=Array.isArray(i)?i.length:1,r}catch{const i=r=>this.deep(r,void 0);return i.size=0,i}const t=i=>this.deep(i,n);return t.size=Array.isArray(n)?n.length:1,t}loadManifest(n,e,t){const i=typeof n=="string"?n:n.id;return this.load(i,e,t)}loadCollection(n,e,t){const i=typeof n=="string"?n:n.id;return this.load(i,e,t)}load(n,e,t){const i=typeof n=="string"?n:n.id;return e?Promise.resolve(this.staticFetcher(i,e,t)):Promise.resolve(this.remoteFetcher(i,{},t))}loadSync(n,e,t){const i=typeof n=="string"?n:n.id;return this.staticFetcher(i,e,t)}loadManifestSync(n,e,t){const i=typeof n=="string"?n:n.id;return this.loadSync(i,e,t)}loadCollectionSync(n,e,t){const i=typeof n=="string"?n:n.id;return this.loadSync(i,e,t)}areInputsEqual(n,e){return wA(n,e)}subscribe(n,e,t){return typeof t>"u"&&(typeof e>"u"||e===!1||e===!0)&&(t=e,e=n,n=i=>i),this.store.subscribe(n,i=>e(i,this),{equalityFn:wA,fireImmediately:!t})}async ensureLoaded(n){const e=typeof n=="string"?n:n.id;this.requestStatus(e)||await this.load(e)}requestStatus(n){return this.select(e=>e.iiif.requests[n])}getPaginationState(n){const e=typeof n=="string"?n:n.id;if(!e)return null;const t=this.getResourceMeta(e,"@vault/pagination");if(t!=null&&t.state)return t.state;const i=this.get(n);if(i.first){const r={currentPage:null,currentPageIndex:null,isFetching:!1,isFullyLoaded:!1,next:i.first,page:1,pages:[],previous:null,totalItems:i.total,currentLength:0};return this.setMetaValue([e,"@vault/pagination","state"],r),r}return null}async loadNextPage(n,e){var t;const i=typeof n=="string"?n:n.id;if(!i)return[null,null];const r=this.getPaginationState(n);if(!r||r.isFullyLoaded||!r.next)return[null,null];if(r.isFetching)return[r,null];const s=typeof r.next=="string"?r.next:r.next.id,a=r.currentPage,o={...r,isFetching:!0};this.setMetaValue([i,"@vault/pagination","state"],o);let l;try{l=await this.loadCollection(s,e,p=>{const{id:g,["@id"]:v,...y}=p||{};return v?{"@id":s,...y}:{id:s,...y}})}catch(p){const g={...r,isFetching:!1,error:p};return this.setMetaValue([i,"@vault/pagination","state"],g),[g,null]}if(!l){const p={...r,isFetching:!1,error:new Error("Collection not found")};return this.setMetaValue([i,"@vault/pagination","state"],p),[p,null]}const u=this.get(i),c=[...u.items||[],...l.items||[]].map(p=>({id:p.id,type:p.type}));this.modifyEntityField({id:i,type:"Collection"},"items",c);const d=this.getPaginationState(n);if(!d)throw new Error("Pagination state not found");const h={...d,isFetching:!1,error:null,currentPage:l.id,next:((t=l.next)==null?void 0:t.id)||null,currentPageIndex:d.pages.length,currentLength:c.length,pages:[...d.pages,{id:l.id,type:"Collection",startIndex:u.items.length,pageLength:l.items.length,order:typeof d.currentPageIndex=="number"?d.currentPageIndex+1:0}],isFullyLoaded:!l.next,previous:a,page:d.pages.length+1};return this.setMetaValue([i,"@vault/pagination","state"],h),[h,l]}getResourceMeta(n,e){const t=this.getState().iiif.meta[n];if(t)return e?t[e]:t}getObject(n,e,t={}){const{reactive:i,...r}=t;return _a(this.get(n,e,r),this,i)}async loadObject(n,e){return _a(await this.load(n,e),this)}async loadManifestObject(n,e){return _a(await this.loadManifest(n,e),this)}async loadCollectionObject(n,e){return _a(await this.loadCollection(n,e),this)}wrapObject(n){return _a(this.get(n,{skipSelfReturn:!1}),this)}isWrapped(n){return Pte(n)}setMetaValue([n,e,t],i){this.dispatch(typeof i=="function"?CA.setMetaValueDynamic({id:n,meta:e,key:t,updateValue:i}):CA.setMetaValue({id:n,meta:e,key:t,value:i}))}};const kte=n=>{const e=n.toString().split(":"),t=Math.ceil(parseInt(e[0])),i=Math.ceil(parseInt(e[1])),r=Dte(Math.ceil(parseInt(e[2])),2);let s=`${t!==0&&i<10?(i+"").padStart(2,"0"):i}:${r}`;return t!==0&&(s=`${t}:${s}`),s},y3=n=>{const e=new Date(n*1e3).toISOString().substr(11,8);return kte(e)},E3=(n,e)=>{if(typeof n!="object"||n===null)return e;for(const t in e)typeof e[t]=="object"&&e[t]!==null&&!Array.isArray(e[t])?(n[t]||(n[t]={}),n[t]=E3(n[t],e[t])):n[t]=e[t];return n},b3=n=>n.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0),T3=(n,e)=>Object.hasOwn(n,e)?n[e].toString():void 0,Dte=(n,e)=>String(n).padStart(e,"0"),x3={behavior:"smooth",block:"center"},Ua={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:"anonymous",ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:x3}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1};function S3(n){const e=(()=>{var i,r;return((r=(i=Ua==null?void 0:Ua.informationPanel)==null?void 0:i.vtt)==null?void 0:r.autoScroll)||{enabled:!0,settings:x3}})();if(n==null)return{enabled:e.enabled,settings:{...e.settings}};if(typeof n=="boolean")return{enabled:n,settings:{...e.settings}};if("enabled"in n){const i=n;return{enabled:i.enabled,settings:{...i.settings}}}const t={enabled:!0,settings:{...n}};return Ote(t.settings),t}function Ote({behavior:n,block:e}){const t=["auto","instant","smooth"],i=["center","end","nearest","start"];if(!t.includes(n))throw TypeError(`'${n}' not in ${t.join(" | ")}`);if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`)}var LA,PA;const Nte=S3((PA=(LA=Ua==null?void 0:Ua.informationPanel)==null?void 0:LA.vtt)==null?void 0:PA.autoScroll);var kA;const Hh={activeCanvas:"",activeManifest:"",activePlayer:null,activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:Ua,customDisplays:[],plugins:[],isAutoScrollEnabled:Nte.enabled,isAutoScrolling:!1,isInformationOpen:((kA=Ua==null?void 0:Ua.informationPanel)==null?void 0:kA.open)??!0,isLoaded:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new v3,openSeadragonViewer:null,viewerId:Ml(),visibleCanvases:[],visibleAnnotations:[]},w3=B.createContext(Hh),A3=B.createContext(Hh);function Mte(n,e){switch(e.type){case"updateActiveCanvas":return e.canvasId||(e.canvasId=""),{...n,activeCanvas:e.canvasId};case"updateActiveManifest":return{...n,activeManifest:e.manifestId};case"updateActivePlayer":return{...n,activePlayer:e.player};case"updateOSDImageLoaded":return{...n,OSDImageLoaded:e.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...n,isAutoScrollEnabled:e.isAutoScrollEnabled};case"updateAutoScrolling":return{...n,isAutoScrolling:e.isAutoScrolling};case"updateCollection":return{...n,collection:e.collection};case"updateConfigOptions":return{...n,configOptions:E3(n.configOptions,e.configOptions)};case"updateContentStateAnnotation":return{...n,contentStateAnnotation:e.contentStateAnnotation};case"updateInformationOpen":return{...n,isInformationOpen:e.isInformationOpen};case"updateInformationPanelResource":return{...n,informationPanelResource:e.informationPanelResource};case"updateIsLoaded":return{...n,isLoaded:e.isLoaded};case"updateManifestSequence":return{...n,sequence:e.sequence};case"updateUserScrolling":return{...n,isUserScrolling:e.isUserScrolling};case"updateOpenSeadragonViewer":return{...n,openSeadragonViewer:e.openSeadragonViewer};case"updateViewerId":return{...n,viewerId:e.viewerId};case"updateActiveSelector":return{...n,activeSelector:e.selector};case"updateVisibleCanvases":return{...n,visibleCanvases:e.visibleCanvases};default:throw new Error(`Unhandled action type: ${e.type}`)}}const Fte=({initialState:n=Hh,children:e})=>{const[t,i]=U.useReducer(Mte,n),{openSeadragonViewer:r}=t;return U.useEffect(()=>{if(r)return r.addHandler("update-viewport",()=>{const s=r.viewport,a=s.getBounds(),o=s.viewportToImageRectangle(a),l=`xywh=${[Math.round(o.x),Math.round(o.y),Math.round(o.width),Math.round(o.height)].join(",")}`;i({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:l}})}),()=>{r.removeAllHandlers("update-viewport")}},[r]),B.createElement(w3.Provider,{value:t},B.createElement(A3.Provider,{value:i},e))};function qt(){const n=B.useContext(w3);if(n===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return n}function si(){const n=B.useContext(A3);if(n===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return n}const Bte=async(n,e)=>{const t=n.get({id:e,type:"Canvas"});if(!(t!=null&&t.annotations)||!t.annotations[0])return[];const i=n.get(t.annotations).filter(s=>s.items?s:!1),r=[];for(const s of i)if(s.items.length>0){const a=s.label||{none:["Annotations"]};r.push({...s,label:a})}else{let a={};try{a=await n.load(s.id)}catch(o){console.log(o)}if(a.items&&a.items.length>0){const o=a.label||{none:["Annotations"]};r.push({...a,label:o})}}return r},C3=async(n,e,t)=>{try{if(t==null||t.q==null)return{};const i=t.q.trim(),r=new URL(e);return r.searchParams.set("q",i),await n.load(r.toString())}catch(i){return console.warn("Error in getContentSearchResources:",i),{}}},I3=(n,e,t,i)=>{var r,s;const a={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},o=l=>{if(l){if(!l.body||!l.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",l);return}let u=l.body;Array.isArray(u)&&(u=u[0]);const c=n.get(u.id);if(!c)return;switch(t){case"painting":return l.target===e.id&&l.motivation&&l.motivation[0]==="painting"&&i.includes(c.type)&&(l.body=c),!!l;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(a.canvas=n.get(e),a.canvas&&(a.annotationPage=n.get(a.canvas.items[0]),a.accompanyingCanvas=(r=a.canvas)!=null&&r.accompanyingCanvas?n.get((s=a.canvas)==null?void 0:s.accompanyingCanvas):void 0),a.annotationPage){const l=n.get(a.annotationPage.items).map(c=>({body:n.get(c.body[0].id),motivation:c.motivation,type:"Annotation"})),u=[];l.forEach(c=>{c.body.type==="Choice"?c.body.items.forEach(d=>u.push({...c,id:d.id,body:n.get(d.id)})):u.push(c)}),a.annotations=u.filter(o)}return a},M1=(n,e="en")=>{if(!n)return"";if(!n[e]){const t=Object.getOwnPropertyNames(n);if(t.length>0)return n[t[0]]}return n[e]},Qs=(n,e)=>{const t=I3(n,{id:e,type:"Canvas"},"painting",["Image","Sound","Video"]);if(t.annotations.length!==0&&t.annotations&&t.annotations)return t.annotations.map(i=>i==null?void 0:i.body)},Dg=209,Ute={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${Dg} 100% 38.2%)`,accentMuted:`hsl(${Dg} 80% 61.8%)`,accentAlt:`hsl(${Dg} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},R3={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:Ge,css:Mae,keyframes:_3,createTheme:Fae}=HC({theme:Ute,media:R3}),Hte=Ge("div",{display:"flex",flexDirection:"column",alignItems:"center"}),zte=Ge("p",{fontWeight:"bold",fontSize:"x-large"}),jte=Ge("span",{fontSize:"medium"}),F1=({error:n})=>{const{message:e}=n;return B.createElement(Hte,{role:"alert"},B.createElement(zte,{"data-testid":"headline"},"Something went wrong"),e&&B.createElement(jte,null,`Error message: ${e}`," "))},Vte=Ge("div",{position:"relative",zIndex:"0"}),L3=Ge("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),P3=Ge("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),Gte=Ge("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),Wte=Ge("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${L3}`]:{flexGrow:"1"},[`& ${P3}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}}),qte=Ge(nF,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),$te=Ge(iF,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),fl=Ge(rF,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),sf=Ge(sF,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Kte=({handleScroll:n,children:e,className:t})=>B.createElement("div",{className:t,onScroll:n},e),Yte=Ge(Kte,{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),k3={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},zh=Ge("button",{textAlign:"left","&:hover":{color:"$accent"}}),B1=Ge("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),jh=Ge("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),Xte=Ge("div",{...k3,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},[`&[dir=rtl] ${jh}`]:{textAlign:"right !important"}}),Qte=({value:n,handleClick:e})=>B.createElement(zh,{onClick:e},B.createElement(jh,{dangerouslySetInnerHTML:{__html:n}})),Zte=({caption:n,handleClick:e,imageUri:t})=>B.createElement(zh,{onClick:e},B.createElement("img",{src:t,alt:`A visual annotation for ${n}`}),B.createElement("span",null,n)),Jte=({value:n,handleClick:e})=>{const t=mG(n);return B.createElement(zh,{onClick:e},B.createElement(jh,{dangerouslySetInnerHTML:{__html:t.html}}))},DA=({value:n,handleClick:e,isContentSearch:t})=>B.createElement(zh,{onClick:e},B.createElement(jh,{dangerouslySetInnerHTML:{__html:n},"data-content-search":t})),ene=()=>{function n(l){return l.map(u=>{const c=u.identifier||Ml();return{...u,identifier:c}})}function e(l){var u;const c=[],d=[],h=n(l);for(const p of h){for(;d.length>0&&d[d.length-1].end<=p.start;)d.pop();d.length>0?(d[d.length-1].children||(d[d.length-1].children=[]),(u=d[d.length-1].children)==null||u.push(p),d.push(p)):(c.push(p),d.push(p))}return c}function t(l,u=[]){return u.some(c=>l.start>=c.start&&l.end<=c.end)}function i(l=[]){return l.sort((u,c)=>u.start-c.start)}function r(l){const u=l.replace(/<(c|v|i|b|u|lang|ruby)(?:\.([^\s>]+))?(?:\s([^>]+))?>/g,(c,d,h,p)=>{const g=document.createElement(d);return h&&(g.className=h.replace(/\./g," ")),(p==null?void 0:p.length)>0&&(g.title=p),g.outerHTML.replace(new RegExp(`</${d}>$`),"")});return console.log("normalizeVttTags",u),u}function s(l){var u;for(const c of l.children)s(c);if(l.localName==="c"||l.localName==="v"){const c=document.createElement("span");for(const d of l.attributes)c.setAttribute(d.name,d.value);c.innerHTML=l.innerHTML,(u=l.parentNode)==null||u.replaceChild(c,l)}}function a(l){const u=r(l),c=document.createElement("div");return c.innerHTML=u,s(c),c.innerHTML}function o(l){return new Promise((u,c)=>{const d=EG.parse(l);d.errors&&d.errors.length&&c(d.errors),u(d.cues.map(h=>({identifier:h.identifier||Ml(),start:h.start,end:h.end,align:h.align,html:a(h.text),text:h.text||""})))})}return{addIdentifiersToParsedCues:n,createNestedCues:e,isChild:t,orderCuesByTime:i,parseVttData:o}},tne=Ge(g_,{display:"flex",flexDirection:"column",width:"100%"}),D3=Ge(v_,{...k3,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),nne=750,ine=n=>{for(;n&&n!==document.body;){const e=window.getComputedStyle(n).overflowY;if(e!=="visible"&&e!=="hidden"&&n.scrollHeight>n.clientHeight)return n;n=n.parentNode}return null},rne=({html:n,text:e,start:t,end:i})=>{var r,s;const a=si(),{activePlayer:o,configOptions:l,isAutoScrollEnabled:u,isUserScrolling:c}=qt(),d=(s=(r=l==null?void 0:l.informationPanel)==null?void 0:r.vtt)==null?void 0:s.autoScroll,[h,p]=U.useState(!1),g=U.useRef(null),v=o;U.useEffect(()=>(v==null||v.addEventListener("timeupdate",()=>{const{currentTime:b}=v;p(t<=b&&b<i)}),()=>document.removeEventListener("timeupdate",()=>{})),[i,t,v]),U.useEffect(()=>{var b;const T=x=>{a({type:"updateAutoScrolling",isAutoScrolling:!0}),x(),setTimeout(()=>a({type:"updateAutoScrolling",isAutoScrolling:!1}),nne)};if(u&&h&&g.current&&!c){const x=g.current;if(x&&x instanceof HTMLElement){const w=ine(x);if(w&&w instanceof HTMLElement){let A;switch((b=d==null?void 0:d.settings)==null?void 0:b.block){case"center":const R=w.getBoundingClientRect();A=x.offsetTop+x.offsetHeight-Math.floor((R.bottom-R.top)/2);break;case"end":A=x.offsetTop+x.offsetHeight-(w.clientHeight-x.clientHeight)+2;break;default:A=x.offsetTop-2;break}T(()=>{var R;return w.scrollTo({top:A,left:0,behavior:(R=d==null?void 0:d.settings)==null?void 0:R.behavior})})}}}},[d,h,c,u,a]);const y=()=>{v&&(v.pause(),v.currentTime=t,v.play())};return B.createElement(D3,{ref:g,"aria-checked":h,"data-testid":"information-panel-cue",onClick:y,value:e},B.createElement("div",{className:"webvtt-cue",dangerouslySetInnerHTML:{__html:n}}),B.createElement("strong",null,y3(t)))},sne=Ge("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${D3}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),O3=({items:n})=>B.createElement(sne,null,n.map(e=>{const{html:t,text:i,start:r,end:s,children:a,identifier:o}=e;return B.createElement("li",{key:o},B.createElement(rne,{html:t,text:i,start:r,end:s}),a&&B.createElement(O3,{items:a}))})),ane=({inlineCues:n,label:e,vttUri:t})=>{const[i,r]=B.useState(n||[]),{createNestedCues:s,orderCuesByTime:a,parseVttData:o}=ene(),[l,u]=B.useState();return U.useEffect(()=>{!n&&t&&fetch(t,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(c=>c.text()).then(c=>{o(c).then(d=>{const h=a(d),p=s(h);r(p)})}).catch(c=>{console.error(t,c.toString()),u(c)})},[t,n]),B.createElement(tne,{"data-testid":"annotation-item-vtt","aria-label":`${M1(e)}`},l&&B.createElement("div",{"data-testid":"error-message"},"Network Error: ",l.toString()),B.createElement(O3,{items:i}))},one=n=>{var e;if(!n)return"LTR";const t=["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"],i=Array.isArray(n)?(e=n[0])==null?void 0:e.split("-")[0]:n==null?void 0:n.split("-")[0];return t.includes(i)?"RTL":"LTR"},une=n=>{var e,t,i,r,s;let a={id:typeof n=="string"?n:n.source};if(typeof n=="string"){if(n.includes("#xywh=")){const o=n.split("#xywh=");if(o&&o[1]){const[l,u,c,d]=o[1].split(",").map(h=>Number(h));a={id:o[0],rect:{x:l,y:u,w:c,h:d}}}}else if(n.includes("#t=")){const o=n.split("#t=");o&&o[1]&&(a={id:o[0],t:o[1]})}}else if(typeof n=="object"){if(((e=n.selector)==null?void 0:e.type)==="PointSelector")a={id:n.source,point:{x:n.selector.x,y:n.selector.y}};else if(((t=n.selector)==null?void 0:t.type)==="SvgSelector")a={id:n.source,svg:n.selector.value};else if(((i=n.selector)==null?void 0:i.type)==="FragmentSelector"&&(r=n.selector)!=null&&r.value.includes("xywh=")&&n.source.type=="Canvas"&&n.source.id){const o=(s=n.selector)==null?void 0:s.value.split("xywh=");if(o&&o[1]){const[l,u,c,d]=o[1].split(",").map(h=>Number(h));a={id:n.source.id,rect:{x:l,y:u,w:c,h:d}}}}}return a},U1=({annotation:n,targetResource:e,isContentSearch:t,isContentState:i})=>{var r,s,a,o,l,u,c;const{target:d}=n,h=(r=d==null?void 0:d.selector)==null?void 0:r.type,p=((a=(s=d==null?void 0:d.selector)==null?void 0:s.value)==null?void 0:a.split("=")[1])||"full",[g,v]=p!=="full"?p==null?void 0:p.split(",").slice(2):[100,100],y=`${e}/${p}/!${((se,j)=>{const q=Math.max(se,j),re=Math.round(se/q*100),z=Math.round(j/q*100);return[re,z].join(",")})(g,v)}/0/default.jpg`,b=qt(),T=si(),{openSeadragonViewer:x,vault:w,visibleCanvases:A}=b,R=n!=null&&n.body?(o=n==null?void 0:n.body)==null?void 0:o.map(se=>w.get(se.id)):[],{format:_=h==="PointSelector"?"text/vtt":"text/plain",language:D="none",value:H="",chars:P=""}=R[0]?R[0]:{},N=h==="PointSelector"?"text/vtt":_,G=((l=R[0])==null?void 0:l.label)||{none:["t"]},X=H||P||"None",te=D?one(D).toLocaleLowerCase():"LTR",Q=h==="PointSelector"&&(u=d==null?void 0:d.selector)!=null&&u.t?[{start:(c=d==null?void 0:d.selector)==null?void 0:c.t,end:0,html:X,text:X,styles:"",children:[]}]:void 0;function ne(){var se;const j=x==null?void 0:x.getOverlayById(n.id);if(j&&x!=null&&x.viewport){j!=null&&j.element&&((se=j.element)==null||se.focus());const q=j==null?void 0:j.getBounds(x.viewport);q.x-=.2,q.y-=.2,q.width+=.5,q.height+=.5,x.viewport.fitBounds(q,!1)}}U.useEffect(()=>{if(!x||!i)return;const se=setInterval(()=>{x!=null&&x.getOverlayById(n.id)&&(ne(),x.container.className="clover-iiif-content-state",clearInterval(se))},1e3);return()=>clearInterval(se)},[x,i]);function oe(se){var j;se.preventDefault(),se.stopPropagation();const q=((j=n==null?void 0:n.target)==null?void 0:j.source)||(n==null?void 0:n.target),re=q==null?void 0:q.id;A.map(z=>z.id).includes(re)?ne():T({type:"updateActiveCanvas",canvasId:re})}function Z(){var se,j,q;switch(N){case"text/plain":return B.createElement(DA,{value:X,handleClick:oe,isContentSearch:t});case"text/html":return B.createElement(Qte,{value:X,handleClick:oe});case"text/markdown":return B.createElement(Jte,{value:X,handleClick:oe});case"text/vtt":return B.createElement(ane,{inlineCues:Q,label:G,vttUri:((se=R[0])==null?void 0:se.id)||void 0});case((j=_==null?void 0:_.match(/^image\//))==null?void 0:j.input):const re=((q=R.find(z=>{var ve;return!((ve=z.id)!=null&&ve.includes("vault://"))}))==null?void 0:q.id)||"";return B.createElement(Zte,{caption:H,handleClick:oe,imageUri:re});default:return B.createElement(DA,{value:X,handleClick:oe})}}if(_)return B.createElement(Xte,{dir:te,"data-format":_,"data-content":X,className:"clover-iiif-annotation-item"},B.createElement("span",{style:{backgroundImage:`url(${y})`,backgroundSize:"cover",backgroundPosition:"center"}}),Z())},N3=(n,e="none")=>{if(!n)return null;if(typeof n=="string")return[n];if(!n[e]){const t=Object.getOwnPropertyNames(n);if(t.length>0)return n[t[0]]}return!n[e]||!Array.isArray(n[e])?null:n[e]},xi=(n,e="none",t=", ")=>{const i=N3(n,e);return Array.isArray(i)?i.join(`${t}`):i};function lne(n){return{__html:cne(n)}}function _r(n,e){const t=Object.keys(n).filter(r=>e.includes(r)?null:r),i=new Object;return t.forEach(r=>{i[r]=n[r]}),i}function cne(n){return sW(n,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const dne=Ge("span",{}),as=n=>{const{as:e,label:t}=n,i=_r(n,["as","label"]);return B.createElement(dne,{as:e,...i},xi(t,i.lang))},fne=(n,e="200,",t="full")=>{Array.isArray(n)&&(n=n[0]);const{id:i,service:r}=n;let s;if(!r)return i;if(Array.isArray(n.service)&&n.service.length>0&&(s=r[0]),s){if(s["@id"])return`${s["@id"]}/${t}/${e}/0/default.jpg`;if(s.id)return`${s.id}/${t}/${e}/0/default.jpg`}},OA=Ge("img",{objectFit:"cover"}),hne=n=>{const e=U.useRef(null),{contentResource:t,altAsLabel:i,region:r="full"}=n;let s;i&&(s=xi(i));const a=_r(n,["contentResource","altAsLabel"]),{type:o,id:l,width:u=200,height:c=200,duration:d}=t;U.useEffect(()=>{if(!l&&!e.current||["Image"].includes(o)||!l.includes("m3u8"))return;const g=new Pn;return e.current&&(g.attachMedia(e.current),g.on(Pn.Events.MEDIA_ATTACHED,function(){g.loadSource(l)})),g.on(Pn.Events.ERROR,function(v,y){if(y.fatal)switch(y.type){case Pn.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${v} network error encountered, try to recover`),g.startLoad();break;case Pn.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${v} media error encountered, try to recover`),g.recoverMediaError();break;default:g.destroy();break}}),()=>{g&&(g.detachMedia(),g.destroy())}},[l,o]);const h=U.useCallback(()=>{if(!e.current)return;let g=0,v=30;if(d&&(v=d),!l.split("#t=")&&d&&(g=d*.1),l.split("#t=").pop()){const b=l.split("#t=").pop();b&&(g=parseInt(b.split(",")[0]))}const y=e.current;y.autoplay=!0,y.currentTime=g,setTimeout(()=>h(),v*1e3)},[d,l]);U.useEffect(()=>h(),[h]);const p=fne(t,`${u},${c}`,r);switch(o){case"Image":return B.createElement(OA,{as:"img",alt:s,css:{width:u,height:c},key:l,src:p,...a});case"Video":return B.createElement(OA,{as:"video",css:{width:u,height:c},disablePictureInPicture:!0,key:l,loop:!0,muted:!0,onPause:h,ref:e,src:l});default:return console.warn(`Resource type: ${o} is not valid or not yet supported in Primitives.`),B.createElement(B.Fragment,null)}},pne=Ge("a",{}),mne=n=>{const{children:e,homepage:t}=n,i=_r(n,["children","homepage"]);return B.createElement(B.Fragment,null,t&&t.map(r=>{const s=xi(r.label,i.lang);return B.createElement(pne,{"aria-label":e?s:void 0,href:r.id,key:r.id,...i},e||s)}))},gne={delimiter:", "},H1=U.createContext(void 0),M3=()=>{const n=U.useContext(H1);if(n===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return n},z1=({children:n,initialState:e=gne})=>{const t=vne(e,"delimiter");return B.createElement(H1.Provider,{value:{delimiter:t}},n)},vne=(n,e)=>Object.hasOwn(n,e)?n[e].toString():void 0,yne=Ge("span",{}),NA=n=>{const{as:e,markup:t}=n,{delimiter:i}=M3();if(!t)return B.createElement(B.Fragment,null);const r=_r(n,["as","markup"]),s=lne(xi(t,r.lang,i));return B.createElement(yne,{as:e,...r,dangerouslySetInnerHTML:s})},F3=n=>B.useContext(H1)?B.createElement(NA,{...n}):B.createElement(z1,null,B.createElement(NA,{...n})),Ene=({as:n="dd",lang:e,value:t})=>B.createElement(F3,{markup:t,as:n,lang:e}),bne=Ge("span",{}),Tne=({as:n="dd",customValueContent:e,lang:t,value:i})=>{var r;const{delimiter:s}=M3(),a=(r=N3(i,t))==null?void 0:r.map(o=>U.cloneElement(e,{value:o}));return B.createElement(bne,{as:n,lang:t},a==null?void 0:a.map((o,l)=>[l>0&&`${s}`,B.createElement(U.Fragment,{key:l},o)]))},B3=n=>{var e;const{item:t,lang:i,customValueContent:r}=n,{label:s,value:a}=t,o=(e=xi(s))==null?void 0:e.replace(" ","-").toLowerCase();return B.createElement("div",{role:"group","data-label":o},B.createElement(as,{as:"dt",label:s,lang:i}),r?B.createElement(Tne,{as:"dd",customValueContent:r,value:a,lang:i}):B.createElement(Ene,{as:"dd",value:a,lang:i}))};function xne(n,e){const t=e.filter(i=>{const{matchingLabel:r}=i,s=Object.keys(i.matchingLabel)[0],a=xi(r,s);if(xi(n,s)===a)return!0}).map(i=>i.Content);if(Array.isArray(t))return t[0]}const Sne=Ge("dl",{}),wne=n=>{const{as:e,customValueContent:t,metadata:i}=n;if(!Array.isArray(i))return B.createElement(B.Fragment,null);const r=T3(n,"customValueDelimiter"),s=_r(n,["as","customValueContent","customValueDelimiter","metadata"]);return B.createElement(z1,{...typeof r=="string"?{initialState:{delimiter:r}}:void 0},i.length>0&&B.createElement(Sne,{as:e,...s},i.map((a,o)=>{const l=t?xne(a.label,t):void 0;return B.createElement(B3,{customValueContent:l,item:a,key:o,lang:s==null?void 0:s.lang})})))};Ge("li",{});Ge("ul",{});const Ane=Ge("li",{}),Cne=Ge("ul",{}),Ine=n=>{const{as:e,rendering:t}=n,i=_r(n,["as","rendering"]);return B.createElement(Cne,{as:e},t&&t.map(r=>{const s=xi(r.label,i.lang);return B.createElement(Ane,{key:r.id},B.createElement("a",{href:r.id,...i,target:"_blank"},s||r.id))}))},Rne=Ge("dl",{}),_ne=n=>{const{as:e,requiredStatement:t}=n;if(!t)return B.createElement(B.Fragment,null);const i=T3(n,"customValueDelimiter"),r=_r(n,["as","customValueDelimiter","requiredStatement"]);return B.createElement(z1,{...typeof i=="string"?{initialState:{delimiter:i}}:void 0},B.createElement(Rne,{as:e,...r},B.createElement(B3,{item:t,lang:r.lang})))},Lne=Ge("li",{}),Pne=Ge("ul",{}),kne=n=>{const{as:e,seeAlso:t}=n,i=_r(n,["as","seeAlso"]);return B.createElement(Pne,{as:e},t&&t.map(r=>{const s=xi(r.label,i.lang);return B.createElement(Lne,{key:r.id},B.createElement("a",{href:r.id,...i},s||r.id))}))},Dne=n=>{const{as:e,summary:t}=n,i=_r(n,["as","customValueDelimiter","summary"]);return B.createElement(F3,{as:e,markup:t,...i})},U3=n=>{const{thumbnail:e,region:t}=n,i=_r(n,["thumbnail"]);return B.createElement(B.Fragment,null,e&&e.map(r=>B.createElement(hne,{contentResource:r,key:r.id,region:t,...i})))},One=({annotationPage:n})=>{var e,t,i,r,s,a;const o=qt(),{vault:l}=o;if(!n||!n.items||((e=n.items)==null?void 0:e.length)===0)return B.createElement(B.Fragment,null);const u=n.items.map(g=>l.get(g.id));if(!u)return B.createElement(B.Fragment,null);const c=u.reduce((g,v)=>(g.canvas=v.target.source.id,g.annotations=[],g.annotations.push(v==null?void 0:v.id),g),{}),d=l.get(c.canvas),h=Qs(l,d.id),p=(t=h==null?void 0:h[0])!=null&&t.service?((r=(i=h==null?void 0:h[0])==null?void 0:i.service[0])==null?void 0:r.id)||((a=(s=h==null?void 0:h[0])==null?void 0:s.service[0])==null?void 0:a["@id"]):void 0;return B.createElement(B1,{"data-testid":"annotation-page"},d&&B.createElement("header",null,B.createElement(as,{label:d.label})),B.createElement("div",{"data-testid":"annotation-page-items"},u==null?void 0:u.map(g=>B.createElement(U1,{annotation:g,targetResource:p,key:g.id}))))},Nne=Ge("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),Mne=Ge("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Fne=({searchServiceUrl:n,setContentSearchResource:e,setLoading:t})=>{const{t:i}=Zs(),[r,s]=U.useState(),a=qt(),{openSeadragonViewer:o,vault:l}=a;async function u(h){if(h.preventDefault(),!!o&&n){if(!r||r.trim()===""){e({});return}t(!0),C3(l,n,{q:r}).then(p=>{e(p),t(!1)})}}const c=h=>{h.preventDefault(),s(h.target.value)},d=i("contentSearchPlaceholder");return B.createElement(Nne,null,B.createElement(MX,{onSubmit:u,className:"content-search-form"},B.createElement(FX,{className:"content-search-input",name:"searchTerms",onChange:c},B.createElement(BX,{placeholder:d})),B.createElement(UX,{asChild:!0},B.createElement(Mne,{type:"submit"},B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},B.createElement("title",null,i("informationPanelTabsSearch")),B.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},Bne=({searchServiceUrl:n,setContentSearchResource:e,activeCanvas:t,annotationPage:i})=>{const r=qt(),{vault:s}=r,{t:a}=Zs(),[o,l]=U.useState(!1),[u,c]=U.useState({});U.useEffect(()=>{var h;if(!(i!=null&&i.items))return;const p=((h=i==null?void 0:i.items)==null?void 0:h.map(g=>s.get(g.id))).reduce((g,v)=>{const y=v.target.source.id;return g[y]||(g[y]=[]),g[y].push(v.id),g},{});c(p)},[i]);let d;return B.createElement(B.Fragment,null,B.createElement(Fne,{searchServiceUrl:n,setContentSearchResource:e,activeCanvas:t,setLoading:l}),o?B.createElement("span",null,a("contentSearchLoading")):u&&Object.keys(u).length>0&&Object.keys(u).map(h=>(d=s.get(h),B.createElement(B1,{key:h,"data-testid":"annotation-page"},d&&B.createElement("header",null,B.createElement(as,{label:d.label})),u[h].map(p=>{var g,v,y,b,T;const x=s.get(p),w=Qs(s,d.id),A=(g=w==null?void 0:w[0])!=null&&g.service?((y=(v=w==null?void 0:w[0])==null?void 0:v.service[0])==null?void 0:y.id)||((T=(b=w==null?void 0:w[0])==null?void 0:b.service[0])==null?void 0:T["@id"]):void 0;return B.createElement(U1,{annotation:x,targetResource:A,key:x.id,isContentSearch:!0})})))))},Une=Ge("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),Hne=Ge("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),zne=({homepage:n})=>(n==null?void 0:n.length)===0?B.createElement(B.Fragment,null):B.createElement(B.Fragment,null,B.createElement("span",{className:"manifest-property-title"},"Homepage"),B.createElement(mne,{homepage:n})),jne=({id:n,htmlLabel:e,parent:t="manifest"})=>B.createElement(B.Fragment,null,B.createElement("span",{className:"manifest-property-title"},e),B.createElement("a",{href:n,target:"_blank",id:`iiif-${t}-id`},n)),Vne=({metadata:n,parent:e="manifest"})=>n?B.createElement(B.Fragment,null,B.createElement(wne,{metadata:n,id:`iiif-${e}-metadata`})):B.createElement(B.Fragment,null),Gne=({rendering:n})=>(n==null?void 0:n.length)===0?B.createElement(B.Fragment,null):B.createElement(B.Fragment,null,B.createElement("span",{className:"manifest-property-title"},"Alternate formats"),B.createElement(Ine,{rendering:n})),Wne=({requiredStatement:n,parent:e="manifest"})=>n?B.createElement(B.Fragment,null,B.createElement(_ne,{requiredStatement:n,id:`iiif-${e}-required-statement`})):B.createElement(B.Fragment,null),qne=({rights:n})=>n?B.createElement(B.Fragment,null,B.createElement("span",{className:"manifest-property-title"},"Rights"),B.createElement("a",{href:n,target:"_blank"},n)):B.createElement(B.Fragment,null),$ne=({seeAlso:n})=>(n==null?void 0:n.length)===0?B.createElement(B.Fragment,null):B.createElement(B.Fragment,null,B.createElement("span",{className:"manifest-property-title"},"See Also"),B.createElement(kne,{seeAlso:n})),Kne=({summary:n,parent:e="manifest"})=>n?B.createElement(B.Fragment,null,B.createElement(Dne,{summary:n,as:"p",id:`iiif-${e}-summary`})):B.createElement(B.Fragment,null),Yne=({label:n,thumbnail:e})=>(e==null?void 0:e.length)===0?B.createElement(B.Fragment,null):B.createElement(B.Fragment,null,B.createElement(U3,{altAsLabel:n||{none:["resource"]},thumbnail:e,style:{backgroundColor:"#6663",objectFit:"cover"}})),Xne=()=>{const n=qt(),{activeManifest:e,vault:t}=n,[i,r]=U.useState(),[s,a]=U.useState([]),[o,l]=U.useState([]),[u,c]=U.useState([]),[d,h]=U.useState([]);return U.useEffect(()=>{var p,g,v,y;const b=t.get(e);b&&(r(b),((p=b.homepage)==null?void 0:p.length)>0&&a(t.get(b.homepage)),((g=b.seeAlso)==null?void 0:g.length)>0&&l(t.get(b.seeAlso)),((v=b.rendering)==null?void 0:v.length)>0&&c(t.get(b.rendering)),((y=b.thumbnail)==null?void 0:y.length)>0&&h(t.get(b.thumbnail)))},[e,t]),i?B.createElement(Hne,null,B.createElement(Une,null,B.createElement(Yne,{thumbnail:d,label:i.label}),B.createElement(Kne,{summary:i.summary}),B.createElement(Vne,{metadata:i.metadata}),B.createElement(Wne,{requiredStatement:i.requiredStatement}),B.createElement(qne,{rights:i.rights}),B.createElement(zne,{homepage:s}),B.createElement($ne,{seeAlso:o}),B.createElement(Gne,{rendering:u}),B.createElement(jne,{id:i.id,htmlLabel:"IIIF Manifest"}))):B.createElement(B.Fragment,null)};function Qne(n){const e=[];return n.forEach(t=>{var i;(i=t.informationPanel)!=null&&i.component&&e.push(t)}),{pluginsWithInfoPanel:e}}const Zne=({contentStateAnnotation:n})=>{var e,t,i,r,s,a;const o=qt(),{vault:l}=o;if(!n)return B.createElement(B.Fragment,null);const u=((e=n==null?void 0:n.target)==null?void 0:e.source)||(n==null?void 0:n.target),c=l.get(u==null?void 0:u.id),d=Qs(l,c.id),h=(t=d==null?void 0:d[0])!=null&&t.service?((r=(i=d==null?void 0:d[0])==null?void 0:i.service[0])==null?void 0:r.id)||((a=(s=d==null?void 0:d[0])==null?void 0:s.service[0])==null?void 0:a["@id"]):void 0;return B.createElement(B1,{"data-testid":"annotation-page"},c&&B.createElement("header",null,B.createElement(as,{label:c.label})," ",B.createElement("em",null,"(Shared)")),B.createElement("div",{"data-testid":"annotation-page-items"},B.createElement(U1,{annotation:n,targetResource:h,key:n.id,isContentState:!0})))},Jne=1500,eie=({activeCanvas:n,annotationResources:e,searchServiceUrl:t,setContentSearchResource:i,contentSearchResource:r})=>{var s;const{t:a}=Zs(),o=si(),l=qt(),{contentStateAnnotation:u,informationPanelResource:c,isAutoScrolling:d,isUserScrolling:h,vault:p,configOptions:g,plugins:v}=l,{informationPanel:y}=g,b=y==null?void 0:y.renderAbout,T=y==null?void 0:y.renderAnnotation,x=p.get({id:n,type:"Canvas"}),w=y==null?void 0:y.renderContentSearch,A=y==null?void 0:y.renderToggle,R=((s=u==null?void 0:u.target)==null?void 0:s.source)||(u==null?void 0:u.target),_=!!u&&R.id===n,D=!!(e!=null&&e.length)||_,{pluginsWithInfoPanel:H}=Qne(v);function P(te,Q){var ne,oe;const Z=(ne=te==null?void 0:te.informationPanel)==null?void 0:ne.component;return Z===void 0?B.createElement(B.Fragment,null):B.createElement(sf,{key:Q,value:te.id},B.createElement(py,{FallbackComponent:F1},B.createElement(Z,{...(oe=te==null?void 0:te.informationPanel)==null?void 0:oe.componentProps,canvas:x,useViewerDispatch:si,useViewerState:qt})))}const N=()=>{o({type:"updateInformationOpen",isInformationOpen:!1})};U.useEffect(()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(y==null?void 0:y.defaultTab))?o({type:"updateInformationPanelResource",informationPanelResource:y==null?void 0:y.defaultTab}):o(_?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[]),U.useEffect(()=>{D||o({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[D]);function G(){if(!d){clearTimeout(h);const te=setTimeout(()=>{o({type:"updateUserScrolling",isUserScrolling:void 0})},Jne);o({type:"updateUserScrolling",isUserScrolling:te})}}const X=te=>{o({type:"updateInformationPanelResource",informationPanelResource:te})};return B.createElement(qte,{"data-testid":"information-panel",defaultValue:c,onValueChange:X,orientation:"horizontal",value:c,className:"clover-viewer-information-panel"},B.createElement($te,{"aria-label":a("informationPanelTabs"),"data-testid":"information-panel-list"},A&&B.createElement(fl,{value:"manifest-back","data-value":"manifest-back",onClick:N,as:"button"},a("informationPanelTabsClose")),b&&B.createElement(fl,{value:"manifest-about"},a("informationPanelTabsAbout")),w&&r&&B.createElement(fl,{value:"manifest-content-search"},a("informationPanelTabsSearch")),T&&D&&B.createElement(fl,{value:"manifest-annotations"},(y==null?void 0:y.annotationTabLabel)||a("informationPanelTabsAnnotations")),H&&H.map((te,Q)=>{var ne;return B.createElement(fl,{key:Q,value:te.id},B.createElement(as,{label:(ne=te.informationPanel)==null?void 0:ne.label}))})),B.createElement(Yte,{handleScroll:G},b&&B.createElement(sf,{value:"manifest-about"},B.createElement(Xne,null)),w&&r&&B.createElement(sf,{value:"manifest-content-search"},B.createElement(Bne,{searchServiceUrl:t,setContentSearchResource:i,activeCanvas:n,annotationPage:r})),T&&e&&B.createElement(sf,{value:"manifest-annotations"},u&&_&&B.createElement(Zne,{contentStateAnnotation:u}),e.map(te=>B.createElement(One,{key:te.id,annotationPage:te}))),H&&H.map((te,Q)=>P(te,Q))))},tie=()=>B.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),nie=()=>B.createElement(B.Fragment,null,B.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),B.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),B.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),iie=()=>B.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),rie=()=>B.createElement(B.Fragment,null,B.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),B.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),sie=()=>B.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),aie=()=>B.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),H3=Ge("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),oie=({children:n})=>B.createElement("title",null,n),Un=n=>B.createElement(H3,{...n,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},n.children);Un.Title=oie;Un.Add=tie;Un.Audio=nie;Un.Close=iie;Un.Download=rie;Un.Image=sie;Un.Video=aie;const uie=_3({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),lie=_3({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),z3=Ge(IJ,{fill:"$secondaryAlt"}),cie=Ge(CJ,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),die=Ge(AJ,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:lie},'&[data-side="bottom"]':{animationName:uie},'&[data-align="end"]':{[`& ${z3}`]:{margin:"0 0.7rem"}}}),fie=Ge(wJ,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),hie=Ge(SJ,{boxSizing:"content-box"}),pie=n=>B.createElement(fie,{...n},n.children),mie=n=>B.createElement(die,{...n,sideOffset:5,collisionPadding:21},B.createElement(z3,null),B.createElement(cie,null,B.createElement(Un,{isSmall:!0},B.createElement(Un.Close,null))),n.children),Za=({children:n})=>B.createElement(hie,null,n);Za.Trigger=pie;Za.Content=mie;const eh=Ge("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${H3}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Af=Ge("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),j3=Ge("span",{display:"flex"}),gie=Ge("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),vie=Ge("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Cf=Ge("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${j3}`]:{position:"absolute",right:"0",bottom:"0",[`& ${eh}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),Jv=Ge(v_,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),yie=Ge(g_,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),Eie=Ge("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${Jv}`]:{figcaption:{fontWeight:"700"},[`& ${eh}`]:{backgroundColor:"$accent"},[`& ${Af}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${Af}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${Af}`]:{borderLeft:"unset"}}}},[`& ${Jv}`]:{[`& ${Cf}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${Cf}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${Cf}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${eh}`]:{display:"flex"}}}}),V3=Ge("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),bie=Ge("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),Og=Ge("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Tie=Ge("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),xie=Ge("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${V3}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),Sie=(n,e)=>{U.useEffect(()=>{function t(i){i.key===n&&e()}return window.addEventListener("keyup",t),()=>window.removeEventListener("keyup",t)},[])},wie=({title:n})=>B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},B.createElement("title",null,n),B.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Aie=({title:n})=>B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},B.createElement("title",null,n),B.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Cie=({title:n})=>B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},B.createElement("title",null,n),B.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),Iie=({title:n})=>B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},B.createElement("title",null,n),B.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Rie=({handleCanvasToggle:n,handleFilter:e,activeIndex:t,canvasLength:i})=>{const[r,s]=U.useState(!1),[a,o]=U.useState(!1),[l,u]=U.useState(!1),{t:c}=Zs();U.useEffect(()=>{u(t===0),t===i-1?o(!0):o(!1)},[t,i]),Sie("Escape",()=>{s(!1),e("")});const d=()=>{s(p=>!p),e("")},h=p=>e(p.target.value);return B.createElement(xie,{isToggle:r,className:"clover-viewer-media-controls"},B.createElement(V3,null,r&&B.createElement(bie,{autoFocus:!0,onChange:h,placeholder:c("commonSearchPlaceholder")}),!r&&B.createElement(Tie,{className:"clover-viewer-media-navigation"},B.createElement(Og,{onClick:()=>n(-1),disabled:l,type:"button"},B.createElement(wie,{title:c("commonPrevious")})),B.createElement("span",null,t+1," ",B.createElement("em",null,"/")," ",i),B.createElement(Og,{onClick:()=>n(1),disabled:a,type:"button"},B.createElement(Aie,{title:c("commonNext")}))),B.createElement(Og,{onClick:d,type:"button",className:"clover-viewer-media-search"},r?B.createElement(Cie,{title:c("commonClose")}):B.createElement(Iie,{title:c("commonSearch")}))))},_ie=({children:n,rootMargin:e="100px",attributes:t={},isVisibleCallback:i=()=>{}})=>{const r=U.useRef(null),[s,a]=U.useState(!1);return U.useEffect(()=>{const o=r.current;if(!o)return;const l=new IntersectionObserver(([u])=>{u.isIntersecting&&(i(!0),a(!0),l.disconnect())},{rootMargin:e});return l.observe(o),()=>l.disconnect()},[r]),B.createElement("div",{ref:r,...t},s?n:null)};var G3="http://library.stanford.edu/iiif/image-api/compliance.html#level0",W3="http://library.stanford.edu/iiif/image-api/compliance.html#level1",q3="http://library.stanford.edu/iiif/image-api/compliance.html#level2",$3="http://library.stanford.edu/iiif/image-api/conformance.html#level0",K3="http://library.stanford.edu/iiif/image-api/conformance.html#level1",Y3="http://library.stanford.edu/iiif/image-api/conformance.html#level2",X3="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",Q3="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",Z3="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",J3="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",eD="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",tD="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",nD="http://iiif.io/api/image/1/level0.json",iD="http://iiif.io/api/image/1/profiles/level0.json",rD="http://iiif.io/api/image/1/level1.json",sD="http://iiif.io/api/image/1/profiles/level1.json",aD="http://iiif.io/api/image/1/level2.json",oD="http://iiif.io/api/image/1/profiles/level2.json",uD="http://iiif.io/api/image/2/level0.json",lD="http://iiif.io/api/image/2/profiles/level0.json",cD="http://iiif.io/api/image/2/level1.json",dD="http://iiif.io/api/image/2/profiles/level1.json",fD="http://iiif.io/api/image/2/level2.json",hD="http://iiif.io/api/image/2/profiles/level2.json",pD="level0",mD="level1",gD="level2",vD="http://iiif.io/api/image/2/level0",yD="http://iiif.io/api/image/2/level1",ED="http://iiif.io/api/image/2/level2",Vh=[ED,q3,Y3,Z3,tD,aD,oD,fD,hD,gD],j1=[...Vh,yD,W3,K3,Q3,eD,rD,sD,cD,dD,mD],bD=[vD,yD,ED,G3,W3,q3,$3,K3,Y3,X3,Q3,Z3,J3,eD,tD,nD,iD,rD,sD,aD,oD,uD,lD,cD,dD,fD,hD,pD,mD,gD],Lie=bD,TD=[vD,G3,$3,X3,J3,nD,iD,uD,lD,pD],Pie={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},kie={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},Die={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]},Oie=Object.defineProperty,Nie=(n,e,t)=>e in n?Oie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,MA=(n,e,t)=>(Nie(n,typeof e!="symbol"?e+"":e,t),t);function Mie(n){try{if(n==="full")return{full:!0};if(n==="square")return{square:!0};let e=n.startsWith("pct:"),t=n.substr(e?4:0).split(",").map(i=>parseFloat(i));return{x:t[0],y:t[1],w:t[2],h:t[3],percent:e}}catch{throw new Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+n)}}function Fie(n){let e={upscaled:!1,max:!1,confined:!1};if(n[0]==="^"&&(e.upscaled=!0,n=n.slice(1)),n==="max"||n==="full")return e.max=!0,e.serialiseAsFull=n==="full",e;if(n[0]==="!"&&(e.confined=!0,n=n.slice(1)),n[0]==="p")return e.percentScale=parseFloat(n.slice(4)),e;let t=n.split(",").map(i=>i.trim());return t.length&&(t[0]!==""&&(e.width=parseInt(t[0],10)),t[1]!==""&&(e.height=parseInt(t[1],10))),e}function Bie(n){let e={angle:0};if(n[0]==="!"&&(e.mirror=!0,n=n.substr(1)),e.angle=parseFloat(n)%360,Number.isNaN(e.angle))throw new Error(`Invalid rotation ${n}`);return e}function Uie(n,e=""){let t=n.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!t)throw new Error(`Invalid or unknown input ${n}`);let i=t[2],r=t[3],s=t[4];if(s[0]==="/"&&(s=s.substring(1)),e.length>0){if(e[0]==="/"&&(e=e.substring(1)),e!==s.substring(0,e.length))throw new Error(`Path does not start with prefix (path: ${s}, prefix: ${e})`);s=s.substring(e.length)}return{scheme:i,server:r,path:s,prefix:e}}function Hie(n,e=""){let{path:t,scheme:i,server:r,prefix:s}=Uie(n,e),a=t.split("/").reverse(),[o,l,u,c,...d]=a,h=d.reverse().filter(Boolean).join("/");if(a.length===1||o==="")return{type:"base",scheme:i,server:r,prefix:s,identifier:h};if(o==="info.json"){let[,...v]=a;return{type:"info",scheme:i,server:r,prefix:s,identifier:v.reverse().filter(Boolean).join("/")}}if(typeof i>"u"||typeof r>"u"||typeof t>"u"||typeof c>"u"||typeof u>"u"||typeof l>"u"||typeof o>"u")throw new Error("Invalid image service URL");let[p="",g=""]=o.split(".");return{type:"image",scheme:i,server:r,prefix:s,identifier:h,originalPath:t,region:Mie(c),size:Fie(u),rotation:Bie(l),quality:p,format:g}}function zie(n){return Vh.indexOf(n)!==-1?Die:j1.indexOf(n)!==-1?kie:Pie}function jie(n){let e=n?Array.isArray(n.profile)?n.profile:[n.profile]:[],t={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let i of e)if(typeof i=="string"&&(i=zie(i)),!!i){if(i.formats)for(let r of i.formats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(i.qualities)for(let r of i.qualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);if(i.supports)for(let r of i.supports)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);if(i.maxHeight&&(t.maxHeight=i.maxHeight),i.maxWidth&&(t.maxWidth=i.maxWidth),i.maxArea&&(t.maxArea=i.maxArea),i.extraFormats)for(let r of i.extraFormats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(i.extraQualities)for(let r of i.extraQualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);if(i.extraFeatures)for(let r of i.extraFeatures)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);i.maxHeight&&(t.maxHeight=i.maxHeight),i.maxWidth&&(t.maxWidth=i.maxWidth),i.maxArea&&(t.maxArea=i.maxArea)}if(n.extraFormats)for(let i of n.extraFormats)t.extraFormats.indexOf(i)===-1&&t.extraFormats.push(i);if(n.extraFeatures)for(let i of n.extraFeatures)t.extraFeatures.indexOf(i)===-1&&t.extraFeatures.push(i);if(n.extraQualities)for(let i of n.extraQualities)t.extraQualities.indexOf(i)===-1&&t.extraQualities.push(i);return t}function FA(n){let e=Array.isArray(n.profile)?n.profile:[n.profile];for(let t of e)if(typeof t=="string"&&TD.indexOf(t)!==-1)return!0;return!1}function Yt(n){if(n["@id"])return n["@id"];if(n.id)return n.id}function Gh(n){if(!n||!n.profile||!Yt(n))return!1;let e=Array.isArray(n.profile)?n.profile:[n.profile];for(let t of e)if(typeof t=="string"&&bD.indexOf(t)!==-1)return!0;return!1}function Vie(n){if(!Gh(n))return!1;let e=Array.isArray(n.profile)?n.profile:[n.profile];for(let t of e)if(typeof t=="string"){if(j1.indexOf(t)!==-1)return!0}else{let i=[...t.supports||[],...t.extraFeatures||[]];if(i.indexOf("regionByPx")!==-1&&(i.indexOf("sizeByW")!==-1||i.indexOf("sizeByWh")!==-1))return!0}return!1}function Gie({x:n=0,y:e=0,w:t,h:i,full:r,square:s,percent:a}){return"full"}function Wie({max:n,percentScale:e,upscaled:t,confined:i,width:r,height:s,serialiseAsFull:a,version:o}){let l=[];return t&&l.push("^"),n?(l.push(a?"full":"max"),l.join("")):(i&&l.push("!"),e&&l.push(`pct:${e}`),r&&l.push(`${r}`),l.push(","),s&&o===3&&l.push(`${s}`),l.join(""))}function qie(n){return`${n.mirror?"!":""}${(n.angle||0)%360}`}function $ie(n,e){let t=n.prefix.startsWith("/")?n.prefix.substring(1):n.prefix,i=`${n.scheme}://${n.server}/${t?`${t}/`:""}${n.identifier}`,{size:r}=n,{region:s,rotation:a,format:o,quality:l}=n;return[i,Gie(s),Wie(r),qie(a),`${l}.${o}`].filter(Boolean).join("/")}function La(n){return n.endsWith("info.json")?n:n.endsWith("/")?`${n}info.json`:`${n}/info.json`}function Kie(n){let e=Hie(La(n.id));if(e.type!=="info")throw new Error("Invalid service URL");let t=jie(n);return{identifier:e.identifier,originalPath:"",server:e.server,prefix:e.prefix,scheme:e.scheme,type:"image",quality:t.extraQualities.indexOf("default")===-1?t.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}function Yie(n,e,t){let i=t.length,r=[];for(let s=0;s<i;s++){let a=t[s];if(!a)continue;let o=a.width;r.push(n/o)}return r}function Xie(n,e,t){let i=t.length,r=[];for(let s=0;s<i;s++){let a=t[s];a&&r.push({width:Math.floor(n/a),height:Math.floor(e/a)})}return r}function Ng(n,e){if(e&&e.profile){let t=e.profile;if(t){let i=Array.isArray(t)?t:[t];if(i.includes(`level${n}`)||i.includes(`http://iiif.io/api/image/2/level${n}.json`)||i.includes(`http://iiif.io/api/image/1/level${n}.json`)||i.includes(`http://iiif.io/api/image/1/profiles/level${n}.json`))return!0;if(n===2){for(let r of i)if(Vh.includes(r))return!0}if(n===1){for(let r of i)if(j1.includes(r))return!0}if(n===0){for(let r of i)if(TD.includes(r))return!0}}}return!1}function ey(n){return Gh(n)?Ng(0,n)?0:Ng(1,n)?1:Ng(2,n)?2:null:null}function xD(n){let e=n.service?Array.isArray(n.service)?n.service:[n.service]:[],t=e.length,i=[];for(let r=0;r<t;r++)Gh(e[r])&&i.push(e[r]);return i}function Qie(n){if(n["@type"])return n["@type"];if(n.type)return n.type}function Fo(n){const e=n.replace(/(https?:\/\/)?(www.)?/i,"");return e.indexOf("/")!==-1?e.split("/")[0]:e}function Zie(n,e,t){const i=n>e?n:e,r=t.length,s=[];for(let a=0;a<r;a++){const o=t[a];if(!o||o.scaleFactors.length===0)continue;let l=o.scaleFactors[0];if(!l)continue;let u=i/l;const c=[l];for(;u>=o.width;)l=l*2,c.push(l),u=u/2;s.push({...o,scaleFactors:c})}return s}function Mg(n,e,t){const i=Kie({"@context":n.version===3?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:La(Yt(n)),profile:n.level===null||typeof n.level>"u"?"level0":`level${n.level}`,type:n.version===3?"ImageService3":"ImageService2"});return i.size.max=!1,i.size.width=e,i.size.height=t,{id:$ie(i),type:"fixed",width:e,height:t||n.height/(n.width||1)*e,unsafe:n.width>e}}function Jie(n,e,t){const i=n.width?n.width:n.maxWidth;return t.height<=n.maxHeight&&t.width<=n.maxWidth&&t.height>=n.minHeight&&t.width>=n.minWidth&&(!e||Math.abs(t.width-i)<Math.abs(e.width-i))}function ere(n,e){const t=[],i=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},n),r=(c,d=0)=>i.explain?t.push(new Array(d).fill(0).map(h=>"    ").join("")+c().trim()):void 0,s=[],a=[];let o=null;r(()=>`Using configuration: ${JSON.stringify(i,null,2)}`);const l=(c,d)=>{if(r(()=>"Swapping choice",3),Jie(i,d,c)){if(i.preferFixedSize&&c.unsafe){r(()=>`We found an image that was marked as unsafe, but it was the best size. (${c.id})`,4),a.push(c);return}i.returnAllOptions&&d&&a.push(d),r(()=>`We found a new image that was the best size. (${c.id})`,4),o=c}else i.returnAllOptions&&a.push(c)};r(()=>`The input shows we have ${e.length} list(s) of candidates to choose from.`);const u=e.length;for(let c=0;c<u;c++){const d=e[c]();r(()=>`Candidate group ${c}: ${JSON.stringify(d,null,2)}`,1);const h=d.length;r(()=>`Checking candidate list number ${c} and found ${h} potential ways of creating image(s)`,1);for(let p=0;p<h;p++){const g=d[p];if(r(()=>`-> Checking candidate ${p}`,1),g.type==="unknown"&&i.atAnyCost&&(r(()=>`We've found an unknown image type, adding this to the "last resort" list`,2),s.push(g)),g.type==="fixed"&&(g.unsafe?(r(()=>`We've found an unsafe fixed image type, adding this to the "last resort" list`,2),s.push(g)):(r(()=>"We've found a fixed size image, checking if it matches the request",2),l(g,o))),g.type==="fixed-service")if(i.unsafeImageService){r(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2);const v=Mg(g,i.width,i.height);l(v,o)}else{r(()=>"Checking for an image from the tile source 3",2);const v=Mg(g,g.width,g.height);l(v,o)}if(g.type==="variable"&&g.maxWidth){const v=Mg({id:g.id,width:g.maxWidth,height:g.maxWidth,level:g.level,version:g.version},g.maxWidth);l(v,o)}}if(o&&!i.returnAllOptions){if(o.unsafe||i.allowUnsafe)continue;r(()=>`We found a match in choice list number ${c}, no searching any more`);break}}return i.atAnyCost&&a.length===0?(r(()=>o?`We found an image! ${o.id} of type ${o.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:o||s[0]||null,fallback:s.slice(1),log:t}):i.returnAllOptions?(r(()=>"Returning all options that we have found"),{best:(i.atAnyCost?o||a[0]||s[0]:o||a[0])||null,fallback:[...a,...s],log:t}):(r(()=>"Returning the best image that we found, and a fallback"),{best:o||a[0]||null,fallback:o?a:a.slice(1),log:t})}function SD(n){return(n["@context"]?Array.isArray(n["@context"])?n["@context"]:[n["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")!==-1}function tre(n){return Gh(n)?(n&&n.sizes?n.sizes:[]).map(e=>({id:Yt(n),type:"fixed-service",height:e.height,width:e.width,level:ey(n),version:SD(n)?3:2})):[]}function nre(n){if(!Vie(n))return[];const e=[],t=Array.isArray(n.profile)?n.profile:[n.profile],i=t.length;for(let r=0;r<i;r++){const s=t[r];if(s&&typeof s!="string"&&(s.maxHeight||s.maxWidth))return[{id:Yt(n),type:"variable",minWidth:0,minHeight:0,maxHeight:s.maxHeight||s.maxWidth,maxWidth:s.maxWidth||s.maxHeight,level:ey(n),version:n["@context"]==="http://iiif.io/api/image/3/context.json"?3:2}]}if(n.tiles){const r=n.tiles.length;for(let s=0;s<r;s++){const a=n.tiles[s];a&&(a.height||a.width)&&e.push({id:Yt(n),type:"variable",minHeight:0,minWidth:0,maxHeight:a.height||a.width,maxWidth:a.width,level:ey(n),version:SD(n)?3:2})}}return e}function BA(n){const e=[],t=n.length;for(let i=0;i<t;i++){const r=n[i];if(!r)continue;const s=tre(r);s.length&&e.push(...s);const a=nre(r);a.length&&e.push(...a)}return e}function UA(n){const e=/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/,t=n.match(e);if(t&&t[4]&&t[5]){const i=t[1],r=parseInt(t[4],10),s=parseInt(t[5],10),a=t[7];if((i==="max"||i==="full")&&r&&s&&a)return{type:"fixed",id:n,height:s,width:r}}return{type:"unknown",id:n}}function ty(n){if(typeof n=="string")return UA(n);const e=Qie(n);if(e!=="Image"&&e!=="sc:Image")return null;const t=n,i=Yt(t);return i?i&&t.width&&t.height?{id:i,type:"fixed",width:t.width,height:t.height,unsafe:!0}:UA(i):null}function ire(n,e=!0,t){const i=[],r=ty(n);if(r===null)return i;const s=n;if(i.push(r),e&&s&&s.width&&s.height){const a=[],o=xD(s);for(const l of o){const u={id:Yt(l),width:s.width,height:s.height};if(t.canLoadSync(u)){const c=t.loadServiceSync(u);c&&(c.height||(c.height=s.height),c.width||(c.width=s.width),a.push(...BA([c])))}}if(a.length)return i.push(...a),i}return s.service&&i.push(...BA(s.service)),i}function rre(n,e){if(n.length!==e.length)return!1;if(n.length===0&&e.length===0)return!0;const t=n.length;let i=!0;for(let s=0;s<t;s++){const a=n[s],o=e[s];if(a.width!==o.width||a.height!==o.height){i=!1;break}}if(i)return!0;let r=0;for(let s=0;s<t;s++)for(let a=0;a<t;a++)if(n[s].width===e[a].width&&n[s].height===e[a].height){r++;break}return r===t}var wD=class{constructor(n={}){Li(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),Li(this,"fetchingCount",0),Li(this,"imageServices",{}),Li(this,"knownImageServers",{}),this.config=Object.assign(this.config,n)}setConfig(n){Object.assign(this.config,n)}sample(n,e,t=!0){const i=Fo(Yt(n)),r=La(Yt(n)),s=this.knownImageServers[i];return this.imageServices[r]=Object.assign(n,{real:!0}),!s&&n.tiles&&!FA(n)?(this.knownImageServers[i]={verifications:0,malformed:!1,root:i,preLoaded:t,sampledId:Yt(n),verified:!1,server:null,result:{context:n["@context"]||[],sampledProfile:n.profile,resourceServiceRatio:e&&n.height?e.height/n.height:1,sampledSizes:n.sizes||[],sizeRatios:Yie(n.width,n.height,n.sizes||[]),sampledTiles:n.tiles||[]}},!0):this.verify(n)}preLoad(n,e=!0){this.knownImageServers[n.root]=n,e&&(this.knownImageServers[n.root].malformed=!1,this.knownImageServers[n.root].verifications=this.config.verificationsRequired)}predict(n,e=!1,t=!1){const i=n==null?void 0:n.source,r=Fo(Yt(n)),s=this.knownImageServers[r],a=La(Yt(n));return this.imageServices[a]?this.imageServices[a]||null:!this.config.approximateServices||!s||!s.result||!(i!=null&&i.height||n.height)||!(i!=null&&i.width||n.width)||!t&&(s.malformed||s.verifications<this.config.verificationsRequired)||n.source&&FA(n.source)?null:(this.imageServices[a]||(this.imageServices[a]={"@context":s.result.context,"@id":Yt(n),id:Yt(n),protocol:"http://iiif.io/api/image",tiles:(i==null?void 0:i.tiles)||Zie(n.width,n.height,s.result.sampledTiles),sizes:(i==null?void 0:i.sizes)||Xie(Math.round(n.width/s.result.resourceServiceRatio),Math.round(n.height/s.result.resourceServiceRatio),s.result.sizeRatios),profile:(i==null?void 0:i.profile)||s.result.sampledProfile,height:(i==null?void 0:i.height)||n.height,width:(i==null?void 0:i.width)||n.width,real:!1}),this.imageServices[a]||null)}async getThumbnailFromResource(n,e,t=!0,i=[]){const r=n?await this.getImageCandidates(n,t):[];return ere(e,[()=>i,()=>r])}async getImageCandidates(n,e=!0){const t=n;if(e&&t&&t.height&&t.width){const i=xD(t);for(const r of i){const s={id:Yt(r),width:r.width?r.width:t.width,height:r.height?r.height:t.height,source:r};await this.loadService(s)}}return ire(n,e,this)}async verify(n){const e=this.predict(n,!1,!0),t=await this.fetchService(Yt(n));if(!e)return!1;const i=e.height===t.height&&e.width===t.width&&e["@context"]===t["@context"]&&rre(e.sizes||[],t.sizes||[]);if(i){const r=Fo(Yt(n)),s=this.knownImageServers[r];s&&(s.verifications+=1,s.verifications>=this.config.verificationsRequired&&(s.verified=!0))}return i}canLoadSync(n){const e=typeof n=="string"?n:Yt(n),t=La(e);if(this.imageServices[t])return!0;const i=this.knownImageServers[Fo(e)];return!!(i&&!i.malformed&&i.verifications>=this.config.verificationsRequired)}async markAsMalformed(n){return this.knownImageServers[Fo(Yt(n))].malformed=!0,this.loadService(n,!0)}async fetchService(n,e=!1){const t=La(n),i=this.imageServices[t];if(i&&(!e||i.real))return i;if(!this.config.enableFetching)throw new Error("Fetching is not enabled");const r=await this.fetch(t).then(s=>s.json());return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==n&&(r.id=n,r["@id"]&&(r["@id"]=n)),this.imageServices[t]=Object.assign(r,{real:!0}),this.imageServices[t]}async fetch(n,e){return fetch(n,e)}async loadService(n,e=!1){if(!this.config.disableThrottling){let r=!0;for(;r;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(s=>setTimeout(s,500));else{r=!1;break}}const t=this.knownImageServers[Fo(Yt(n))];if(t&&!t.malformed&&!e){await t.result;const r=this.loadServiceSync(n);if(r)return r}this.fetchingCount++;const i=await this.fetchService(Yt(n),e);return this.fetchingCount--,i.real&&this.sample(i,n),i}loadServiceSync(n){const e=La(Yt(n));return this.imageServices[e]?this.imageServices[e]:this.config.approximateServices?this.predict(n):null}};function sre(n={}){const e=n.events||m3(),t=n.loader||new wD;return{store:h3((i,r)=>({loaded:{},loadServiceSync:(s,a,o)=>{const l=s.id||s["@id"],u=r().loaded[l];if(u&&u.status==="done")return u.service;if(u&&u.status==="loading")return null;if(u&&u.status==="error")throw new Error("Failed to load image service");const c={id:Yt(s),width:s.width||(a==null?void 0:a.width)||0,height:s.height||(a==null?void 0:a.height)||0,source:s},d=t.loadServiceSync(c);return d?(i(h=>({loaded:{...h.loaded,[l]:{status:"done",service:d,real:!0}}})),e.emit("image-service.loaded",{id:l,service:d})):o&&r().loadService(s,a).then(()=>{}),d},loadService:async(s,a)=>{const o=s.id||s["@id"],l=r().loaded[o];if(l&&l.status==="done")return l.service;if(l&&l.status==="loading")return new Promise((u,c)=>{const d=h=>{h.id===o&&(e.off("image-service.loaded",d),u(h.service||s))};e.on("image-service.loaded",d)});if(l&&l.status==="error"&&!(a!=null&&a.force))throw new Error("Failed to load image service");e.emit("image-service.loading",{id:o});try{const u={id:Yt(s),width:s.width||0,height:s.height||0,source:s},c=await t.loadService(u,a==null?void 0:a.force);return i(d=>({loaded:{...d.loaded,[o]:{status:"done",service:c,real:c.real}}})),e.emit("image-service.loaded",{id:o,service:c}),c}catch(u){throw e.emit("image-service.error",{id:o,error:u}),u}}})),events:e}}sre();var af={},V1={get(n){return n},setMetaValue([n,e,t],i){const r=V1.getResourceMeta(n,e),s=r?r[t]:void 0,a=typeof i=="function"?i(s):i;af[n]={...af[n]||{},[e]:{...(af[n]||{})[e]||{},[t]:a}}},getResourceMeta:(n,e)=>{const t=af[n];if(t)return e?t[e]:t},async load(n){const e=typeof n=="string"?n:n.id;return fetch(e).then(t=>t.json())},requestStatus(n){}},are=new wD,HA=new Map;function ore(n,{vault:e=V1,dereference:t=!1,...i}={}){let r=HA.get(e);return r||(r=ure(e),HA.set(e,r)),r.getBestThumbnailAtSize(n,i,t)}function ure(n=V1,e={}){const t=e.imageServiceLoader||are;async function i(r,s,a=!1,o=[],l){const u=()=>t.getThumbnailFromResource(void 0,s,a,o);if(!r)return await t.getThumbnailFromResource(void 0,s,a,o);if(typeof r=="string"){const d=ty(r);return d&&o.push(d),await t.getThumbnailFromResource(void 0,s,a,o)}const c=n.get(r,{skipSelfReturn:!1});if(typeof c=="string")return{best:ty(c),fallback:[],log:[]};if(!c)return await u();switch(await(async d=>{if(d&&d.thumbnail&&d.thumbnail.length){const h=n.get(d.thumbnail[0]),p=await t.getImageCandidates(h,a);p&&p.length&&o.push(...p)}})(c),c.type){case"Annotation":{const d=Array.isArray(c.body)?c.body:[c.body],h=n.get(d[0]);return l&&!h.width&&(h.width=l.width,h.height=l.height),await t.getThumbnailFromResource(h,s,a,o)}case"Canvas":{const d=c;return i(d.items[0],s,a,o,{width:d.width,height:d.height})}case"AnnotationPage":return i(c.items[0],s,a,o,l);case"Choice":{const d=c;return!d.items||d.items[0]?await u():i(d.items[0],s,a,o,l)}case"Collection":{const d=c.items[0];return d?i(d,s,a,o,l):await u()}case"Manifest":{const d=c.items[0];return d?i(d,s,a,o,l):await u()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return l&&!c.width&&(c.width=l.width,c.height=l.height),t.getThumbnailFromResource(c,s,a,o)}return await u()}return{getBestThumbnailAtSize:i}}const lre=({type:n})=>{switch(n){case"Sound":return B.createElement(Un.Audio,null);case"Image":return B.createElement(Un.Image,null);case"Video":return B.createElement(Un.Video,null);default:return B.createElement(Un.Image,null)}},cre=({canvas:n,canvasIndex:e,isActive:t,type:i,handleChange:r})=>{const[s,a]=U.useState(!1),[o,l]=U.useState(),u=qt(),{vault:c}=u,d=200,h=n!=null&&n.label?xi(n==null?void 0:n.label):String(e+1);U.useEffect(()=>{s&&(async()=>{var g,v;try{if(((g=n==null?void 0:n.thumbnail)==null?void 0:g.length)!==0)l((v=n==null?void 0:n.thumbnail[0])==null?void 0:v.id);else{const{best:y}=await ore(n,{vault:c,dereference:!0,width:d,height:d});l(y==null?void 0:y.id)}}catch(y){console.error("Error fetching thumbnail",y)}})()},[n,s]);const p=g=>{a(g)};return B.createElement(Jv,{"aria-checked":t,"data-testid":"media-thumbnail","data-canvas":e,onClick:()=>r(n.id),value:n.id},B.createElement("figure",null,B.createElement(Cf,null,B.createElement(_ie,{isVisibleCallback:p,attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(s),"data-testid":"media-thumbnail-lazyload"}},o&&B.createElement("img",{alt:h,"data-testid":"media-thumbnail-image",src:o})),B.createElement(Af,null),B.createElement(j3,null,B.createElement(eh,{isIcon:!0,"data-testid":"thumbnail-tag"},B.createElement(gie,null),B.createElement(Un,{"aria-label":i},B.createElement(lre,{type:i})),["Video","Sound"].includes(i)&&B.createElement(vie,null,y3(n.duration))))),B.createElement("figcaption",{"data-testid":"fig-caption"},n.label?B.createElement(as,{label:n.label}):(e+1).toString())))},dre=n=>n.body?n.body.type:"Image",fre=({items:n})=>{const{t:e}=Zs(),t=si(),i=qt(),{activeCanvas:r,vault:s,sequence:a}=i,[o,l]=U.useState(""),[u,c]=U.useState([]),[d,h]=U.useState(0),p=B.useRef(null),g="painting",v=T=>{r!==T&&t({type:"updateActiveCanvas",canvasId:T})};U.useEffect(()=>{if(!u.length){const T=["Image","Sound","Video"],x=n.map(w=>I3(s,w,g,T)).filter(w=>w.annotations.length>0);c(x)}},[n,u.length,s]),U.useEffect(()=>{u.forEach((T,x)=>{T!=null&&T.canvas&&T.canvas.id===r&&h(x)})},[r,u]),U.useEffect(()=>{const T=document.querySelector(`[data-canvas="${d}"]`);if(T instanceof HTMLElement&&p.current){const x=T.offsetLeft-p.current.offsetWidth/2+T.offsetWidth/2;p.current.scrollTo({left:x,behavior:"smooth"})}},[d]);const y=T=>l(T),b=T=>{const x=a[1].findIndex(_=>_.includes(d)),w=x+T>=0?x+T:a[1].length-1;if(!a[1][w])return;const A=a[1][w][0],R=a[0][A].id;R&&v(R)};return B.createElement(B.Fragment,null,B.createElement(Rie,{handleFilter:y,handleCanvasToggle:b,activeIndex:d,canvasLength:n.length}),B.createElement(yie,{"aria-label":e("media.selectItem"),"data-testid":"media","data-active-canvas":n[d].id,"data-canvas-length":n.length,"data-filter":o,ref:p},a[1].filter(T=>T.some(x=>{var w;const A=a[0][x].id,R=u.find(D=>{var H;return((H=D==null?void 0:D.canvas)==null?void 0:H.id)===A});if(!R)return!1;const _=xi((w=R==null?void 0:R.canvas)==null?void 0:w.label)||"";return!(o&&!_.toLowerCase().includes(o.toLowerCase()))})).map((T,x)=>{const w=T.map(A=>a[0][A].id).includes(r);return B.createElement(Eie,{"data-active":w,key:x},T.map(A=>{var R,_;const D=a[0][A].id,H=u.find(P=>{var N;return((N=P==null?void 0:P.canvas)==null?void 0:N.id)===D});return H?B.createElement(cre,{canvas:H.canvas,canvasIndex:u.findIndex(P=>P===H),handleChange:v,isActive:r===((R=H==null?void 0:H.canvas)==null?void 0:R.id),key:(_=H==null?void 0:H.canvas)==null?void 0:_.id,type:dre(H.annotations[0])}):null}))})))},AD=Ge("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),CD=Ge("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),ID=Ge(CD,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),hre=Ge("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${ID}`]:{backgroundColor:"$accent"},[`${AD}`]:{backgroundColor:"#6662"}}}),pre=Ge("div",{width:"100%",height:"100%"}),mre=Ge("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),gre=Ge(tee,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),vre=Ge(nee,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),yre=Ge(ree,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),Ere=Ge(iee,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),RD=Ge(eee,{position:"relative",zIndex:"5",width:"100%"}),Fg=({direction:n,title:e})=>{const t=()=>B.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),i=()=>B.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return B.createElement(mre,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},B.createElement("title",null,e),n==="up"&&B.createElement(t,null),n==="down"&&B.createElement(i,null))},_D=({children:n,label:e,maxHeight:t,onValueChange:i,value:r})=>B.createElement(RD,{onValueChange:i,value:r},B.createElement(gre,{"data-testid":"select-button"},B.createElement(vk,{"data-testid":"select-button-value"}),B.createElement(yk,null,B.createElement(Fg,{direction:"down",title:"select"}))),B.createElement(Ek,null,B.createElement(vre,{css:{maxHeight:`${t} !important`},"data-testid":"select-content"},B.createElement(Ok,null,B.createElement(Fg,{direction:"up",title:"scroll up for more"})),B.createElement(wk,null,B.createElement(Ck,null,e&&B.createElement(Ere,null,B.createElement(as,{"data-testid":"select-label",label:e})),n)),B.createElement(Nk,null,B.createElement(Fg,{direction:"down",title:"scroll down for more"}))))),LD=n=>B.createElement(yre,{...n},n.thumbnail&&B.createElement(U3,{thumbnail:n.thumbnail}),B.createElement(Pk,null,B.createElement(as,{label:n.label})),B.createElement(Dk,null));let Ha=window.OpenSeadragon;if(!Ha&&(Ha=vl,!Ha))throw new Error("OpenSeadragon is missing.");const zA="http://www.w3.org/2000/svg";Ha.Viewer&&(Ha.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new PD(this),this._svgOverlayInfo)});const PD=function(n){const e=this;this._viewer=n,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(zA,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(zA,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){e.resize()}),this._viewer.addHandler("open",function(){e.resize()}),this._viewer.addHandler("rotate",function(){e.resize()}),this._viewer.addHandler("flip",function(){e.resize()}),this._viewer.addHandler("resize",function(){e.resize()}),this.resize()};PD.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const n=this._viewer.viewport.pixelFromPoint(new Ha.Point(0,0),!0),e=this._viewer.viewport.getZoom(!0),t=this._viewer.viewport.getRotation(),i=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x;let s=r*e;const a=s;i&&(s=-s,n.x=-n.x+r),this._node.setAttribute("transform","translate("+n.x+","+n.y+") scale("+s+","+a+") rotate("+t+")")},onClick:function(n,e){new Ha.MouseTracker({element:n,clickHandler:e}).setTracking(!0)}};function Lr(n){for(let e in n)(typeof n[e]>"u"||n[e]===null)&&delete n[e];return n}function bre(n){return Array.isArray(n)?n:n?[n]:[]}var jA=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function Tre(n){if(typeof n>"u"||n===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(n))throw new Error("Array is not a valid entity");if(typeof n!="object")throw new Error(`${typeof n} is not a valid entity`);if(typeof n["@type"]=="string"){let e=jA.indexOf(n["@type"]);if(e!==-1)return jA[e]}if(n.profile)return"Service";if(n.format||n["@type"])return"ContentResource";throw new Error("Resource type is not known")}var xre=class kD{constructor(e,t={}){MA(this,"traversals"),MA(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new kD({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let t=[...(e.manifests||[]).map(s=>typeof s=="string"?{"@id":s,"@type":"sc:Manifest"}:s),...(e.collections||[]).map(s=>typeof s=="string"?{"@id":s,"@type":"sc:Collection"}:s),...e.members||[]],i=[],r=t.filter(s=>i.includes(s["@id"])?!1:(i.push(s["@id"]),!0));delete e.collections,delete e.manifests,e.members=r}return e.manifests&&(e.manifests=e.manifests.map(t=>this.traverseManifest(typeof t=="string"?{"@id":t,"@type":"sc:Manifest"}:t))),e.collections&&(e.collections=e.collections.map(t=>this.traverseCollection(typeof t=="string"?{"@id":t,"@type":"sc:Collection"}:t))),e.members&&(e.members=e.members.map(t=>typeof t=="string"?t:t["@type"]==="sc:Collection"?this.traverseCollection(t):t["@type"]==="sc:Manifest"?this.traverseManifest(t):this.traverseUnknown(t))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(t=>this.traverseSequence(t))),e.structures&&(e.structures=e.structures.map(t=>this.traverseRange(t))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(t=>this.traverseCanvas(t))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(t=>this.traverseAnnotation(t))),e.otherContent&&(e.otherContent=e.otherContent.map(t=>this.traverseAnnotationList(t))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Range"}:i),...(e.canvases||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Canvas"}:i),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(i=>this.traverseUnknown(i)):void 0}return e}traverseAnnotationList(e){let t=typeof e=="string"?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(t=>this.traverseAnnotation(t))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(t=>this.traverseContentResource(t)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(t=>this.traverseAnnotationList(t))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&e.default!=="rdf:nil"&&(e.default=this.traverseContentResource(e.default)),e.item&&e.item!=="rdf:nil"&&(e.item=e.item.map(t=>this.traverseContentResource(t))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return e["@type"]==="oa:Choice"?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||typeof e=="string")return e;switch(Tre(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let s of i)typeof s=="string"?r.push(this.traverseContentResource({"@id":s,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(s));return!t&&!this.options.convertPropsToArray?r[0]:r}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let s of i)r.push(this.traverseService(s));return!t&&!this.options.convertPropsToArray?r[0]:r}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&(typeof e.within=="string"||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&(typeof e.startCanvas=="string"?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&(typeof e.contentLayer=="string"?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e))if(this.options.convertPropsToArray)e=[e];else return this.traverseType(e,t);return e.map(i=>this.traverseType(i,t))}traverseType(e,t){return t.reduce((i,r)=>{let s=r(i);return typeof s>"u"&&!this.options.allowUndefinedReturn?i:s},e)}},Sre="http://library.stanford.edu/iiif/image-api/compliance.html#level1",wre="http://library.stanford.edu/iiif/image-api/compliance.html#level2",Are="http://library.stanford.edu/iiif/image-api/conformance.html#level1",Cre="http://library.stanford.edu/iiif/image-api/conformance.html#level2",Ire="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",Rre="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",_re="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",Lre="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",Pre="http://iiif.io/api/image/1/level1.json",kre="http://iiif.io/api/image/1/profiles/level1.json",Dre="http://iiif.io/api/image/1/level2.json",Ore="http://iiif.io/api/image/1/profiles/level2.json",Nre="http://iiif.io/api/image/2/level1.json",Mre="http://iiif.io/api/image/2/profiles/level1.json",Fre="http://iiif.io/api/image/2/level2.json",Bre="http://iiif.io/api/image/2/profiles/level2.json",Ure="level1",Hre="level2",zre="http://iiif.io/api/image/2/level1",jre="http://iiif.io/api/image/2/level2",Vre=[zre,jre,Sre,wre,Are,Cre,Ire,Rre,_re,Lre,Pre,kre,Dre,Ore,Nre,Mre,Fre,Bre,Ure,Hre],ny={attributionLabel:"Attribution",providerId:"http://example.org/provider",providerName:""};function Gre(n){if(typeof n=="string")return[n];if(!n)return[];let e=Array.isArray(n)?n:[n],t=[];for(let i of e){if(typeof i=="string"){t.push(i);continue}t.push({"@language":i["@language"]||i.language,"@value":i["@value"]||i.value})}return t}function Da(n,e="none"){if(!n)return{none:[""]};let t=Gre(n),i={};for(let r of t){if(typeof r=="string"){i[e]=i[e]?i[e]:[],i[e].push(r||"");continue}if(!r["@language"]){i[e]=i[e]?i[e]:[],i[e].push(r["@value"]||"");continue}let s=r["@language"];i[s]=i[s]?i[s]:[],i[s].push(r["@value"]||"")}return Object.keys(i).length===0?{none:[""]}:i}function DD(n){if(Array.isArray(n))return DD(n.find(e=>typeof e=="string"));if(Vh.indexOf(n)!==-1)return"level2";if(Vre.indexOf(n)!==-1)return"level1";if(Lie.indexOf(n)!==-1)return"level0";if(typeof n=="string")return n}function Wre(n){let e=Array.isArray(n)?n:[n];for(let t of e)switch(t){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function qre(n){switch(n){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function VA(n){for(let e of["sc","oa","dcterms","dctypes","iiif"])if(n.startsWith(`${e}:`))return n.slice(e.length+1);return n}var $re=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function G1(n){let e=n["@id"]||n.id,t=n["@type"]||n.type,i=n.profile||void 0,r=n["@context"]||void 0;if(i){let s=qre(i);if(s)return s}if(r){let s=Wre(r);if(s)return s}if(t){if(Array.isArray(t)){if(t.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(t.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";t=t[0]}for(let s of["sc","oa","dcterms","dctypes","iiif"])if(t.startsWith(`${s}:`)){t=t.slice(s.length+1);break}switch(t){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(t&&$re.indexOf(t)!==-1)return t;if(n.format){if(n.format.startsWith("image/"))return"Image";if(n.format.startsWith("text/")||n.format==="application/pdf")return"Text";if(n.format.startsWith("application/"))return"Dataset"}return e&&(e.endsWith(".jpg")||e.endsWith(".png")||e.endsWith(".jpeg"))?"Image":t||"unknown"}var Kre=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function Yre(n){let e=n.match(Kre);return e?e[0]:n}function Xre(n,e="Rights/License",t="none"){let i=null,r=[],s=Array.isArray(n)?n:[n];for(let a of s){let o=a?Yre(a):void 0;if(o&&(o.indexOf("creativecommons.org")!==-1||o.indexOf("rightsstatements.org")!==-1)){o.startsWith("https://")?i=`http://${o.slice(8)}`:i=o;continue}o&&r.push({label:{[t]:[e]},value:{[t]:[o]}})}return[i,r]}var Qre=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function Zre(n){if(n){let e=Array.isArray(n)?n:[n],t=[];for(let i of e)i==="http://iiif.io/api/presentation/2/context.json"&&t.push("http://iiif.io/api/presentation/3/context.json"),Qre.indexOf(i)===-1&&t.push(i);if(e.length)return t.length===1?t[0]:t}}function Jre(n){return n?n.map(e=>({label:Da(e.label),value:Da(e.value)})):[]}var GA=0;function OD(n,e){let t=encodeURI(n.id||n["@id"]||"").trim();return t&&e?`${t}/${e}`:t||(GA++,`http://example.org/${n["@type"]}${e?`/${e}`:""}/${GA}`)}function os(n){let e=[...n.behavior||[]];n.viewingHint&&e.push(n.viewingHint);let t;return Array.isArray(n.motivation)?t=n.motivation.map(VA):n.motivation&&(t=VA(n.motivation)),{"@context":n["@context"]?Zre(n["@context"]):void 0,id:(n["@id"]||OD(n)).trim(),type:G1(n),behavior:e.length?e:void 0,height:n.height?n.height:void 0,width:n.width?n.width:void 0,motivation:t,viewingDirection:n.viewingDirection,profile:n.profile,format:n.format?n.format:void 0,duration:void 0,timeMode:void 0}}function us(n){let[e,t]=Xre(n.license),i=[...n.metadata?Jre(n.metadata):[],...t];return{rights:e,metadata:i.length?i:void 0,label:n.label?Da(n.label):void 0,requiredStatement:n.attribution?{label:Da(ny.attributionLabel),value:Da(n.attribution)}:void 0,navDate:n.navDate,summary:n.description?Da(n.description):void 0,thumbnail:ese(n.thumbnail)}}function ese(n){return n&&(Array.isArray(n)?n:[n]).map(e=>typeof e=="string"?{id:e,type:"Image"}:(e.type==="unknown"&&(e.type="Image"),e))}function tse(n){if(!n.within)return;let e=Array.isArray(n.within)?n.within:[n.within],t=[];for(let i of e)if(typeof i=="string"){if(i)switch(n["@type"]){case"sc:Manifest":t.push({id:i,type:"Collection"});break}}else i["@id"]&&t.push({id:i["@id"],type:G1(i)});return t.length?t:void 0}function ia(n){let e=n.related?Array.isArray(n.related)?n.related:[n.related]:[],t=n.contentLayer;return{provider:n.logo||e.length?[{id:ny.providerId,type:"Agent",homepage:e.length?[e[0]]:void 0,logo:n.logo?Array.isArray(n.logo)?n.logo:[n.logo]:void 0,label:Da(ny.providerName)}]:void 0,partOf:tse(n),rendering:n.rendering,seeAlso:n.seeAlso,start:n.startCanvas,service:n.service?bre(n.service):void 0,supplementary:t?[t]:void 0}}function nse(n){return{chars:n.chars,format:n.format?n.format:void 0,language:n.language}}function Bg(n,e){return n?typeof n=="string"?{id:n,type:e}:typeof(n==null?void 0:n["@id"])=="string"?{id:n["@id"],type:e}:typeof n.id=="string"?{id:n.id,type:e}:null:null}function ise(n){let e={};if(n.first){let t=Bg(n.first,"Collection");t&&(e.first=t)}if((n.total||n.total===0)&&(e.total=n.total),n.prev){let t=Bg(n.prev,"Collection");t&&(e.prev=t)}if(n.next){let t=Bg(n.next,"Collection");t&&(e.next=t)}return e}function rse(n){let e=[];for(let t of n){let i={...t};i.items&&i.items.length===0&&delete i.items,e.push(i)}return e}function sse(n){return Lr({...os(n),...us(n),...ia(n),...ise(n),items:rse(n.members)})}function ase(n){let e=[],t=[],i,r;for(let a of n.sequences||[])a.canvases.length&&e.push(...a.canvases),a.behavior&&t.push(...a.behavior),a.viewingDirection&&(r=a.viewingDirection),a.startCanvas&&(i=a.startCanvas);let s=os(n);return t.length&&(s.behavior?s.behavior.push(...t):s.behavior=t),Lr({...s,...us(n),...ia(n),viewingDirection:r,start:i,items:e,structures:ose(n.structures)})}function ose(n){if(!n)return n;let e=new Map;for(let i of n)e.set(i.id,i);let t=[];for(let i of n)if(i.items){let r=i.items.map(s=>typeof s=="string"?(t.push(s),e.get(s)||s):s&&s.id?(t.push(s.id),e.get(s.id)||s):s);i.items=r}return n.filter(i=>t.indexOf(i.id)===-1)}function use(n){return Lr({...os(n),...us(n),...ia(n),annotations:n.otherContent&&n.otherContent.length?n.otherContent:void 0,items:n.images&&n.images.length?[{id:OD(n,"annotation-page"),type:"AnnotationPage",items:n.images}]:void 0})}function lse(n){return Lr({...os(n),...us(n),...ia(n),items:n.resources&&n.resources.length?n.resources:void 0})}function cse(n){return!n.canvases||n.canvases.length===0?{canvases:[],behavior:[]}:{canvases:n.canvases,behavior:n.viewingHint?[n.viewingHint]:[],viewingDirection:n.viewingDirection,startCanvas:n.startCanvas}}function dse(n){function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if(typeof t=="string")return encodeURI(t).trim();if("@type"in t){let i;if(typeof t.full=="string")i=t.full;else if(t.full["@type"]==="dctypes:Image")i={id:t.full["@id"],type:"Image"};else if(t.full["@type"]==="sc:Canvas")i={id:t.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${t.full["@type"]}`);return{type:"SpecificResource",source:i,selector:iy(t.selector)}}else return encodeURI(t["@id"]).trim()}return Lr({...os(n),...us(n),...ia(n),target:e(n.on),body:Array.isArray(n.resource)?n.resource.map(WA):WA(n.resource)})}function WA(n){return n.type==="Choice"?n:ND(n)}function ND(n){let e=n;return Lr({...os(e),...us(e),...ia(e),...nse(e)})}function fse(n){let e=[];return n.default&&n.default!=="rdf:nil"&&e.push(n.default),n.item&&n.item!=="rdf:nil"&&e.push(...n.item),Lr({...os(n),...us(n),items:e})}function hse(n){return Lr({...os(n),...us(n),...ia(n),items:n.members})}function pse(n){let{"@id":e,"@type":t,"@context":i,profile:r,...s}=n,a={};return e&&(a["@id"]=e),a["@type"]=G1(n),a["@type"]==="unknown"&&(i&&i.length&&(a["@context"]=i),a["@type"]="Service"),r&&(a.profile=DD(r)),Lr({...a,...s})}function mse(n){return Lr({...os(n),...us(n),...ia(n)})}var gse=new xre({collection:[sse],manifest:[ase],canvas:[use],annotationList:[lse],sequence:[cse],annotation:[dse],contentResource:[ND],choice:[fse],range:[hse],service:[pse],layer:[mse]});function vse(n){return n&&n["@context"]&&(n["@context"]==="http://iiif.io/api/presentation/2/context.json"||n["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||n["@context"]==="http://www.shared-canvas.org/ns/context.json")||n["@context"]==="http://iiif.io/api/image/2/context.json"||n["@id"]&&n["@type"]==="sc:Collection"||n["@id"]&&n["@type"]==="sc:Manifest"?(n["@context"]||(n["@context"]="http://iiif.io/api/presentation/2/context.json"),gse.traverseUnknown(n)):n}function iy(n){if((Array.isArray(n["@type"])&&n["@type"].includes("oa:SvgSelector")||n["@type"]=="oa:SvgSelector")&&("chars"in n||"value"in n))return{type:"SvgSelector",value:"chars"in n?n.chars:n.value};if(n["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:n.value};if(n["@type"]==="oa:Choice")return[iy(n.default),...(Array.isArray(n.item)?n.item:[n.item]).map(iy)];if(n["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in n?n.region:void 0,rotation:"rotation"in n?n.rotation:void 0};throw new Error(`Unsupported selector type: ${n["@type"]}`)}const yse=n=>(Array.isArray(n["@context"])?n["@context"]:[n["@context"]]).map(e=>e==null?void 0:e.replace("http://","https://")),Ese=n=>fetch(`${n.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(e=>{console.error(`The IIIF tilesource ${n.replace(/\/$/,"")}/info.json failed to load: ${e}`)}),bse=n=>{let e,t;if(Array.isArray(n)&&(e=n[0],e)){let i;"@id"in e?i=e["@id"]:i=e.id,t=i}return t},MD=n=>{var e,t,i,r,s,a,o,l,u,c,d,h,p,g,v;let y,b={};switch(n==null?void 0:n.type){case"SpecificResource":y=(i=(t=(e=n==null?void 0:n.target)==null?void 0:e.partOf)==null?void 0:t[0])==null?void 0:i.id,b={manifest:y,canvas:(r=n==null?void 0:n.target)==null?void 0:r.id},n!=null&&n.selector&&(b.selector=n.selector);break;case"Range":case"Annotation":const T=((s=n==null?void 0:n.target)==null?void 0:s.source)||(n==null?void 0:n.target),x=(a=n==null?void 0:n.target)==null?void 0:a.selector;b={manifest:(l=(o=T==null?void 0:T.partOf)==null?void 0:o[0])==null?void 0:l.id,canvas:T==null?void 0:T.id},(((u=n==null?void 0:n.target)==null?void 0:u.type)==="SpecificResource"||(c=n==null?void 0:n.target)!=null&&c.selector)&&(b.selector=x);break;case"Canvas":if(y=(h=(d=n==null?void 0:n.partOf)==null?void 0:d[0])==null?void 0:h.id,b={manifest:y,canvas:n==null?void 0:n.id},(p=n==null?void 0:n.id)!=null&&p.includes("#xywh=")){const[w,A]=n.id.split("#xywh=");b.canvas=w,b.selector={type:"FragmentSelector",value:`xywh=${A}`}}break;case"Manifest":y=n==null?void 0:n.id,b={collection:(v=(g=n==null?void 0:n.partOf)==null?void 0:g[0])==null?void 0:v.id,manifest:n==null?void 0:n.id};break;case"Collection":y=n==null?void 0:n.id,b={collection:y};break}return{resourceId:y,active:b}},Tse=n=>{const e=["https://iiif.io/api/presentation/2/context.json","https://iiif.io/api/presentation/3/context.json"],t=new TypeError(`The IIIF content may not be a valid IIIF resource: ${e.join(", ")}`);n["@context"]||console.warn(t);const i=yse(n);try{if(i.includes(e[0])){const r=vse(n);if(!r||!r.id||!r.type)throw t;return r}else{if(i.includes(e[1]))return n;throw t}}catch(r){console.warn(r)}},xse=n=>{if(typeof n=="string"&&Cse(n))return{resourceId:n};if(typeof n=="object"){const e=Tse(n);return{resourceId:e==null?void 0:e.id,resourceObject:e}}else{const e=JSON.parse(UM(n)),{active:t}=MD(e);return{active:t,resourceId:e==null?void 0:e.resourceId,resourceObject:e}}},Sse=n=>{const{resourceId:e,resourceObject:t}=xse(n);return t||e},wse=n=>n.items.map(e=>e.id)[0],Ase=n=>{const e=n.items.filter(t=>t.type==="Manifest").map(t=>t.id);return e.length==0?null:e[0]},Cse=n=>{try{new URL(n)}catch{return!1}return!0};var Pi=(n=>(n.TiledImage="tiledImage",n.SimpleImage="simpleImage",n))(Pi||{});const Ise=n=>{const e=Array.isArray(n==null?void 0:n.service)&&(n==null?void 0:n.service.length)>0,t=e?bse(n==null?void 0:n.service):n==null?void 0:n.id,i=e?Pi.TiledImage:Pi.SimpleImage;return{uri:t,imageType:i}},Rse=(n,e)=>{const t=e?Pi.TiledImage:Pi.SimpleImage;return{uri:n,imageType:t}},ry=Ge("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),_se=Ge("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),Lse=Ge("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${ry}`]:{display:"block"}},false:{[`${ry}`]:{display:"none"}}}}}),Bo=({className:n,id:e,label:t,children:i})=>{const r=t.toLowerCase().replace(/\s/g,"-");return B.createElement(CD,{id:e,className:n,"data-testid":"openseadragon-button","data-button":r},B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${e}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},B.createElement("title",{id:`${e}-svg-title`},t),i))},Pse=Ge("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),kse=()=>B.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),Dse=()=>B.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),Ose=()=>B.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),Nse=()=>B.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),qA=()=>B.createElement(B.Fragment,null,B.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),B.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),Mse=({_cloverViewerHasPlaceholder:n,config:e})=>{const t=qt(),{activeCanvas:i,plugins:r,vault:s,openSeadragonViewer:a}=t,o=s.get({id:i,type:"Canvas"});function l(){return r.filter(u=>{var c;return(c=u.imageViewer)==null?void 0:c.controls}).map((u,c)=>{var d,h,p,g;const v=(h=(d=u.imageViewer)==null?void 0:d.controls)==null?void 0:h.component;return B.createElement(v,{key:c,...(g=(p=u==null?void 0:u.imageViewer)==null?void 0:p.controls)==null?void 0:g.componentProps,canvas:o,useViewerDispatch:si,useViewerState:qt})})}return U.useEffect(()=>{if(!a)return;const u=a.viewport.getRotation();a.addHandler("home",()=>{a.viewport.setRotation(u)})},[a]),B.createElement(Pse,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:n},e.showZoomControl&&B.createElement(B.Fragment,null,B.createElement(Bo,{id:e.zoomInButton,label:"zoom in"},B.createElement(kse,null)),B.createElement(Bo,{id:e.zoomOutButton,label:"zoom out"},B.createElement(Dse,null))),e.showFullPageControl&&B.createElement(Bo,{id:e.fullPageButton,label:"full page"},B.createElement(Ose,null)),e.showRotationControl&&B.createElement(B.Fragment,null,B.createElement(Bo,{id:e.rotateRightButton,label:"rotate right"},B.createElement(qA,null)),B.createElement(Bo,{id:e.rotateLeftButton,label:"rotate left"},B.createElement(qA,null))),e.showHomeControl&&B.createElement(Bo,{id:e.homeButton,label:"reset"},B.createElement(Nse,null)),l())};async function FD(n,e=3,t=500){try{return await n()}catch(i){if(e<=0)throw i;return await new Promise(r=>setTimeout(r,t)),FD(n,e-1,t)}}const Fse=n=>new Promise(e=>setTimeout(e,n)),$A=async(n,e,t=3,i=300)=>{for(let r=0;r<t;r++){const s=e?e-1:0,a=n.getItemAt(s);if(a)return a;await Fse(i)}throw new Error("No base item found at index 0 after retries")},Bse=({annotations:n,ariaLabel:e,config:t,uri:i,_cloverViewerHasPlaceholder:r,imageType:s,openSeadragonCallback:a})=>{const[o,l]=U.useState([]),[u,c]=U.useState([]),[d,h]=U.useState(),[p,g]=U.useState([]),v=si(),y=U.useRef(!1),b="clover-iiif-image-openseadragon-annotation",T=t.gestureSettingsMouse.scrollToZoom===!1;U.useEffect(()=>(y.current||(y.current=!0,d||h(vl(t))),()=>d==null?void 0:d.destroy()),[]),U.useEffect(()=>{x()},[d,a]),U.useEffect(()=>{d&&JSON.stringify(i)!==JSON.stringify(u)&&(d.forceRedraw(),T&&d.addHandler("canvas-scroll",function(w){w.preventDefault=!1}),c(i))},[T,d,u,i]),U.useEffect(()=>{!u.length||!d||(d.close(),(async()=>{switch(s){case"simpleImage":let w=1,A=0;for(let R=0;R<u.length;R++){const _=u[R];if(n){const D=new Image;D.src=_,await D.decode(),g(H=>[...H,{width:D==null?void 0:D.width,height:D==null?void 0:D.height}])}try{if(R!==0){const D=(await $A(d.world,R)).getBounds();A=D.x+D.width,w=D.height}d.addSimpleImage({url:_,x:A,y:0,height:w,success:()=>{l(D=>[...D,_]),typeof v=="function"&&v({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(D){console.error(`Failed to load image at ${_}:`,D)}}break;case"tiledImage":{let R=1,_=0;for(let D=0;D<u.length;D++){const H=u[D];try{const P=await FD(()=>Ese(H),3,1e3);if(!P)throw new Error(`No tile source for ${H}`);if(D!==0){const N=(await $A(d.world,D)).getBounds();_=N.x+N.width,R=N.height}d.addTiledImage({tileSource:P,x:_,y:0,height:R,success:()=>{l(N=>[...N,H]),typeof v=="function"&&v({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(P){console.error(`Failed to load tile at ${H}:`,P)}}break}default:console.warn(`Unsupported imageType: "${s}"`);break}})().catch(w=>console.error("Error drawing tiles",w)))},[u,s,d]),U.useEffect(()=>{if(o){let w=0;const A=()=>{if(w<3){const R=d==null?void 0:d.world.getHomeBounds();R&&(d==null||d.viewport.fitBounds(R,!0)),w++,setTimeout(A,50)}};A(),d==null||d.addHandler("canvas-click",R=>{const _=d==null?void 0:d.getOverlayById(R.originalTarget.id);if(_){const D=_==null?void 0:_.getBounds(d.viewport);return D.x-=.1,D.y-=.1,D.width+=.2,D.height+=.2,d==null||d.viewport.fitBounds(D,!1),R.preventDefaultAction=!0}})}},[o]),U.useEffect(()=>{function w(A,R,_){let D=A*_;if(R===0)return D;for(;R>0;){const H=d==null?void 0:d.world.getItemAt(R-1);if(H){const P=H.getBounds().width;D+=P,R--}else break}return D}n&&(d==null||d.clearOverlays(),n.forEach(A=>{var R,_,D,H;const{annotation:P,targetIndex:N}=A,G=((_=(R=d==null?void 0:d.viewport)==null?void 0:R.getBounds())==null?void 0:_.width)||1,X=d==null?void 0:d.world.getItemAt(N),te=X?(X==null?void 0:X.getBounds().width)/(X==null?void 0:X.getContentSize().x):((D=p[N])==null?void 0:D.width)/G,Q=une(P==null?void 0:P.target),ne=P!=null&&P.body?(H=P==null?void 0:P.body[0])==null?void 0:H.value:void 0;if(Q!=null&&Q.rect){const{x:oe,y:Z,w:se,h:j}=Q==null?void 0:Q.rect,q=w(oe,N,te),re=new vl.Rect(q,Z*te,se*te,j*te),z=document.createElement("button");if(z.classList.add(b),z.id=P.id,z.setAttribute("tabindex","0"),z.setAttribute("role","button"),z.setAttribute("data-active","true"),z.setAttribute("tabindex","0"),z.setAttribute("role","button"),z.setAttribute("data-active","false"),ne){z.setAttribute("aria-label",ne);const ve=document.createElement("label");ve.innerHTML=ne,z.appendChild(ve)}z.addEventListener("mousedown",ve=>{ve.stopPropagation(),ve.preventDefault()}),z.addEventListener("touchstart",ve=>{ve.stopPropagation(),ve.preventDefault()}),z.addEventListener("click",ve=>{ve.stopPropagation(),ve.preventDefault()}),z.addEventListener("keydown",ve=>{if(ve.key==="Enter"){ve.stopPropagation(),ve.preventDefault();const Le=new vl.Rect(re.x-.1,re.y-.1,re.width+.2,re.height+.2);d==null||d.viewport.fitBounds(Le,!1)}}),z.addEventListener("focus",()=>{z.setAttribute("data-active","true")}),z.addEventListener("mouseover",()=>{z.setAttribute("data-active","true")}),z.addEventListener("mouseout",()=>{z.removeAttribute("data-active")}),z.addEventListener("blur",()=>{z.removeAttribute("data-active")}),d==null||d.addOverlay(z,re,vl.Placement.CENTER)}}),x())},[o,n]);function x(){d&&(a==null||a(d))}return B.createElement(Lse,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":t.id,hasNavigator:t.showNavigator},B.createElement(Mse,{_cloverViewerHasPlaceholder:r,config:t}),t.showNavigator&&B.createElement(ry,{id:t.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),B.createElement(_se,{id:t.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...e&&{"aria-label":e}}))};function Use(n){return{id:`openseadragon-${n}`,navigatorId:`openseadragon-navigator-${n}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${n}`,homeButton:`reset-${n}`,rotateLeftButton:`rotateLeft-${n}`,rotateRightButton:`rotateRight-${n}`,zoomInButton:`zoomIn-${n}`,zoomOutButton:`zoomOut-${n}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}const Hse=({_cloverViewerHasPlaceholder:n=!1,annotations:e,body:t,instanceId:i,isTiledImage:r=!1,label:s,src:a="",openSeadragonCallback:o,openSeadragonConfig:l={}})=>{const u=i??Ml(),c=typeof s=="string"?s:xi(s),d={...Use(u),...l},h=Array.isArray(t)?t:t?[t]:[],p=Array.isArray(a)?a:a?[a]:[];let g=[],v=Pi.SimpleImage;if(h.length){const b=h.map(Ise);g=b.map(T=>T.uri).filter(Boolean),v=b.some(T=>T.imageType===Pi.TiledImage)?Pi.TiledImage:Pi.SimpleImage}else if(p.length){const b=p.map(T=>Rse(T,r));g=b.map(T=>T.uri).filter(Boolean),v=b.some(T=>T.imageType===Pi.TiledImage)?Pi.TiledImage:Pi.SimpleImage}if(!g.length)return null;const y=b=>{o==null||o(b)};return B.createElement(py,{FallbackComponent:F1},B.createElement(Bse,{_cloverViewerHasPlaceholder:n,annotations:e,ariaLabel:c,config:d,imageType:v,key:u,uri:g,openSeadragonCallback:y}))},zse=({isActive:n,isMedia:e,items:t,setIsInteractive:i})=>{const{vault:r}=qt(),[s,a]=U.useState([]),o=s.length>1;if(U.useEffect(()=>{a([]);const c=t.map(d=>{const h=Qs(r,d.id);if(!h)return null;const{id:p,width:g,height:v}=h[0];return p?{src:p,width:g||640,height:v||640,alt:d.label?M1(d.label):"placeholder image"}:null}).filter(d=>d!==null);c.length&&a(c)},[t,o]),!n||!s.length)return null;const l=s.map(c=>c.width/c.height*1),u=l.reduce((c,d)=>c+d,0);return B.createElement(AD,{onClick:()=>i(!0),isMedia:e,className:"clover-viewer-placeholder","data-active":n,"data-paged":o},s.map((c,d)=>{const h=l[d]/u*100;return B.createElement("img",{...c,key:d,alt:c.alt,style:{width:`${h}%`}})}))},jse=Ge("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),Vse=B.forwardRef((n,e)=>{const t=B.useRef(null),i=U.useCallback(()=>{var s,a;if((s=e.current)!=null&&s.currentTime&&((a=e.current)==null?void 0:a.currentTime)>0)return;const o=e.current;if(!o)return;const l=new AudioContext,u=l.createMediaElementSource(o),c=l.createAnalyser(),d=t.current;if(!d)return;d.width=o.offsetWidth,d.height=o.offsetHeight;const h=d.getContext("2d");u.connect(c),c.connect(l.destination),c.fftSize=256;const p=c.frequencyBinCount,g=new Uint8Array(p);setInterval(function(){r(c,h,p,g,d.width,d.height)},20)},[e]);B.useEffect(()=>{!e||!e.current||(e.current.onplay=i)},[i,e]);function r(s,a,o,l,u,c){const d=u/o*2.6;let h,p=0;s.getByteFrequencyData(l),a.fillStyle="#000000",a.fillRect(0,0,u,c);for(let g=0;g<o;g++)h=l[g]*2,a.fillStyle="rgba(78, 42, 132, 1)",a.fillRect(p,c-h,d,h),p+=d+6}return B.createElement(jse,{ref:t,role:"presentation"})}),Gse=Ge("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),Wse=({resource:n,ignoreCaptionLabels:e})=>{const t=M1(n.label,"en");return Array.isArray(t)&&t.some(i=>e.includes(i))?null:B.createElement("track",{key:n.id,src:n.id,label:Array.isArray(t)?t[0]:t,srcLang:"en","data-testid":"player-track"})},qse=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],$se=({allSources:n,annotationResources:e,painting:t})=>{const[i,r]=B.useState(0),[s,a]=B.useState(),o=B.useRef(null),l=(t==null?void 0:t.type)==="Sound",u=si(),c=qt(),{activeCanvas:d,configOptions:h,contentStateAnnotation:p,vault:g}=c;return U.useEffect(()=>{if(!t.id||!o.current)return;if(o!=null&&o.current){const b=o.current;u({type:"updateActivePlayer",player:b}),b.src=t.id,b.load()}if(t.id.split(".").pop()!=="m3u8"&&t.format&&!qse.includes(t.format))return;const v={xhrSetup:function(b,T){b.withCredentials=!!h.withCredentials}},y=new Pn(v);return y.attachMedia(o.current),y.on(Pn.Events.MEDIA_ATTACHED,function(){y.loadSource(t.id)}),y.on(Pn.Events.ERROR,function(b,T){if(T.fatal)switch(T.type){case Pn.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${b} network error encountered, try to recover`),y.startLoad();break;case Pn.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${b} media error encountered, try to recover`),y.recoverMediaError();break;default:y.destroy();break}}),()=>{if(y&&o.current){const b=o.current;y.detachMedia(),y.destroy(),b.currentTime=0}}},[h.withCredentials,t.id,t.format,u]),U.useEffect(()=>{var v,y,b,T;const x=g.get(d),w=(v=x.accompanyingCanvas)!=null&&v.id?Qs(g,(y=x.accompanyingCanvas)==null?void 0:y.id):null,A=(b=x.placeholderCanvas)!=null&&b.id?Qs(g,(T=x.placeholderCanvas)==null?void 0:T.id):null;w&&A?a(i===0?A[0].id:w[0].id):(w&&a(w[0].id),A&&a(A[0].id))},[d,i,g]),U.useEffect(()=>{const v=o==null?void 0:o.current;if(!v)return;let y=null,b=!1;const T=()=>{b||(b=!0,y=setInterval(()=>{v&&!v.paused&&!v.ended&&(r(v.currentTime),u({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(v.currentTime)}}))},500)),v&&v.paused&&(r(v.currentTime),u({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(v.currentTime)}}))};return v.addEventListener("timeupdate",T),()=>{v==null||v.removeEventListener("timeupdate",T),y&&clearInterval(y)}},[t.id,d]),U.useEffect(()=>{var v,y;if(p){const b=o==null?void 0:o.current;if(!b)return;const T=(v=p==null?void 0:p.target)==null?void 0:v.selector,{type:x,t:w,value:A}=T||{};if((((y=p==null?void 0:p.target)==null?void 0:y.source)||(p==null?void 0:p.target)).id!==d)return;if(w&&x==="PointSelector"&&(r(w),b.currentTime=w),x==="FragmentSelector"&&A){const R=A.split("=")[1];if(!R)return;const _=R.split(",")[0];r(_),b.currentTime=_}}},[o,p]),B.createElement(Gse,{css:{backgroundColor:h.canvasBackgroundColor,maxHeight:h.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},B.createElement("video",{id:"clover-iiif-video",key:t.id,ref:o,"data-src":t.id,controls:!0,height:t.height,width:t.width,crossOrigin:h.crossOrigin,poster:s,style:{maxHeight:h.canvasHeight,position:"relative",zIndex:"1"}},n.map(v=>B.createElement("source",{src:v.id,type:v.format,key:v.id})),(e==null?void 0:e.length)>0&&e.map(v=>{const y=[];return v.items.forEach(b=>{g.get(b.id).body.forEach(T=>{const x=g.get(T.id);y.push(x)})}),y.map(b=>B.createElement(Wse,{resource:b,ignoreCaptionLabels:h.ignoreCaptionLabels||[],key:b.id}))}),"Sorry, your browser doesn't support embedded videos."),l&&B.createElement(Vse,{ref:o}))},Kse=()=>B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},B.createElement("title",{id:"close-svg-title"},"close"),B.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),Yse=({isMedia:n})=>B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},B.createElement("title",{id:"open-svg-title"},"open"),n?B.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):B.createElement(B.Fragment,null,B.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),B.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Xse=({handleToggle:n,isInteractive:e,isMedia:t})=>B.createElement(ID,{onClick:n,isInteractive:e,isMedia:t,"data-testid":"placeholder-toggle"},e?B.createElement(Kse,null):B.createElement(Yse,{isMedia:t})),Qse=({activeCanvas:n,annotationResources:e,contentSearchResource:t,isMedia:i,painting:r})=>{var s,a,o,l;const[u,c]=B.useState(0),[d,h]=B.useState(!1),[p,g]=B.useState([]),[v,y]=B.useState([]),[b,T]=B.useState(0),{configOptions:x,customDisplays:w,contentStateAnnotation:A,informationPanelResource:R,openSeadragonViewer:_,vault:D,viewerId:H,visibleCanvases:P}=qt(),[N,G]=B.useState([]),X=!!A&&n===((a=(s=A==null?void 0:A.target)==null?void 0:s.source)==null?void 0:a.id),te=si(),Q=D.get(n),ne=v.length&&!d&&!i,oe=(r==null?void 0:r.length)>1,Z=`${H}-${b3(n+u+JSON.stringify(P)+b)}`,se=()=>{h(!d),T(ve=>ve+1)},j=ve=>{const Le=r.findIndex(Ce=>Ce.id===ve);c(Le)},q=w.find(ve=>{var Le;let Ce=!1;const{canvasId:Ae,paintingFormat:ke}=ve.target;if(Array.isArray(Ae)&&Ae.length>0&&(Ce=Ae.includes(n)),Array.isArray(ke)&&ke.length>0){const je=((Le=r[u])==null?void 0:Le.format)||"";Ce=!!(je&&ke.includes(je))}return Ce});U.useEffect(()=>{X&&ne&&b===0&&se()},[X,ne]),U.useEffect(()=>{ne&&(te({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),te({type:"updateActiveSelector",selector:void 0}))},[ne]),U.useEffect(()=>{var ve,Le,Ce;const Ae=[];if(R==="manifest-annotations"&&(e==null||e.forEach((ke,je)=>{var We;(We=ke==null?void 0:ke.items)==null||We.forEach(de=>{const Re=D.get(de.id);Re&&Ae.push({annotation:{...Re,body:Re.body.map(Ie=>D.get(Ie.id)||Ie)},targetIndex:je})})}),A)){const ke=((ve=A==null?void 0:A.target)==null?void 0:ve.source)||(A==null?void 0:A.target);Ae.push({annotation:{...A,body:(Le=A==null?void 0:A.body)==null?void 0:Le.map(je=>D.get(je.id)||je)},targetIndex:P.findIndex(je=>je.id===ke.id)})}R==="manifest-content-search"&&((Ce=t==null?void 0:t.items)==null||Ce.forEach(ke=>{const je=D.get(ke.id);if(je){const We=P.findIndex(de=>de.id===je.target.source.id);typeof We=="number"&&Ae.push({annotation:{...je,body:je.body.map(de=>D.get(de.id)||de)},targetIndex:We})}})),G(Ae)},[e,t,A,R,P]),U.useEffect(()=>{if(!i){const ve=P.map(Ce=>{const Ae=Ce.id,ke=Qs(D,Ae);return ke?ke[u]:void 0}).filter(Boolean),Le=P.map(Ce=>{var Ae;const ke=Ce.id,je=D.get(ke),We=(Ae=je==null?void 0:je.placeholderCanvas)==null?void 0:Ae.id;return!We||!We?null:{id:We,label:je==null?void 0:je.label}}).filter(Ce=>Ce!==null);g(ve),y(Le)}},[u,n,P,i,Q]),U.useEffect(()=>{c(0)},[P]);const re=ve=>{ve&&!ne&&(_==null?void 0:_.id)!==`openseadragon-${Z}`&&te({type:"updateOpenSeadragonViewer",openSeadragonViewer:ve})},z=(o=q==null?void 0:q.display)==null?void 0:o.component;return B.createElement(hre,{className:"clover-viewer-painting"},B.createElement(pre,{style:{backgroundColor:x.canvasBackgroundColor,height:x.canvasHeight==="auto"?"100%":x.canvasHeight}},!!v.length&&!i&&B.createElement(Xse,{handleToggle:se,isInteractive:d,isMedia:i}),!!(v!=null&&v.length)&&!i&&B.createElement(zse,{isActive:!!ne,isMedia:i,items:v,setIsInteractive:h}),!ne&&!q&&(i?B.createElement($se,{allSources:r,painting:r[u],annotationResources:e}):r&&B.createElement(Hse,{_cloverViewerHasPlaceholder:!!(v!=null&&v.length),annotations:N,body:p,instanceId:Z,key:Z,openSeadragonCallback:re,openSeadragonConfig:x.openSeadragon})),!ne&&z&&B.createElement(z,{id:n,annotationBody:r[u],hooks:{useViewerDispatch:si,useViewerState:qt},...q==null?void 0:q.display.componentProps})),oe&&B.createElement(_D,{value:(l=r[u])==null?void 0:l.id,onValueChange:j,maxHeight:"200px"},r==null?void 0:r.map(ve=>B.createElement(LD,{value:ve==null?void 0:ve.id,key:ve==null?void 0:ve.id,label:ve==null?void 0:ve.label}))))},Zse=({activeCanvas:n,annotationResources:e,searchServiceUrl:t,setContentSearchResource:i,contentSearchResource:r,isAudioVideo:s,items:a,painting:o})=>{var l,u;const{contentStateAnnotation:c,isInformationOpen:d,configOptions:h,sequence:p,visibleCanvases:g}=qt(),{informationPanel:v}=h,y=g.map(w=>w.id),b=(e.length>0||y.includes((u=(l=c==null?void 0:c.target)==null?void 0:l.source)==null?void 0:u.id))&&(v==null?void 0:v.renderAnnotation)&&(v==null?void 0:v.renderToggle)===!1&&d,T=(v==null?void 0:v.renderAbout)&&d||b,x=v==null?void 0:v.renderToggle;return B.createElement(L3,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},B.createElement(P3,{"data-aside-active":T,"data-aside-toggle":x},B.createElement(Qse,{activeCanvas:n,annotationResources:e,contentSearchResource:r,isMedia:s,painting:o}),p[1].length>1&&B.createElement(Vte,{className:"clover-viewer-media-wrapper"},B.createElement(fre,{items:a,activeItem:0}))),T&&B.createElement(Gte,{"data-aside-active":T,"data-aside-toggle":x},B.createElement(eie,{activeCanvas:n,annotationResources:e,searchServiceUrl:t,setContentSearchResource:i,contentSearchResource:r})))},Jse=Ge(Za.Trigger,{width:"30px",padding:"5px"}),BD=Ge(Za.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),eae=Ge("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),tae=Ge("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${RD}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),nae=Ge("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),iae=()=>{var n;const e=si(),t=qt(),{activeManifest:i,collection:r,configOptions:s,vault:a}=t,o=s==null?void 0:s.canvasHeight,l=u=>{e({type:"updateActiveCanvas",canvasId:void 0}),e({type:"updateActiveManifest",manifestId:u}),e({type:"updateViewerId",viewerId:Ml()})};return B.createElement("div",{style:{margin:"0.75rem"}},B.createElement(_D,{label:r.label,maxHeight:o,value:i,onValueChange:l},(n=r==null?void 0:r.items)==null?void 0:n.map(u=>B.createElement(LD,{value:u.id,key:u.id,thumbnail:u!=null&&u.thumbnail?a.get(u==null?void 0:u.thumbnail):void 0,label:u.label}))))},rae=(n,e=2500)=>{const{t}=Zs(),[i,r]=U.useState(""),s=U.useCallback(()=>{navigator.clipboard.writeText(n).then(()=>r(t("copySuccess")),()=>r(t("copyFailure")))},[n]);return U.useEffect(()=>{if(!i)return;const a=setTimeout(()=>r(""),e);return()=>clearTimeout(a)},[i]),[i,s]},sae=Ge("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),aae=({status:n})=>n?B.createElement(sae,{"data-copy-status":n},n):null,KA=({textPrompt:n,textToCopy:e})=>{const[t,i]=rae(e);return B.createElement("button",{onClick:i},n," ",B.createElement(aae,{status:t}))},oae=({title:n})=>{const e="#ed1d33",t="#2873ab";return B.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},B.createElement("title",null,n),B.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},B.createElement("g",{transform:"scale(0.1)"},B.createElement("path",{style:{fill:t},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),B.createElement("path",{style:{fill:t},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),B.createElement("path",{style:{fill:e},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),B.createElement("path",{style:{fill:e},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),B.createElement("path",{style:{fill:t},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),B.createElement("path",{style:{fill:t},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),B.createElement("path",{style:{fill:e},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},uae=Ge(hee,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),lae=Ge(pee,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});Ge("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});const cae=Ge("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),dae=()=>{const{isInformationOpen:n}=qt(),e=si(),{t}=Zs(),i=r=>{e({type:"updateInformationOpen",isInformationOpen:r})};return B.createElement(cae,null,B.createElement(uae,{checked:n,onCheckedChange:i,id:"information-toggle","aria-label":t("informationPanelToggle"),name:"toggled?"},B.createElement(lae,null,B.createElement("span",null,"i"))))},fae=B.memo(dae),hae=Ge(Za.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),pae=Ge(BD,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function mae(n){const{vault:e}=qt();try{const t=n&&e.get(n);if(!t)throw new Error(`Vault entity ${n} not found.`);return(t==null?void 0:t["@id"])||(t==null?void 0:t.id)}catch(t){return console.error(t),n}}function YA(n,e){const t=[];if(!n)return t;for(const i of n)if(i.id){const r=e.get(i.id);r&&t.push(r)}return t}function gae(){const{activeCanvas:n,activeManifest:e,vault:t}=qt(),[i,r]=U.useState({root:[],canvas:[]});return U.useEffect(()=>{const s=t.get(e),a=t.get(n),o=s==null?void 0:s.rendering,l=a==null?void 0:a.rendering,u=YA(o,t),c=YA(l,t);r({root:u,canvas:c})},[n,e,t]),{...i}}function XA(n,e){return n.map(({format:t,id:i,label:r})=>{const s=mae(i);return{format:t,id:s,label:xi(r)||e}})}function vae(){const n=gae(),e=XA((n==null?void 0:n.root)||[],"Root Rendering Label"),t=XA((n==null?void 0:n.canvas)||[],"Canvas Rendering Label");return{allPages:e,individualPages:t}}const yae=()=>{const{allPages:n,individualPages:e}=vae(),t=n.length>0||e.length>0,i=r=>{window.open(r,"_blank")};return t?B.createElement(Za,null,B.createElement(hae,{"data-testid":"download-button"},B.createElement(Un,null,B.createElement(Un.Download,null))),B.createElement(pae,{"data-testid":"download-content"},e.length>0&&B.createElement(B.Fragment,null,B.createElement("h3",null,"Individual Pages"),B.createElement("ul",null,e.map(({format:r,id:s,label:a})=>B.createElement("li",{key:a},B.createElement("button",{onClick:()=>i(s)},a," (",r,")"))))),n.length>0&&B.createElement(B.Fragment,null,B.createElement("h3",null,"All Pages"),B.createElement("ul",null,n.map(({format:r,id:s,label:a})=>B.createElement("li",{key:a},B.createElement("button",{onClick:()=>i(s)},a," (",r,")"))))))):null},Eae=({manifestId:n,manifestLabel:e})=>{const t=qt(),{collection:i,configOptions:r}=t,{informationPanel:s,showDownload:a,showIIIFBadge:o,showTitle:l}=r,u=a||o||(s==null?void 0:s.renderToggle),{t:c}=Zs();return B.createElement(tae,{className:"clover-viewer-header"},i!=null&&i.items?B.createElement(iae,null):B.createElement(eae,{className:l?"":"visually-hidden"},l&&B.createElement(as,{label:e,className:"label"})),u&&B.createElement(nae,null,a&&B.createElement(yae,null),o&&B.createElement(Za,null,B.createElement(Jse,null,B.createElement(oae,{title:c("commonShare")})),B.createElement(BD,null,(i==null?void 0:i.items)&&B.createElement("button",{onClick:d=>{d.preventDefault(),window.open(i.id,"_blank")}},c("shareCollectionJson")),B.createElement("button",{onClick:d=>{d.preventDefault(),window.open(n,"_blank")}},c("shareManifestJson"))," ",(i==null?void 0:i.items)&&B.createElement(KA,{textPrompt:c("shareCollectionCopy"),textToCopy:i.id}),B.createElement(KA,{textPrompt:c("shareManifestCopy"),textToCopy:n}))),(s==null?void 0:s.renderToggle)&&B.createElement(fae,null)))},bae=n=>{const e=()=>window.matchMedia?window.matchMedia(n).matches:!1,[t,i]=U.useState(e);return U.useEffect(()=>{const r=()=>i(e);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)}),t},Tae=({manifest:n,theme:e,iiifContentSearchQuery:t})=>{var i;const r=qt(),s=si(),{activeCanvas:a,isInformationOpen:o,vault:l,configOptions:u,visibleCanvases:c}=r,d=["100%","auto"],h=(u==null?void 0:u.canvasHeight)&&d.includes(u==null?void 0:u.canvasHeight),[p,g]=U.useState(!1),[v,y]=U.useState([]),[b,T]=U.useState([]),[x,w]=U.useState(),A=bae(R3.sm),[R,_]=U.useState(),D=U.useCallback(P=>{s({type:"updateInformationOpen",isInformationOpen:P})},[s]);U.useEffect(()=>{var P;(P=u==null?void 0:u.informationPanel)!=null&&P.open&&D(!A)},[A,(i=u==null?void 0:u.informationPanel)==null?void 0:i.open]),U.useEffect(()=>{},[A]),U.useEffect(()=>{const P=Qs(l,a);P&&(g(["Sound","Video"].indexOf(P[0].type)>-1),y(P));const N=zM(l,n,a);s({type:"updateVisibleCanvases",visibleCanvases:N})},[a,A,n,l,s]),U.useEffect(()=>{(async()=>{const P=await Promise.all(c.map(N=>Bte(l,N.id)));T(P.flat())})()},[c]);const H=n.service.some(P=>["SearchService1","SearchService2"].includes(P.type||P["@type"]));return U.useEffect(()=>{if(H){const P=n.service.find(N=>["SearchService1","SearchService2"].includes(N.type||N["@type"]));P&&_(P.id||P["@id"])}},[n,H]),U.useEffect(()=>{var P;R&&((P=u.informationPanel)==null?void 0:P.renderContentSearch)!==!1&&C3(l,R,t).then(N=>w(N))},[R]),B.createElement(py,{FallbackComponent:F1},B.createElement(Wte,{className:`${e} clover-viewer`,css:{background:u==null?void 0:u.background},"data-absolute-position":h,"data-information-panel-open":o},B.createElement(l8,{open:o,onOpenChange:D},B.createElement(Eae,{manifestLabel:n.label,manifestId:n.id}),B.createElement(Zse,{activeCanvas:a,painting:v,annotationResources:b,searchServiceUrl:R,setContentSearchResource:w,contentSearchResource:x,items:n.items,isAudioVideo:p}))))},QA={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function xae(n){return{ok:n.status>=200&&n.status<300,status:n.status,statusText:n.statusText,headers:n.getAllResponseHeaders(),data:n.responseText,json:()=>JSON.parse(n.responseText)}}function ZA(n,e=null){return{ok:!1,status:n.status,statusText:n.statusText,headers:n.getAllResponseHeaders(),data:e||n.statusText,json:()=>JSON.parse(e||n.statusText)}}function Sae(n,e=QA){const t=e.headers||QA.headers;return new Promise((i,r)=>{const s=new XMLHttpRequest;s.open("get",n),s.withCredentials=e.withCredentials,t&&Object.keys(t).forEach(a=>s.setRequestHeader(a,t[a])),s.onload=()=>{i(xae(s))},s.onerror=()=>{r(ZA(s,"Failed to make request."))},s.ontimeout=()=>{r(ZA(s,"Request took longer than expected."))},s.send()})}const JA={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},wae=({canvasIdCallback:n,contentStateCallback:e,customDisplays:t=[],plugins:i=[],customTheme:r,iiifContent:s,id:a,manifestId:o,options:l,iiifContentSearchQuery:u})=>{var c,d,h;let p=s;a&&(p=a),o&&(p=o);const g=S3((d=(c=l==null?void 0:l.informationPanel)==null?void 0:c.vtt)==null?void 0:d.autoScroll);return B.createElement(Fte,{initialState:{...Hh,customDisplays:t,plugins:i,isAutoScrollEnabled:g.enabled,isInformationOpen:!!((h=l==null?void 0:l.informationPanel)!=null&&h.open),vault:new v3({customFetcher:v=>Sae(v,{withCredentials:l==null?void 0:l.withCredentials,headers:l==null?void 0:l.requestHeaders}).then(y=>JSON.parse(y.data))})}},B.createElement(Aae,{iiifContent:p,canvasIdCallback:n,contentStateCallback:e,customTheme:r,options:l,iiifContentSearchQuery:u}))},Aae=({canvasIdCallback:n,contentStateCallback:e,customTheme:t,iiifContent:i,options:r,iiifContentSearchQuery:s})=>{const a=si(),o=qt(),{activeCanvas:l,activeManifest:u,activeSelector:c,isLoaded:d,vault:h,visibleCanvases:p}=o,[g,v]=U.useState(),[y,b]=U.useState();let T={};if(t&&(T=H8("custom",t)),U.useEffect(()=>{a({type:"updateActiveSelector",selector:void 0})},[l,u]),U.useEffect(()=>{var x;if(n&&n(l),e&&u&&l){const w=((x=p[0])==null?void 0:x.id)||l,A=`${u}/state/${b3(w+JSON.stringify(c))}`,R={...JA,id:A,target:{type:"SpecificResource",source:{id:w,type:"Canvas",partOf:[{id:u,type:"Manifest"}]},selector:c}};e({json:R,encoded:BM(JSON.stringify(R))})}},[l,u,c,n,e,p]),U.useEffect(()=>{u&&h.load(u).then(x=>{if(!x)return;b(x);const w=NC(h,x),A=l||wse(x);a({type:"updateActiveCanvas",canvasId:A}),a({type:"updateManifestSequence",sequence:w})}).catch(x=>{console.error(`Manifest failed to load: ${x}`)}).finally(()=>{a({type:"updateIsLoaded",isLoaded:!0})})},[i,u,a,h]),U.useEffect(()=>{a({type:"updateConfigOptions",configOptions:r}),(async()=>{var x;if(!i)return;const w=Sse(i);try{const A=typeof w=="object"&&w!=null&&w.id?await h.loadSync(w==null?void 0:w.id,w):await h.load(w);v(A)}catch(A){if((!w||!w.id)&&console.error(`Failed to load resource: ${A}`),w!=null&&w.id&&(w==null?void 0:w.type)==="Annotation"&&(x=w==null?void 0:w.motivation)!=null&&x.includes("contentState")){const R=await h.loadSync(w.id,w);R&&v(R)}else w!=null&&w.id&&["Canvas","Manifest"].includes(w==null?void 0:w.type)&&await h.loadSync(w.id,w)&&v({...JA,target:w})}})()},[a,i,r,h]),U.useEffect(()=>{if(g)switch(g.type){case"Annotation":if(g!=null&&g.motivation&&(Array.isArray(g==null?void 0:g.motivation)?g!=null&&g.motivation.includes("contentState"):(g==null?void 0:g.motivation)==="content-state")){const{active:w}=MD(g);a({type:"updateActiveManifest",manifestId:w.manifest}),a({type:"updateActiveCanvas",canvasId:w.canvas}),a({type:"updateContentStateAnnotation",contentStateAnnotation:g})}break;case"Collection":const x=Ase(g);a({type:"updateCollection",collection:g}),x&&a({type:"updateActiveManifest",manifestId:x});break;case"Manifest":a({type:"updateActiveManifest",manifestId:g.id});break}},[a,i,g]),!d)if(r!=null&&r.customLoadingComponent){const x=r.customLoadingComponent;return B.createElement(x,null)}else return B.createElement(B.Fragment,null,"Loading");return!y||!y.items?(console.log(`The IIIF manifest ${i} failed to load.`),B.createElement(B.Fragment,null)):y.items.length===0?(console.log(`The IIIF manifest ${i} does not contain canvases.`),B.createElement(B.Fragment,null)):B.createElement(Tae,{manifest:y,theme:T,key:y.id,iiifContentSearchQuery:s})};function Cae(){return be.jsx(be.Fragment,{children:be.jsx("div",{children:be.jsx(wae,{iiifContent:"/sample/manifest.json",options:{canvasHeight:"auto"}})})})}jN.createRoot(document.getElementById("root")).render(be.jsx(U.StrictMode,{children:be.jsx(Cae,{})}));
